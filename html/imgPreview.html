<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片查看</title>
  <link rel="stylesheet" href="./css/reset.css">
  <link rel="stylesheet" href="./css/viewer.css">
  <link rel="stylesheet" href="./css/vue-button-new.css">
  <link rel="stylesheet" href="./css/imgPreview.css">
</head>

<body style="background-color: #25282E;">
  <div id="app">
    <div class="videoCk">
      <header>
        <div class="left">
            <i class="red close"></i>
            <i class="yellow minimize"></i>
            <i class="green full-screen"></i>
            <i class="green exit-full-screen"></i>
        </div>
        <div class="right">
            <i class="minimize"></i>
            <i class="full-screen"></i>
            <i class="exit-full-screen"></i>
            <i class="close redAct"></i>
        </div>
    </header>
      <div id="videoCk"></div>
    </div>
    <div class="prevNext prev" @click="prev()">
      <i class="prevNextIcon"></i>
    </div>
    <div class="prevNext next" @click="next()">
      <i class="prevNextIcon"></i>
    </div>
    <!--预览控制栏-->
    <div class="worksviewBtnWrap">
      <div @click="viewZoomOut" class="viewBtn" id="viewZoomOut"><i></i>
        <div class="bubble">缩小</div>
      </div>
      <div @click="viewZoomIn" class="viewBtn" id="viewZoomIn"><i></i>
        <div class="bubble">放大</div>
      </div>
      <div @click="recover" class="viewBtn" id="recover"><i></i>
        <div class="bubble">复原</div>
      </div>
      <div @click="viewFlip" class="viewBtn" id="viewFlip"><i></i>
        <div class="bubble">翻转</div>
      </div>
      <div @click="viewDownload(0)" class="viewBtn" id="viewDownload"><i></i>
        <div class="bubble">下载</div>
      </div>
      <div class="viewSplit"></div>
    </div>
  </div>
  <script src="./js/imgPreview/2.6.14.js"></script>
  <script src="./js/imgPreview/viewer.js"></script>
  <script src="./js/imgPreview/v-viewer.js"></script>
  <script src="./js/imgPreview.js"></script>
  <script src="./js/jquery-3.5.1.min.js"></script>
  <script>
    let isInit = false;
    let prevDom = document.querySelector('.prev > .prevNextIcon');
    let nextDom = document.querySelector('.next > .prevNextIcon');
    
    window.RendererProcessHelper.registeCallback("updateShowImgUrl", args => {
      console.log("updateShowImgUrl", args.index, args.urls);
      if (args.index == 0) {
          prevDom.style.display = "none";
      } else {
          prevDom.style.display = "flex";
      }
      if (args.index == args.urls.length-1) {
          nextDom.style.display = "none";
      } else {
          nextDom.style.display = "flex";
      }
      app.setImgUrl(args.urls);
      app.goto(args.index);
    })
    
    window.RendererProcessHelper.registeCallback("pageLoadFinish", args => {
      if (isInit) {
        return;
      }
      isInit = true;
      console.log("loadFinish", args.index, args.urls);

      if (args.index == 0) {
          prevDom.style.display = "none";
      } else {
          prevDom.style.display = "flex";
      }
      if (args.index == args.urls.length-1) {
          nextDom.style.display = "none";
      } else {
          nextDom.style.display = "flex";
      }
      // args.width = args.width + "px";
      // args.height = args.height + "px";
      // app.setImgUrl("https://upload-images.jianshu.io/upload_images/5809200-a99419bb94924e6d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240");
      app.setImgUrl(args.urls);
      app.goto(args.index);

      if (window.RendererProcessHelper.getPlatform() == "darwin") {
        $(".right").hide()
        $(".left").show()
      } else {
        $(".right").show()
        $(".left").hide()
      }
      $(".exit-full-screen").hide();
      $(".close").click(() => {
          window.close();
      })
      $(".minimize").click(() => {
          window.RendererProcessHelper.minBtnForWindowFunction();
      })
      $(".full-screen").click(() => {
          window.RendererProcessHelper.maxBtnForWindowFunction();
          $(".full-screen").hide();
          $(".exit-full-screen").show();
      })
      $(".exit-full-screen").click(() => {
          window.RendererProcessHelper.unMaxBtnForWindowFunction();
          $(".exit-full-screen").hide();
          $(".full-screen").show();
      })
    })
    window.RendererProcessHelper.registeCallback("maximize", () => {
      $(".full-screen").hide();
      $(".exit-full-screen").show();
    })
    window.RendererProcessHelper.registeCallback("unmaximize", () => {
      $(".exit-full-screen").hide();
      $(".full-screen").show();
    })

    window.RendererProcessHelper.registeCallback("newImageOpened", args => {
      if (args.index >= args.urls.length) {
        return;
      }
      //关闭相同url图片窗口
      if (args.urls[args.index] == getImgUrl()) {
        window.close();
      }
    })

    function minimize(e) {
      //   e.stopPropagation();
      window.RendererProcessHelper.minBtnForWindowFunction()

    }
    function maximize(e) {
      // e.stopPropagation();
      window.RendererProcessHelper.maxBtnForWindowFunction()
      document.querySelector(".maximize").style.display = 'none';
      document.querySelector(".maximize-recover").style.display = 'inline-block';
    }
    function maximizeRecover(e) {
      window.RendererProcessHelper.unMaxBtnForWindowFunction();
      document.querySelector(".maximize-recover").style.display = 'none';
      document.querySelector(".maximize").style.display = 'inline-block';
    }

    function closeWindow(e) {
      // e.stopPropagation();
      window.RendererProcessHelper.closeBtnForWindowFunction();
    }

    function getImgUrl() {
      const dom = document.getElementsByClassName('viewer-canvas')[0];
      if (dom) {
        return dom.firstChild.src;
      }
    }
    document.addEventListener('keydown', function(event) {
      if (event.key === "Escape") {
        window.close()
      }
    });
  </script>
</body>

</html>