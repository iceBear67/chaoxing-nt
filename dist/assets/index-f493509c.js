import{a as C,u as T,s as U,c as g,o as F,b as D,e as w,J as H,f as R,h as i,m as I,y as N,j as h,_ as P,l as q,q as A}from"./index-26603ea5.js";import{c as v,T as V}from"./index-b0b4f58c.js";import{M as W}from"./index-51260f4b.js";import{M as z,ab as E}from"./message-4d42f580.js";import{B as K}from"./index-94663b0f.js";import{u as L}from"./index-46519fef.js";import{_ as O}from"./lodash-4dfbea43.js";import"./base-82955267.js";import"./msg-render-self.vue_vue_type_style_index_1_lang-eac93c38.js";/* empty css                    */import"./time-f90370a8.js";import"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";/* empty css                                                              *//* empty css                     */import"./forward-bb18e89e.js";import"./el-input-983a785f.js";import"./el-popper-548470bb.js";/* empty css                                                              *//* empty css                                                              */import{M as j}from"./index-403401b5.js";/* empty css                   *//* empty css                                                              */import"./index-ab028c07.js";import"./_commonjsHelpers-de833af9.js";import"./message-fe5b63d1.js";import"./validate-f7672251.js";import"./createAttachment-a64a5f42.js";import"./dayjs.min-d6672770.js";import"./index-9c66cebd.js";import"./index-952b158c.js";import"./icon-803f5cc0.js";import"./index-15f48857.js";import"./_baseGet-ad9634b7.js";import"./event-9519ab40.js";import"./index-e5f0a9f0.js";import"./use-form-common-props-325f2441.js";import"./index-08289d2b.js";import"./constants-84857360.js";import"./aria-60e0cdc6.js";import"./typescript-defaf979.js";import"./index-12f9ba11.js";import"./index-57013d5d.js";const J=["src"],$=C({__name:"index",setup(G){const u=K("cxofficial"),{t:x}=T(),r=z(),{subscribesUrl:a,chatTargetId:n,subscribesConversations:d,getCxofficialConversation:y}=U(r),l=g(()=>{if(n.value==-6)return x("message.cxofficial");{const e=d.value.find(o=>o.conversationKey==n.value);return(e==null?void 0:e.name)||""}}),m=g(()=>n.value==-6?y.value:d.value.find(o=>o.conversationKey==n.value));let c=null;const M=O.debounce(async e=>{var f,_;e.preventDefault();let o="";const s=a.value.match(/\/subscribe\/([^/?#]+)/);if(s&&s[1])o=s[1];else{console.log("未找到 subscribe/ 后面的字符串");return}const t=await window.MainWindowHelper.genRequest({baseUrl:"https://appswh.chaoxing.com",url:"/apis/subscribe/getSubscribeInfo",getParams:{idcard:o,puid:r.puid},postParams:{},tokenSign:!0});console.log(t),t.result==1&&(c=(f=t==null?void 0:t.data)==null?void 0:f.subscribe),document.body.click();const b=[[{name:"推荐给朋友",handler:()=>{S(),p()}}]];t!=null&&t.data&&((_=t.data)!=null&&_.isFans)&&b[0].push({name:"不再关注",handler:()=>{k(),p()}});const{destroy:p}=v(j,{menuList:b,left:e==null?void 0:e.x,top:42,itemHoverColor:"#F0F6FF",bottomBorder:!1});L.windowClickOnce(p)},200,{leading:!0}),S=()=>{var o,s;const e={att_web:{content:(c==null?void 0:c.remark)||((o=m.value)==null?void 0:o.subtitle),logo:(s=m.value)==null?void 0:s.logo,title:l.value,url:a.value,showContent:1},attachmentType:25};console.log(e,m.value),E(e)},k=()=>{const{destroy:e}=v(W,{title:"提示",content:`不再关注“${l.value}”，你将不再收到其下发的消息`,cancelBtn:{text:"仍然关注",callback(){e()}},confirmBtn:{text:"不再关注",async callback(){let o="";const s=a.value.match(/\/subscribe\/([^/?#]+)/);if(s&&s[1])o=s[1];else{console.log("未找到 subscribe/ 后面的字符串");return}const t=await window.MainWindowHelper.genRequest({baseUrl:"https://appswh.chaoxing.com",url:"/apis/subscribe/addOrCancelSubscribeFans",getParams:{status:0,idcard:o,puid:r.puid},postParams:{},tokenSign:!0});console.log(t),t.result==1?r.setSubscribesUrl(a.value+"?t="+Date.now()):V({content:(t==null?void 0:t.msg)||(t==null?void 0:t.errorMsg)||"删除失败",zIndex:2024,duration:2e3}),e()}}})};F(()=>{B()});async function B(){const e=await window.RendererHelper.getTempStore("message_subscribesUrl");e&&(r.setSubscribesUrl(e+"?t="+Date.now()),a.value=r.subscribesUrl,window.RendererHelper.setTempStore("message_subscribesUrl",""))}return(e,o)=>{const s=P;return q(),D("div",{class:h(i(u).b())},[w("div",{class:h(i(u).e("header"))},[H(R(i(l))+" ",1),I(s,{"icon-class":"menu",style:{cursor:"pointer"},width:"20px",height:"20px",color:"#8A8B99",onClick:N(i(M),["stop"])},null,8,["onClick"])],2),w("iframe",{src:i(a),target:"_blank",allowpopups:"",class:"my_scrollbar"},`\r
    `,8,J)],2)}}});const Ae=A($,[["__scopeId","data-v-1d162d70"]]);export{Ae as default};
