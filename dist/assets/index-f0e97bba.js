import{a as D,r as l,c as N,o as j,n as U,i as h,I as _,M as V,l as i,e as p,j as z,m as M,b as E,g as J,h as n,F as P,y as $,f as K,_ as Q,z as W,A as Y,q as Z}from"./index-26603ea5.js";import"./base-82955267.js";/* empty css                     */import{c as ee,M as a}from"./message-fe5b63d1.js";import{aS as I}from"./message-4d42f580.js";import{f as te,h as oe}from"./msg-render-self-a4c45e18.js";import{D as se}from"./index-d3d722e6.js";import{l as ne}from"./lodash-4dfbea43.js";import{u as x}from"./index-46519fef.js";import{E as re}from"./index-853a0f6e.js";import"./_commonjsHelpers-de833af9.js";import"./validate-f7672251.js";import"./index-b0b4f58c.js";import"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";import"./index-94663b0f.js";import"./forward-bb18e89e.js";import"./index-9c66cebd.js";import"./el-input-983a785f.js";import"./index-952b158c.js";import"./icon-803f5cc0.js";import"./typescript-defaf979.js";import"./index-15f48857.js";import"./_baseGet-ad9634b7.js";import"./event-9519ab40.js";import"./use-form-common-props-325f2441.js";import"./index-08289d2b.js";import"./constants-84857360.js";import"./index-12f9ba11.js";import"./aria-60e0cdc6.js";import"./index-e5f0a9f0.js";import"./el-popper-548470bb.js";import"./index-57013d5d.js";import"./createAttachment-a64a5f42.js";import"./msg-render-self.vue_vue_type_style_index_1_lang-eac93c38.js";/* empty css                    */import"./avatar-d72faaaf.js";import"./time-f90370a8.js";import"./dayjs.min-d6672770.js";import"./avatar-13472c92.js";import"./index-ab028c07.js";/* empty css                                                              */import"./emoji-f1b6b027.js";import"./index-3e12c228.js";import"./isEqual-c46d625c.js";import"./_Uint8Array-24db2bd7.js";import"./index-f81182f6.js";import"./token-dd454517.js";import"./image-e958eb32.js";import"./use-global-config-c67545e0.js";import"./index-7e6c4fb9.js";import"./vnode-45baa450.js";/* empty css                   *//* empty css                                                              */const ae=u=>(W("data-v-9ba18887"),u=u(),Y(),u),ce=["id"],le=ae(()=>p("div",{class:"dash-line"},null,-1)),ie=["onClick"],pe={class:"quick-select-text"},ue=D({__name:"index",setup(u){const y=l(!0),d=l([]),m=l(""),f=l({}),r=l([]),k=l(),g=l();function R(){var t,o,s;(s=g.value)==null||s.setScrollTop(((o=(t=g.value)==null?void 0:t.wrapRef)==null?void 0:o.scrollHeight)??0)}const w=l({});let v=null;const A=Date.now();function b(t){var o;return I(t.from,m.value)?(o=f.value)==null?void 0:o.name:(t==null?void 0:t.sendName)??""}const B=N(()=>x.getLocalUserAvatar({puid:f.value.puid}));function H(t){var s;const o=(s=w.value[t.from])==null?void 0:s.puid;return o?x.getLocalUserAvatar({puid:o,timeStamp:A}):""}j(()=>{window.RendererHelper.getUser().then(t=>{m.value=String(t.uid),f.value=t}),window.RendererHelper.getTempStore("checkMsgIds").then(t=>{r.value=t??[]}),window.RendererHelper.getTempStore("chatHistoryList").then(t=>{d.value=t.map(o=>ee(o.msgbody)).sort((o,s)=>o.time-s.time),U(()=>{R()})}),window.RendererHelper.getTempStore("currentGroupMemberObject").then(t=>{w.value=t})});function T({val:t,source:o}){console.log(t,o),t?r.value.push(o.id):ne.remove(r.value,s=>s===o.id)}function G(){r.value=[]}function X(){const t=k.value,o=document.querySelectorAll(".message");v=null,F(t,o)}function q(t){var c;const o=t.id,s=(c=d.value.find(e=>e.id===o))==null?void 0:c.time;s&&(r.value=d.value.filter(e=>e.time>=s).map(e=>e.id))}function F(t,o){const s=new IntersectionObserver(c=>{c.forEach(e=>{if(e.isIntersecting)return s.disconnect(),v===null&&(v=e.target,q(e.target)),e.target})},{root:t,threshold:.9});o.forEach(c=>{s.observe(c)})}function L(){y.value=!1,window.close()}function O(){window.RendererHelper.setTempStore("checkMsgIds",V(r.value)),window.close()}return(t,o)=>{const s=re,c=Q;return i(),h(se,{title:"选择聊天记录",visible:y.value,options:{"close-on-click-modal":!1},width:640,onClose:L,onConfirm:O},{cancelBtn:_(()=>[p("span",{class:z(["cancel-btn",{disabled:r.value.length<1}]),onClick:G},"取消选中",2)]),default:_(()=>[p("div",{class:"check-messages",ref_key:"containerRef",ref:k},[M(s,{ref_key:"scrollbarRef",ref:g},{default:_(()=>[(i(!0),E(P,null,J(d.value,e=>{var S,C;return i(),E("div",{class:"message",id:e.id,key:(e==null?void 0:e.time)+(e==null?void 0:e.from)},[n(I)(e.from,m.value)?(i(),h(te,{key:0,source:e,"is-only-read":!0,"msg-type":e.type,isMultipleChoice:"",contents:e.type===n(a).TEXT?e==null?void 0:e.msg:"",attachment:e.type===n(a).TEXT?(S=e==null?void 0:e.ext)==null?void 0:S.attachment:void 0,"sent-time":e.time,name:b(e),defaultContent:e.type!==n(a).TEXT&&e.type!==n(a).IMAGE,imgs:e.type===n(a).IMAGE?e:{},onChange:T,"check-msg-ids":r.value,avatar:n(B)},null,8,["source","msg-type","contents","attachment","sent-time","name","defaultContent","imgs","check-msg-ids","avatar"])):(i(),h(oe,{key:1,source:e,"is-only-read":!0,isMultipleChoice:"","msg-type":e.type,contents:e.type===n(a).TEXT?e==null?void 0:e.msg:"","sent-time":e.time,attachment:e.type===n(a).TEXT?(C=e==null?void 0:e.ext)==null?void 0:C.attachment:void 0,name:b(e),defaultContent:e.type!==n(a).TEXT&&e.type!==n(a).IMAGE,imgs:e.type===n(a).IMAGE?e:{},onChange:T,"check-msg-ids":r.value,avatar:H(e)},null,8,["source","msg-type","contents","sent-time","attachment","name","defaultContent","imgs","check-msg-ids","avatar"]))],8,ce)}),128))]),_:1},512),le,p("div",{class:"quick-select",onClick:$(X,["stop"])},[M(c,{"icon-class":"arrow-down2",width:"14",height:"14",color:"#3A8BFF"}),p("span",pe,K(`选择以下消息 (已选${r.value.length}条)`),1)],8,ie)],512)]),_:1},8,["visible"])}}});const ut=Z(ue,[["__scopeId","data-v-9ba18887"]]);export{ut as default};
