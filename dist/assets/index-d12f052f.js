var jt=Object.defineProperty;var Kt=(i,t,e)=>t in i?jt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var u=(i,t,e)=>(Kt(i,typeof t!="symbol"?t+"":t,e),e);import{aA as Jt,aB as Qt}from"./message-4d42f580.js";import{F as Zt}from"./forward-bb18e89e.js";import{n as te,a as ee,o as ie,b as se,l as ne}from"./index-26603ea5.js";import"./index-46519fef.js";import"./_commonjsHelpers-de833af9.js";import"./lodash-4dfbea43.js";import"./message-fe5b63d1.js";import"./validate-f7672251.js";import"./index-b0b4f58c.js";import"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";import"./index-94663b0f.js";import"./base-82955267.js";import"./el-input-983a785f.js";import"./index-9c66cebd.js";import"./index-952b158c.js";import"./icon-803f5cc0.js";import"./typescript-defaf979.js";import"./index-15f48857.js";import"./_baseGet-ad9634b7.js";import"./event-9519ab40.js";import"./use-form-common-props-325f2441.js";import"./index-08289d2b.js";import"./constants-84857360.js";import"./index-12f9ba11.js";import"./aria-60e0cdc6.js";import"./el-popper-548470bb.js";import"./index-57013d5d.js";import"./createAttachment-a64a5f42.js";import"./index-e5f0a9f0.js";const oe=[{id:1,title:"square"},{id:2,title:"round"},{id:3,title:"right-top"},{id:4,title:"brush"},{id:5,title:"mosaicPen"},{id:6,title:"text"},{id:12,title:"pin"},{id:15,title:"get-text"},{id:7,title:"separateLine"},{id:8,title:"undo"},{id:14,title:"share"},{id:9,title:"save"},{id:10,title:"close"},{id:11,title:"confirm"}];function re(i,t){let e=ae(t);const s=(i.path||i.composedPath&&i.composedPath())[1].children;for(let o=0;o<s.length;o++){const r=s[o];r.className.includes("active")&&r.classList.remove(r.classList[2])}i.target.className+=" "+e}function ae(i){let t="";switch(i){case 1:t="square-active";break;case 2:t="round-active";break;case 3:t="right-top-active";break;case 4:t="brush-active";break;case 5:t="mosaicPen-active";break;case 6:t="text-active"}return t}function le(i){switch(i){case 1:return 24-8;case 2:return 24*2+8;case 3:return 24*4-6;case 4:return 24*5+8;case 5:return 24*7+6;case 6:return 24*9-6;default:return 0}}function Mt(i,t,e,n,s,o,r,l){const{startX:d,startY:c,width:h,height:a}=l;r.save(),r.beginPath(),r.rect(d,c,h,a),r.clip(),r.strokeStyle=s,r.lineWidth=o,r.beginPath(),r.rect(i,t,e,n),r.stroke(),r.restore()}let ht=!0,ct=null,tt=!0,dt=0,ut=0,gt=!1,ft=null;const _={r:0,g:0,b:0,a:.5};let mt=!0,pt=null,wt=null,Ct=0;class D{constructor(){tt&&(ht=!0,dt=0,ut=0,gt=!0,mt=!0,ct=null,wt=null,tt=!1,ft=null,pt=null,Ct=1)}getScreenIndex(){return Ct}setScreenIndex(t){Ct=t}setInitStatus(t){tt=t}getInitStatus(){return tt}getWebRtcStatus(){return ht}setWebRtcStatus(t){ht=t}setScreenShotDom(t){ft=t}getScreenShotDom(){return ft}getScreenFlow(){return ct}setScreenFlow(t){ct=t}getWindowList(){return wt}settWindowList(t){wt=t}getCanvasSize(){return{canvasWidth:dt,canvasHeight:ut}}setCanvasSize(t,e){dt=t,ut=e}getShowScreenDataStatus(){return gt}setShowScreenDataStatus(t){gt=t}setMaskColor(t){_.r=t.r,_.g=t.g,_.b=t.b,_.a=t.a}getMaskColor(){return _}setWriteImgState(t){mt=t}getWriteImgState(){return mt}setSaveCallback(t){pt=t}getSaveCallback(){return pt}}function W(i,t,e,n,s,o,r,l,d=!1){const c=r==null?void 0:r.width,h=r==null?void 0:r.height,a=window.devicePixelRatio||1,g=new D;if(!c||!h||!l||!r)return;if(s.clearRect(0,0,c,h),s.save(),s.fillStyle="rgba(0, 0, 0, .3)",s.fillRect(0,0,c,h),s.globalCompositeOperation="source-atop",!d){s.clearRect(i,t,e,n),s.globalCompositeOperation="source-over";const p=2;s.beginPath(),s.strokeStyle="#3A8BFF",s.lineWidth=2,s.strokeRect(i,t,e,n),s.stroke(),s.lineWidth=2,s.beginPath(),s.arc(i,t,p,0,2*Math.PI,!1),s.fillStyle="#fff",s.fill(),s.stroke(),s.beginPath(),s.arc(i+e/2,t,p,0,2*Math.PI,!1),s.fill(),s.stroke(),s.beginPath(),s.arc(i+e,t,p,0,2*Math.PI,!1),s.fill(),s.stroke(),s.beginPath(),s.arc(i+e,t+n/2,p,0,2*Math.PI,!1),s.fill(),s.stroke(),s.beginPath(),s.arc(i+e,t+n,p,0,2*Math.PI,!1),s.fill(),s.stroke(),s.beginPath(),s.arc(i+e/2,t+n,p,0,2*Math.PI,!1),s.fill(),s.stroke(),s.beginPath(),s.arc(i,t+n,p,0,2*Math.PI,!1),s.fill(),s.stroke(),s.beginPath(),s.arc(i,t+n/2,p,0,2*Math.PI,!1),s.fill(),s.stroke()}s.restore(),s.save(),s.globalCompositeOperation="destination-over";let{imgWidth:w,imgHeight:f}={imgWidth:parseInt(r==null?void 0:r.style.width),imgHeight:parseInt(r==null?void 0:r.style.height)};const m=g.getScreenShotDom();return m!=null&&(w=m.clientWidth,f=m.clientHeight),!g.getWebRtcStatus()&&m==null&&(w=l.width/a,f=l.height/a),s.drawImage(l,0,0,w,f),s.restore(),{startX:Math.min(i,i+e),startY:Math.min(t,t+n),width:Math.abs(e),height:Math.abs(n)}}function Lt(i,t,e,n,s,o,r,l){const d=t<n?t:n,c=e<s?e:s,h=t>=n?t:n,a=e>=s?e:s,g=(h-d)*.5,w=(a-c)*.5,f=d+g,m=c+w,{startX:p,startY:y,width:x,height:B}=l;if(i.save(),i.beginPath(),i.rect(p,y,x,B),i.clip(),i.beginPath(),i.lineWidth=o,i.strokeStyle=r,typeof i.ellipse=="function")i.ellipse(f,m,g,w,0,0,2*Math.PI);else throw"你的浏览器不支持ellipse，无法绘制椭圆";i.stroke(),i.closePath(),i.restore()}class Gt{constructor(){u(this,"beginPoint",{x:0,y:0});u(this,"stopPoint",{x:0,y:0});u(this,"polygonVertex",[]);u(this,"angle",0);u(this,"arrowInfo",{edgeLen:10,angle:10});u(this,"arrowWidth",1)}draw(t,e,n,s,o,r,l,d){e=e,n=n,s=s,o=o,r==3?r=2:r==5?r=3:r=1,r=r,this.beginPoint.x=e,this.beginPoint.y=n,this.stopPoint.x=s,this.stopPoint.y=o,this.arrowWidth=r,this.arrowCord(this.beginPoint,this.stopPoint),this.sideCord(),this.drawArrow(t,l,r,d)}drawArrow(t,e,n,s){const{startX:o,startY:r,width:l,height:d}=s;t.fillStyle=e,t.lineWidth=n,t.save(),t.beginPath(),t.rect(o,r,l,d),t.clip(),t.beginPath(),t.moveTo(this.polygonVertex[0],this.polygonVertex[1]),t.lineTo(this.polygonVertex[2],this.polygonVertex[3]),t.lineTo(this.polygonVertex[4],this.polygonVertex[5]),t.lineTo(this.polygonVertex[6],this.polygonVertex[7]),t.lineTo(this.polygonVertex[8],this.polygonVertex[9]),t.lineTo(this.polygonVertex[10],this.polygonVertex[11]),t.closePath(),t.fill()}setArrowInfo(t,e){this.arrowInfo.edgeLen=t,this.arrowInfo.angle=e}dynArrowSize(){const t=this.stopPoint.x-this.beginPoint.x,e=this.stopPoint.y-this.beginPoint.y,n=Math.sqrt(t**2+e**2);n<50?this.arrowInfo.edgeLen=n/2:n<250?this.arrowInfo.edgeLen/=2:n<500&&(this.arrowInfo.edgeLen=this.arrowInfo.edgeLen*n/500),console.log("this.arrowInfo.edgeLen",this.arrowInfo.edgeLen)}getRadian(t,e){this.angle=Math.atan2(e.y-t.y,e.x-t.x)/Math.PI*180,this.arrowWidth==1?this.setArrowInfo(25,25):this.arrowWidth==2?this.setArrowInfo(30,25):this.arrowWidth==3&&this.setArrowInfo(35,25),this.dynArrowSize()}arrowCord(t,e){this.polygonVertex[0]=t.x,this.polygonVertex[1]=t.y,this.polygonVertex[6]=e.x,this.polygonVertex[7]=e.y,this.getRadian(t,e);let n=0;this.arrowWidth==1?n=this.arrowInfo.edgeLen*.6:this.arrowWidth==2?n=this.arrowInfo.edgeLen*.7:this.arrowWidth==3&&(n=this.arrowInfo.edgeLen*.8),this.polygonVertex[8]=e.x-n*Math.cos(Math.PI/180*(this.angle+this.arrowInfo.angle)),this.polygonVertex[9]=e.y-n*Math.sin(Math.PI/180*(this.angle+this.arrowInfo.angle)),this.polygonVertex[4]=e.x-n*Math.cos(Math.PI/180*(this.angle-this.arrowInfo.angle)),this.polygonVertex[5]=e.y-n*Math.sin(Math.PI/180*(this.angle-this.arrowInfo.angle))}sideCord(){const t={x:0,y:0};t.x=(this.polygonVertex[4]+this.polygonVertex[8])/2,t.y=(this.polygonVertex[5]+this.polygonVertex[9])/2,this.polygonVertex[2]=(this.polygonVertex[4]+t.x)/2,this.polygonVertex[3]=(this.polygonVertex[5]+t.y)/2,this.polygonVertex[10]=(this.polygonVertex[8]+t.x)/2,this.polygonVertex[11]=(this.polygonVertex[9]+t.y)/2}}function he(i,t,e){if(t.points.length<2)return;const{startX:n,startY:s,width:o,height:r}=e;i.save(),i.beginPath(),i.rect(n,s,o,r),i.clip(),i.lineWidth=t.size,i.strokeStyle=t.color,i.beginPath(),i.moveTo(t.points[0].x,t.points[0].y);for(const l of t.points)i.lineTo(l.x,l.y);i.stroke(),i.restore()}function lt(i,t,e,n,s,o,r){const l=window.devicePixelRatio||1;e=e,n=n,s=s,o=o;let d=16;o==1?(o=14,d=16):o==3?(o=18,d=22):(o=22,d=26),l>1&&(d=d+3);const c=t.split(`
`);i.save(),i.lineWidth=1,i.fillStyle=r,i.textBaseline="middle",i.font=`normal ${o}px none`,c.forEach((h,a)=>{let g=h.split(""),w="";for(let f=0;f<g.length;f++){const m=w+g[f];i.measureText(m).width>s&&f>0?(i.fillText(w,e,n),w=g[f],n+=d):w=m}i.fillText(w,e,n),n+=d}),i.restore()}async function ce(){var l;const i=new H,t=i.getHistory(),e=(l=i.getTempContainer())==null?void 0:l.getContext("2d"),n=i.getScreenShotContainer(),s=n==null?void 0:n.getContext("2d"),o=i.getCutOutBoxPosition(),r=i.getScreenShotImageController();if(s!=null&&n!=null&&r!=null&&t.length>0){console.log("cutOutBoxPosition",i.getCutOutBoxPosition()),e==null||e.clearRect(o.startX+2,o.startY+2,o.width-4,o.height-4),s.clearRect(o.startX+2,o.startY+2,o.width-4,o.height-4),i.popHistory();let d=W(o.startX,o.startY,o.width,o.height,s,10,n,r,!1);console.log("historyList",t),await ue(t,s,d)}i.setUndoClickNum(i.getUndoClickNum()+1),t.length<=0&&(i.setUndoClickNum(0),i.setUndoStatus(!1))}async function de(i){return new Promise((t,e)=>{const n=new Image;n.onload=()=>t(n),n.onerror=()=>e(new Error(`Failed to load image from ${i}`)),n.src=i})}async function ue(i,t,e){const n=new H,s=new Gt,o=n.getCutOutBoxPosition(),r={width:parseInt(window.getComputedStyle(document.body).width),height:parseInt(window.getComputedStyle(document.body).height)},l=window.devicePixelRatio||1,d=document.createElement("canvas");d.width=r.width*l,d.height=r.height*l;const c=d.getContext("2d");if(c!=null){for(let h=0;h<i.length;h++){const a=i[h];if(a.type==="mosaicPen"&&a.info.imgSrc)try{const g=await de(a.info.imgSrc);t.drawImage(g,0,0,r.width*l,r.height*l)}catch(g){console.error("Error loading image:",g)}}for(let h=0;h<i.length;h++){const a=i[h];switch(a.type){case"square":Mt(a.info.x,a.info.y,a.info.width,a.info.height,a.info.color,a.info.size,c,e);break;case"round":Lt(c,a.info.currentX,a.info.currentY,a.info.x,a.info.y,a.info.size,a.info.color,e);break;case"right-top":s.draw(c,a.info.x,a.info.y,a.info.currentX,a.info.currentY,a.info.size,a.info.color,e);break;case"brush":he(c,a.info,e);break;case"text":const g=o.width+o.startX-a.info.x;lt(c,a.info.text,a.info.x,a.info.y,g,a.info.size,a.info.color);break}}t.drawImage(d,0,0,r.width*l,r.height*l)}}function q(i,t,e=document.body){const n=e.getBoundingClientRect();return{left:i||Math.abs(n.left),top:t||Math.abs(n.top)}}let Wt=!1,St=!1,yt=!1,et="#F53340",xt="",Pt=3;const ge=10;let It=0,j=[];const fe=!1;let vt=!1,X={startX:0,startY:0,width:0,height:0},T=null,P=null,I=null,v=null,b=null,C=null,M=null,K=null,k=null,N=null,O=null,A=null,V=null,Y=null,L=null,Ht=null,it=!1,bt=!1,zt="",Et,me=30,st=!1;const Rt=window.devicePixelRatio||1,nt=document.createElement("div"),J=document.createElement("div"),ot=document.createElement("div"),G=document.createElement("div"),$=document.createElement("div"),pe=54,we=40;let z=null;class H{constructor(){bt&&(bt=!1,T=null,P=null,I=null,St=!1,v=null,M=null,k=null,K=null,b=null,C=null,X={startX:0,startY:0,width:0,height:0},yt=!1,st=!1,vt=!1,et="#F53340",xt="",Pt=3,j=[],It=0,N=null,O=null,A=null,V=null,Y=null,L=null,z=null)}setInitStatus(t){bt=t}getMagifierContent(){J.style.marginTop="10px",J.style.marginLeft="4px",J.style.fontSize="12px",ot.style.marginLeft="4px",ot.style.fontSize="12px",nt.style.width="134px",nt.style.height="100px",G.style.position="absolute",G.style.top="0px",G.style.left="67px",G.style.width="2px",G.style.height="100px",G.style.backgroundColor="#3A8BFF",$.style.position="absolute",$.style.top="50px",$.style.left="0px",$.style.width="134px",$.style.height="2px",$.style.backgroundColor="#3A8BFF"}getCanvasMagnifier(){return z=document.createElement("canvas"),z.width=pe*Rt,z.height=we*Rt,this.getMagifierContent(),z}setScreenShotInfo(t,e){this.getScreenShotContainer(),P!=null&&(it&&document.body.classList.add("__screenshot-lock-scroll"),P.width=t,P.height=e,this.getTempContainer(),I!=null&&(I.width=t,I.height=e,I.style.width=t+"px",I.style.height=e+"px"))}setScreenShotPosition(t,e){if(this.getScreenShotContainer(),P==null)return;const{left:n,top:s}=q(t,e);P.style.left=n+"px",P.style.top=s+"px"}showScreenShotPanel(){this.getScreenShotContainer(),P!=null&&(P.style.display="block")}showtempContainer(){this.getTempContainer(),I!=null&&(I.style.display="block")}getTempContainer(){return I=document.getElementById("tempContainer"),I}setTempContainerPosition(t,e){const{left:n,top:s}=q(t,e);this.getTempContainer(),I!=null&&(I.style.left=n+"px",I.style.top=s+"px")}getScreenShotContainer(){return P=document.getElementById("screenShotContainer"),P}getToolController(){return v=document.getElementById("toolPanel"),v}getCutBoxSizeContainer(){return b=document.getElementById("cutBoxSizePanel"),b}getTextInputController(){return M=document.getElementById("textInputPanel"),M}getTextStatus(){return fe}getScreenShotImageController(){return Ht}setScreenShotImageController(t){Ht=t}setToolStatus(t){if(v=this.getToolController(),t){v.style.display="block";return}v.style.display="none"}setCutBoxSizeStatus(t){if(b!=null){if(t){b.style.display="flex";return}b.style.display="none"}}setCutBoxSizePosition(t,e){if(b==null)return;const{left:n,top:s}=q(t,e);b.style.left=n+"px";let o=0;P&&(o=parseInt(P.style.top)),b.style.top=s+o+"px"}setCutBoxSize(t,e){if(b==null)return;const n=b.childNodes;if(n.length>0){n[0].innerText=`${t} * ${e}`;return}const s=document.createElement("p");s.innerText=`${t} * ${e}`,b.appendChild(s)}getMagnifierController(){return C=document.getElementById("magnifierPanel"),C}setMagnifierStatus(t){if(C!=null){if(t){C.style.display="flex";return}C.style.display="none"}}setMagnifierPosition(t,e,n,s){if(C==null)return;const{left:o,top:r}=q(t,e),l={bottom:e+170>s,right:t+140>n};l.bottom&&(C.style.left=o+20+"px",C.style.top=r-160+"px"),l.right&&(C.style.left=o-130+"px",C.style.top=r+20+"px"),l.right&&l.bottom&&(C.style.left=o-136+"px",C.style.top=r-160+"px"),!l.right&&!l.bottom&&(C.style.left=o+20+"px",C.style.top=r+20+"px")}setMagnifierContent(t,e,n){const s=Math.ceil(t),o=Math.ceil(e);if(C==null)return;const r=C.childNodes;if(r.length>0){r[3].innerText=`坐标：(${s} , ${o})`,r[4].innerText=`颜色：${n}`;return}const l=document.createTextNode(`坐标：(${s}, ${o})`),d=document.createTextNode(`颜色：${n}`);z&&(z.style.width="134px",z.style.height="100px",nt.appendChild(z)),J.appendChild(l),ot.appendChild(d),C.appendChild(G),C.appendChild($),C.appendChild(nt),C.appendChild(J),C.appendChild(ot)}setTextStatus(t){if(M=this.getTextInputController(),M!=null){if(t){M.style.display="block";return}M.style.display="none"}}setToolInfo(t,e){v=document.getElementById("toolPanel");const{left:n,top:s}=q(t,e);v.style.left=n+"px";let o=0;P&&(o=parseInt(P.style.top)),v.style.top=s+o+"px"}getToolClickStatus(){return yt}setToolClickStatus(t){yt=t}setResetScrollbarState(t){st=t}getResetScrollbarState(){return st}getCutOutBoxPosition(){return X}getDragging(){return St}setDragging(t){St=t}getDraggingTrim(){return Wt}getToolPositionStatus(){return vt}setToolPositionStatus(t){vt=t}setDraggingTrim(t){Wt=t}setCutOutBoxPosition(t,e,n,s){X.startX=t,X.startY=e,X.width=n,X.height=s}setOptionStatus(t){if(k=this.getOptionController(),k!=null){if(t){k.style.display="block";return}k.style.display="none"}}hiddenOptionIcoStatus(){K!=null&&(K.style.display="none")}showmosaicCursor(t,e){this.getScreenShotContainer(),T=this.getMosaicCursor(),T!=null&&(T.style.left=t+"px",T.style.top=e+"px")}getMosaicCursor(){return T=document.getElementById("mosaicCursorPanel"),T}setMosaicCursorStatus(t){if(T=this.getMosaicCursor(),T!=null){if(t){T.style.display="block";return}T.style.display="none"}}getOptionController(){return k=document.getElementById("optionPanel"),k}setOptionPosition(t){if(k=this.getOptionController(),k==null)return;const e=this.getToolPosition();if(e==null)return;const n=e.left+"px",s=e.top+36+4+"px";k.style.left=n,k.style.top=s}getToolPosition(){if(v=this.getToolController(),v!=null)return{left:v.offsetLeft,top:v.offsetTop}}getSelectedColor(){return et}setSelectedColor(t){et=t,Y=this.getColorSelectPanel(),Y!=null&&(Y.style.backgroundColor=et)}getColorSelectPanel(){return Y=document.getElementById("colorSelectPanel"),Y}getToolName(){return xt}setToolName(t){xt=t}getPenSize(){return Pt}setPenSize(t){Pt=t}getBorderSize(){return ge}getHistory(){return j}shiftHistory(){return j.shift()}popHistory(){return j.pop()}pushHistory(t){j.push(t)}getUndoClickNum(){return It}setUndoClickNum(t){It=t}getColorPanel(){return N=document.getElementById("colorPanel"),N}setColorPanelStatus(t){if(N=this.getColorPanel(),N!=null){if(t){N.style.display="flex";return}N.style.display="none"}}getNoScrollStatus(){return it}setNoScrollStatus(t){t!=null&&(it=t)}setActiveToolName(t){zt=t}getActiveToolName(){return zt}setTextInfo(t){Et=t}getTextInfo(){return Et}getMaxUndoNum(){return me}getRightPanel(){return O=document.getElementById("rightPanel"),O}setRightPanel(t){if(O=this.getRightPanel(),O!=null){if(t){O.style.display="flex";return}O.style.display="none"}}getBrushPanel(){return A=document.getElementById("brushSelectPanel"),A}setBrushPanel(t){if(A=this.getBrushPanel(),A!=null){if(t){A.style.display="flex";return}A.style.display="none"}}getTextPanel(){return V=document.getElementById("textSelectPanel"),V}setTextPanel(t){if(V=this.getTextPanel(),V!=null){if(t){V.style.display="flex";return}V.style.display="none"}}setUndoStatus(t){if(L=this.getUndoController(),L!=null){if(t){L.classList.add("undo"),L.classList.remove("undo-disabled"),L.addEventListener("click",this.cancelEvent);return}L.classList.add("undo-disabled"),L.classList.remove("undo")}}cancelEvent(){ce(),M!=null&&(M.style.display="none")}getUndoController(){return L=document.getElementById("undoPanel"),L}destroyDOM(){if(P==null||I==null||v==null||K==null||k==null||M==null||b==null)return;const t=new D;it&&document.body.classList.remove("__screenshot-lock-scroll"),document.body.removeChild(P),document.body.removeChild(I),document.body.removeChild(v),document.body.removeChild(K),document.body.removeChild(k),document.body.removeChild(M),document.body.removeChild(b),st&&(document.documentElement.classList.remove("hidden-screen-shot-scroll"),document.body.classList.remove("hidden-screen-shot-scroll")),t.setInitStatus(!0)}}function Q(i,t,e){const n=window.devicePixelRatio||1;i.width=Math.round(t*n),i.height=Math.round(e*n),i.style.width=t+"px",i.style.height=e+"px";const s=i.getContext("2d");return s&&s.scale(n,n),s}function Ce(i,t,e,n,s){const o=window.devicePixelRatio||1,r=i.getImageData(t*o,e*o,n*o,s*o),l=document.createElement("canvas"),d=Q(l,n,s);if(d){d.putImageData(r,0,0);const c=document.createElement("a");c.href=l.toDataURL("png"),c.download=`${new Date().getTime()}.png`,c.click()}}function Se(i,t,e,n,s,o=.75,r=!0){const l=window.devicePixelRatio||1,d=i.getImageData(t*l,e*l,n*l,s*l),c=document.createElement("canvas"),h=Q(c,n,s);return h?(h.putImageData(d,0,0),r&&(c==null||c.toBlob(a=>{var f;if(a==null)return;const g=window.ClipboardItem;if(g==null)return c.toDataURL("png");const w=new g({[a.type]:a});(f=navigator.clipboard)==null||f.write([w]).then(()=>"写入成功")},"image/png",o)),c.toDataURL("image/png",o)):""}function ye(i,t,e,n,s){return new Promise((o,r)=>{const l=window.devicePixelRatio||1,d=i.getImageData(t*l,e*l,n*l,s*l),c=document.createElement("canvas"),h=Q(c,n,s);h?(h.putImageData(d,0,0),c.toBlob(a=>{a?o(a):r(new Error("Failed to create Blob."))},"image/png")):r(new Error("Failed to get canvas 2D context."))})}function Dt(i,t={quality:.75,writeToClipboard:!0}){var g;const{quality:e=.75,writeToClipboard:n=!0}=t??{},s=new H,o=new D,r=(g=s.getScreenShotContainer())==null?void 0:g.getContext("2d");let{startX:l,startY:d,width:c,height:h}=s.getCutOutBoxPosition();l=l+4,d=d+4,c=c-7,h=h-7;let a="";return r&&(i?Ce(r,l,d,c,h):a=Se(r,l,d,c,h,e,n===!1?!1:o.getWriteImgState())),a}function Bt(){var r;const i=new H,t=(r=i.getScreenShotImageController())==null?void 0:r.getContext("2d");let{startX:e,startY:n,width:s,height:o}=i.getCutOutBoxPosition();return ye(t,e,n,s,o)}function U(i,t){const e=new H,n=e.getScreenShotContainer();if(n==null)return;n.getContext("2d");let s=e.getMaxUndoNum();console.log("maxUndoNum",s),e.getHistory().length>e.getMaxUndoNum()&&e.shiftHistory(),e.pushHistory({type:i,info:t}),e.getToolName()=="mosaicPen"&&console.log("这里是马赛克"),console.log("保存当前画布状态","data.getHistory().length",e.getHistory()),e.getHistory().length>0&&e.setUndoStatus(!0)}let rt,at,R;function xe(){const i=document.getElementById("brushSelectPanel");rt=i==null?void 0:i.getElementsByTagName("div"),rt[0].classList.remove("brush-small-active"),rt[1].classList.add("brush-medium-active"),rt[2].classList.remove("brush-big-active");const t=document.getElementById("textSelectPanel");at=t==null?void 0:t.getElementsByTagName("div"),at[0].classList.remove("text-small-active"),at[1].classList.add("text-medium-active"),at[2].classList.remove("text-big-active");const e=document.getElementById("colorPanel");R=e==null?void 0:e.getElementsByClassName("color-item"),R[0].classList.add("color-active"),R[1].classList.remove("color-active"),R[2].classList.remove("color-active"),R[3].classList.remove("color-active"),R[4].classList.remove("color-active"),R[5].classList.remove("color-active"),R[6].classList.remove("color-active")}function Pe(i,t,e,n,s){var g,w;const o=new H,r=new D,l=o.getTextInputController(),d=o.getScreenShotContainer(),c=o.getScreenShotImageController();if(o.setActiveToolName(i),d==null||c==null)return;const h=d.getContext("2d");if(!o.getToolClickStatus()){const f=((g=o.getToolPosition())==null?void 0:g.left)||0,m=((w=o.getToolPosition())==null?void 0:w.top)||0;m&&o.getToolPositionStatus()&&o.setToolInfo(f,m-46),o.setToolStatus(!0);const p=o.getCutOutBoxPosition();W(p.startX,p.startY,p.width,p.height,h,o.getBorderSize(),d,c)}if(o.setToolName(i),o.setSelectedColor("#F53340"),o.setPenSize(3),re(e,t),xe(),o.setBrushPanel(!0),o.setTextPanel(!1),i=="text"&&(o.setTextPanel(!0),o.setBrushPanel(!1)),o.setOptionStatus(!0),o.setOptionPosition(le(t)),o.setRightPanel(!0),i=="mosaicPen"&&(o.setRightPanel(!1),o.hiddenOptionIcoStatus()),l!=null&&o.getTextStatus()||l!=null&&i!=="text"){const f=l.innerText;if(f&&f!==""){const{positionX:m,positionY:p,textMaxWidth:y,color:x,size:B}=o.getTextInfo();lt(h,f,m,p,y,B,x),U("text",{x:m,y:p,text:f,color:x,size:B})}l.innerHTML="",o.setTextStatus(!1)}if(o.setDragging(!1),o.setDraggingTrim(!1),i=="save"){o.setOptionStatus(!1),Dt(!0);const f=r.getSaveCallback();f&&f(0,"保存成功"),o.destroyDOM(),o.setInitStatus(!0)}if(i=="close"&&(s&&s(),o.destroyDOM(),o.setInitStatus(!0)),i=="confirm"){const f=Dt(!1);n&&n(f),o.destroyDOM(),o.setInitStatus(!0)}if(o.setToolClickStatus(!0),i==="get-text"){const f=o.getCutOutBoxPosition(),{width:m,height:p}=f;window.RendererHelper.hideWindow(),Bt().then(async y=>{const x=await y.arrayBuffer();window.RendererHelper.previewImage({width:m,height:p},{imageBlob:x,imgUrl:[],curIndex:0,actions:["get-text"]})}).finally(()=>{window.close()})}if(i==="pin"){const f=o.getCutOutBoxPosition();window.RendererHelper.hideWindow(),Bt().then(async m=>{const{startX:p,startY:y,width:x,height:B}=f??{},F=await m.arrayBuffer(),E=await window.RendererHelper.getScreenBounds(),Z=1;window.RendererHelper.openWindow(`sview:/#/screenShotPin?x=${p}&y=${y}&width=${x}&height=${B}`,{width:x+2*Z,height:B+2*Z,x:p+E.x,y:y+E.y,alwaysOnTop:!0,frame:!1,resizable:!1,movable:!0,title:"钉在桌面上",roundedCorners:!1,transparent:!0},{imageBlob:F})}).finally(()=>{window.close()})}i==="share"&&(window.RendererHelper.hideWindow(),a(o).finally(()=>{window.close()}));async function a(f){const m=await Bt(),p=Date.now(),y=new File([m],`${p}.png`,{type:"image/png",lastModified:p}),x=f.getCutOutBoxPosition(),B=await m.arrayBuffer(),F=await window.RendererHelper.getUID(),E=await Jt(y,F),{objectId:Z,data:$t={}}=E??{},{width:Ut,height:Xt}=x,{name:Yt,previewUrl:_t}=$t,qt={objectId:Z,title:Yt,type:"img",url:_t,arrayBuffer:B,width:Ut,height:Xt};window.RendererHelper.openWindow(Qt,{width:640,height:Zt,frame:!1,modal:!0,resizable:!1,subWindow:!1,id:"studyForward"},{imgData:qt})}}function Ie(i,t){let e=ve(t);const s=(i.path||i.composedPath&&i.composedPath())[1].children;for(let o=0;o<s.length;o++){const r=s[o];r.className.includes("active")&&r.classList.remove(r.classList[2])}i.target.className+=" "+e}function ve(i){let t="";switch(i){case 1:t="brush-small-active";break;case 2:t="brush-medium-active";break;case 3:t="brush-big-active";break}return t}function kt(i,t,e){const n=new H;Ie(e,t);let s=1;switch(i){case"small":s=1;break;case"medium":s=3;break;case"big":s=5;break}return n.setPenSize(s),s}function be(i,t){let e=Be(t);const s=(i.path||i.composedPath&&i.composedPath())[1].children;for(let o=0;o<s.length;o++){const r=s[o];r.className.includes("active")&&r.classList.remove(r.classList[2])}i.target.className+=" "+e}function Be(i){let t="";switch(i){case 1:t="text-small-active";break;case 2:t="text-medium-active";break;case 3:t="text-big-active";break}return t}function Tt(i,t,e){const n=new H;be(e,t);let s=1;switch(i){case"small":s=1;break;case"medium":s=3;break;case"big":s=5;break}return n.setPenSize(s),s}function ke(i){const t=new H;let e="#F33131";switch(i){case 1:e="#F33131";break;case 2:e="#FFE45B";break;case 3:e="#52CC5C";break;case 4:e="#3A8BFF";break;case 5:e="#FFFFFF";break;case 6:e="#A9AFB8";break;case 7:e="#131B26";break}return t.setSelectedColor(e),e}class Te{constructor(t){u(this,"screenShotController");u(this,"tempContainer");u(this,"toolController");u(this,"optionIcoController");u(this,"optionController");u(this,"cutBoxSizeContainer");u(this,"textInputController");u(this,"magnifierController");u(this,"completeCallback");u(this,"saveCallback");u(this,"closeCallback");u(this,"hiddenIcoArr");u(this,"language");u(this,"toolbar");u(this,"mosaicCursor");if(this.screenShotController=document.createElement("canvas"),this.tempContainer=document.createElement("canvas"),this.toolController=document.createElement("div"),this.optionIcoController=document.createElement("div"),this.optionController=document.createElement("div"),this.cutBoxSizeContainer=document.createElement("div"),this.textInputController=document.createElement("div"),this.magnifierController=document.createElement("div"),this.mosaicCursor=document.createElement("div"),this.saveCallback=t==null?void 0:t.saveCallback,this.completeCallback=t==null?void 0:t.completeCallback,this.closeCallback=t==null?void 0:t.closeCallback,this.hiddenIcoArr=[],this.language="zh_CN",(!t||!Object.prototype.hasOwnProperty.call(t,"completeCallback"))&&(this.completeCallback=e=>{sessionStorage.setItem("screenShotImg",e)}),t!=null&&t.hiddenToolIco)for(const e in t.hiddenToolIco)t.hiddenToolIco[e]&&this.filterHideIcon(e);this.setAllControllerId(),this.setOptionIcoClassName(),this.toolbar=oe,this.setToolBarIco();try{window.MainWindowHelper.getLanguage().then(e=>{this.language=e}).finally(()=>{this.setBrushSelectPanel()})}catch{this.setBrushSelectPanel()}this.setTextInputPanel(),this.setDomToBody(),this.hiddenAllDom()}setToolBarIco(){for(let t=0;t<this.toolbar.length;t++){const e=this.toolbar[t];let n=!1;for(let o=0;o<this.hiddenIcoArr.length;o++)if(this.hiddenIcoArr[o]===e.title){n=!0;break}if(n)continue;const s=document.createElement("div");e.title=="undo"?(s.className="item-panel undo-disabled",s.id="undoPanel"):(s.className=`item-panel ${e.title}`,s.addEventListener("click",o=>{Pe(e.title,e.id,o,this.completeCallback,this.closeCallback)})),s.setAttribute("data-title",e.title),s.setAttribute("data-id",e.id+""),this.toolController.appendChild(s)}this.hiddenIcoArr.length>0&&(this.toolController.style.minWidth="24px")}setBrushSelectPanel(){const t=document.createElement("div");t.className="brush-select-panel";for(let c=0;c<3;c++){const h=document.createElement("div");switch(h.className="item-panel",c){case 0:h.classList.add("brush-small"),h.addEventListener("click",a=>{kt("small",1,a)});break;case 1:h.classList.add("brush-medium"),h.addEventListener("click",a=>{kt("medium",2,a)});break;case 2:h.classList.add("brush-big"),h.addEventListener("click",a=>{kt("big",3,a)});break}t.appendChild(h),t.id="brushSelectPanel"}const e={zh_CN:{small:"小",medium:"中",large:"大"},en_US:{small:"S",medium:"M",large:"L"}},n=e[this.language]??e.zh_CN,s=function(c){return n[c]??c},o=document.createElement("div");o.className="text-select-panel";for(let c=0;c<3;c++){const h=document.createElement("div");switch(h.className="item-panel",c){case 0:h.innerText=s("small"),h.classList.add("text-small"),h.classList.add("text-small-active"),h.addEventListener("click",a=>{Tt("small",1,a)});break;case 1:h.innerText=s("medium"),h.classList.add("text-medium"),h.addEventListener("click",a=>{Tt("medium",2,a)});break;case 2:h.innerText=s("large"),h.classList.add("text-big"),h.addEventListener("click",a=>{Tt("big",3,a)});break}o.appendChild(h),o.id="textSelectPanel"}const r=document.createElement("div");r.className="right-panel";const l=document.createElement("div");l.id="colorPanel",l.className="color-panel";const d=["#F33131","#FFE45B","#52CC5C","#3A8BFF","#FFFFFF","#A9AFB8","#131B26"];for(let c=0;c<d.length;c++){const h=document.createElement("div");h.className="color-item";const a=document.createElement("div");a.className="color-one",a.style.backgroundColor=d[c],c==4&&(a.style.border="1px solid rgba(0, 0, 0, 0.06)"),c===0&&h.classList.add("color-active"),a.addEventListener("click",g=>{g.stopPropagation(),document.querySelectorAll(".color-item").forEach(f=>{f.classList.remove("color-active")}),h.classList.add("color-active"),ke(c+1)}),h.setAttribute("data-index",c+""),h.appendChild(a),l.appendChild(h)}r.appendChild(l),r.id="rightPanel",this.optionController.appendChild(t),this.optionController.appendChild(o),this.optionController.appendChild(r)}setTextInputPanel(){this.textInputController.contentEditable="true",this.textInputController.spellcheck=!1}setAllControllerId(){this.screenShotController.id="screenShotContainer",this.tempContainer.id="tempContainer",this.toolController.id="toolPanel",this.optionIcoController.id="optionIcoController",this.optionController.id="optionPanel",this.cutBoxSizeContainer.id="cutBoxSizePanel",this.textInputController.id="textInputPanel",this.magnifierController.id="magnifierPanel",this.mosaicCursor.id="mosaicCursorPanel"}hiddenAllDom(){this.screenShotController.style.display="none",this.tempContainer.style.display="none",this.toolController.style.display="none",this.optionIcoController.style.display="none",this.optionController.style.display="none",this.cutBoxSizeContainer.style.display="none",this.textInputController.style.display="none",this.magnifierController.style.display="none",this.mosaicCursor.style.display="none"}setDomToBody(){document.body.appendChild(this.screenShotController),document.body.appendChild(this.tempContainer),document.body.appendChild(this.toolController),document.body.appendChild(this.optionIcoController),document.body.appendChild(this.optionController),document.body.appendChild(this.cutBoxSizeContainer),document.body.appendChild(this.textInputController),document.body.appendChild(this.magnifierController),document.body.appendChild(this.mosaicCursor)}setOptionIcoClassName(){this.optionIcoController.className="ico-panel"}filterHideIcon(t){switch(t){case"rightTop":this.hiddenIcoArr.push("right-top");break;default:this.hiddenIcoArr.push(t);break}}}async function Me(i,t,e){var d;new D;const n=new D,s=n.getCanvasSize(),o={width:parseFloat(window.getComputedStyle(document.body).width),height:parseFloat(window.getComputedStyle(document.body).height)},r=Math.max(o.width||0,Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),Math.max(document.body.clientWidth,document.documentElement.clientWidth)),l=Math.max(o.height||0,Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),Math.max(document.body.clientHeight,document.documentElement.clientHeight));if(i.clearRect(0,0,r,l),e!=null&&n.getShowScreenDataStatus()){const c=window.devicePixelRatio||1;let h=await createImageBitmap(e);t.width=h.width*c,t.height=h.height*c,t.style.width=h.width+"px",t.style.height=h.height+"px",i.drawImage(h,0,0,h.width/c,h.height/c),(d=t==null?void 0:t.getContext("2d"))==null||d.drawImage(h,0,0,h.width,h.height,0,0,h.width*c,h.height*c)}i.save(),i.fillStyle="rgba(0, 0, 0, .3)",s.canvasWidth!==0&&s.canvasHeight!==0?i.fillRect(0,0,s.canvasWidth,s.canvasHeight):i.fillRect(0,0,r,l),i.restore()}function S(i){return i>0?i:0}function Ft(i,t,e){return S(i)+t>e?S(e-t):S(i)}function Nt(i,t,e,n,s,o){const{startX:r,startY:l,width:d,height:c}=o;t<r||t>r+d||e<l||e>l+c||(i.save(),i.lineWidth=n,i.strokeStyle=s,i.lineTo(t,e),i.stroke(),i.restore())}function Ot(i,t,e){i.beginPath(),i.moveTo(t,e)}const Le=(i,t,e)=>{const n=i.width,s=i.data,o=[];return o[0]=s[4*(e*n+t)],o[1]=s[4*(e*n+t)+1],o[2]=s[4*(e*n+t)+2],o[3]=s[4*(e*n+t)+3],o},We=(i,t,e,n)=>{const s=i.width,o=i.data;o[4*(e*s+t)]=n[0],o[4*(e*s+t)+1]=n[1],o[4*(e*s+t)+2]=n[2],o[4*(e*s+t)+3]=n[3]};function He(i,t,e,n,s){if(Array.isArray(i))i.forEach(o=>{At(o.x,o.y,t,e,n,s)});else{const o=i.x,r=i.y;At(o,r,t,e,n,s)}}const At=(i,t,e,n,s,o)=>{let r=!1;const l=window.devicePixelRatio||1,{startX:d,startY:c,width:h,height:a}=o;if((i>=d+h-22||t>=c+a-22)&&(r=!0),e==1?e=r?10:16:e==3?e=r?10:20:e=r?8:24,i=r?i-3:i,i<d||i+20>d+h||t<c||t+20>c+a)return;s.save(),s.beginPath(),s.rect(d,c,h,a),s.clip(),s.beginPath();const g=s.getImageData(i*l,t*l,e*l,e*l),w=g.width,f=g.height,m=w/n,p=f/n;for(let y=0;y<p;y++)for(let x=0;x<m;x++){const B=Le(g,x*n+Math.floor(Math.random()*n),y*n+Math.floor(Math.random()*n));for(let F=0;F<n;F++)for(let E=0;E<n;E++)We(g,x*n+E,y*n+F,B)}s.putImageData(g,i*l,t*l)};function ze(i,t,e,n,s,o,r){let l,d,c,h=0;switch(r){case 2:return d=t-(n+o)>0?n+o:t,h=S(o-(t-n)),{tempStartX:e,tempStartY:d,tempWidth:s,tempHeight:h};case 3:return h=S(t-n),{tempStartX:e,tempStartY:n,tempWidth:s,tempHeight:h};case 4:return l=i-(e+s)>0?e+s:i,c=S(s-(i-e)),{tempStartX:l,tempStartY:n,tempWidth:c,tempHeight:o};case 5:return c=S(i-e),{tempStartX:e,tempStartY:n,tempWidth:c,tempHeight:o};case 6:return l=i-(e+s)>0?e+s:i,d=t-(n+o)>0?n+o:t,c=S(s-(i-e)),h=S(o-(t-n)),{tempStartX:l,tempStartY:d,tempWidth:c,tempHeight:h};case 7:return c=S(i-e),h=S(t-n),{tempStartX:e,tempStartY:n,tempWidth:c,tempHeight:h};case 8:return d=t-(n+o)>0?n+o:t,c=S(i-e),h=S(o-(t-n)),{tempStartX:e,tempStartY:d,tempWidth:c,tempHeight:h};case 9:return l=i-(e+s)>0?e+s:i,c=S(s-(i-e)),h=S(t-n),{tempStartX:l,tempStartY:n,tempWidth:c,tempHeight:h}}}function Ee(i,t){const{startX:e,startY:n,width:s,height:o}=t,r=i/2,l=[];return l[0]={x:e+r,y:n+r,width:s-i,height:o-i,index:1,option:1},l[1]={x:e+r,y:n,width:s-i,height:r,index:2,option:2},l[2]={x:e-r+s/2,y:n-r,width:i,height:r,index:2,option:2},l[3]={x:e+r,y:n-r+o,width:s-i,height:r,index:2,option:3},l[4]={x:e-r+s/2,y:n+o,width:i,height:r,index:2,option:3},l[5]={x:e,y:n+r,width:r,height:o-i,index:3,option:4},l[6]={x:e-r,y:n-r+o/2,width:r,height:i,index:3,option:4},l[7]={x:e-r+s,y:n+r,width:r,height:o-i,index:3,option:5},l[8]={x:e+s,y:n-r+o/2,width:r,height:i,index:3,option:5},l[9]={x:e-r,y:n-r,width:i,height:i,index:4,option:6},l[10]={x:e-r+s,y:n-r+o,width:i,height:i,index:4,option:7},l[11]={x:e-r+s,y:n-r,width:i,height:i,index:5,option:8},l[12]={x:e-r,y:n-r+o,width:i,height:i,index:5,option:9},l}function Re(i,t,e,n){let s=(i.width-t)/2+i.startX;n==="left"&&(s=i.startX),n==="right"&&(s=i.startX+i.width-t),s<0&&(s=0),s+t>e&&(s=e-t);let r=i.startY+i.height+10;return(i.width<0&&i.height<0||i.width>0&&i.height<0)&&(r=i.startY+10),{mouseX:s,mouseY:r}}function Vt(i,t,e){return!(i<e.startX||t<e.startY||i>e.startX+e.width||t>e.startY+e.height)}function De(i){const t=new D;(i==null?void 0:i.enableWebRtc)===!1&&(t.setWebRtcStatus(!1),t.setInitStatus(!1)),t.setScreenFlow(i.screenFlow),i.windowList&&t.settWindowList(i.windowList),i.screenIndex!==void 0&&i.screenIndex!==null&&t.setScreenIndex(i.screenIndex),i!=null&&i.canvasWidth&&(i!=null&&i.canvasHeight)&&t.setCanvasSize(i.canvasWidth,i.canvasHeight),(i==null?void 0:i.showScreenData)===!0&&t.setShowScreenDataStatus(!0),i!=null&&i.maskColor&&typeof i.maskColor=="object"&&t.setMaskColor(i.maskColor),(i==null?void 0:i.writeBase64)===!1&&t.setWriteImgState(i.writeBase64),i!=null&&i.screenShotDom&&t.setScreenShotDom(i.screenShotDom),i!=null&&i.saveCallback&&t.setSaveCallback(i.saveCallback)}function Fe(i,t){switch(t){case"text":i.style.cursor="text";break;default:i.style.cursor="default";break}}class Ne{constructor(t,e){u(this,"data");u(this,"screenShotContainer");u(this,"screenShotDom",null);u(this,"toolController");u(this,"screenShotImageController");u(this,"screenShotCanvas");u(this,"tempContainer");u(this,"tempContext");u(this,"textInputController");u(this,"optionController");u(this,"optionIcoController");u(this,"cutBoxSizeContainer");u(this,"magnifierController");u(this,"plugInParameters");u(this,"drawGraphPosition",{startX:0,startY:0,width:0,height:0});u(this,"tempGraphPosition",{startX:0,startY:0,width:0,height:0});u(this,"cutOutBoxBorderArr",[]);u(this,"borderOption",null);u(this,"movePosition",{moveStartX:0,moveStartY:0});u(this,"windowBoxX",0);u(this,"windowBoxY",0);u(this,"windowBoxW",0);u(this,"windowBoxH",0);u(this,"dragFlag",!1);u(this,"clickCutFullScreen",!1);u(this,"getFullScreenStatus",!1);u(this,"getWindowStatus",!1);u(this,"isShowMagnifier",!1);u(this,"drawGraphPrevX",0);u(this,"drawGraphPrevY",0);u(this,"degreeOfBlur",5);u(this,"dpr",window.devicePixelRatio||1);u(this,"fullScreenDiffHeight",60);u(this,"position",{left:0,top:0});u(this,"imgData",null);u(this,"imageBitmap",null);u(this,"mouseInsideCropBox",!1);u(this,"drawStatus",!1);u(this,"textInputPosition",{mouseX:0,mouseY:0});u(this,"placement","center");u(this,"drawArrow",new Gt);u(this,"windowList",[]);u(this,"customRightClickEvent",{state:!1});u(this,"screenViewSize",{width:0,height:0});u(this,"isScreenFinish",!1);u(this,"isToolHide",!1);u(this,"windowOneSend",!1);u(this,"isScreenSuccess",!1);u(this,"canvasMagnifier");u(this,"canvasMagnifierCTX");u(this,"canvasImageData");u(this,"scaledWidth",54*this.dpr);u(this,"scaledHeight",40*this.dpr);u(this,"magnifierColor","#000000");u(this,"mosaicSmall",new URL(""+new URL("mosaic_small-e0650722.svg",import.meta.url).href,self.location).href);u(this,"mosaicMillde",new URL(""+new URL("mosaic_middle-58a34608.svg",import.meta.url).href,self.location).href);u(this,"mosaicBig",new URL(""+new URL("mosaic_big-3eec5584.svg",import.meta.url).href,self.location).href);u(this,"brushPositions",{});u(this,"mosicPositions",{});u(this,"cutPositonRes",{width:0,height:0});u(this,"isNotMac",RendererHelper.getPlatform()!="darwin");u(this,"leaveWindow",t=>{console.log("鼠标离开屏幕事件"),this.isScreenSuccess||this.cleanSelectArea()});u(this,"mouseDownEvent",t=>{if(t.button!=0||this.data.getToolName()=="undo")return;this.data.setDragging(!0),this.drawStatus=!1,this.data.setToolPositionStatus(!1);const e=S(t.offsetX),n=S(t.offsetY);if(console.log("鼠标按下",e,n),this.data.getToolClickStatus()&&(this.drawGraphPosition.startX=e,this.drawGraphPosition.startY=n,this.data.showtempContainer(),this.tempContainer&&this.registerForRightClickEvent(this.tempContainer)),this.data.getToolName()=="brush"&&this.tempContext&&this.screenShotCanvas&&(Ot(this.screenShotCanvas,e,n),Ot(this.tempContext,e,n),this.brushPositions={points:[{x:e,y:n}]}),this.data.getToolName()=="mosaicPen",this.data.getToolName()=="text"&&this.textInputController&&this.screenShotContainer&&this.screenShotCanvas&&this.tempContext){if(!this.mouseInsideCropBox)return;const s=this.cutPositonRes.width-this.textInputPosition.mouseX,o=this.cutPositonRes.width-e;o>80?(this.textInputController.style.minWidth="80px",this.textInputController.style.removeProperty("width"),console.log("texrInputMaxWidth > 80")):(console.log("texrInputMaxWidth < 80"),this.textInputController.style.width=o+"px",this.textInputController.style.removeProperty("min-width")),this.textInputController.addEventListener("input",function(){this.offsetWidth>=o?(this.style.overflowWrap="break-word",this.style.width=o+"px"):this.style.overflowWrap="break-word"}),this.data.setTextStatus(!0),this.textInputPosition.mouseX!=0&&this.textInputPosition.mouseY!=0&&this.textInputPosition.mouseX!=e&&this.textInputPosition.mouseY!=n&&(lt(this.screenShotCanvas,this.textInputController.innerText,this.textInputPosition.mouseX,this.textInputPosition.mouseY,s,this.data.getPenSize(),this.data.getSelectedColor()),lt(this.tempContext,this.textInputController.innerText,this.textInputPosition.mouseX,this.textInputPosition.mouseY,s,this.data.getPenSize(),this.data.getSelectedColor()),this.textInputController.innerText!==""&&U("text",{x:this.textInputPosition.mouseX,y:this.textInputPosition.mouseY,text:this.textInputController.innerText,color:this.data.getSelectedColor(),size:this.data.getPenSize()}),this.textInputController.innerText!==""&&this.data.setTextStatus(!1),this.textInputController.innerHTML="");const r=e+this.position.left;let l=14;this.data.getPenSize()==1?l=14:this.data.getPenSize()==3?l=18:l=22,this.textInputController.style.left=r+"px",this.textInputController.style.fontSize=l+"px",this.textInputController.style.fontFamily="none",this.textInputController.style.color=this.data.getSelectedColor(),setTimeout(()=>{if(this.textInputController){const d=this.textInputController.offsetHeight,c=n-Math.floor(d/2)+this.position.top;this.textInputController.style.top=c+"px",this.textInputController.focus(),this.textInputPosition={mouseX:e,mouseY:n},this.data.setTextInfo({positionX:e,positionY:n,textMaxWidth:s,color:this.data.getSelectedColor(),size:this.data.getPenSize()})}})}this.borderOption?(this.data.setDraggingTrim(!0),this.movePosition.moveStartX=e,this.movePosition.moveStartY=n):!this.isScreenFinish&&!this.isScreenSuccess&&(this.getWindowStatus=!0,this.drawGraphPosition.startX=e,this.drawGraphPosition.startY=n)});u(this,"timer",0);u(this,"mouseMoveEvent",t=>{var f;let e=new Date().getTime();if(this.timer=e,this.screenShotCanvas==null||this.tempContext==null||this.tempContainer==null||this.screenShotContainer==null||this.data.getToolName()=="undo")return;const{startX:n,startY:s,width:o,height:r}=this.drawGraphPosition,l=S(t.offsetX),d=S(t.offsetY),c=(f=this.windowList)==null?void 0:f.find(m=>{const{x:p,y,width:x,height:B}=m;return l>=p&&l<=p+x&&d>=y&&d<=y+B});console.debug("当前窗口",c),c!==void 0?(this.windowBoxX=c.x,this.windowBoxY=c.y,this.windowBoxW=c.width,this.windowBoxH=c.height):(this.windowBoxX=0,this.windowBoxY=0,this.windowBoxW=this.screenViewSize.width,this.windowBoxH=this.screenViewSize.height),this.isShowMagnifier||this.showMagnifier(l,d),this.getWindowStatus||(this.tempGraphPosition=W(this.windowBoxX,this.windowBoxY,this.windowBoxW,this.windowBoxH,this.screenShotCanvas,this.data.getBorderSize(),this.screenShotContainer,this.screenShotImageController,!1));const h=l-this.drawGraphPosition.startX,a=d-this.drawGraphPosition.startY;!this.data.getToolClickStatus()&&this.data.getDragging()&&(h!==0||a!==0)&&(this.dragFlag=!0,this.data.setToolStatus(!1),this.data.setCutBoxSizeStatus(!1));const g=l-n,w=d-s;if(this.data.getToolClickStatus()&&this.data.getDragging()){const m=this.data.getCutOutBoxPosition();if(!Vt(n,s,m))return;switch(this.data.getToolName()!="mosaicPen",this.drawStatus=!0,this.tempContext.clearRect(0,0,this.screenShotContainer.width,this.screenShotContainer.height),this.data.getToolName()){case"square":Mt(n,s,g,w,this.data.getSelectedColor(),this.data.getPenSize(),this.tempContext,m);break;case"round":Lt(this.tempContext,l,d,n,s,this.data.getPenSize(),this.data.getSelectedColor(),m);break;case"right-top":this.drawArrow.draw(this.tempContext,n,s,l,d,this.data.getPenSize(),this.data.getSelectedColor(),m);break;case"brush":Nt(this.tempContext,l,d,this.data.getPenSize(),this.data.getSelectedColor(),m),Nt(this.screenShotCanvas,l,d,this.data.getPenSize(),this.data.getSelectedColor(),m),this.brushPositions.points.push({x:l,y:d});break;case"mosaicPen":He({x:l,y:d},this.data.getPenSize(),this.degreeOfBlur,this.screenShotCanvas,m);break}return}this.isScreenFinish||this.operatingCutOutBox(l,d,n,s,o,r,this.screenShotCanvas),!(!this.data.getDragging()||this.data.getDraggingTrim())&&!this.isScreenFinish&&!this.isScreenSuccess&&(h!==0||a!==0)&&(this.tempGraphPosition=W(n,s,g,w,this.screenShotCanvas,this.data.getBorderSize(),this.screenShotContainer,this.screenShotImageController,!1))});u(this,"mouseUpEvent",t=>{let e=S(t.offsetX),n=S(t.offsetY);const s=this.data.getBorderSize();if(this.data.getToolName()=="undo"||(this.data.setDragging(!1),this.data.setDraggingTrim(!1),this.screenShotCanvas==null||this.screenShotContainer==null||this.tempContext==null||this.tempContainer==null))return;const o=this.data.getCutOutBoxPosition();if(this.data.setMagnifierStatus(!1),o.width===0&&o.height===0&&o.startX===0&&o.startY===0&&!this.dragFlag&&this.clickCutFullScreen&&!this.isScreenFinish&&(this.windowBoxH>=this.screenViewSize.height&&(this.getFullScreenStatus=!0),this.tempGraphPosition=W(this.windowBoxX,this.windowBoxY,this.windowBoxW,this.windowBoxH,this.screenShotCanvas,s,this.screenShotContainer,this.screenShotImageController,!1)),!(this.screenShotContainer==null||this.screenShotCanvas==null||this.tempContext==null||this.tempContainer==null)){if(this.data.getToolClickStatus()&&this.drawStatus){const r=this.drawGraphPosition.startX,l=this.drawGraphPosition.startY;let d=e-this.drawGraphPosition.startX,c=n-this.drawGraphPosition.startY;const h=this.data.getSelectedColor(),a=this.data.getPenSize();if(!Vt(r,l,o))return;switch(this.tempContext.clearRect(0,0,this.screenShotContainer.width,this.screenShotContainer.height),this.data.getToolName()){case"square":U("square",{x:r,y:l,width:d,height:c,color:h,size:a}),Mt(r,l,d,c,h,a,this.screenShotCanvas,o);break;case"round":U("round",{x:r,y:l,currentX:e,currentY:n,color:h,size:a}),Lt(this.screenShotCanvas,e,n,r,l,a,h,o);break;case"right-top":U("right-top",{x:r,y:l,currentX:e,currentY:n,color:h,size:a}),this.drawArrow.draw(this.screenShotCanvas,r,l,e,n,a,h,o);break;case"brush":this.brushPositions.color=h,this.brushPositions.size=a,U("brush",this.brushPositions),this.brushPositions={};break;case"mosaicPen":const g=this.screenShotContainer.toDataURL("image/png");this.mosicPositions.imgSrc=g,U("mosaicPen",this.mosicPositions),this.mosicPositions={};break}return}else if(this.data.getToolClickStatus()&&!this.drawStatus)return;if((this.tempGraphPosition.width<2||this.tempGraphPosition.height<2)&&(this.tempGraphPosition=W(this.windowBoxX,this.windowBoxY,this.windowBoxW,this.windowBoxH,this.screenShotCanvas,s,this.screenShotContainer,this.screenShotImageController,!1)),this.drawGraphPosition=this.tempGraphPosition,this.isScreenSuccess=!0,this.isShowMagnifier=!0,this.windowOneSend||ScreenShotHelper.sendToOtherSceenshotWindow("isStopShot",{isScreenFinish:!0,isToolHide:!0,clickCutFullScreen:!1,windowOneSend:!0}),!this.data.getToolClickStatus()&&!this.isScreenFinish){const{startX:r,startY:l,width:d,height:c}=this.drawGraphPosition;this.data.setCutOutBoxPosition(r,l,d,c)}this.cutOutBoxBorderArr=Ee(this.data.getBorderSize(),this.drawGraphPosition),(this.tempContainer!=null&&this.dragFlag||this.clickCutFullScreen)&&(this.isToolHide||(this.tempContainer.style.cursor="move",this.data.setToolStatus(!0),this.data.setCutBoxSizeStatus(!0)),this.dragFlag=!1,this.toolController!=null&&this.showToolBar())}});document.body.style.cursor="none",this.plugInParameters=new D,De(t),new Te(t),this.screenShotImageController=document.createElement("canvas");let n=document.getElementById("screenShotContainer")||{style:{cursor:"auto"}};this.data=new H,this.setOptionalParameter(t),this.setGlobalParameter(),this.data.setNoScrollStatus(t==null?void 0:t.noScroll),this.canvasMagnifier=this.data.getCanvasMagnifier(),this.canvasMagnifierCTX=this.canvasMagnifier.getContext("2d"),this.load(t==null?void 0:t.triggerCallback,t==null?void 0:t.cancelCallback).then(()=>{e&&e(),!(this.toolController==null||this.screenShotContainer==null||this.textInputController==null||this.magnifierController==null)&&(this.adjustContainerLevels(t!=null&&t.level?t.level:0),this.customRightClickEvent.state&&this.registerForRightClickEvent(this.screenShotContainer),setTimeout(()=>{n.style.cursor="auto",document.body.style.cursor="auto"},500))}),RendererHelper.on("isStopShot",s=>{console.log("接收另一个屏幕发送过来的信息",s),this.isScreenFinish=s.isScreenFinish,this.isToolHide=s.isToolHide,this.getWindowStatus=!0,this.isShowMagnifier=!0,this.clickCutFullScreen=s.clickCutFullScreen,this.windowOneSend=s.windowOneSend,this.cleanSelectArea()})}async setWindowList(t){var l,d,c,h;this.plugInParameters.settWindowList(t),this.windowList=this.plugInParameters.getWindowList();const e={width:((l=this.screenShotContainer)==null?void 0:l.width)||0/this.dpr,height:((d=this.screenShotContainer)==null?void 0:d.height)||0/this.dpr};(c=this.windowList)==null||c.forEach(a=>{this.dpr!==1&&this.isNotMac&&(a.x=Math.floor(a.x*1/this.dpr),a.y=Math.floor(a.y*1/this.dpr),a.width=Math.floor(a.width*1/this.dpr),a.height=Math.floor(a.height*1/this.dpr));const g={top:a.y<0,bottom:a.y+a.height>e.height,left:a.x<0,right:a.x+a.width>e.width};a.x=a.x>0?a.x:0,a.y=a.y>0?a.y:0,g.bottom&&(console.log("窗口超出了屏幕的下方。"),a.width=a.width,a.height=e.height-a.y),g.left&&(console.log("窗口超出了屏幕的左侧。"),a.width=a.width+a.x,a.height=a.height),g.right&&(console.log("窗口超出了屏幕的右侧。"),a.width=e.width-a.x,a.height=a.height),g.left&&g.bottom&&(a.width=a.width+a.x,a.height=e.height-a.y),g.right&&g.bottom&&(a.width=e.width-a.x,a.height=e.height-a.y),g.left&&g.right&&g.bottom&&(a.width=e.width,a.height=e.height-a.y),g.left&&g.right&&g.top&&(a.width=e.width,a.height=e.height-40),!g.top&&!g.bottom&&!g.left&&!g.right&&(a.width=a.width,a.height=a.height)});let n=await window.RendererHelper.getMousePointInWindow(),s=n.x,o=n.y;const r=(h=this.windowList)==null?void 0:h.find(a=>{const{x:g,y:w,width:f,height:m}=a;return s>=g&&s<=g+f&&o>=w&&o<=w+m});console.debug("初始化当前窗口",r),r!==void 0?(this.windowBoxX=r.x,this.windowBoxY=r.y,this.windowBoxW=r.width,this.windowBoxH=r.height):(this.windowBoxX=0,this.windowBoxY=0,this.windowBoxW=this.screenViewSize.width,this.windowBoxH=this.screenViewSize.height),this.isShowMagnifier||this.showMagnifier(s,o),!this.getWindowStatus&&this.screenShotCanvas&&this.screenShotContainer&&(this.tempGraphPosition=W(this.windowBoxX,this.windowBoxY,this.windowBoxW,this.windowBoxH,this.screenShotCanvas,this.data.getBorderSize(),this.screenShotContainer,this.screenShotImageController,!1))}getCanvasController(){return this.screenShotContainer}destroyComponents(){this.data.destroyDOM(),this.data.setInitStatus(!0)}registerForRightClickEvent(t){t.addEventListener("contextmenu",e=>{if(e.preventDefault(),this.customRightClickEvent.handleFn){this.customRightClickEvent.handleFn();return}this.destroyComponents()})}async showMagnifier(t,e){var r;const n=(t-27)*this.dpr,s=(e-20)*this.dpr;if(this.canvasMagnifierCTX){if(this.imageBitmap==null)return;(r=this.canvasMagnifierCTX)==null||r.drawImage(this.imageBitmap,n,s,this.scaledWidth,this.scaledHeight,0,0,this.scaledWidth,this.scaledHeight)}if(this.data.setMagnifierStatus(!0),this.data.setMagnifierPosition(t,e,this.screenViewSize.width,this.screenViewSize.height),this.screenShotCanvas==null)return;let o=this.getScreenshotColor(t,e);o&&(this.magnifierColor=o),this.data.setMagnifierContent(t*this.dpr,e*this.dpr,this.magnifierColor)}getScreenshotColor(t,e){if(this.canvasImageData){const n=(e*this.canvasImageData.width+t)*4,s=this.canvasImageData.data[n],o=this.canvasImageData.data[n+1],r=this.canvasImageData.data[n+2],l=c=>c.toString(16).padStart(2,"0");return`#${l(s)}${l(o)}${l(r)}`.toUpperCase()}}async load(t,e){const n=this.plugInParameters.getCanvasSize();if(this.screenViewSize={width:parseInt(window.getComputedStyle(document.body).width),height:parseInt(window.getComputedStyle(document.body).height)},this.data.setScreenShotPosition(this.position.left,this.position.top),this.data.setTempContainerPosition(this.position.left,this.position.top),n.canvasWidth!==0&&n.canvasHeight!==0&&(this.data.setScreenShotInfo(this.screenViewSize.width,this.screenViewSize.height),console.log("isNotMac",this.isNotMac),this.screenShotImageController.width=this.isNotMac?n.canvasWidth:n.canvasWidth*this.dpr,this.screenShotImageController.height=this.isNotMac?n.canvasHeight:n.canvasHeight*this.dpr),this.screenShotContainer==null||this.tempContainer==null)return;const s=Q(this.screenShotContainer,this.screenShotImageController.width,this.screenShotImageController.height);if(this.tempContext=Q(this.tempContainer,this.screenShotImageController.width,this.screenShotImageController.height),s!=null){if(this.data.showScreenShotPanel(),!this.plugInParameters.getWebRtcStatus()&&this.imgData!=null){await this.drawPictures(t,s,this.imgData);return}if(this.plugInParameters.getScreenFlow()){this.initScreenShot(void 0,s,this.screenShotImageController);return}}}adjustContainerLevels(t){this.screenShotContainer==null||this.toolController==null||this.textInputController==null||this.optionIcoController==null||this.optionController==null||this.cutBoxSizeContainer==null||this.magnifierController==null||this.tempContainer==null||t<=0||(this.screenShotContainer.style.zIndex=`${t}`,this.toolController.style.zIndex=`${t+1}`,this.textInputController.style.zIndex=`${t+1}`,this.optionIcoController.style.zIndex=`${t+1}`,this.optionController.style.zIndex=`${t+1}`,this.cutBoxSizeContainer.style.zIndex=`${t+1}`,this.magnifierController.style.zIndex=`${t+1}`,this.tempContainer.style.zIndex=`${t+1}`)}registerContainerShortcuts(t){t.addEventListener("keydown",e=>{if(this.screenShotCanvas!=null&&((e.metaKey||e.ctrlKey)&&e.code==="Enter"||e.code==="Escape")){const n=t.innerText;if(!n||n===""){this.data.setTextStatus(!1);return}t.innerHTML="",this.data.setTextStatus(!1)}})}showToolBar(){if(this.toolController==null||this.screenShotContainer==null||this.tempContainer==null)return;const t=Re(this.drawGraphPosition,this.toolController.offsetWidth,this.screenViewSize.width,this.placement),e=this.screenViewSize.height;if(t.mouseY>e-70){if(t.mouseY-=this.drawGraphPosition.height+60,t.mouseY<40){const s=this.screenViewSize.height;t.mouseY=s-this.fullScreenDiffHeight}this.data.setToolPositionStatus(!0)}if(this.getFullScreenStatus){this.screenViewSize.height;const s=(this.drawGraphPosition.width-this.toolController.offsetWidth)/2;t.mouseX=s}this.drawGraphPosition.height+50>e&&(t.mouseY=this.drawGraphPosition.height-44),this.data.setToolInfo(t.mouseX+this.position.left,t.mouseY+this.position.top);let n=0;this.drawGraphPosition.startY-35<0?n=this.drawGraphPosition.startY+4:n=this.drawGraphPosition.startY-35,this.data.setCutBoxSizePosition(this.drawGraphPosition.startX,n),this.cutPositonRes.startX=this.drawGraphPosition.startX,this.cutPositonRes.startY=this.drawGraphPosition.startY,this.cutPositonRes.width=this.drawGraphPosition.startX+this.drawGraphPosition.width,this.cutPositonRes.height=this.drawGraphPosition.startY+this.drawGraphPosition.height,this.data.setCutBoxSize(this.drawGraphPosition.width,this.drawGraphPosition.height),this.getFullScreenStatus=!1}setGlobalParameter(){this.screenShotContainer=this.data.getScreenShotContainer(),this.toolController=this.data.getToolController(),this.textInputController=this.data.getTextInputController(),this.optionController=this.data.getOptionController(),this.cutBoxSizeContainer=this.data.getCutBoxSizeContainer(),this.magnifierController=this.data.getMagnifierController(),this.tempContainer=this.data.getTempContainer()}setOptionalParameter(t){var e,n;(t==null?void 0:t.clickCutFullScreen)===!0&&(this.clickCutFullScreen=!0),(t==null?void 0:t.imgData)!=null&&(this.imgData=t.imgData),(t==null?void 0:t.position)!=null&&(((e=t.position)==null?void 0:e.top)!=null&&(this.position.top=t.position.top),((n=t.position)==null?void 0:n.left)!=null&&(this.position.left=t.position.left)),t!=null&&t.screenShotDom&&(this.screenShotDom=t.screenShotDom),t!=null&&t.toolPosition&&(this.placement=t.toolPosition),(t==null?void 0:t.customRightClickEvent)!=null&&(this.customRightClickEvent=t.customRightClickEvent)}operatingCutOutBox(t,e,n,s,o,r,l){if(this.screenShotContainer==null)return;const{moveStartX:d,moveStartY:c}=this.movePosition;if(this.cutOutBoxBorderArr.length>0&&!this.data.getDraggingTrim()){let h=!1;l.beginPath();for(let a=0;a<this.cutOutBoxBorderArr.length;a++)if(l.rect(this.cutOutBoxBorderArr[a].x,this.cutOutBoxBorderArr[a].y,this.cutOutBoxBorderArr[a].width,this.cutOutBoxBorderArr[a].height),l.isPointInPath(t*this.dpr,e*this.dpr)){switch(this.cutOutBoxBorderArr[a].index){case 1:this.data.getToolClickStatus()?Fe(this.screenShotContainer,this.data.getActiveToolName()):this.screenShotContainer.style.cursor="move";break;case 2:if(this.data.getToolClickStatus())break;this.screenShotContainer.style.cursor="ns-resize";break;case 3:if(this.data.getToolClickStatus())break;this.screenShotContainer.style.cursor="ew-resize";break;case 4:if(this.data.getToolClickStatus())break;this.screenShotContainer.style.cursor="nwse-resize";break;case 5:if(this.data.getToolClickStatus())break;this.screenShotContainer.style.cursor="nesw-resize";break}this.borderOption=this.cutOutBoxBorderArr[a].option,h=!0;break}this.mouseInsideCropBox=h,l.closePath(),h||(this.screenShotContainer.style.cursor="default",this.tempContainer.style.cursor="default",this.borderOption=null),this.data.getToolClickStatus()&&h&&this.tempContainer&&(this.data.getToolName()=="mosaicPen"?this.data.getPenSize()==1?(this.screenShotContainer.style.cursor=`url('${this.mosaicSmall}') 7 7, auto`,this.tempContainer.style.cursor=`url('${this.mosaicSmall}') 7 7, auto`):this.data.getPenSize()==3?(this.screenShotContainer.style.cursor=`url('${this.mosaicMillde}') 9 9, auto`,this.tempContainer.style.cursor=`url('${this.mosaicMillde}') 9 9, auto`):(this.screenShotContainer.style.cursor=`url('${this.mosaicBig}') 11 11, auto`,this.tempContainer.style.cursor=`url('${this.mosaicBig}') 11 11, auto`):this.tempContainer.style.cursor="default")}if(this.data.getDraggingTrim())if(this.borderOption===1){let h=Ft(t-(d-n),o,this.screenShotContainer.width),a=Ft(e-(c-s),r,this.screenShotContainer.height);const g=this.screenViewSize.width,w=this.screenViewSize.height,f=h+o,m=a+r;f>g&&(h=g-o),m>w&&(a=w-r),this.tempGraphPosition=W(h,a,o,r,l,this.data.getBorderSize(),this.screenShotContainer,this.screenShotImageController,!1)}else{this.isShowMagnifier=!1;const{tempStartX:h,tempStartY:a,tempWidth:g,tempHeight:w}=ze(t,e,n,s,o,r,this.borderOption);this.tempGraphPosition=W(h,a,g,w,l,this.data.getBorderSize(),this.screenShotContainer,this.screenShotImageController,!1)}}async drawPictures(t,e,n){var s;this.screenShotContainer!=null&&(console.log("imageData:",n),this.imageBitmap=await createImageBitmap(n),(s=this.screenShotImageController.getContext("2d"))==null||s.drawImage(this.imageBitmap,0,0,this.screenShotImageController.width,this.screenShotImageController.height),te(()=>{var o;this.canvasImageData=(o=this.screenShotImageController.getContext("2d"))==null?void 0:o.getImageData(0,0,this.screenShotImageController.width,this.screenShotImageController.height)}),console.log("this.dpr",this.dpr),console.log("this.screenShotImageController.width",this.screenShotImageController.width,this.screenShotImageController.height),this.initScreenShot(t,e,this.screenShotImageController))}async initScreenShot(t,e,n){t!=null&&t({code:0,msg:"截图加载完成"}),this.screenShotCanvas=e,this.data.setScreenShotImageController(n),await Me(e,n,this.plugInParameters.getScreenFlow()),document.addEventListener("mousedown",this.mouseDownEvent),document.addEventListener("mousemove",this.mouseMoveEvent),document.addEventListener("mouseup",this.mouseUpEvent),document.addEventListener("mouseleave",this.leaveWindow),document.addEventListener("mousewheel",function(s){s.preventDefault()},{passive:!1})}cleanSelectArea(){console.log("取消框选和放大镜"),this.data.setMagnifierStatus(!1),this.screenShotCanvas&&this.screenShotContainer&&!this.isScreenFinish&&(this.tempGraphPosition=W(this.windowBoxX,this.windowBoxY,this.windowBoxW,this.windowBoxH,this.screenShotCanvas,this.data.getBorderSize(),this.screenShotContainer,this.screenShotImageController,!0))}}const Oe={class:"screen_shot"},pi=ee({__name:"index",setup(i){ie(async()=>{let o=await window.ScreenShotHelper.loadScreenShotData();console.info("readyData:",o);let r=o.allWindows;r==null||r.sort((c,h)=>h.level-c.level);let l=o.screenInfo.screenIndex;const d=new Ne({enableWebRtc:!1,showScreenData:!0,imgData:o.screenInfo.imgData,screenIndex:l,canvasWidth:o.screenInfo.width,canvasHeight:o.screenInfo.height,windowList:r,level:999,completeCallback:t,closeCallback:n,saveCallback:e,customRightClickEvent:{state:!0,handleFn:s},wrcReplyTime:500,clickCutFullScreen:!0,hiddenToolIco:{}},async()=>{let c=await window.ScreenShotHelper.getAllWindowsInfo();await d.setWindowList(c)})});const t=o=>{window.RendererHelper.setClipboardByMainProcess(null,null,o),window.ScreenShotHelper.screenShotFinished({e:o}),window.close()},e=o=>{console.log(o),o==0&&setTimeout(()=>{window.close()},500)},n=()=>{window.close()},s=()=>{window.close()};return(o,r)=>(ne(),se("div",Oe))}});export{pi as default};
