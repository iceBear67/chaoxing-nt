import{u as St,_ as Zt,w as Cs,e as ns,d as cn,g as Mt,j as en,E as $o,b as vs,f as Po,l as dn,S as Fo,k as zt,T as tn,y as Bo,D as sn,n as Hs,N as Wo,o as Uo,U as Dn,s as qs,t as Ko}from"./base-82955267.js";import{g as zo,i as Ln,r as jn,P as Vn,M as Go,m as jo,b as Vo}from"./msg-render-self.vue_vue_type_style_index_1_lang-eac93c38.js";import{a as qe,l as p,i as Ne,I as ze,G as yt,L as nn,bh as Yo,h as o,U as Yn,aP as An,r as Z,ay as qo,bc as Xo,c as J,C as Ve,n as xs,o as rs,m as we,e as H,j as D,k as Qe,y as je,p as Y,b,F as at,J as _t,f as Q,R as _s,g as Nt,bk as qn,a0 as Jo,V as $s,W as Ps,a_ as Xn,B as Gt,aH as Vt,aC as On,Z as bt,az as Jn,Q as Ut,w as Be,v as Ue,H as Zo,a1 as Qo,$ as er,_ as js,u as bs,q as as,x as tr,M as Zn,z as un,A as fn,s as sr,X as Qn,D as nr,t as or}from"./index-26603ea5.js";/* empty css                    */import{d as rr}from"./avatar-d72faaaf.js";import{B as gn}from"./index-94663b0f.js";import{r as Fs}from"./time-f90370a8.js";import{M as is,aA as Xs,a0 as ar,D as ir,b as lr,B as Vs,aC as ks,aD as Rn,aE as cr,aF as dr,aG as hn,aH as Hn,aI as ur,x as fr,t as $n,o as Js,w as gr,q as hr,r as mr,aJ as pr,Z as vr,G as eo,m as ee,aK as on,aL as yr,a5 as to,a6 as so,as as no,aM as oo,aN as wr,af as Bs,aO as ro,aa as ao,ab as io,a7 as lo,ag as co,_ as uo,ac as fo,av as Zs,P as xr,ap as kr}from"./message-4d42f580.js";import{u as he}from"./index-46519fef.js";import{_ as pe,l as Cr}from"./lodash-4dfbea43.js";import{M as Fe,C as Me,F as _r}from"./message-fe5b63d1.js";import{d as mn}from"./avatar-13472c92.js";import{T as Pe,c as gt}from"./index-b0b4f58c.js";import{M as ws}from"./index-ab028c07.js";import{b as br,E as Ws,c as Us,G as go,e as ho}from"./emoji-f1b6b027.js";import{s as Ir}from"./validate-f7672251.js";import{t as Tr}from"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";import{d as Er,u as Mr}from"./forward-bb18e89e.js";import{u as Nr}from"./el-input-983a785f.js";import"./el-popper-548470bb.js";import{E as pn}from"./index-3e12c228.js";/* empty css                     */import{s as Sr}from"./token-dd454517.js";import{t as Dr,u as Lr,E as Et,c as Ar,h as Or,i as Rr,z as Hr,x as $r,y as Pr,A as Fr,l as Br,B as Wr}from"./index-952b158c.js";import{c as Ur,i as Kr}from"./icon-803f5cc0.js";import{u as zr}from"./use-form-common-props-325f2441.js";import{c as Kt}from"./index-9c66cebd.js";import{E as lt}from"./aria-60e0cdc6.js";import{u as vn}from"./index-e5f0a9f0.js";import{a as Gr}from"./constants-84857360.js";import{i as jr}from"./isEqual-c46d625c.js";import{E as Vr}from"./index-853a0f6e.js";import{t as Yr}from"./image-e958eb32.js";import{b as qr}from"./createAttachment-a64a5f42.js";import{E as Xr,a as Jr}from"./index-12f9ba11.js";import{m as mo}from"./typescript-defaf979.js";import{u as Zr}from"./index-57013d5d.js";import{k as Qr}from"./use-global-config-c67545e0.js";import{a as ea}from"./_baseGet-ad9634b7.js";import{g as ta}from"./index-7e6c4fb9.js";var sa="Expected a function";function Qs(s,t,e){var r=!0,n=!0;if(typeof s!="function")throw new TypeError(sa);return ea(e)&&(r="leading"in e?!!e.leading:r,n="trailing"in e?!!e.trailing:n),Er(s,t,{leading:r,maxWait:t,trailing:n})}const na=qe({name:"ElCollapseTransition"}),oa=qe({...na,setup(s){const t=St("collapse-transition"),e=n=>{n.style.maxHeight="",n.style.overflow=n.dataset.oldOverflow,n.style.paddingTop=n.dataset.oldPaddingTop,n.style.paddingBottom=n.dataset.oldPaddingBottom},r={beforeEnter(n){n.dataset||(n.dataset={}),n.dataset.oldPaddingTop=n.style.paddingTop,n.dataset.oldPaddingBottom=n.style.paddingBottom,n.style.height&&(n.dataset.elExistsHeight=n.style.height),n.style.maxHeight=0,n.style.paddingTop=0,n.style.paddingBottom=0},enter(n){requestAnimationFrame(()=>{n.dataset.oldOverflow=n.style.overflow,n.dataset.elExistsHeight?n.style.maxHeight=n.dataset.elExistsHeight:n.scrollHeight!==0?n.style.maxHeight=`${n.scrollHeight}px`:n.style.maxHeight=0,n.style.paddingTop=n.dataset.oldPaddingTop,n.style.paddingBottom=n.dataset.oldPaddingBottom,n.style.overflow="hidden"})},afterEnter(n){n.style.maxHeight="",n.style.overflow=n.dataset.oldOverflow},enterCancelled(n){e(n)},beforeLeave(n){n.dataset||(n.dataset={}),n.dataset.oldPaddingTop=n.style.paddingTop,n.dataset.oldPaddingBottom=n.style.paddingBottom,n.dataset.oldOverflow=n.style.overflow,n.style.maxHeight=`${n.scrollHeight}px`,n.style.overflow="hidden"},leave(n){n.scrollHeight!==0&&(n.style.maxHeight=0,n.style.paddingTop=0,n.style.paddingBottom=0)},afterLeave(n){e(n)},leaveCancelled(n){e(n)}};return(n,l)=>(p(),Ne(Yn,nn({name:o(t).b()},Yo(r)),{default:ze(()=>[yt(n.$slots,"default")]),_:3},16,["name"]))}});var ra=Zt(oa,[["__file","collapse-transition.vue"]]);const aa=Cs(ra),ia=(s,t)=>{if(!ns||!s||!t)return!1;const e=s.getBoundingClientRect();let r;return t instanceof Element?r=t.getBoundingClientRect():r={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},e.top<r.bottom&&e.bottom>r.top&&e.right>r.left&&e.left<r.right},la=cn({urlList:{type:Mt(Array),default:()=>mo([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Mt(String)}}),ca={close:()=>!0,switch:s=>en(s),rotate:s=>en(s)},da=qe({name:"ElImageViewer"}),ua=qe({...da,props:la,emits:ca,setup(s,{expose:t,emit:e}){var r;const n=s,l={CONTAIN:{name:"contain",icon:An(Dr)},ORIGINAL:{name:"original",icon:An(Lr)}};let m,g="";const{t:k}=vn(),C=St("image-viewer"),{nextZIndex:y}=Zr(),L=Z(),N=Z([]),B=qo(),F=Z(!0),G=Z(n.initialIndex),te=Xo(l.CONTAIN),U=Z({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),le=Z((r=n.zIndex)!=null?r:y()),V=J(()=>{const{urlList:q}=n;return q.length<=1}),We=J(()=>G.value===0),Le=J(()=>G.value===n.urlList.length-1),_e=J(()=>n.urlList[G.value]),me=J(()=>[C.e("btn"),C.e("prev"),C.is("disabled",!n.infinite&&We.value)]),re=J(()=>[C.e("btn"),C.e("next"),C.is("disabled",!n.infinite&&Le.value)]),I=J(()=>{const{scale:q,deg:ue,offsetX:ie,offsetY:be,enableTransition:xe}=U.value;let Ee=ie/q,Se=be/q;const Ke=ue*Math.PI/180,ct=Math.cos(Ke),tt=Math.sin(Ke);Ee=Ee*ct+Se*tt,Se=Se*ct-ie/q*tt;const nt={transform:`scale(${q}) rotate(${ue}deg) translate(${Ee}px, ${Se}px)`,transition:xe?"transform .3s":""};return te.value.name===l.CONTAIN.name&&(nt.maxWidth=nt.maxHeight="100%"),nt}),P=J(()=>`${G.value+1} / ${n.urlList.length}`);function ce(){ae(),m==null||m(),document.body.style.overflow=g,e("close")}function de(){const q=Qs(ie=>{switch(ie.code){case lt.esc:n.closeOnPressEscape&&ce();break;case lt.space:O();break;case lt.left:Oe();break;case lt.up:Ae("zoomIn");break;case lt.right:$e();break;case lt.down:Ae("zoomOut");break}}),ue=Qs(ie=>{const be=ie.deltaY||ie.deltaX;Ae(be<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});B.run(()=>{Kt(document,"keydown",q),Kt(document,"wheel",ue)})}function ae(){B.stop()}function ge(){F.value=!1}function Ie(q){F.value=!1,q.target.alt=k("el.image.error")}function W(q){if(F.value||q.button!==0||!L.value)return;U.value.enableTransition=!1;const{offsetX:ue,offsetY:ie}=U.value,be=q.pageX,xe=q.pageY,Ee=Qs(Ke=>{U.value={...U.value,offsetX:ue+Ke.pageX-be,offsetY:ie+Ke.pageY-xe}}),Se=Kt(document,"mousemove",Ee);Kt(document,"mouseup",()=>{Se()}),q.preventDefault()}function Te(){U.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function O(){if(F.value)return;const q=Qr(l),ue=Object.values(l),ie=te.value.name,xe=(ue.findIndex(Ee=>Ee.name===ie)+1)%q.length;te.value=l[q[xe]],Te()}function X(q){const ue=n.urlList.length;G.value=(q+ue)%ue}function Oe(){We.value&&!n.infinite||X(G.value-1)}function $e(){Le.value&&!n.infinite||X(G.value+1)}function Ae(q,ue={}){if(F.value)return;const{minScale:ie,maxScale:be}=n,{zoomRate:xe,rotateDeg:Ee,enableTransition:Se}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...ue};switch(q){case"zoomOut":U.value.scale>ie&&(U.value.scale=Number.parseFloat((U.value.scale/xe).toFixed(3)));break;case"zoomIn":U.value.scale<be&&(U.value.scale=Number.parseFloat((U.value.scale*xe).toFixed(3)));break;case"clockwise":U.value.deg+=Ee,e("rotate",U.value.deg);break;case"anticlockwise":U.value.deg-=Ee,e("rotate",U.value.deg);break}U.value.enableTransition=Se}function st(q){var ue;((ue=q.detail)==null?void 0:ue.focusReason)==="pointer"&&q.preventDefault()}function et(){n.closeOnPressEscape&&ce()}function Ge(q){if(q.ctrlKey){if(q.deltaY<0)return q.preventDefault(),!1;if(q.deltaY>0)return q.preventDefault(),!1}}return Ve(_e,()=>{xs(()=>{const q=N.value[0];q!=null&&q.complete||(F.value=!0)})}),Ve(G,q=>{Te(),e("switch",q)}),rs(()=>{de(),m=Kt("wheel",Ge,{passive:!1}),g=document.body.style.overflow,document.body.style.overflow="hidden"}),t({setActiveItem:X}),(q,ue)=>(p(),Ne(o(Jr),{to:"body",disabled:!q.teleported},{default:ze(()=>[we(Yn,{name:"viewer-fade",appear:""},{default:ze(()=>[H("div",{ref_key:"wrapper",ref:L,tabindex:-1,class:D(o(C).e("wrapper")),style:Qe({zIndex:le.value})},[we(o(Xr),{loop:"",trapped:"","focus-trap-el":L.value,"focus-start-el":"container",onFocusoutPrevented:st,onReleaseRequested:et},{default:ze(()=>[H("div",{class:D(o(C).e("mask")),onClick:je(ie=>q.hideOnClickModal&&ce(),["self"])},null,10,["onClick"]),Y(" CLOSE "),H("span",{class:D([o(C).e("btn"),o(C).e("close")]),onClick:ce},[we(o(Et),null,{default:ze(()=>[we(o(Ar))]),_:1})],2),Y(" ARROW "),o(V)?Y("v-if",!0):(p(),b(at,{key:0},[H("span",{class:D(o(me)),onClick:Oe},[we(o(Et),null,{default:ze(()=>[we(o(Or))]),_:1})],2),H("span",{class:D(o(re)),onClick:$e},[we(o(Et),null,{default:ze(()=>[we(o(Rr))]),_:1})],2)],64)),q.$slots.progress||q.showProgress?(p(),b("div",{key:1,class:D([o(C).e("btn"),o(C).e("progress")])},[yt(q.$slots,"progress",{activeIndex:G.value,total:q.urlList.length},()=>[_t(Q(o(P)),1)])],2)):Y("v-if",!0),Y(" ACTIONS "),H("div",{class:D([o(C).e("btn"),o(C).e("actions")])},[H("div",{class:D(o(C).e("actions__inner"))},[yt(q.$slots,"toolbar",{actions:Ae,prev:Oe,next:$e,reset:O,activeIndex:G.value,setActiveItem:X},()=>[we(o(Et),{onClick:ie=>Ae("zoomOut")},{default:ze(()=>[we(o(Hr))]),_:1},8,["onClick"]),we(o(Et),{onClick:ie=>Ae("zoomIn")},{default:ze(()=>[we(o($r))]),_:1},8,["onClick"]),H("i",{class:D(o(C).e("actions__divider"))},null,2),we(o(Et),{onClick:O},{default:ze(()=>[(p(),Ne(_s(o(te).icon)))]),_:1}),H("i",{class:D(o(C).e("actions__divider"))},null,2),we(o(Et),{onClick:ie=>Ae("anticlockwise")},{default:ze(()=>[we(o(Pr))]),_:1},8,["onClick"]),we(o(Et),{onClick:ie=>Ae("clockwise")},{default:ze(()=>[we(o(Fr))]),_:1},8,["onClick"])])],2)],2),Y(" CANVAS "),H("div",{class:D(o(C).e("canvas"))},[(p(!0),b(at,null,Nt(q.urlList,(ie,be)=>(p(),b(at,{key:be},[be===G.value?(p(),b("img",{key:0,ref_for:!0,ref:xe=>N.value[be]=xe,src:ie,style:Qe(o(I)),class:D(o(C).e("img")),crossorigin:q.crossorigin,onLoad:ge,onError:Ie,onMousedown:W},null,46,["src","crossorigin"])):Y("v-if",!0)],64))),128))],2),yt(q.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var fa=Zt(ua,[["__file","image-viewer.vue"]]);const ga=Cs(fa),ha=cn({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:Mt([String,Object])},previewSrcList:{type:Mt(Array),default:()=>mo([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Mt(String)}}),ma={load:s=>s instanceof Event,error:s=>s instanceof Event,switch:s=>en(s),close:()=>!0,show:()=>!0},pa=qe({name:"ElImage",inheritAttrs:!1}),va=qe({...pa,props:ha,emits:ma,setup(s,{expose:t,emit:e}){const r=s,{t:n}=vn(),l=St("image"),m=qn(),g=J(()=>$o(Object.entries(m).filter(([W])=>/^(data-|on[A-Z])/i.test(W)||["id","style"].includes(W)))),k=Nr({excludeListeners:!0,excludeKeys:J(()=>Object.keys(g.value))}),C=Z(),y=Z(!1),L=Z(!0),N=Z(!1),B=Z(),F=Z(),G=ns&&"loading"in HTMLImageElement.prototype;let te;const U=J(()=>[l.e("inner"),V.value&&l.e("preview"),L.value&&l.is("loading")]),le=J(()=>{const{fit:W}=r;return ns&&W?{objectFit:W}:{}}),V=J(()=>{const{previewSrcList:W}=r;return vs(W)&&W.length>0}),We=J(()=>{const{previewSrcList:W,initialIndex:Te}=r;let O=Te;return Te>W.length-1&&(O=0),O}),Le=J(()=>r.loading==="eager"?!1:!G&&r.loading==="lazy"||r.lazy),_e=()=>{ns&&(L.value=!0,y.value=!1,C.value=r.src)};function me(W){L.value=!1,y.value=!1,e("load",W)}function re(W){L.value=!1,y.value=!0,e("error",W)}function I(){ia(B.value,F.value)&&(_e(),de())}const P=Fo(I,200,!0);async function ce(){var W;if(!ns)return;await xs();const{scrollContainer:Te}=r;Po(Te)?F.value=Te:dn(Te)&&Te!==""?F.value=(W=document.querySelector(Te))!=null?W:void 0:B.value&&(F.value=ta(B.value)),F.value&&(te=Kt(F,"scroll",P),setTimeout(()=>I(),100))}function de(){!ns||!F.value||!P||(te==null||te(),F.value=void 0)}function ae(){V.value&&(N.value=!0,e("show"))}function ge(){N.value=!1,e("close")}function Ie(W){e("switch",W)}return Ve(()=>r.src,()=>{Le.value?(L.value=!0,y.value=!1,de(),ce()):_e()}),rs(()=>{Le.value?ce():_e()}),t({showPreview:ae}),(W,Te)=>(p(),b("div",nn({ref_key:"container",ref:B},o(g),{class:[o(l).b(),W.$attrs.class]}),[y.value?yt(W.$slots,"error",{key:0},()=>[H("div",{class:D(o(l).e("error"))},Q(o(n)("el.image.error")),3)]):(p(),b(at,{key:1},[C.value!==void 0?(p(),b("img",nn({key:0},o(k),{src:C.value,loading:W.loading,style:o(le),class:o(U),crossorigin:W.crossorigin,onClick:ae,onLoad:me,onError:re}),null,16,["src","loading","crossorigin"])):Y("v-if",!0),L.value?(p(),b("div",{key:1,class:D(o(l).e("wrapper"))},[yt(W.$slots,"placeholder",{},()=>[H("div",{class:D(o(l).e("placeholder"))},null,2)])],2)):Y("v-if",!0)],64)),o(V)?(p(),b(at,{key:2},[N.value?(p(),Ne(o(ga),{key:0,"z-index":W.zIndex,"initial-index":o(We),infinite:W.infinite,"zoom-rate":W.zoomRate,"min-scale":W.minScale,"max-scale":W.maxScale,"show-progress":W.showProgress,"url-list":W.previewSrcList,crossorigin:W.crossorigin,"hide-on-click-modal":W.hideOnClickModal,teleported:W.previewTeleported,"close-on-press-escape":W.closeOnPressEscape,onClose:ge,onSwitch:Ie},Jo({toolbar:ze(O=>[yt(W.$slots,"toolbar",$s(Ps(O)))]),default:ze(()=>[W.$slots.viewer?(p(),b("div",{key:0},[yt(W.$slots,"viewer")])):Y("v-if",!0)]),_:2},[W.$slots.progress?{name:"progress",fn:ze(O=>[yt(W.$slots,"progress",$s(Ps(O)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):Y("v-if",!0)],64)):Y("v-if",!0)],16))}});var ya=Zt(va,[["__file","image.vue"]]);const po=Cs(ya),wa=cn({type:{type:String,values:["primary","success","info","warning","danger",""],default:""},size:{type:String,values:Ur,default:""},truncated:Boolean,lineClamp:{type:[String,Number]},tag:{type:String,default:"span"}}),xa=qe({name:"ElText"}),ka=qe({...xa,props:wa,setup(s){const t=s,e=Z(),r=zr(),n=St("text"),l=J(()=>[n.b(),n.m(t.type),n.m(r.value),n.is("truncated",t.truncated),n.is("line-clamp",!zt(t.lineClamp))]),m=()=>{var g,k,C,y,L,N,B;if(qn().title)return;let G=!1;const te=((g=e.value)==null?void 0:g.textContent)||"";if(t.truncated){const U=(k=e.value)==null?void 0:k.offsetWidth,le=(C=e.value)==null?void 0:C.scrollWidth;U&&le&&le>U&&(G=!0)}else if(!zt(t.lineClamp)){const U=(y=e.value)==null?void 0:y.offsetHeight,le=(L=e.value)==null?void 0:L.scrollHeight;U&&le&&le>U&&(G=!0)}G?(N=e.value)==null||N.setAttribute("title",te):(B=e.value)==null||B.removeAttribute("title")};return rs(m),Xn(m),(g,k)=>(p(),Ne(_s(g.tag),{ref_key:"textRef",ref:e,class:D(o(l)),style:Qe({"-webkit-line-clamp":g.lineClamp})},{default:ze(()=>[yt(g.$slots,"default")]),_:3},8,["class","style"]))}});var Ca=Zt(ka,[["__file","text.vue"]]);const _a=Cs(Ca),os="$treeNodeId",Pn=function(s,t){!t||t[os]||Object.defineProperty(t,os,{value:s.id,enumerable:!1,configurable:!1,writable:!1})},yn=(s,t)=>t==null?void 0:t[s||os],rn=(s,t,e)=>{const r=s.value.currentNode;e();const n=s.value.currentNode;r!==n&&t("current-change",n?n.data:null,n)},an=s=>{let t=!0,e=!0,r=!0;for(let n=0,l=s.length;n<l;n++){const m=s[n];(m.checked!==!0||m.indeterminate)&&(t=!1,m.disabled||(r=!1)),(m.checked!==!1||m.indeterminate)&&(e=!1)}return{all:t,none:e,allWithoutDisable:r,half:!t&&!e}},ys=function(s){if(s.childNodes.length===0||s.loading)return;const{all:t,none:e,half:r}=an(s.childNodes);t?(s.checked=!0,s.indeterminate=!1):r?(s.checked=!1,s.indeterminate=!0):e&&(s.checked=!1,s.indeterminate=!1);const n=s.parent;!n||n.level===0||s.store.checkStrictly||ys(n)},Ls=function(s,t){const e=s.store.props,r=s.data||{},n=e[t];if(Hs(n))return n(r,s);if(dn(n))return r[n];if(zt(n)){const l=r[t];return zt(l)?"":l}},ln=function(s,t){s.forEach(e=>{e.canFocus=t,ln(e.childNodes,t)})};let ba=0;class jt{constructor(t){this.isLeafByUser=void 0,this.isLeaf=void 0,this.id=ba++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const e in t)tn(t,e)&&(this[e]=t[e]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){var t;const e=this.store;if(!e)throw new Error("[Node]store is required!");e.registerNode(this);const r=e.props;if(r&&typeof r.isLeaf<"u"){const m=Ls(this,"isLeaf");Bo(m)&&(this.isLeafByUser=m)}if(e.lazy!==!0&&this.data?(this.setData(this.data),e.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&e.lazy&&e.defaultExpandAll&&!this.isLeafByUser&&this.expand(),vs(this.data)||Pn(this,this.data),!this.data)return;const n=e.defaultExpandedKeys,l=e.key;l&&!sn(this.key)&&n&&n.includes(this.key)&&this.expand(null,e.autoExpandParent),l&&e.currentNodeKey!==void 0&&this.key===e.currentNodeKey&&(e.currentNode=this,e.currentNode.isCurrent=!0),e.lazy&&e._initDefaultCheckedNode(this),this.updateLeafState(),(this.level===1||((t=this.parent)==null?void 0:t.expanded)===!0)&&(this.canFocus=!0)}setData(t){vs(t)||Pn(this,t),this.data=t,this.childNodes=[];let e;this.level===0&&vs(this.data)?e=this.data:e=Ls(this,"children")||[];for(let r=0,n=e.length;r<n;r++)this.insertChild({data:e[r]})}get label(){return Ls(this,"label")}get key(){const t=this.store.key;return this.data?this.data[t]:null}get disabled(){return Ls(this,"disabled")}get nextSibling(){const t=this.parent;if(t){const e=t.childNodes.indexOf(this);if(e>-1)return t.childNodes[e+1]}return null}get previousSibling(){const t=this.parent;if(t){const e=t.childNodes.indexOf(this);if(e>-1)return e>0?t.childNodes[e-1]:null}return null}contains(t,e=!0){return(this.childNodes||[]).some(r=>r===t||e&&r.contains(t))}remove(){const t=this.parent;t&&t.removeChild(this)}insertChild(t,e,r){if(!t)throw new Error("InsertChild error: child is required.");if(!(t instanceof jt)){if(!r){const n=this.getChildren(!0);n!=null&&n.includes(t.data)||(zt(e)||e<0?n==null||n.push(t.data):n==null||n.splice(e,0,t.data))}Object.assign(t,{parent:this,store:this.store}),t=Gt(new jt(t)),t instanceof jt&&t.initialize()}t.level=this.level+1,zt(e)||e<0?this.childNodes.push(t):this.childNodes.splice(e,0,t),this.updateLeafState()}insertBefore(t,e){let r;e&&(r=this.childNodes.indexOf(e)),this.insertChild(t,r)}insertAfter(t,e){let r;e&&(r=this.childNodes.indexOf(e),r!==-1&&(r+=1)),this.insertChild(t,r)}removeChild(t){const e=this.getChildren()||[],r=e.indexOf(t.data);r>-1&&e.splice(r,1);const n=this.childNodes.indexOf(t);n>-1&&(this.store&&this.store.deregisterNode(t),t.parent=null,this.childNodes.splice(n,1)),this.updateLeafState()}removeChildByData(t){let e=null;for(let r=0;r<this.childNodes.length;r++)if(this.childNodes[r].data===t){e=this.childNodes[r];break}e&&this.removeChild(e)}expand(t,e){const r=()=>{if(e){let n=this.parent;for(;n&&n.level>0;)n.expanded=!0,n=n.parent}this.expanded=!0,t&&t(),ln(this.childNodes,!0)};this.shouldLoadData()?this.loadData(n=>{vs(n)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||ys(this),r())}):r()}doCreateChildren(t,e={}){t.forEach(r=>{this.insertChild(Object.assign({data:r},e),void 0,!0)})}collapse(){this.expanded=!1,ln(this.childNodes,!1)}shouldLoadData(){return!!(this.store.lazy===!0&&this.store.load&&!this.loaded)}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser<"u"){this.isLeaf=this.isLeafByUser;return}const t=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!t||t.length===0;return}this.isLeaf=!1}setChecked(t,e,r,n){if(this.indeterminate=t==="half",this.checked=t===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:m,allWithoutDisable:g}=an(this.childNodes);!this.isLeaf&&!m&&g&&(this.checked=!1,t=!1);const k=()=>{if(e){const C=this.childNodes;for(let N=0,B=C.length;N<B;N++){const F=C[N];n=n||t!==!1;const G=F.disabled?F.checked:n;F.setChecked(G,e,!0,n)}const{half:y,all:L}=an(C);L||(this.checked=L,this.indeterminate=y)}};if(this.shouldLoadData()){this.loadData(()=>{k(),ys(this)},{checked:t!==!1});return}else k()}const l=this.parent;!l||l.level===0||r||ys(l)}getChildren(t=!1){if(this.level===0)return this.data;const e=this.data;if(!e)return null;const r=this.store.props;let n="children";return r&&(n=r.children||"children"),zt(e[n])&&(e[n]=null),t&&!e[n]&&(e[n]=[]),e[n]}updateChildren(){const t=this.getChildren()||[],e=this.childNodes.map(l=>l.data),r={},n=[];t.forEach((l,m)=>{const g=l[os];!!g&&e.findIndex(C=>(C==null?void 0:C[os])===g)>=0?r[g]={index:m,data:l}:n.push({index:m,data:l})}),this.store.lazy||e.forEach(l=>{r[l==null?void 0:l[os]]||this.removeChildByData(l)}),n.forEach(({index:l,data:m})=>{this.insertChild({data:m},l)}),this.updateLeafState()}loadData(t,e={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(e).length)){this.loading=!0;const r=l=>{this.childNodes=[],this.doCreateChildren(l,e),this.loaded=!0,this.loading=!1,this.updateLeafState(),t&&t.call(this,l)},n=()=>{this.loading=!1};this.store.load(this,r,n)}else t&&t.call(this)}eachNode(t){const e=[this];for(;e.length;){const r=e.shift();e.unshift(...r.childNodes),t(r)}}reInitChecked(){this.store.checkStrictly||ys(this)}}class Ia{constructor(t){this.lazy=!1,this.checkStrictly=!1,this.autoExpandParent=!1,this.defaultExpandAll=!1,this.checkDescendants=!1,this.currentNode=null,this.currentNodeKey=null;for(const e in t)tn(t,e)&&(this[e]=t[e]);this.nodesMap={}}initialize(){if(this.root=new jt({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const t=this.load;t(this.root,e=>{this.root.doCreateChildren(e),this._initDefaultCheckedNodes()},Wo)}else this._initDefaultCheckedNodes()}filter(t){const e=this.filterNodeMethod,r=this.lazy,n=async function(l){const m=l.root?l.root.childNodes:l.childNodes;for(const[g,k]of m.entries())k.visible=!!(e!=null&&e.call(k,t,k.data,k)),g%80===0&&g>0&&await xs(),await n(k);if(!l.visible&&m.length){let g=!0;g=!m.some(k=>k.visible),l.root?l.root.visible=g===!1:l.visible=g===!1}t&&l.visible&&!l.isLeaf&&(!r||l.loaded)&&l.expand()};n(this)}setData(t){t!==this.root.data?(this.nodesMap={},this.root.setData(t),this._initDefaultCheckedNodes(),this.setCurrentNodeKey(this.currentNodeKey)):this.root.updateChildren()}getNode(t){if(t instanceof jt)return t;const e=Uo(t)?yn(this.key,t):t;return this.nodesMap[e]||null}insertBefore(t,e){var r;const n=this.getNode(e);(r=n.parent)==null||r.insertBefore({data:t},n)}insertAfter(t,e){var r;const n=this.getNode(e);(r=n.parent)==null||r.insertAfter({data:t},n)}remove(t){const e=this.getNode(t);e&&e.parent&&(e===this.currentNode&&(this.currentNode=null),e.parent.removeChild(e))}append(t,e){const r=Dn(e)?this.root:this.getNode(e);r&&r.insertChild({data:t})}_initDefaultCheckedNodes(){const t=this.defaultCheckedKeys||[],e=this.nodesMap;t.forEach(r=>{const n=e[r];n&&n.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(t){const e=this.defaultCheckedKeys||[];!sn(t.key)&&e.includes(t.key)&&t.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(t){t!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=t,this._initDefaultCheckedNodes())}registerNode(t){const e=this.key;if(!(!t||!t.data))if(!e)this.nodesMap[t.id]=t;else{const r=t.key;sn(r)||(this.nodesMap[r]=t)}}deregisterNode(t){!this.key||!t||!t.data||(t.childNodes.forEach(r=>{this.deregisterNode(r)}),delete this.nodesMap[t.key])}getCheckedNodes(t=!1,e=!1){const r=[],n=function(l){(l.root?l.root.childNodes:l.childNodes).forEach(g=>{(g.checked||e&&g.indeterminate)&&(!t||t&&g.isLeaf)&&r.push(g.data),n(g)})};return n(this),r}getCheckedKeys(t=!1){return this.getCheckedNodes(t).map(e=>(e||{})[this.key])}getHalfCheckedNodes(){const t=[],e=function(r){(r.root?r.root.childNodes:r.childNodes).forEach(l=>{l.indeterminate&&t.push(l.data),e(l)})};return e(this),t}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(t=>(t||{})[this.key])}_getAllNodes(){const t=[],e=this.nodesMap;for(const r in e)tn(e,r)&&t.push(e[r]);return t}updateChildren(t,e){const r=this.nodesMap[t];if(!r)return;const n=r.childNodes;for(let l=n.length-1;l>=0;l--){const m=n[l];this.remove(m.data)}for(let l=0,m=e.length;l<m;l++){const g=e[l];this.append(g,r.data)}}_setCheckedKeys(t,e=!1,r){const n=this._getAllNodes().sort((k,C)=>k.level-C.level),l=Object.create(null),m=Object.keys(r);n.forEach(k=>k.setChecked(!1,!1));const g=k=>{k.childNodes.forEach(C=>{var y;l[C.data[t]]=!0,(y=C.childNodes)!=null&&y.length&&g(C)})};for(let k=0,C=n.length;k<C;k++){const y=n[k],L=y.data[t].toString();if(!m.includes(L)){y.checked&&!l[L]&&y.setChecked(!1,!1);continue}if(y.childNodes.length&&g(y),y.isLeaf||this.checkStrictly){y.setChecked(!0,!1);continue}if(y.setChecked(!0,!0),e){y.setChecked(!1,!1);const B=function(F){F.childNodes.forEach(te=>{te.isLeaf||te.setChecked(!1,!1),B(te)})};B(y)}}}setCheckedNodes(t,e=!1){const r=this.key,n={};t.forEach(l=>{n[(l||{})[r]]=!0}),this._setCheckedKeys(r,e,n)}setCheckedKeys(t,e=!1){this.defaultCheckedKeys=t;const r=this.key,n={};t.forEach(l=>{n[l]=!0}),this._setCheckedKeys(r,e,n)}setDefaultExpandedKeys(t){t=t||[],this.defaultExpandedKeys=t,t.forEach(e=>{const r=this.getNode(e);r&&r.expand(null,this.autoExpandParent)})}setChecked(t,e,r){const n=this.getNode(t);n&&n.setChecked(!!e,r)}getCurrentNode(){return this.currentNode}setCurrentNode(t){const e=this.currentNode;e&&(e.isCurrent=!1),this.currentNode=t,this.currentNode.isCurrent=!0}setUserCurrentNode(t,e=!0){var r;const n=t[this.key],l=this.nodesMap[n];this.setCurrentNode(l),e&&this.currentNode&&this.currentNode.level>1&&((r=this.currentNode.parent)==null||r.expand(null,!0))}setCurrentNodeKey(t,e=!0){var r;if(this.currentNodeKey=t,Dn(t)){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const n=this.getNode(t);n&&(this.setCurrentNode(n),e&&this.currentNode&&this.currentNode.level>1&&((r=this.currentNode.parent)==null||r.expand(null,!0)))}}const wn="RootTree",vo="NodeInstance",Fn="TreeNodeMap",Ta=qe({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(s){const t=St("tree"),e=Vt(vo),r=Vt(wn);return()=>{const n=s.node,{data:l,store:m}=n;return s.renderContent?s.renderContent(On,{_self:e,node:n,data:l,store:m}):yt(r.ctx.slots,"default",{node:n,data:l},()=>[On(_a,{tag:"span",truncated:!0,class:t.be("node","label")},()=>[n.label])])}}});var Ea=Zt(Ta,[["__file","tree-node-content.vue"]]);function yo(s){const t=Vt(Fn,null),e={treeNodeExpand:r=>{var n;s.node!==r&&((n=s.node)==null||n.collapse())},children:[]};return t&&t.children.push(e),bt(Fn,e),{broadcastExpanded:r=>{if(s.accordion)for(const n of e.children)n.treeNodeExpand(r)}}}const wo=Symbol("dragEvents");function Ma({props:s,ctx:t,el$:e,dropIndicator$:r,store:n}){const l=St("tree"),m=Z({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return bt(wo,{treeNodeDragStart:({event:y,treeNode:L})=>{if(y.dataTransfer){if(Hs(s.allowDrag)&&!s.allowDrag(L.node))return y.preventDefault(),!1;y.dataTransfer.effectAllowed="move";try{y.dataTransfer.setData("text/plain","")}catch{}m.value.draggingNode=L,t.emit("node-drag-start",L.node,y)}},treeNodeDragOver:({event:y,treeNode:L})=>{if(!y.dataTransfer)return;const N=L,B=m.value.dropNode;B&&B.node.id!==N.node.id&&qs(B.$el,l.is("drop-inner"));const F=m.value.draggingNode;if(!F||!N)return;let G=!0,te=!0,U=!0,le=!0;Hs(s.allowDrop)&&(G=s.allowDrop(F.node,N.node,"prev"),le=te=s.allowDrop(F.node,N.node,"inner"),U=s.allowDrop(F.node,N.node,"next")),y.dataTransfer.dropEffect=te||G||U?"move":"none",(G||te||U)&&(B==null?void 0:B.node.id)!==N.node.id&&(B&&t.emit("node-drag-leave",F.node,B.node,y),t.emit("node-drag-enter",F.node,N.node,y)),G||te||U?m.value.dropNode=N:m.value.dropNode=null,N.node.nextSibling===F.node&&(U=!1),N.node.previousSibling===F.node&&(G=!1),N.node.contains(F.node,!1)&&(te=!1),(F.node===N.node||F.node.contains(N.node))&&(G=!1,te=!1,U=!1);const V=N.$el,We=V.querySelector(`.${l.be("node","content")}`).getBoundingClientRect(),Le=e.value.getBoundingClientRect();let _e;const me=G?te?.25:U?.45:1:-1,re=U?te?.75:G?.55:0:1;let I=-9999;const P=y.clientY-We.top;P<We.height*me?_e="before":P>We.height*re?_e="after":te?_e="inner":_e="none";const ce=V.querySelector(`.${l.be("node","expand-icon")}`).getBoundingClientRect(),de=r.value;_e==="before"?I=ce.top-Le.top:_e==="after"&&(I=ce.bottom-Le.top),de.style.top=`${I}px`,de.style.left=`${ce.right-Le.left}px`,_e==="inner"?Ko(V,l.is("drop-inner")):qs(V,l.is("drop-inner")),m.value.showDropIndicator=_e==="before"||_e==="after",m.value.allowDrop=m.value.showDropIndicator||le,m.value.dropType=_e,t.emit("node-drag-over",F.node,N.node,y)},treeNodeDragEnd:y=>{var L,N;const{draggingNode:B,dropType:F,dropNode:G}=m.value;if(y.preventDefault(),y.dataTransfer&&(y.dataTransfer.dropEffect="move"),B!=null&&B.node.data&&G){const te={data:B.node.data};F!=="none"&&B.node.remove(),F==="before"?(L=G.node.parent)==null||L.insertBefore(te,G.node):F==="after"?(N=G.node.parent)==null||N.insertAfter(te,G.node):F==="inner"&&G.node.insertChild(te),F!=="none"&&(n.value.registerNode(te),n.value.key&&B.node.eachNode(U=>{var le;(le=n.value.nodesMap[U.data[n.value.key]])==null||le.setChecked(U.checked,!n.value.checkStrictly)})),qs(G.$el,l.is("drop-inner")),t.emit("node-drag-end",B.node,G.node,F,y),F!=="none"&&t.emit("node-drop",B.node,G.node,F,y)}B&&!G&&t.emit("node-drag-end",B.node,null,F,y),m.value.showDropIndicator=!1,m.value.draggingNode=null,m.value.dropNode=null,m.value.allowDrop=!0}}),{dragState:m}}const Na=qe({name:"ElTreeNode",components:{ElCollapseTransition:aa,ElCheckbox:pn,NodeContent:Ea,ElIcon:Et,Loading:Br},props:{node:{type:jt,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:Boolean},emits:["node-expand"],setup(s,t){const e=St("tree"),{broadcastExpanded:r}=yo(s),n=Vt(wn),l=Z(!1),m=Z(!1),g=Z(),k=Z(),C=Z(),y=Vt(wo),L=Jn();bt(vo,L),s.node.expanded&&(l.value=!0,m.value=!0);const N=n.props.props.children||"children";Ve(()=>{var I;const P=(I=s.node.data)==null?void 0:I[N];return P&&[...P]},()=>{s.node.updateChildren()}),Ve(()=>s.node.indeterminate,I=>{G(s.node.checked,I)}),Ve(()=>s.node.checked,I=>{G(I,s.node.indeterminate)}),Ve(()=>s.node.childNodes.length,()=>s.node.reInitChecked()),Ve(()=>s.node.expanded,I=>{xs(()=>l.value=I),I&&(m.value=!0)});const B=I=>yn(n.props.nodeKey,I.data),F=I=>{const P=s.props.class;if(!P)return{};let ce;if(Hs(P)){const{data:de}=I;ce=P(de,I)}else ce=P;return dn(ce)?{[ce]:!0}:ce},G=(I,P)=>{(g.value!==I||k.value!==P)&&n.ctx.emit("check-change",s.node.data,I,P),g.value=I,k.value=P},te=I=>{rn(n.store,n.ctx.emit,()=>{var P;if((P=n==null?void 0:n.props)==null?void 0:P.nodeKey){const de=B(s.node);n.store.value.setCurrentNodeKey(de)}else n.store.value.setCurrentNode(s.node)}),n.currentNode.value=s.node,n.props.expandOnClickNode&&le(),(n.props.checkOnClickNode||s.node.isLeaf&&n.props.checkOnClickLeaf&&s.showCheckbox)&&!s.node.disabled&&V(!s.node.checked),n.ctx.emit("node-click",s.node.data,s.node,L,I)},U=I=>{var P;(P=n.instance.vnode.props)!=null&&P.onNodeContextmenu&&(I.stopPropagation(),I.preventDefault()),n.ctx.emit("node-contextmenu",I,s.node.data,s.node,L)},le=()=>{s.node.isLeaf||(l.value?(n.ctx.emit("node-collapse",s.node.data,s.node,L),s.node.collapse()):s.node.expand(()=>{t.emit("node-expand",s.node.data,s.node,L)}))},V=I=>{s.node.setChecked(I,!(n!=null&&n.props.checkStrictly)),xs(()=>{const P=n.store.value;n.ctx.emit("check",s.node.data,{checkedNodes:P.getCheckedNodes(),checkedKeys:P.getCheckedKeys(),halfCheckedNodes:P.getHalfCheckedNodes(),halfCheckedKeys:P.getHalfCheckedKeys()})})};return{ns:e,node$:C,tree:n,expanded:l,childNodeRendered:m,oldChecked:g,oldIndeterminate:k,getNodeKey:B,getNodeClass:F,handleSelectChange:G,handleClick:te,handleContextMenu:U,handleExpandIconClick:le,handleCheckChange:V,handleChildNodeExpand:(I,P,ce)=>{r(P),n.ctx.emit("node-expand",I,P,ce)},handleDragStart:I=>{n.props.draggable&&y.treeNodeDragStart({event:I,treeNode:s})},handleDragOver:I=>{I.preventDefault(),n.props.draggable&&y.treeNodeDragOver({event:I,treeNode:{$el:C.value,node:s.node}})},handleDrop:I=>{I.preventDefault()},handleDragEnd:I=>{n.props.draggable&&y.treeNodeDragEnd(I)},CaretRight:Wr}}});function Sa(s,t,e,r,n,l){const m=Ut("el-icon"),g=Ut("el-checkbox"),k=Ut("loading"),C=Ut("node-content"),y=Ut("el-tree-node"),L=Ut("el-collapse-transition");return Be((p(),b("div",{ref:"node$",class:D([s.ns.b("node"),s.ns.is("expanded",s.expanded),s.ns.is("current",s.node.isCurrent),s.ns.is("hidden",!s.node.visible),s.ns.is("focusable",!s.node.disabled),s.ns.is("checked",!s.node.disabled&&s.node.checked),s.getNodeClass(s.node)]),role:"treeitem",tabindex:"-1","aria-expanded":s.expanded,"aria-disabled":s.node.disabled,"aria-checked":s.node.checked,draggable:s.tree.props.draggable,"data-key":s.getNodeKey(s.node),onClick:je(s.handleClick,["stop"]),onContextmenu:s.handleContextMenu,onDragstart:je(s.handleDragStart,["stop"]),onDragover:je(s.handleDragOver,["stop"]),onDragend:je(s.handleDragEnd,["stop"]),onDrop:je(s.handleDrop,["stop"])},[H("div",{class:D(s.ns.be("node","content")),style:Qe({paddingLeft:(s.node.level-1)*s.tree.props.indent+"px"})},[s.tree.props.icon||s.CaretRight?(p(),Ne(m,{key:0,class:D([s.ns.be("node","expand-icon"),s.ns.is("leaf",s.node.isLeaf),{expanded:!s.node.isLeaf&&s.expanded}]),onClick:je(s.handleExpandIconClick,["stop"])},{default:ze(()=>[(p(),Ne(_s(s.tree.props.icon||s.CaretRight)))]),_:1},8,["class","onClick"])):Y("v-if",!0),s.showCheckbox?(p(),Ne(g,{key:1,"model-value":s.node.checked,indeterminate:s.node.indeterminate,disabled:!!s.node.disabled,onClick:je(()=>{},["stop"]),onChange:s.handleCheckChange},null,8,["model-value","indeterminate","disabled","onClick","onChange"])):Y("v-if",!0),s.node.loading?(p(),Ne(m,{key:2,class:D([s.ns.be("node","loading-icon"),s.ns.is("loading")])},{default:ze(()=>[we(k)]),_:1},8,["class"])):Y("v-if",!0),we(C,{node:s.node,"render-content":s.renderContent},null,8,["node","render-content"])],6),we(L,null,{default:ze(()=>[!s.renderAfterExpand||s.childNodeRendered?Be((p(),b("div",{key:0,class:D(s.ns.be("node","children")),role:"group","aria-expanded":s.expanded,onClick:je(()=>{},["stop"])},[(p(!0),b(at,null,Nt(s.node.childNodes,N=>(p(),Ne(y,{key:s.getNodeKey(N),"render-content":s.renderContent,"render-after-expand":s.renderAfterExpand,"show-checkbox":s.showCheckbox,node:N,accordion:s.accordion,props:s.props,onNodeExpand:s.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,["aria-expanded","onClick"])),[[Ue,s.expanded]]):Y("v-if",!0)]),_:1})],42,["aria-expanded","aria-disabled","aria-checked","draggable","data-key","onClick","onContextmenu","onDragstart","onDragover","onDragend","onDrop"])),[[Ue,s.node.visible]])}var Da=Zt(Na,[["render",Sa],["__file","tree-node.vue"]]);function La({el$:s},t){const e=St("tree");rs(()=>{l()}),Xn(()=>{Array.from(s.value.querySelectorAll("input[type=checkbox]")).forEach(g=>{g.setAttribute("tabindex","-1")})});function r(m,g){var k,C;const y=t.value.getNode(m[g].dataset.key);return y.canFocus&&y.visible&&(((k=y.parent)==null?void 0:k.expanded)||((C=y.parent)==null?void 0:C.level)===0)}Kt(s,"keydown",m=>{const g=m.target;if(!g.className.includes(e.b("node")))return;const k=m.code,C=Array.from(s.value.querySelectorAll(`.${e.is("focusable")}[role=treeitem]`)),y=C.indexOf(g);let L;if([lt.up,lt.down].includes(k)){if(m.preventDefault(),k===lt.up){L=y===-1?0:y!==0?y-1:C.length-1;const B=L;for(;!r(C,L);){if(L--,L===B){L=-1;break}L<0&&(L=C.length-1)}}else{L=y===-1?0:y<C.length-1?y+1:0;const B=L;for(;!r(C,L);){if(L++,L===B){L=-1;break}L>=C.length&&(L=0)}}L!==-1&&C[L].focus()}[lt.left,lt.right].includes(k)&&(m.preventDefault(),g.click());const N=g.querySelector('[type="checkbox"]');[lt.enter,lt.numpadEnter,lt.space].includes(k)&&N&&(m.preventDefault(),N.click())});const l=()=>{var m;if(!s.value)return;const g=Array.from(s.value.querySelectorAll(`.${e.is("focusable")}[role=treeitem]`));Array.from(s.value.querySelectorAll("input[type=checkbox]")).forEach(y=>{y.setAttribute("tabindex","-1")});const C=s.value.querySelectorAll(`.${e.is("checked")}[role=treeitem]`);if(C.length){C[0].setAttribute("tabindex","0");return}(m=g[0])==null||m.setAttribute("tabindex","0")}}const Aa=qe({name:"ElTree",components:{ElTreeNode:Da},props:{data:{type:Mt(Array),default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkOnClickLeaf:{type:Boolean,default:!0},checkDescendants:Boolean,autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:{type:Mt(Function)},showCheckbox:Boolean,draggable:Boolean,allowDrag:{type:Mt(Function)},allowDrop:{type:Mt(Function)},props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:Boolean,highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:Kr}},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(s,t){const{t:e}=vn(),r=St("tree"),n=Vt(Sr,null),l=Z(new Ia({key:s.nodeKey,data:s.data,lazy:s.lazy,props:s.props,load:s.load,currentNodeKey:s.currentNodeKey,checkStrictly:s.checkStrictly,checkDescendants:s.checkDescendants,defaultCheckedKeys:s.defaultCheckedKeys,defaultExpandedKeys:s.defaultExpandedKeys,autoExpandParent:s.autoExpandParent,defaultExpandAll:s.defaultExpandAll,filterNodeMethod:s.filterNodeMethod}));l.value.initialize();const m=Z(l.value.root),g=Z(null),k=Z(null),C=Z(null),{broadcastExpanded:y}=yo(s),{dragState:L}=Ma({props:s,ctx:t,el$:k,dropIndicator$:C,store:l});La({el$:k},l);const N=J(()=>{const{childNodes:O}=m.value,X=n?n.hasFilteredOptions!==0:!1;return(!O||O.length===0||O.every(({visible:Oe})=>!Oe))&&!X});Ve(()=>s.currentNodeKey,O=>{l.value.setCurrentNodeKey(O??null)}),Ve(()=>s.defaultCheckedKeys,(O,X)=>{jr(O,X)||l.value.setDefaultCheckedKey(O??[])}),Ve(()=>s.defaultExpandedKeys,O=>{l.value.setDefaultExpandedKeys(O??[])}),Ve(()=>s.data,O=>{l.value.setData(O)},{deep:!0}),Ve(()=>s.checkStrictly,O=>{l.value.checkStrictly=O});const B=O=>{if(!s.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");l.value.filter(O)},F=O=>yn(s.nodeKey,O.data),G=O=>{if(!s.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const X=l.value.getNode(O);if(!X)return[];const Oe=[X.data];let $e=X.parent;for(;$e&&$e!==m.value;)Oe.push($e.data),$e=$e.parent;return Oe.reverse()},te=(O,X)=>l.value.getCheckedNodes(O,X),U=O=>l.value.getCheckedKeys(O),le=()=>{const O=l.value.getCurrentNode();return O?O.data:null},V=()=>{if(!s.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const O=le();return O?O[s.nodeKey]:null},We=(O,X)=>{if(!s.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");l.value.setCheckedNodes(O,X)},Le=(O,X)=>{if(!s.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");l.value.setCheckedKeys(O,X)},_e=(O,X,Oe)=>{l.value.setChecked(O,X,Oe)},me=()=>l.value.getHalfCheckedNodes(),re=()=>l.value.getHalfCheckedKeys(),I=(O,X=!0)=>{if(!s.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");rn(l,t.emit,()=>{y(O),l.value.setUserCurrentNode(O,X)})},P=(O,X=!0)=>{if(!s.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");rn(l,t.emit,()=>{y(),l.value.setCurrentNodeKey(O??null,X)})},ce=O=>l.value.getNode(O),de=O=>{l.value.remove(O)},ae=(O,X)=>{l.value.append(O,X)},ge=(O,X)=>{l.value.insertBefore(O,X)},Ie=(O,X)=>{l.value.insertAfter(O,X)},W=(O,X,Oe)=>{y(X),t.emit("node-expand",O,X,Oe)},Te=(O,X)=>{if(!s.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");l.value.updateChildren(O,X)};return bt(wn,{ctx:t,props:s,store:l,root:m,currentNode:g,instance:Jn()}),bt(Gr,void 0),{ns:r,store:l,root:m,currentNode:g,dragState:L,el$:k,dropIndicator$:C,isEmpty:N,filter:B,getNodeKey:F,getNodePath:G,getCheckedNodes:te,getCheckedKeys:U,getCurrentNode:le,getCurrentKey:V,setCheckedNodes:We,setCheckedKeys:Le,setChecked:_e,getHalfCheckedNodes:me,getHalfCheckedKeys:re,setCurrentNode:I,setCurrentKey:P,t:e,getNode:ce,remove:de,append:ae,insertBefore:ge,insertAfter:Ie,handleNodeExpand:W,updateKeyChildren:Te}}});function Oa(s,t,e,r,n,l){const m=Ut("el-tree-node");return p(),b("div",{ref:"el$",class:D([s.ns.b(),s.ns.is("dragging",!!s.dragState.draggingNode),s.ns.is("drop-not-allow",!s.dragState.allowDrop),s.ns.is("drop-inner",s.dragState.dropType==="inner"),{[s.ns.m("highlight-current")]:s.highlightCurrent}]),role:"tree"},[(p(!0),b(at,null,Nt(s.root.childNodes,g=>(p(),Ne(m,{key:s.getNodeKey(g),node:g,props:s.props,accordion:s.accordion,"render-after-expand":s.renderAfterExpand,"show-checkbox":s.showCheckbox,"render-content":s.renderContent,onNodeExpand:s.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),s.isEmpty?(p(),b("div",{key:0,class:D(s.ns.e("empty-block"))},[yt(s.$slots,"empty",{},()=>{var g;return[H("span",{class:D(s.ns.e("empty-text"))},Q((g=s.emptyText)!=null?g:s.t("el.tree.emptyText")),3)]})],2)):Y("v-if",!0),Be(H("div",{ref:"dropIndicator$",class:D(s.ns.e("drop-indicator"))},null,2),[[Ue,s.dragState.showDropIndicator]])],2)}var Ra=Zt(Aa,[["render",Oa],["__file","tree.vue"]]);const Ha=Cs(Ra),$a={class:"custom-tree-node"},Ht=qe({__name:"index",props:{msgList:Array,mixImgUrl:String,cancelBtn:{type:Object,default:{text:"取消",callback:()=>!0}},confirmBtn:{type:Object,default:{text:"确定",callback:()=>!0}},zIndex:{type:Number,default:100},toastZIndex:{type:Number,default:100}},setup(s){const t=s,e=is(),r=Zo.global.t,n=Z(["0"]),l=gn("saveToCloud"),m={label:"根目录",source:{residstr:"0"},isCreate:!1,residstr:"0"},g=re=>{const I=[];for(let P of re)I.push({label:P.name,source:P,residstr:String(P.residstr),isCreate:!1});return I},k=Z(null),C=Z([{label:"",source:{},children:[]}]),y=async re=>{const{page:I,fldid:P,getFavoriteDir:ce,shareid:de}=re;try{const ae=await window.MainWindowHelper.genRequest({url:"https://sharewh.chaoxing.com/pc/forward/getCloudFolders",getParams:{page:I,fldid:P,getFavoriteDir:ce,shareId:de,showShare:!0},tokenSign:!0});if(console.log("云盘文件夹",ae),ae.result===1)return ae.data}catch{alert("获取云盘文件夹失败")}return[]},L=async(re,I)=>{var Te,O,X,Oe,$e,Ae,st,et,Ge,q,ue;if(re.level===0)return I([m]);const{data:P}=re;if(P.isCreate)return I([]);const ce=((Te=P.source)==null?void 0:Te.residstr)||((Oe=(X=(O=P==null?void 0:P.source)==null?void 0:O.shareInfo)==null?void 0:X.rw)==null?void 0:Oe.residstr),de=((st=(Ae=($e=P==null?void 0:P.source)==null?void 0:$e.shareInfo)==null?void 0:Ae.rw)==null?void 0:st.shareid)||((et=P==null?void 0:P.source)==null?void 0:et.shareid);if(console.log("shareid",de),(Ge=P.source)!=null&&Ge.data)return I(g((q=P.source)==null?void 0:q.data));const ae=await y({page:1,fldid:ce,getFavoriteDir:0,shareid:de});de&&ae.length>0&&ae.forEach(ie=>{ie.shareid=de});const ge=pe.overEvery(pe.matches({restype:"RES_TYPE_YUNPAN_SHARED_RWFOLDER"}),ie=>ie.creator!==e.puid),[Ie,W]=pe.partition(ae,ge);Ie.length>0&&W.unshift({name:"共享给我的文件夹",residstr:"-2",restype:"RES_TYPE_YUNPAN_SHARED_RWFOLDER",isOtherShare:!0,data:Ie}),de&&((ue=P==null?void 0:P.source)==null?void 0:ue.puid)!==e.puid&&W.forEach(ie=>{ie.restype="RES_TYPE_YUNPAN_SHARED_RWFOLDER"}),I(g(W))};let N,B,F=Z(!0);const G=(re,I)=>{var P;(P=re==null?void 0:re.source)!=null&&P.isOtherShare?F.value=!1:F.value=!0,N=re,B=I},te={children:"children",label:"label",residstr:"",source:{},isCreate:!1};let U=Z("新建文件夹"),le={label:"",source:{residstr:"-1"},isCreate:!0,residstr:"-1"},V;const We=re=>{var I,P,ce,de,ae;if(_e(re),console.log("获取选中的节点",B),B&&!((I=B==null?void 0:B.data)!=null&&I.isCreate))B!=null&&B.childNodes[0]?(n.value=[(P=B==null?void 0:B.data)==null?void 0:P.residstr],k.value.insertBefore(le,B==null?void 0:B.childNodes[0])):k.value.append(le,B),V=B;else{const ge=k.value.getNode(m).childNodes;console.log("获取根节点的子节点列表",ge),ge.length>0?(ae=(de=(ce=ge[0])==null?void 0:ce.data)==null?void 0:de.source)!=null&&ae.isOtherShare?k.value.insertAfter(le,ge[0]):k.value.insertBefore(le,ge[0]):k.value.append(le,m),V=m}console.log("父节点",V)},Le=async re=>{var I,P,ce,de,ae,ge,Ie,W,Te,O,X,Oe,$e,Ae,st,et,Ge,q,ue,ie,be,xe;re.stopPropagation();try{const Ee=await window.MainWindowHelper.genRequest({url:"https://sharewh.chaoxing.com/pc/forward/createCloudFolders",getParams:{fldid:((de=(ce=(P=(I=V==null?void 0:V.data)==null?void 0:I.source)==null?void 0:P.shareInfo)==null?void 0:ce.rw)==null?void 0:de.residstr)||((ae=V==null?void 0:V.data)==null?void 0:ae.residstr)||V.residstr,name:U.value,shareId:((W=(Ie=(ge=V==null?void 0:V.data)==null?void 0:ge.source)==null?void 0:Ie.shareInfo)==null?void 0:W.shareid)||((O=(Te=V==null?void 0:V.data)==null?void 0:Te.source)==null?void 0:O.shareid)},tokenSign:!0});if(console.log("创建文件夹res",Ee),Ee.result==1){const Se={label:U.value,source:{residstr:Ee.data,shareid:(($e=(Oe=(X=V==null?void 0:V.data)==null?void 0:X.source)==null?void 0:Oe.shareInfo)==null?void 0:$e.shareid)||((st=(Ae=V==null?void 0:V.data)==null?void 0:Ae.source)==null?void 0:st.shareid),restype:(Ge=(et=V==null?void 0:V.data)==null?void 0:et.source)==null?void 0:Ge.restype,puid:(ue=(q=V==null?void 0:V.data)==null?void 0:q.source)==null?void 0:ue.puid},isCreate:!1,residstr:Ee.data};if(V)if(V!=null&&V.childNodes)k.value.insertBefore(Se,V==null?void 0:V.childNodes[0]);else{const Ke=k.value.getNode(V).childNodes;(xe=(be=(ie=Ke[0])==null?void 0:ie.data)==null?void 0:be.source)!=null&&xe.isOtherShare?k.value.insertAfter(Se,Ke.length>0?Ke[0]:null):k.value.insertBefore(Se,Ke.length>0?Ke[0]:null)}Pe({content:r("message.createFolderSuccessfully"),zIndex:t.toastZIndex,duration:2e3}),_e(re)}}catch(Ee){console.error("err",Ee)}},_e=re=>{re.stopPropagation(),k.value.remove(le),U.value="新建文件夹"},me=async()=>{var ce,de,ae,ge,Ie,W,Te,O,X,Oe,$e,Ae,st,et,Ge,q,ue,ie,be,xe,Ee,Se,Ke,ct,tt,nt,Re,Qt,es,wt,Dt,dt,Lt,Xe,Tt,ut,ht,xt,ot,Pt,mt,ts,Ft,kt,pt,ft;let re=((ce=N==null?void 0:N.source)==null?void 0:ce.restype)=="RES_TYPE_YUNPAN_SHARED_RWFOLDER"&&((de=N==null?void 0:N.source)==null?void 0:de.puid)!==e.puid;if(console.log("isShareFolder",re),!t.msgList)return t.msgList;const I=[];for(let K of t.msgList){if(K.type===Fe.IMAGE){let De,He,Ye;K!=null&&K.url&&((ae=K==null?void 0:K.url)!=null&&ae.startsWith("http"))?(Ye=await fetch(K==null?void 0:K.url).then(it=>it.blob()),De=new File([Ye],`img_${K==null?void 0:K.id}.png`,{type:"png",lastModified:new Date().getTime()})):(He=window.RendererHelper.getFileData(K==null?void 0:K.url),Ye=new Blob([He]),De=new File([Ye],`img_${K==null?void 0:K.id}.png`,{type:"png",lastModified:new Date().getTime()}));const Je=await Xs(De);if(Je.result){const it=Je.objectId,Bt=Je.data.name;re?I.push({fileId:it,name:Bt,srcPuid:(ge=K==null?void 0:K.ext)==null?void 0:ge.fromPuid}):I.push({fileId:it,name:Bt})}}if(K.type===Fe.AUDIO){let De,He;He=await fetch(K==null?void 0:K.url).then(Je=>Je.blob()),De=new File([He],`语音_${K==null?void 0:K.id}.amr`,{type:"amr",lastModified:new Date().getTime()});const Ye=await Xs(De);if(Ye.result){const Je=Ye.objectId,it=Ye.data.name;re?I.push({fileId:Je,name:it,srcPuid:(Ie=K==null?void 0:K.ext)==null?void 0:Ie.fromPuid}):I.push({fileId:Je,name:it})}}if(K.type===Fe.TEXT){if((Te=(W=K.ext)==null?void 0:W.attachment)!=null&&Te.att_clouddisk){const De=((Oe=(X=(O=K.ext)==null?void 0:O.attachment)==null?void 0:X.att_clouddisk)==null?void 0:Oe.fileId)||((st=(Ae=($e=K.ext)==null?void 0:$e.attachment)==null?void 0:Ae.att_clouddisk)==null?void 0:st.objectId),He=(q=(Ge=(et=K.ext)==null?void 0:et.attachment)==null?void 0:Ge.att_clouddisk)==null?void 0:q.name;re?I.push({fileId:De,name:He,srcPuid:(ue=K==null?void 0:K.ext)==null?void 0:ue.fromPuid}):I.push({fileId:De,name:He})}if((be=(ie=K.ext)==null?void 0:ie.attachment)!=null&&be.att_video){const De=(Se=(Ee=(xe=K.ext)==null?void 0:xe.attachment)==null?void 0:Ee.att_video)==null?void 0:Se.objectId2,He=(tt=(ct=(Ke=K.ext)==null?void 0:Ke.attachment)==null?void 0:ct.att_video)==null?void 0:tt.fileTitle;re?I.push({fileId:De,name:He,srcPuid:(nt=K==null?void 0:K.ext)==null?void 0:nt.fromPuid}):I.push({fileId:De,name:He})}if((Qt=(Re=K.ext)==null?void 0:Re.attachment)!=null&&Qt.att_voice){const De=(Dt=(wt=(es=K.ext)==null?void 0:es.attachment)==null?void 0:wt.att_voice)==null?void 0:Dt.objectId2,He=((Xe=(Lt=(dt=K.ext)==null?void 0:dt.attachment)==null?void 0:Lt.att_voice)==null?void 0:Xe.fileTitle)+".amr";re?I.push({fileId:De,name:He,srcPuid:(Tt=K==null?void 0:K.ext)==null?void 0:Tt.fromPuid}):I.push({fileId:De,name:He})}}}if(t.mixImgUrl){let K,De,He;t.mixImgUrl&&t.mixImgUrl.startsWith("http")?(He=await fetch(t.mixImgUrl).then(Je=>Je.blob()),K=new File([He],`img_${(ut=t.msgList[0])==null?void 0:ut.id}.png`,{type:"png",lastModified:new Date().getTime()})):(De=window.RendererHelper.getFileData(t.mixImgUrl),He=new Blob([De]),K=new File([He],`img_${(ht=t.msgList[0])==null?void 0:ht.id}.png`,{type:"png",lastModified:new Date().getTime()}));const Ye=await Xs(K);if(Ye.result){const Je=Ye.objectId,it=Ye.data.name;re?I.push({fileId:Je,name:it,srcPuid:((ot=(xt=t.msgList[0])==null?void 0:xt.ext)==null?void 0:ot.fromPuid)||e.puid}):I.push({fileId:Je,name:it})}}console.log("attachArr",I);let P;re?P={fldid:N.source.residstr||((ts=(mt=(Pt=N==null?void 0:N.source)==null?void 0:Pt.shareInfo)==null?void 0:mt.rw)==null?void 0:ts.residstr),saveToShare:"1",destPuid:String((Ft=N==null?void 0:N.source)==null?void 0:Ft.puid),attachArr:encodeURIComponent(JSON.stringify(I))}:P={fldid:N.source.residstr||((ft=(pt=(kt=N==null?void 0:N.source)==null?void 0:kt.shareInfo)==null?void 0:pt.rw)==null?void 0:ft.residstr),attachArr:encodeURIComponent(JSON.stringify(I))};try{const K=await window.MainWindowHelper.genRequest({url:"https://sharewh.chaoxing.com/pc/forward/batchSaveToCloud",postParams:P,getParams:{t:"1"},tokenSign:!0});console.log("存云盘",K),K.result==1&&(Pe({content:r("message.saveSuccessfully"),zIndex:t.toastZIndex,duration:2e3}),setTimeout(()=>{var De;(De=t.confirmBtn)==null||De.callback()},2500))}catch{Pe({content:r("message.saveFailure"),zIndex:t.toastZIndex,duration:2e3})}};return(re,I)=>{const P=js,ce=Ha,de=Vr;return p(),Ne(Tr,{center:!0,shouldWrapper:!1},{default:ze(()=>[H("div",{class:D(o(l).e("cover")),style:Qe({zIndex:t.zIndex})},null,6),H("div",{class:D(o(l).b()),style:Qe({zIndex:t.zIndex})},[H("header",{class:D(o(l).e("header"))},[H("span",{class:D(o(l).e("title"))},Q(o(r)("message.savetoclouddrive")),3),H("i",{onClick:I[0]||(I[0]=()=>{var ae,ge;(ge=(ae=t.cancelBtn).callback)==null||ge.call(ae)}),class:D(o(l).e("close"))},[we(P,{"icon-class":"close",width:"20",height:"20",color:"#8A8B99"})],2)],2),H("main",{class:D(o(l).e("main"))},[we(de,null,{default:ze(()=>[we(ce,{ref_key:"tree",ref:k,lazy:"",load:L,"highlight-current":"","node-key":"residstr",onNodeClick:G,"default-expanded-keys":n.value,data:C.value,props:te},{default:ze(({node:ae,data:ge})=>{var Ie,W;return[H("span",$a,[!ge.isCreate&&((Ie=ge==null?void 0:ge.source)==null?void 0:Ie.restype)!="RES_TYPE_YUNPAN_SHARED_RWFOLDER"?(p(),b("span",{key:0,class:D(o(l).e("treeLabel"))},Q(ae.label),3)):!ge.isCreate&&((W=ge==null?void 0:ge.source)==null?void 0:W.restype)=="RES_TYPE_YUNPAN_SHARED_RWFOLDER"?(p(),b("span",{key:1,class:D(o(l).e("treeLabelShare"))},Q(ae.label),3)):(p(),b("span",{key:2,class:D(o(l).e("treeCreate"))},[Be(H("input",{type:"text","onUpdate:modelValue":I[1]||(I[1]=Te=>Qo(U)?U.value=Te:U=Te),onClick:I[2]||(I[2]=je(()=>{},["stop"]))},null,512),[[er,o(U)]]),H("span",{onClick:Le,class:D(o(l).e("createConfirm"))},null,2),H("span",{onClick:_e,class:D(o(l).e("createCancel"))},null,2)],2))])]}),_:1},8,["default-expanded-keys","data"])]),_:1})],2),H("footer",{class:D(o(l).e("footer")),style:Qe({"justify-content":o(F)?"space-between":"flex-end"})},[Be(H("span",{onClick:We,class:D(o(l).e("createFolder"))},[we(P,{"icon-class":"create-folder",width:"14",height:"14",color:"#3A8BFF"}),H("span",null,Q(o(r)("message.newfolder")),1)],2),[[Ue,o(F)]]),H("span",{class:D(o(l).e("right"))},[H("button",{onClick:I[3]||(I[3]=()=>{var ae,ge;(ge=(ae=t.cancelBtn).callback)==null||ge.call(ae)}),class:D(o(l).e("cancel"))},Q(t.cancelBtn.text),3),Be(H("button",{onClick:me,class:D(o(l).e("confirm"))},Q(t.confirmBtn.text),3),[[Ue,o(F)]])],2)],6)],6)]),_:1})}}}),xo={msgType:{type:String,default:""},avatar:{type:String,default:mn},contents:{type:String,default:""},imgs:{type:Object,default:{}},audio:{type:Object,default:{}},defaultContent:{type:Boolean,default:!1},attachment:Object,source:{type:Object,default:()=>{}},isMultipleChoice:{type:Boolean,default:!1},callback:Function,groupSelf:Object,isOnlyRead:{type:Boolean,default:!1},checkMsgIds:{type:Array,default:()=>[]}},ko={"mouse-menu":s=>s,"mouse-menu-handler":s=>s,"audio-event":s=>s,change:s=>s,"update-avator":s=>s,"reply-handler":s=>s,"drop-start":s=>s},oe={SAVE_TO_CLOUD:"save-to-clund",DELETE_EVENT:"delete-event",REPLY_EVENT:"reply-event",MULTIPLE_CHOICE:"multiple-choice",COPY_EVENT:"copy-event",DOWNLOAD_EVENT:"download-event",REVOCATION_EVENT:"revocation-event",SAVE_AS_EVENT:"save-as-event",At_MEMBER_EVENT:"at-member-event",FORWARD_EVENT:"forward-event",ENTER_DOWNLOAD_FOLDER:"enter-download-folder",VOICE_TO_TEXT:"voice-to-text"},$t={"min-width":"48px","min-height":"48px","max-width":"280px","max-height":"240px",border:"1px solid rgba(0, 0, 0, 0.04)","border-radius":"6px",overflow:"hidden",cursor:"pointer"},Co="origin",_o="400_400",Yt=`https://p.ananas.chaoxing.com/star3/${Co}`,qt=`https://p.cldisk.com/star3/${Co}`,Xt=`https://p.ananas.chaoxing.com/star3/${_o}`,Jt=`https://p.cldisk.com/star3/${_o}`,Pa="cx_text_mixing_img";function bo(s){return s.startsWith(Yt)?pe.replace(s,Yt,Xt):s.startsWith(qt)?pe.replace(s,qt,Jt):s}function Fa(s){return s.startsWith(Xt)?pe.replace(s,Xt,Yt):s.startsWith(Jt)?pe.replace(s,Jt,qt):s}function Ks(s){return!s||s.length===0?"":(console.log("[genClipboardTextFromTextMixingList] call",JSON.stringify(s)),s.reduce((t,e)=>e.type==="text"?t+e.content:t,""))}function zs(s){return!s||s.length===0?"":(console.log("[genClipboardHtmlFromTextMixingList] call",JSON.stringify(s)),s.reduce((t,e)=>e.type==="image"?t+`<img src="${e.image}" class="${Pa}">`:e.type==="text"?t+pe.escape(e.content).replaceAll(`
`,"<br>"):t,""))}async function Ac(s){const t=[];if(!s||!s.ops)return t;console.log("[convertDeltaToTextMixingList] call",JSON.stringify(s));for(const e of s.ops)if(e.insert&&typeof e.insert=="string"&&t.push({type:"text",content:e.insert}),e.insert&&typeof e.insert=="object"&&e.insert.image){let r=e.insert.image;r.startsWith("blob:")&&(r=await Yr(r)),t.push({type:"image",image:r,preview:r})}return t}function Io(s){if(!s)return console.log("[genClipboardTextFromDocumentFragment] content is empty!"),"";let t="";const e=s!=null&&s.childNodes?Array.from(s.childNodes):[];try{for(const r of e){const n=r==null?void 0:r.querySelectorAll("img.el-image__inner"),l=r==null?void 0:r.querySelectorAll("span.ns-receive__text");if(n){const m=Array.from(n).map(g=>{const k=g.cloneNode(!0);return k.classList.add("cx_text_mixing_img"),k.src=Fa(k.src),k});t+=m.map(g=>g.outerHTML).join("")}l&&(t+=Array.from(l).map(m=>{const g="html/emoji",k=new RegExp(`<img[^>]*src=["'][^"']*${g}[^"']*["'][^>]*alt="cxemoji-([^"]*)"[^>]*>`,"g");return m.innerHTML.replace(k,"$1")}).join(""))}return t}catch(r){return console.error("[genClipboardTextFromDocumentFragment] error",r),""}}const Ba={class:"icon-area"},Wa=["src"],Ua={class:"content-area"},Ka={class:"header"},za={class:"name"},Ga={class:"tag"},ja={class:"tag-content"},Va={class:"desc"},Ya={class:"file-size"},qa=qe({__name:"index",props:{source:null,inRecord:{type:Boolean}},setup(s){const t=s,e=is(),{t:r}=bs(),n=async()=>{let C;C=t.source.from==e.loginId?t.source.ext.localPath:t.source.ext.savePath,console.log("[openPath] targetPath:",C),await window.RendererHelper.checkFileExists(C)?window.RendererHelper.openPath(C):Pe({content:r("transferFile.notFoundTip"),duration:2e3})},l=J(()=>t.source.ext.onlineFileInfo.isFolder===!0),m=J(()=>ar(t.source.ext.onlineFileInfo.size??0)),g=J(()=>l.value?ir:zo(t.source.ext.onlineFileInfo.name??"")),k=J(()=>t.source.ext.onlineFileInfo.name??"");return(C,y)=>(p(),b("div",{class:D(["online-file-card",{"in-record":t.inRecord}]),onClick:n},[H("div",Ba,[H("img",{class:"icon",src:o(g)},null,8,Wa)]),H("div",Ua,[H("div",Ka,[H("div",za,Q(o(k)),1),H("div",Ga,[H("div",ja,Q(o(r)("transferFile.online")),1)])]),H("div",Va,[H("div",Ya,Q(o(m)),1)])])],2))}}),To=as(qa,[["__scopeId","data-v-3171a2b7"]]);async function Xa(s){try{const t=await new Response(s).arrayBuffer();return new Uint8Array(t)}catch(t){throw console.error("转换失败：",t),t}}function Eo(s,t,e){var y;if(s.msgType!=Fe.AUDIO||(y=s.source)!=null&&y.isRecall)return{};const r=s.audio;let n=null,l;const m=Z(""),g=Z(!1);return window.MainWindowHelper.cacheMessageAudio(r==null?void 0:r.url).then(L=>{L!=null&&L.startsWith("/")&&(L="file://"+L),m.value=L||(r==null?void 0:r.url),console.log("msgRender:initAudio.audioUrl",m.value),fetch(m.value).then(N=>(n=new lr,n.initWithUrl(N.url).then(()=>{r!=null&&r.duration||(r.duration=n==null?void 0:n.getDuration())}),n.onEnded(()=>{g.value=!1,e({event:"end",obj:n})}),N.blob())).then(async N=>{l=await Xa(N)})}),{isPlay:g,playAudio:()=>{var L,N,B,F,G,te,U,le,V,We,Le,_e;if(!n){console.log("msgRender:playAudio amr is empty",n);return}if(n.isInit()===!1){console.log("msgRender:playAudio amr is not init",n);return}if(g.value){e({event:"stop",obj:n});try{n.stop()}catch(me){console.error("msgRender:playAudio.stop",me)}}else{e({event:"play",obj:n});try{n.play()}catch(me){console.error("msgRender:playAudio.play",me)}}g.value=!g.value,(L=s.source)!=null&&L.isplay||(s.source.chatType==Me.SINGLE?(t.sendReadMessage((N=s.source)==null?void 0:N.from,"read",(B=s.source)==null?void 0:B.id),t.updateAudioPlayStatus((F=s.source)==null?void 0:F.from,(G=s.source)==null?void 0:G.id)):(((U=(te=s.source)==null?void 0:te.ext)==null?void 0:U.showRead)==1&&t.sendCMDMessage({chatType:Me.SINGLE,to:(le=s.source)==null?void 0:le.from,action:"CMD_GROUP_MSG_READ",ext:{fromPuid:String(t.puid),fromUid:String(t.loginId),groupId:(V=s.source)==null?void 0:V.to,msgId:(We=s.source)==null?void 0:We.id,time:String(new Date().getTime())},from:t.loginId}),t.updateAudioPlayStatus((Le=s.source)==null?void 0:Le.to,(_e=s.source)==null?void 0:_e.id)))},audioUrl:m,voiceToText:async L=>{if(console.log("voiceToText:audioUrl:",m.value),l){let N=await window.AsrHelper.startByAmr(l);console.log("asrResult:",N),N.trim()===""?L&&L({success:!1}):L&&L({success:!0,data:N})}}}}function Mo(s){return s.ext.voiceToText!=null&&s.ext.voiceToText!==""}const Ja={class:"title"},Za={class:"description"},Qa={key:0,class:"head-list"},ei={class:"item"},ti={class:"item-label"},si={class:"item-content"},ni={key:2,class:"tail-item"},oi={class:"item"},ri={class:"item-label"},ai={class:"item-content"},ii=qe({__name:"GroupChainMsgRender",props:{source:null,isSelfSend:{type:Boolean}},setup(s){const t=s,{t:e}=bs(),r=Vt("previewGroupChain")??Cr.noop,n=Z(!1),l=()=>{t.source.ext.groupChainData.dragonPreviewUrl?r(t.source):n.value=!0},m=J(()=>{var y;return((y=t.source.ext.groupChainData)==null?void 0:y.items)??[]}),g=J(()=>m.value.length-t.source.ext.groupChainData.endNum-t.source.ext.groupChainData.startNum>0),k=J(()=>n.value?m.value:m.value.slice(0,t.source.ext.groupChainData.startNum)),C=J(()=>n.value?[]:m.value.slice(m.value.length-t.source.ext.groupChainData.endNum,m.value.length));return(y,L)=>{var N,B,F,G;return p(),b("div",{class:D(["message-wrapper",{"is-self-send":t.isSelfSend}])},[H("div",Ja,Q((N=t.source.ext.groupChainData)==null?void 0:N.title),1),H("div",Za,Q((B=t.source.ext.groupChainData)==null?void 0:B.description),1),Be(H("div",{class:"example"},Q(`${o(e)("message.example")} ${(F=t.source.ext.groupChainData)==null?void 0:F.example}`),513),[[Ue,(G=t.source.ext.groupChainData)==null?void 0:G.example]]),o(k)&&o(k).length>0?(p(),b("div",Qa,[(p(!0),b(at,null,Nt(o(k),te=>(p(),b("div",ei,[H("div",ti,Q(`${te.index}.`),1),H("div",si,Q(te.content),1)]))),256))])):Y("",!0),!n.value&&o(g)?(p(),b("div",{key:1,class:"expand",onClick:L[0]||(L[0]=()=>{l()})}," ... "+Q(o(e)("message.expand")),1)):Y("",!0),o(g)&&o(C)&&o(C).length>0?(p(),b("div",ni,[(p(!0),b(at,null,Nt(o(C),te=>(p(),b("div",oi,[H("div",ri,Q(`${te.index}.`),1),H("div",ai,Q(te.content),1)]))),256))])):Y("",!0)],2)}}}),No=as(ii,[["__scopeId","data-v-30908ef7"]]);function So(s){return Vs(s)?!0:!!ks(s)}async function Do(s,t){const{robotMessageEl:e}=t??{};if(Vs(s)){const r=Rn(s,cr),n=Rn(s,dr);return window.RendererHelper.setClipboardByMainProcess(n,r),r}else if(ks(s))return li(s,e);return""}function li(s,t){const e=window.getSelection();if(e!=null&&e.toString()){const r=e.getRangeAt(0),n=document.createElement("div");n.appendChild(r.cloneContents());const l=n.innerText;return window.RendererHelper.setClipboardByMainProcess(null,l),l}else{const r=t.innerText;return window.RendererHelper.setClipboardByMainProcess(null,r),r}}function xn(s){return s.ext.attChatCall===!0}const ci=["onClick"],di=qe({__name:"index",props:{source:null},setup(s){const t=s,e=is(),r=J(()=>hn(t.source.from)===String(e.loginId));function n(){var m;const l=(m=e.getCurrentConversation)==null?void 0:m.puid;l!==void 0?window.MainWindowHelper.audioCallTo(l):console.error("[handleVoiceCall][puid=undefined]")}return(l,m)=>{const g=js;return o(xn)(s.source)?(p(),b("span",{key:0,class:"voice-call-message",onClick:je(n,["stop"])},[H("span",null,Q(s.source.msg),1),we(g,{"icon-class":"voice-message-finished",color:o(r)?"white":"black",width:"20px",height:"20px"},null,8,["color"])],8,ci)):Y("",!0)}}}),Lo=as(di,[["__scopeId","data-v-01579c6c"]]),ui={class:"typewriter"},fi=["innerHTML"],gi=["innerHTML"],hi=qe({__name:"index",props:{fullText:{default:""},speed:{default:100},isLoading:{type:Boolean,default:!1}},setup(s){const t=s,e=Z(""),r=Z(0),n=Z(!1);let l=null;const m=()=>{l&&(clearInterval(l),l=null),n.value=!1},g=()=>{if(m(),e.value="",r.value=0,n.value=!0,t.fullText.length===0){n.value=!1;return}l=setInterval(()=>{r.value<t.fullText.length?(e.value+=t.fullText.charAt(r.value),r.value++):m()},t.speed)};return Ve(()=>t.fullText,(k,C)=>{k?C||g():(e.value="",m())},{immediate:!0}),tr(()=>{m()}),(k,C)=>(p(),b("div",ui,[s.isLoading?(p(),b("div",{key:0,innerHTML:e.value},null,8,fi)):(p(),b("div",{key:1,innerHTML:s.fullText},null,8,gi))]))}});function mi(s){return s&&s.type==="STATIC_LIST_TEXT"}function pi(s,t){const e=new URL(s);for(const[r,n]of Object.entries(t))e.searchParams.set(r,n);return e.toString()}const Gs=s=>s.replace(/&/gu,"&amp;").replace(/</gu,"&lt;").replace(/>/gu,"&gt;").replace(/"/gu,"&quot;").replace(/'/gu,"&#39;"),Bn=(s,t,e=0)=>{let r=0,n=t-1;for(;n>=e&&s.charCodeAt(n)===92;)r++,n--;return r},Wn=(s,t,e)=>{const r=s.src.charCodeAt(t-1),n=s.src.charCodeAt(t+1);return{canOpen:e||!Ln(n),canClose:!(n>=48&&n<=57)&&(e||!Ln(r))}},vi=s=>(t,e)=>{if(t.src[t.pos]!=="$")return!1;let r=Wn(t,t.pos,s);if(!r.canOpen)return e||(t.pending+="$"),t.pos++,!0;const n=t.pos+1;let l=n,m;const g=t.src.lastIndexOf("$");if(g===-1)return!1;for(;(l=t.src.indexOf("$",l))<=g;){for(m=l-1;t.src.charCodeAt(m)===92;)m--;if((l-m)%2===1)break;l++}if(l===-1)return e||(t.pending+="$"),t.pos=n,!0;if(l-n===0)return e||(t.pending+="$$"),t.pos=n+1,!0;if(r=Wn(t,l,s),!r.canClose)return e||(t.pending+="$"),t.pos=n,!0;if(!e){const k=t.push("math_inline","math",0);k.markup="$",k.content=t.src.slice(n,l)}return t.pos=l+1,!0},yi=()=>(s,t)=>{const e=s.pos;if(s.src.charCodeAt(e)!==92||s.src.charCodeAt(e+1)!==40)return!1;let r=e+2,n=!1;const l=s.src.length;for(;r<l-1;){if(s.src.charCodeAt(r)===92&&s.src.charCodeAt(r+1)===41){if(Bn(s.src,e)%2===1)return!1;if(Bn(s.src,r,e+2)%2===0){n=!0;break}}r++}if(!n)return!1;if(!t){const m=s.push("math_inline","math",0);m.markup="\\(",m.content=s.src.slice(e+2,r)}return s.pos=r+2,!0},wi=(s,t,e,r)=>{const n=s.bMarks[t]+s.tShift[t];let l=s.eMarks[t];if(n+2>l||s.src.charCodeAt(n)!==36||s.src.charCodeAt(n+1)!==36)return!1;if(r)return!0;let m=s.skipSpacesBack(l,n),g=n+2,k,C=!1;m-g>=2&&s.src.charCodeAt(m-1)===36&&s.src.charCodeAt(m-2)===36?(k=s.src.slice(g,m-2),C=!0):k=s.src.slice(g,l);let y=t,L="";for(;!C&&(y++,!(y>=e||(g=s.bMarks[y]+s.tShift[y],l=s.eMarks[y],g<l&&s.tShift[y]<s.blkIndent)));)m=s.skipSpacesBack(l,g),m-g>=2&&s.src.charCodeAt(m-1)===36&&s.src.charCodeAt(m-2)===36&&(L=s.src.slice(g,m-2),C=!0);s.line=C?y+1:y;const N=s.push("math_block","math",0);return N.block=!0,N.content=(k?`${k}
`:"")+s.getLines(t+1,y,s.tShift[t],!0)+(L?`${L}
`:""),N.map=[t,s.line],N.markup="$$",!0},xi=()=>(s,t,e,r)=>{const n=s.bMarks[t]+s.tShift[t];let l=s.eMarks[t];if(n+2>l||s.src.charCodeAt(n)!==92||s.src.charCodeAt(n+1)!==91)return!1;if(r)return!0;let m=s.skipSpacesBack(l,n),g=n+2,k,C=!1;m-g>=2&&s.src.charCodeAt(m-1)===93&&s.src.charCodeAt(m-2)===92?(k=s.src.slice(g,m-2),C=!0):k=s.src.slice(g,l);let y=t,L="";for(;!C&&(y++,!(y>=e||(g=s.bMarks[y]+s.tShift[y],l=s.eMarks[y],g<l&&s.tShift[y]<s.blkIndent)));)m=s.skipSpacesBack(l,g),m-g>=2&&s.src.charCodeAt(m-1)===93&&s.src.charCodeAt(m-2)===92&&(L=s.src.slice(g,m-2).trimEnd(),C=!0);if(!C)return!1;s.line=y+1;const N=s.push("math_block","math",0);return N.block=!0,N.content=(k?`${k}
`:"")+s.getLines(t+1,y,s.tShift[t],!0)+(L?`${L}
`:""),N.map=[t,s.line],N.markup="\\[",!0},Un={alt:["paragraph","reference","blockquote","list"]},ki=(s,t)=>{if(typeof(t==null?void 0:t.render)!="function")throw new Error('[@mdit/plugin-tex]: "render" option should be a function');const{allowInlineWithSpace:e=!1,mathFence:r=!1,delimiters:n="dollars",render:l}=t;if(r){const m=s.renderer.rules.fence;s.renderer.rules.fence=(...g)=>{const[k,C,,y]=g,{content:L,info:N}=k[C];return N.trim()==="math"?l(L,!0,y):m(...g)}}(n==="dollars"||n==="all")&&(s.inline.ruler.after("escape","math_inline_dollar",vi(e)),s.block.ruler.after("blockquote","math_block_dollar",wi,Un)),(n==="brackets"||n==="all")&&(s.inline.ruler.before("escape","math_inline_bracket",yi()),s.block.ruler.after("blockquote","math_block_bracket",xi(),Un)),s.renderer.rules.math_inline=(m,g,k,C)=>l(m[g].content,!1,C),s.renderer.rules.math_block=(m,g,k,C)=>l(m[g].content,!0,C)},Ci=(s,t,e)=>{let r;try{r=jn(s,{...t,displayMode:!1})}catch(n){/* istanbul ignore else -- @preserve */if(n instanceof Vn)console.error(n),r=`<span class='katex-error' title='${Gs(n.toString())}'>${Gs(s)}</span>`;else throw n}return(e==null?void 0:e(r,!1))??r},_i=(s,t,e)=>{let r;try{r=`<p class='katex-block'>${jn(s,{...t,displayMode:!0})}</p>
`}catch(n){/* istanbul ignore else -- @preserve */if(n instanceof Vn)console.error(n),r=`<p class='katex-block katex-error' title='${Gs(n.toString())}'>${Gs(s)}</p>
`;else throw n}return(e==null?void 0:e(r,!0))??r},bi=(s,t={})=>{const{allowInlineWithSpace:e=!1,delimiters:r,mathFence:n,logger:l=C=>C==="newLineInDisplayMode"?"ignore":"warn",macros:m={},transformer:g,...k}=t;s.use(ki,{allowInlineWithSpace:e,delimiters:r,mathFence:n,render:(C,y,L)=>{const N={strict:(B,F,G)=>l(B,F,G,L)??"ignore",macros:m,throwOnError:!1,...k};return y?_i(C,N,g):Ci(C,N,g)}})};function Ii(s){return typeof s!="string"||!s?"":new DOMParser().parseFromString(s,"text/html").body.textContent||""}const Ys=s=>(un("data-v-52a61599"),s=s(),fn(),s),Ti={class:"dot"},Ei=Ys(()=>H("i",{class:"dot-item"},null,-1)),Mi=Ys(()=>H("i",{class:"dot-item"},null,-1)),Ni=Ys(()=>H("i",{class:"dot-item"},null,-1)),Si=[Ei,Mi,Ni],Di={key:0},Li={key:1},Ai={key:2,class:"robot-menu"},Oi=Ys(()=>H("br",null,null,-1)),Ri={class:"robot-menu-items"},Hi=["onClick"],$i={key:3},Pi={key:4},Fi=["src"],Bi=["innerHTML","data-msg-id"],Wi={key:8},Ui={key:9},Ki=qe({__name:"robot-message",props:{source:null},setup(s,{expose:t}){const e=s,{t:r}=bs(),n=is(),l=Z(),m=Go({html:!0,breaks:!0,linkify:!0});m.use(bi,{delimiters:"all"}),m.use(jo),m.renderer.rules.link_open=(me,re,I,P,ce)=>{const de=me[re];return de.attrIndex("target")===-1&&de.attrPush(["target","_blank"]),ce.renderToken(me,re,I)};function g(me){const re=Ir(me);return m.render(re)}const k=J(()=>{var me;return((me=e.source.ext.robotMessageInfo)==null?void 0:me.answerType)==="LLM_TEXT"}),C=J(()=>fr(e.source.ext.robotMessageInfo)),y=J(()=>$n(e.source.ext.robotMessageInfo)),L=J(()=>e.source.ext.robotStreamStatus===Js.LOADING);J(()=>e.source.ext.robotStreamStatus===Js.STREAMING);const N=J(()=>e.source.ext.robotStreamStatus===Js.FAILED),B=J(()=>e.source.ext.robotMessageInfo.option===12),F=J(()=>gr(e.source.ext.robotMessageInfo)),G=J(()=>hr(e.source.ext.robotMessageInfo)),te=J(()=>mr(e.source.ext.robotMessageInfo)),U=J(()=>pr(e.source.ext.robotMessageInfo)),le=J(()=>G.value?(e.source.ext.iframeContentHeight??200)+"px":"100%"),V=J(()=>{if(G.value){const me={bot_referer:"*",bot_msg:e.source.id};return pi(e.source.ext.robotMessageInfo.pcIframeUrl,me)}else return""}),We=J(()=>$n(e.source.ext.robotMessageInfo)&&e.source.ext.robotMessageInfo.hitType==="QA"?Ii(e.source.msg):e.source.msg),Le=J(()=>ks(e.source)?g(Hn(e.source,e.source.msg)):k.value?g(e.source.msg):"");async function _e(me){var re,I;if(console.log("robotMenuItem",me),mi(me)){const P=(I=(re=e.source.ext.replyInfo)==null?void 0:re.ext)==null?void 0:I.atToInfo;if(!P)return;const ce={atToInfo:Zn(P)},{to:de,chatType:ae}=e.source,ge={chatType:ae,to:de,from:String(n.loginId),ext:ce,msg:`@${P[0].name}：${me.content}`},{msg:Ie}=await n.saveMsg({msgType:Fe.TEXT,msgOptions:ge,isAtt:!1});n.sendShowTypeMessage({msg:Ie},!0,!1,{questionData:pe.cloneDeep(me)})}else me.url&&window.open(me.url)}return t({rootEl:l}),(me,re)=>(p(),b("div",{class:"robot-message",ref_key:"rootEl",ref:l},[Be(H("span",Ti,Si,512),[[Ue,o(L)]]),o(N)?(p(),b("div",Di,Q(o(r)("message.messageLoadFailed")),1)):o(B)?(p(),b("div",Li,"["+Q(o(r)("message.stopped"))+"]",1)):o(te)?(p(),b("div",Ai,[H("div",null,Q(o(Hn)(e.source)),1),Oi,H("div",Ri,[(p(!0),b(at,null,Nt(e.source.ext.robotMessageInfo.items,I=>(p(),b("div",{class:"robot-menu-item",onClick:P=>_e(I)},Q(o(he).hyperLink(I.content)),9,Hi))),256))])])):o(F)?(p(),b("div",$i,Q(e.source.msg),1)):o(U)?(p(),b("div",Pi,[we(o(ur),{attachment:{url:e.source.ext.robotMessageInfo.url,title:o(r)("message.richText")}},null,8,["attachment"])])):o(G)?(p(),b("iframe",{key:5,style:Qe({height:o(le)}),src:o(V),frameborder:"0"},null,12,Fi)):o(ks)(e.source)?(p(),b("div",{key:6,innerHTML:o(Le),class:"markdown-body","data-msg-id":e.source.id},null,8,Bi)):o(k)?(p(),Ne(hi,{key:7,class:"markdown-body","full-text":o(Le),"is-loading":!1},null,8,["full-text"])):o(C)?(p(),b("div",Wi,Q(s.source.msg),1)):o(y)?(p(),b("div",Ui,Q(o(We)),1)):Y("",!0)],512))}}),zi=as(Ki,[["__scopeId","data-v-52a61599"]]);let As;const Gi=new Uint8Array(16);function ji(){if(!As&&(As=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!As))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return As(Gi)}const Ze=[];for(let s=0;s<256;++s)Ze.push((s+256).toString(16).slice(1));function Vi(s,t=0){return(Ze[s[t+0]]+Ze[s[t+1]]+Ze[s[t+2]]+Ze[s[t+3]]+"-"+Ze[s[t+4]]+Ze[s[t+5]]+"-"+Ze[s[t+6]]+Ze[s[t+7]]+"-"+Ze[s[t+8]]+Ze[s[t+9]]+"-"+Ze[s[t+10]]+Ze[s[t+11]]+Ze[s[t+12]]+Ze[s[t+13]]+Ze[s[t+14]]+Ze[s[t+15]]).toLowerCase()}const Yi=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Kn={randomUUID:Yi};function Ao(s,t,e){if(Kn.randomUUID&&!t&&!s)return Kn.randomUUID();s=s||{};const r=s.random||(s.rng||ji)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(let n=0;n<16;++n)t[e+n]=r[n];return t}return Vi(r)}const Oo=s=>(un("data-v-9f6a4dbb"),s=s(),fn(),s),qi=["id"],Xi=["src"],Ji=["onClick"],Zi=["src"],Qi=["innerHTML"],el=["innerHTML"],tl={key:5},sl={key:0},nl=["innerHTML"],ol=Oo(()=>H("br",null,null,-1)),rl=["onClick"],al=["innerHTML"],il={key:6},ll={key:0,class:"text-with-audio"},cl={class:"to-text-loading"},dl=Oo(()=>H("i",{class:"loading"},null,-1)),ul=[dl],fl={class:"to-text-fail"},gl={class:"to-text-complete"},hl={key:7},ml={key:9,class:"unreadRed"},pl=["src"],vl={key:0,class:"rich-message-item rich-message-text-item"},yl=["innerHTML"],wl={key:1,class:"rich-message-item rich-message-image-item"},xl={key:2,style:{"user-select":"none"}},kl={style:{"user-select":"none"}},zn=280,Os=240,Cl=qe({__name:"msg-render",props:{...xo,name:{type:String,default:""},isShowAddOne:{type:Boolean,default:!1},changeDownloadState:Object,groupInfo:Object},emits:{...ko,"at-to-info":s=>s,"click-robot-report":s=>s,"click-avatar":(s,t)=>{}},setup(s,{emit:t}){var Es,cs,Ms,ds,us,fs,gs,hs,ms,ps;const e=s,r=vr.sanitize,{t:n}=bs(),l=gn("receive"),m=nr(),g=is(),k=eo(),{conversationListData:C}=sr(g),y=Z(!1),L=Z(),N=J(()=>e.source.ext.onlineFileTransferSuccess===!0),B=d=>{t("change",{val:d,source:pe.cloneDeep(e.source)})},F=Z(null),G=()=>{var d,u;(d=F.value)!=null&&d.src.startsWith("cximg://")?F.value.src=(u=F.value)==null?void 0:u.src.replace("cximg://",""):F.value.src=mn},{isPlay:te,playAudio:U,audioUrl:le,voiceToText:V}=Eo(e,g,d=>{t("audio-event",d)});let We=null,Le=0;const _e=async d=>{var c;Le++;const u=await window.RendererHelper.getMousePointInWindow(),w=await window.RendererHelper.getMousePointInScreen(),{width:i,height:a}=await window.RendererHelper.getScreenWorkArea();w.x+340>i?u.x-340:u.x,w.y+200>a?u.y-200:u.y,Le===1?We=setTimeout(async()=>{var f,h,v,T,S,_,$,A;if(Le=0,((f=e.source)==null?void 0:f.chatType)===Me.GROUP&&((v=(h=k.getGroupsInfos)==null?void 0:h.members)!=null&&v.find(x=>x.uid==e.source.from))){let x=(S=(T=k.getGroupsInfos)==null?void 0:T.members)==null?void 0:S.find(E=>E.uid==e.source.from);if(x){let E=x.uid;t("update-avator",E),t("click-avatar",d,x.puid);const R=setTimeout(()=>{t("update-avator",E),clearTimeout(R)},2e3)}}else{let x="";const E=(_=e.source)==null?void 0:_.from;if(($=g.conversationListData[e.source.from])!=null&&$.puid)x=(A=g.conversationListData[e.source.from])==null?void 0:A.puid;else{let M=await window.RendererHelper.getUsersByTuids(String(E));M&&(x=String(M[0].puid))}t("update-avator",E),g.setMessageToConversationCount(),t("click-avatar",d,x);const R=setTimeout(()=>{t("update-avator",E),g.setMessageToConversationCount(),clearTimeout(R)},2e3)}},300):(clearTimeout(We),Le=0,((c=e.source)==null?void 0:c.chatType)===Me.GROUP&&(g.conversationList[e==null?void 0:e.source.from]?re():me()))},me=async()=>{var a,c,f,h,v,T,S,_,$;let{from:d,to:u,sendName:w,ext:i}=e==null?void 0:e.source;if(C.value[d])g.setChatTargetId(d),m.push({path:"/message/conversation",query:{id:d,chatType:Me.SINGLE,t:new Date().getTime()}});else{let A="default";if(((a=e.source)==null?void 0:a.chatType)===Me.GROUP){let x=(h=(f=(c=k.getGroupsInfos)==null?void 0:c.members)==null?void 0:f.find(M=>M.uid==e.source.from))==null?void 0:h.puid;if(!x){let M=await window.RendererHelper.getUsersByTuids(String(e.source.from));x=String(M[0].puid),w=M[0].name}A=x?`https://photo.chaoxing.com/p/${x}_80?flag=1&psize=100_100c&ext=jpg`:((T=(v=C.value[u])==null?void 0:v.conversationInfo)==null?void 0:T.avatarUrl[0])||"default",w=w||(($=(_=(S=k.getGroupsInfos)==null?void 0:S.members)==null?void 0:_.find(M=>M.uid==e.source.from))==null?void 0:$.name);const E=await g.getLastMessage(String(d)),R=E.success&&E.data?E.data.msg:"";await g.gatherConversation(String(d),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:w,pic:[A],chatType:Me.SINGLE,puid:String(x),msg:R}}),g.setChatTargetId(d),m.push({path:"/message/conversation",query:{id:d,chatType:Me.SINGLE,t:new Date().getTime()}}),br({msgId:String(d),puid:g.puid,type:_r.SINGLE,status:1})}}},re=()=>{const{from:d}=e==null?void 0:e.source;g.deleteStoreMsg(d),g.setChatTargetId(d),m.push({path:"/message/conversation",query:{id:d,chatType:Me.SINGLE,t:new Date().getTime()}})},I=()=>{var d;((d=e.source)==null?void 0:d.chatType)===Me.GROUP&&t("mouse-menu-handler",{event:oe.At_MEMBER_EVENT,data:e.source})},P=J(()=>{var d,u,w;return Number((d=e.audio)==null?void 0:d.length)>1?Math.floor(Number((u=e.audio)==null?void 0:u.length)):Math.ceil(Number((w=e.audio)==null?void 0:w.length))}),ce=async()=>{var v,T;console.log("props.source",e.source);const{chatType:d,ext:u,to:w,msg:i,type:a,id:c}=e.source;let f=pe.cloneDeep({to:w,chatType:d,ext:u,msg:i,from:String(g.loginId)});console.log("消息+1>>>>>>>>",f),((T=(v=f.ext)==null?void 0:v.readList)==null?void 0:T.length)>0&&(f.ext.readList=[]);const{msg:h}=await g.saveMsg({msgType:a,msgOptions:f});g.sendShowTypeMessage({msg:h},!1)},de=()=>{var d,u;return(u=(d=e.source)==null?void 0:d.ext)==null?void 0:u.expression_id},ae=d=>{let u=he.htmlEncodeByRegExp(d);return u=he.hyperLink(u).replace(/\n/g,"<br/>"),Ws.forEach(w=>{if(u.indexOf(w.msg)!==-1){const i=`${Us}${w.fileName}.png`,a=new URL(i,import.meta.url).href;u=u.replaceAll(w.msg,`<img src="${a}" alt="cxemoji-${w.msg}" width="20" height="20" style="vertical-align: bottom;"/>`)}}),u},ge=d=>{d.url?window.open(d.url):t("click-robot-report",{item:d,res:e.source})},Ie=J(()=>{let d=he.htmlEncodeByRegExp(e.contents);return d=he.hyperLink(d).replace(/\n/g,"<br/>"),de()?go.forEach(u=>{var w,i;if(((i=(w=e.source)==null?void 0:w.ext)==null?void 0:i.expression_id)==u.expression_id){const a=`${ho}${u.fileName}.gif`;d=`<img src="${new URL(a,import.meta.url).href}" alt="cxemoji-${u.msg}" width="70" height="70" style="vertical-align: bottom;user-select: none;-webkit-user-drag: none;"/>`}}):Ws.forEach(u=>{if(d.indexOf(u.msg)!==-1){const w=`${Us}${u.fileName}.png`,i=new URL(w,import.meta.url).href;d=d.replaceAll(u.msg,`<img src="${i}" alt="cxemoji-${u.msg}" width="20" height="20" style="vertical-align: bottom;"/>`)}}),d});let W=Z("cxmsgimg://"+((Es=e.imgs)==null?void 0:Es.thumb)),Te=Z("cxmsgimg://"+((cs=e.imgs)==null?void 0:cs.url)),O=Z(!1),X=Z(!0);const Oe=()=>{var d,u,w,i,a;W.value==((d=e.imgs)==null?void 0:d.thumb)?W.value="cxmsgimg://"+((u=e.imgs)==null?void 0:u.url):W.value=="cxmsgimg://"+((w=e.imgs)==null?void 0:w.url)?(console.log("[message][msg-render.vue][imgError]",(i=e.imgs)==null?void 0:i.url),O.value=!0,X.value=!1):W.value=(a=e.imgs)==null?void 0:a.thumb},$e=()=>{X.value=!1},Ae=(d,u,w,i)=>{var a;if(d)if(console.log("[previewImg] imgUrl:",d),O.value)Pe({content:n("message.msgImgOutOfDate"),duration:2e3});else if(X.value)Pe({content:"图片正在加载中, 请稍后再试",duration:2e3});else{let c=!1,f={width:void 0,height:void 0};if(w){const h=w.target;if(d.startsWith("cxmsgimg://")){c=!0;const v=new Image;v.src=d,v.onload=T=>{var _;const S=T.target;f.width=S==null?void 0:S.width,f.height=S==null?void 0:S.height,(_=e.callback)==null||_.call(e,d,u,f,i)},v.onerror=()=>{var T;(T=e.callback)==null||T.call(e,d,u,f,i)}}else if((a=h==null?void 0:h.src)!=null&&a.includes("rw"))try{const T=new URL(h.src).searchParams,S=T.get("rw"),_=T.get("rh");S&&(f.width=parseInt(S)),_&&(f.height=parseInt(_))}catch(v){console.error(v)}else f.width=h.naturalWidth,f.height=h.naturalHeight}console.log("[previewImg] imageSize.width:",f.width,"imageSize.height:",f.height),c||e.callback&&e.callback(d,u,f)}},st=async()=>{var d;e.msgType===Fe.IMAGE&&await window.MainWindowHelper.cacheMessageImage((d=e.imgs)==null?void 0:d.url)},et=J(()=>{var d,u;return q((d=e.imgs)==null?void 0:d.height,(u=e.imgs)==null?void 0:u.width)}),Ge=d=>{const u=new URLSearchParams(new URL(d).search),w=u.get("rw"),i=u.get("rh");if(w&&i)return q(Number(i),Number(w));console.error("未找到宽度和高度参数",d)},q=(d,u)=>!d||d===0?{height:`${Os}px`,...$t}:u<=zn&&d<=Os?{height:`${d}px`,width:`${u}px`,...$t}:u>d?{height:`${d/u*zn}px`,...$t}:{width:`${u/d*Os}px`,height:`${Os}px`,...$t},ue=d=>{if(d.target.src&&(d.target.src.indexOf("cximg://")>=0||d.target.src.indexOf("cxmsgimg://")>=0)){let u=d.target.src.replace("cximg://","");u=u.replace("cxmsgimg://",""),d.target.src=u}else d.target.src=to},ie=Z(""),be=async()=>{var w,i,a,c,f,h,v,T,S,_,$,A,x,E,R,M,j;if(!((i=(w=e.source)==null?void 0:w.ext)!=null&&i.replyInfo)){ie.value="";return}const d=!((h=(f=(c=(a=e.source)==null?void 0:a.ext)==null?void 0:c.replyInfo)==null?void 0:f.body)!=null&&h.isText)&&((_=(S=(T=(v=e.source)==null?void 0:v.ext)==null?void 0:T.replyInfo)==null?void 0:S.body)==null?void 0:_.content)=="[图片]";let u=(E=(x=(A=($=e.source)==null?void 0:$.ext)==null?void 0:A.replyInfo)==null?void 0:x.body)==null?void 0:E.remotePath;if(d&&(!u||u.indexOf("http")==-1)){const z=await window.MessageDbHelper.queryOneMessageById((j=(M=(R=e.source)==null?void 0:R.ext)==null?void 0:M.replyInfo)==null?void 0:j.messageId);if(z.success&&z.data.msgbody){const se=JSON.parse(z.data.msgbody);u=se.url.indexOf("cxmsgimg")>=0?se.url:"cxmsgimg://"+se.url}}ie.value=u?u.indexOf("cxmsgimg")>=0?u:"cxmsgimg://"+u:""},xe=J(()=>{var d,u,w,i,a,c,f,h,v,T,S,_,$,A,x,E,R,M,j,z,se,ne,ve,Ce;return(u=(d=e.source)==null?void 0:d.ext)!=null&&u.replyInfo?{isImg:!((c=(a=(i=(w=e.source)==null?void 0:w.ext)==null?void 0:i.replyInfo)==null?void 0:a.body)!=null&&c.isText)&&((T=(v=(h=(f=e.source)==null?void 0:f.ext)==null?void 0:h.replyInfo)==null?void 0:v.body)==null?void 0:T.content)=="[图片]",remotePath:(A=($=(_=(S=e.source)==null?void 0:S.ext)==null?void 0:_.replyInfo)==null?void 0:$.body)==null?void 0:A.remotePath,name:(R=(E=(x=e.source)==null?void 0:x.ext)==null?void 0:E.replyInfo)==null?void 0:R.name,content:so(((M=e.source)==null?void 0:M.ext)??{}),timestamp:(se=(z=(j=e.source)==null?void 0:j.ext)==null?void 0:z.replyInfo)==null?void 0:se.timestamp,isGroup:(Ce=(ve=(ne=e.source)==null?void 0:ne.ext)==null?void 0:ve.replyInfo)==null?void 0:Ce.isGroup}:!1}),Ee=()=>{var d,u;e.isMultipleChoice||t("reply-handler",(u=(d=e.source)==null?void 0:d.ext)==null?void 0:u.replyInfo)},Se=ee({icon:"delete",name:n("message.delete"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.DELETE_EVENT});const{destroy:d}=gt(ws,{title:n("message.reminder"),content:n("message.deleteMessage"),cancelBtn:{text:n("message.cancel"),callback(){d()}},confirmBtn:{text:n("message.delete"),callback(){var u,w,i,a;(e==null?void 0:e.source.chatType)===Me.GROUP&&g.delMessage((u=e.source)==null?void 0:u.id,(w=e.source)==null?void 0:w.to),(e==null?void 0:e.source.chatType)===Me.SINGLE&&g.delMessage((i=e.source)==null?void 0:i.id,(a=e.source)==null?void 0:a.from),d()}}})}}),Ke=ee({icon:"singleChat",name:n("message.singleRelpy"),menuHandler:async()=>{g.setSingleReplyInfo(on(e.source)),me()}}),ct=ee({icon:"reply",name:n("message.reply"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.REPLY_EVENT,data:on(e.source)})}}),tt=ee({icon:"multiple-choice",name:n("message.multiplechoice"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.MULTIPLE_CHOICE}),y.value=!0,t("change",{val:!0,source:pe.cloneDeep(e.source)})}}),nt=ee({icon:"revocation",name:n("message.withdraw"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.REVOCATION_EVENT});const{destroy:d}=gt(ws,{title:n("message.reminder"),content:n("message.revocationMessage"),cancelBtn:{text:n("message.cancel"),callback(){d()}},confirmBtn:{text:n("message.withdraw"),callback(){var u,w,i,a,c;g.recallMessage({ext:{msgId_from:(u=e.source)==null?void 0:u.from,msgId_time:(w=e.source)==null?void 0:w.time},mid:(i=e.source)==null?void 0:i.id,to:(a=e.source)==null?void 0:a.to,chatType:(c=e.source)==null?void 0:c.chatType,isPcRecall:!0,updateStore:!0}),d()}}})}});let Re=Z(!1);const Qt=d=>{e.msgType===Fe.TEXT?wt(d):e.msgType===Fe.AUDIO&&Tt(d)},es=d=>{d.preventDefault();const u=ee({icon:"download-folder",name:n("transferFile.openFolder"),menuHandler:async()=>{let w=e.source.ext.savePath;if(w){const i=await window.RendererHelper.openFileInManagerAndSelect(w);console.log("callResult:",i),(i==null?void 0:i.code)!==0&&Pe({content:n("transferFile.notFoundTip"),duration:2e3})}else console.error("[onlineFileCard openFolder] no onlineFilePath")}});t("mouse-menu",{menuList:[[u],[Se]],event:d})},wt=d=>{var f,h,v,T;d.preventDefault();const u=ee({icon:"copy",name:n("message.Copy"),menuHandler:()=>{var S,_,$;if(t("mouse-menu-handler",{event:oe.COPY_EVENT}),So(e.source))Do(e.source,{robotMessageEl:(S=L.value)==null?void 0:S.rootEl}).then(()=>{Pe({content:n("message.copied"),duration:2e3})}).catch(A=>{console.error("copySpecialMessage error:",A)});else{let A=e.contents;const x=Array.isArray(($=(_=e==null?void 0:e.source)==null?void 0:_.ext)==null?void 0:$.textMixings),E=window.getSelection(),R=E==null?void 0:E.getRangeAt(0),M=R==null?void 0:R.cloneContents(),j=(M==null?void 0:M.childNodes.length)??0;if(j===0&&x){const ne=e.source.ext.textMixings,ve=zs(ne),Ce=Ks(ne);window.RendererHelper.setClipboardByMainProcess(ve,Ce),Pe({content:n("message.copied"),duration:2e3});return}const z=M==null?void 0:M.querySelectorAll("img"),se=z?Array.from(z).filter(ne=>!(ne.alt&&ne.alt.startsWith("cxemoji-"))).length>0:!1;if(x&&se)if(j>0){const ne=Io(M);window.RendererHelper.setClipboardByMainProcess(ne,"")}else{const ne=e.source.ext.textMixings,ve=zs(ne),Ce=Ks(ne);window.RendererHelper.setClipboardByMainProcess(ve,Ce)}else{let ne=no();ne&&(A=ne),A=he.htmlDecodeByRegExp(A),A=A.replace(/<br>/g,`
`),console.log("复制下来的内容",A),window.RendererHelper.setClipboardByMainProcess(void 0,A)}Pe({content:n("message.copied"),duration:2e3})}}}),w=ee({icon:"forward",name:n("message.retransmission"),menuHandler:()=>{oo(pe.cloneDeep(e.source),`[${n("message.retransmission")}]${e.source.sendName}${n("message.sChatlogs")}`)}}),i=[ct],a=[Se];de()||(i.unshift(u),i.push(w),((f=e==null?void 0:e.groupSelf)!=null&&f.owner||(h=e==null?void 0:e.groupSelf)!=null&&h.admin)&&((v=e==null?void 0:e.groupInfo)==null?void 0:v.owner)!=((T=e==null?void 0:e.source)==null?void 0:T.from)&&a.push(nt),a.push(tt)),(e==null?void 0:e.source.chatType)===Me.GROUP&&a.push(Ke);let c=[i,a];wr(e.source)||(ks(e.source)?(c=[[u]],t("mouse-menu",{menuList:c,event:d})):t("mouse-menu",{menuList:c,event:d})),Re.value=!0,he.windowClickOnce(()=>Re.value=!1)},Dt=d=>{var w,i,a,c;d.preventDefault();const u=[Se];((w=e==null?void 0:e.groupSelf)!=null&&w.owner||(i=e==null?void 0:e.groupSelf)!=null&&i.admin)&&((a=e==null?void 0:e.groupInfo)==null?void 0:a.owner)!=((c=e==null?void 0:e.source)==null?void 0:c.from)&&u.push(nt),u.push(tt),(e==null?void 0:e.source.chatType)===Me.GROUP&&u.push(Ke),t("mouse-menu",{menuList:[[ee({icon:"copy",name:n("message.Copy"),menuHandler:async()=>{var h;t("mouse-menu-handler",{event:oe.COPY_EVENT});let f=await window.RendererHelper.getMessageImageCachePath((h=e.imgs)==null?void 0:h.url);await window.RendererHelper.isFileExists(f)?window.RendererHelper.setClipboardByMainProcess(null,null,{localPath:f}):d&&window.RendererHelper.copyImageAt(d==null?void 0:d.x,d==null?void 0:d.y),Pe({content:n("message.copied"),duration:2e3})}}),ee({icon:"cloud",name:n("message.savetoclouddrive"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_TO_CLOUD});const{destroy:f}=gt(Ht,{msgList:[pe.cloneDeep(e.source)],cancelBtn:{text:n("message.cancel"),callback(){f()}},confirmBtn:{text:n("message.done"),callback(){f()}}})}}),ct,ee({icon:"forward",name:n("message.retransmission"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.FORWARD_EVENT}),Bs(pe.cloneDeep(e.source),null)}})],[ee({icon:"save",name:n("message.saveas"),menuHandler:async()=>{var h,v;t("mouse-menu-handler",{event:oe.SAVE_AS_EVENT});let f=await window.RendererHelper.getMessageImageCachePath((h=e.imgs)==null?void 0:h.url);await window.RendererHelper.isFileExists(f)?window.MainWindowHelper.saveLocalFileAs(f,`img_${new Date().getTime()}.png`):window.MainWindowHelper.saveFileAs((v=e.imgs)==null?void 0:v.url,`img_${new Date().getTime()}.png`)}})],u],event:d}),Re.value=!0,he.windowClickOnce(()=>Re.value=!1)},dt=d=>{var a,c,f,h;d.preventDefault();const u=d.target;let w;u.tagName.toLowerCase()==="img"&&(w=u.getAttribute("src"),w!=null&&w.startsWith(Xt)?w=w.replace(Xt,Yt):w!=null&&w.startsWith(Jt)&&(w=w.replace(Jt,qt)));const i=[Se];((a=e==null?void 0:e.groupSelf)!=null&&a.owner||(c=e==null?void 0:e.groupSelf)!=null&&c.admin)&&((f=e==null?void 0:e.groupInfo)==null?void 0:f.owner)!=((h=e==null?void 0:e.source)==null?void 0:h.from)&&i.push(nt),i.push(tt),(e==null?void 0:e.source.chatType)===Me.GROUP&&i.push(Ke),t("mouse-menu",{menuList:[[ee({icon:"copy",name:n("message.Copy"),menuHandler:async()=>{if(t("mouse-menu-handler",{event:oe.COPY_EVENT}),d){if(w!=null&&w.startsWith(Yt)||w!=null&&w.startsWith(qt)){const v=await he.convertImgToBase64(w);window.RendererHelper.setClipboardByMainProcess(null,null,{base64Url:v})}else window.RendererHelper.copyImageAt(d==null?void 0:d.x,d==null?void 0:d.y);Pe({content:n("message.copied"),duration:2e3})}}}),ee({icon:"cloud",name:n("message.savetoclouddrive"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_TO_CLOUD});const{destroy:v}=gt(Ht,{msgList:[pe.cloneDeep(e.source)],mixImgUrl:w,cancelBtn:{text:n("message.cancel"),callback(){v()}},confirmBtn:{text:n("message.done"),callback(){v()}}})}}),ct,ee({icon:"forward",name:n("message.retransmission"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.FORWARD_EVENT}),Bs(pe.cloneDeep(e.source),w)}})],[ee({icon:"save",name:n("message.saveas"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_AS_EVENT}),w&&window.MainWindowHelper.saveFileAs(w,`img_${new Date().getTime()}.png`)}})],i],event:d})},Lt=Z(""),Xe=Z(-1),Tt=d=>{var a,c,f,h;d.preventDefault();const u=[Se];((a=e==null?void 0:e.groupSelf)!=null&&a.owner||(c=e==null?void 0:e.groupSelf)!=null&&c.admin)&&((f=e==null?void 0:e.groupInfo)==null?void 0:f.owner)!=((h=e==null?void 0:e.source)==null?void 0:h.from)&&u.push(nt),u.push(tt),(e==null?void 0:e.source.chatType)===Me.GROUP&&u.push(Ke);const w=ee({icon:"voice-to-text",name:n("message.voiceToText"),menuHandler:async()=>{var v,T,S,_,$,A,x,E,R,M,j,z;Xe.value==-1&&(Xe.value=0,Lt.value="",V&&V(se=>{console.log("语音转文字res",se),se.success?(Xe.value=2,Lt.value=se.data):Xe.value=1,t("mouse-menu-handler",{event:oe.VOICE_TO_TEXT})}),(v=e.source)!=null&&v.isplay||(e.source.chatType==Me.SINGLE?(g.sendReadMessage((T=e.source)==null?void 0:T.from,"read",(S=e.source)==null?void 0:S.id),g.updateAudioPlayStatus((_=e.source)==null?void 0:_.from,($=e.source)==null?void 0:$.id)):(((x=(A=e.source)==null?void 0:A.ext)==null?void 0:x.showRead)==1&&g.sendCMDMessage({chatType:Me.SINGLE,to:(E=e.source)==null?void 0:E.from,action:"CMD_GROUP_MSG_READ",ext:{fromPuid:String(g.puid),fromUid:String(g.loginId),groupId:(R=e.source)==null?void 0:R.to,msgId:(M=e.source)==null?void 0:M.id,time:String(new Date().getTime())},from:g.loginId}),g.updateAudioPlayStatus((j=e.source)==null?void 0:j.to,(z=e.source)==null?void 0:z.id))))}}),i=[[ee({icon:"cloud",name:n("message.savetoclouddrive"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_TO_CLOUD});const{destroy:v}=gt(Ht,{msgList:[{...pe.cloneDeep(e.source),url:le==null?void 0:le.value}],cancelBtn:{text:n("message.cancel"),callback(){v()}},confirmBtn:{text:n("message.done"),callback(){v()}}})}}),ct,ee({icon:"forward",name:n("message.retransmission"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.FORWARD_EVENT}),ro({...pe.cloneDeep(e.source),url:le==null?void 0:le.value})}})],u];Mo(e.source)||i.push([w]),t("mouse-menu",{menuList:i,event:d}),Re.value=!0,he.windowClickOnce(()=>Re.value=!1)},ut=Gt({}),ht=Gt({}),xt=Gt({});bt("attCustomize",ut),bt("attOperation",ht),bt("attProgress",xt);const ot=(d,u,w,i,a,c,f)=>{ut.content=d,ut.style=u,ut.fn=w,ht.content=i,ht.fn=a,xt.showProgressBar=c,xt.progressBarWidth=f},Pt=d=>{let u="",w="",i="";return d!=null&&d.att_video?(u=d.att_video.resid,w="att_video",i=d==null?void 0:d.att_video):d!=null&&d.att_clouddisk?(u=d.att_clouddisk.resid||d.att_clouddisk.objectId,w="att_clouddisk",i=d==null?void 0:d.att_clouddisk):d!=null&&d.att_cloudFolder&&(u=d.att_cloudFolder.resid,w="att_cloudFolder",i=d),{resid:u,attType:w,att:i}},mt=(d,u,w,i)=>{var h,v,T;const{resid:a,attType:c,att:f}=Pt((v=(h=e.source)==null?void 0:h.ext)==null?void 0:v.attachment);switch(d){case 2:ot(n("header.Paused"),"","",c=="att_video"?`<svg class="svg-icon" aria-hidden="true" style="width:36px;height:36px">
          <use xlink:href="#icon-stop_download_video"></use>
        </svg>`:`<svg class="svg-icon" aria-hidden="true" style="width:10px;height:10px;margin-right:4px">
          <use xlink:href="#icon-stop_download"></use>
        </svg> ${n("message.start")}`,async()=>{let $=(await window.MainWindowHelper.loadDownloadList()).filter(A=>A.resId==a);$&&(window.MainWindowHelper.resumeDownload([$[0].id]),window.MainWindowHelper.checkDiskFileDownloadChanged(a,A=>{const{downloadSpeed:x,receivedBytes:E,totalSize:R,state:M}=A,j=he.byteConvert(x),z=`${Math.ceil(E/R*100)}%`;mt(M,j,z,!0)}))},!0,w);break;case 3:ot(`<span style="margin-right:6px">${n("message.Downloading")}</span>
          <span>${u||"0B"}/S</span>`,"","",c=="att_video"?`<svg class="svg-icon" aria-hidden="true" style="width:36px;height:36px">
          <use xlink:href="#icon-start_download_video"></use>
        </svg>`:`<svg class="svg-icon" aria-hidden="true" style="width:10px;height:10px;margin-right:4px">
          <use xlink:href="#icon-start_download"></use>
        </svg> ${n("message.pause")}`,async()=>{let $=(await window.MainWindowHelper.loadDownloadList()).filter(A=>A.resId==a);$&&window.MainWindowHelper.pauseDownload([$[0].id])},!0,w),i&&window.MainWindowHelper.checkDiskFileDownloadChanged(a,_=>{const{downloadSpeed:$,receivedBytes:A,totalSize:x,state:E}=_,R=he.byteConvert($),M=`${Math.ceil(A/x*100)}%`;mt(E,R,M,!1)});break;case 4:if(ot(n("message.downloaded"),"","","","",!1,""),!i)for(let _ of pt)((T=e.source)==null?void 0:T.id)==(_==null?void 0:_.id)&&(_.isDownLoad=!0);break;case 6:let S;c=="att_clouddisk"&&(S={color:"#3A8BFF"}),ot(c=="att_video"?`${n("message.redownload")}`:`<svg class="svg-icon" aria-hidden="true" style="width:10px;height:10px;margin-right:4px">
        <use xlink:href="#icon-reload"></use>
        </svg> ${n("message.redownload")}`,S,c=="att_video"?"":async()=>{let $=(await window.MainWindowHelper.loadDownloadList()).filter(A=>A.resId==a);$&&(window.MainWindowHelper.resumeDownload([$[0].id]),i&&window.MainWindowHelper.checkDiskFileDownloadChanged(a,A=>{const{downloadSpeed:x,receivedBytes:E,totalSize:R,state:M}=A,j=he.byteConvert(x),z=`${Math.ceil(E/R*100)}%`;mt(M,j,z,!1)}))},c=="att_video"?`<svg class="svg-icon" aria-hidden="true" style="width:36px;height:36px">
          <use xlink:href="#icon-redownload_video"></use>
        </svg>`:"",c=="att_video"?async()=>{let $=(await window.MainWindowHelper.loadDownloadList()).filter(A=>A.resId==a);$&&(window.MainWindowHelper.resumeDownload([$[0].id]),i&&window.MainWindowHelper.checkDiskFileDownloadChanged(a,A=>{const{downloadSpeed:x,receivedBytes:E,totalSize:R,state:M}=A,j=he.byteConvert(x),z=`${Math.ceil(E/R*100)}%`;mt(M,j,z,!1)}))}:"",!1,"");break}},ts=(ds=(Ms=e.source)==null?void 0:Ms.downLoadState)==null?void 0:ds.state,Ft=he.byteConvert((fs=(us=e.source)==null?void 0:us.downLoadState)==null?void 0:fs.downloadSpeed),kt=`${Math.ceil(((hs=(gs=e.source)==null?void 0:gs.downLoadState)==null?void 0:hs.receivedBytes)/((ps=(ms=e.source)==null?void 0:ms.downLoadState)==null?void 0:ps.totalSize)*100)}%`;mt(ts,Ft,kt,!0);const pt=g.messageList[g.chatTargetId];Ve(()=>e.changeDownloadState,(d,u)=>{var i,a,c,f;if(!((a=(i=e.source)==null?void 0:i.ext)!=null&&a.attachment)||!d)return;const w=new Set((c=d==null?void 0:d.resIds)==null?void 0:c.filter(h=>typeof h=="string"));for(let h of pt){if(!h)continue;const{resid:v}=Pt((f=h==null?void 0:h.ext)==null?void 0:f.attachment);v&&w.has(v)&&((d==null?void 0:d.type)=="delete"&&(h.isDownLoad=!1,ut.content="",ht.content="",xt.showProgressBar=!1),(d==null?void 0:d.type)=="start"&&window.MainWindowHelper.checkDiskFileDownloadChanged(v,T=>{const{downloadSpeed:S,receivedBytes:_,totalSize:$,state:A}=T,x=he.byteConvert(S),E=`${Math.ceil(_/$*100)}%`;mt(A,x,E,!1)}))}},{deep:!0,immediate:!0});const ft=(d,u,w=!1)=>{fo(d,u,i=>{const{downloadSpeed:a,receivedBytes:c,totalSize:f,state:h}=i,v=he.byteConvert(a),T=`${Math.ceil(c/f*100)}%`;mt(h,v,T,!1)},w)};let K=!1,De=0,He=0;const Ye=d=>{d.button===0&&(K=!0,De=d.clientX,He=d.clientY)},Je=async d=>{var i,a;let u=Math.abs(d.clientX-De),w=Math.abs(d.clientY-He);if(K&&(u-5>0||w-5>0)&&!X.value&&!O.value){K=!1;let c=await window.RendererHelper.getMessageImageCachePath((i=e.imgs)==null?void 0:i.url);if(c){const f=document.createElement("canvas");f.width=120,f.height=120;const h=f.toDataURL("image/png");let v=(a=Ct.value)==null?void 0:a.props.attachment.resid,T={dragImgUrl:h,resId:v,filePath:c};window.MainWindowHelper.dragDownloadFile(T),t("drop-start",!0)}}},it=async d=>{var i,a,c,f;let u=Math.abs(d.clientX-De),w=Math.abs(d.clientY-He);if(K&&(u-5>0||w-5>0)&&((i=e.source)!=null&&i.isDownLoad||(a=e.imgs)!=null&&a.url)){K=!1;let h=(c=Ct.value)==null?void 0:c.props.attachment.resid,v=(f=Ct.value)==null?void 0:f.props.attachment.objectId,T=document.getElementById(`${e.source.id}`),S=T==null?void 0:T.querySelector("#attContextId"),_=S==null?void 0:S.querySelector("img");if(console.log("attContextDom",_==null?void 0:_.clientWidth,_==null?void 0:_.src,h,v),_==null)return;let $=document.createElement("canvas"),A=$.getContext("2d");const x=document.createElement("canvas"),E=x.getContext("2d");x.width=120,x.height=120;let R=new Image;R.crossOrigin="Anonymous",R.src=_==null?void 0:_.src,R.onload=function(){$.width=44,$.height=44,_.clientWidth<=120&&(A==null||A.drawImage(R,0,0,44,44));const M=(x.width-$.width)/2,j=(x.height-$.height)/2;E==null||E.drawImage($,M,j);let se={dragImgUrl:x.toDataURL("image/png"),resId:h,objectId:v};window.MainWindowHelper.dragDownloadFile(se),t("drop-start",!0)}}},Bt=()=>{K=!1},ls=d=>{var T,S,_,$,A,x,E;d.preventDefault();let u=e.attachment;typeof u=="string"&&(u=JSON.parse(u));const w=[ct],i=ao(u);i&&w.push(ee({icon:"forward",name:n("message.retransmission"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.FORWARD_EVENT}),io(pe.cloneDeep(u))}}));const a=(T=lo[(u==null?void 0:u.attachmentType)||-1])==null?void 0:T.insertNote,c=ee({icon:"copy",name:n("message.Copy"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.COPY_EVENT}),co(u)}});a&&w.unshift(c);const f=[Se];((S=e==null?void 0:e.groupSelf)!=null&&S.owner||(_=e==null?void 0:e.groupSelf)!=null&&_.admin)&&(($=e==null?void 0:e.groupInfo)==null?void 0:$.owner)!=((A=e==null?void 0:e.source)==null?void 0:A.from)&&f.push(nt),i&&f.push(tt);const h=[];if(((u==null?void 0:u.att_clouddisk)||(u==null?void 0:u.att_video)||(u==null?void 0:u.att_voice))&&(w.unshift(ee({icon:"cloud",name:n("message.savetoclouddrive"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_TO_CLOUD});const{destroy:R}=gt(Ht,{msgList:[pe.cloneDeep(e.source)],cancelBtn:{text:n("message.cancel"),callback(){R()}},confirmBtn:{text:n("message.done"),callback(){R()}}})}})),u!=null&&u.att_voice||((x=e.source)!=null&&x.isDownLoad?h.push(ee({icon:"download-folder",name:n("message.openFolder"),menuHandler:()=>{var R,M,j,z,se,ne,ve,Ce,fe,ye,rt,It,At,Ot,Rt;if(t("mouse-menu-handler",{event:oe.ENTER_DOWNLOAD_FOLDER}),(j=(M=(R=e.source)==null?void 0:R.ext)==null?void 0:M.attachment)!=null&&j.att_video||(ne=(se=(z=e.source)==null?void 0:z.ext)==null?void 0:se.attachment)!=null&&ne.att_clouddisk){const{resid:Wt,objectId:ss}=(fe=(Ce=(ve=e.source)==null?void 0:ve.ext)==null?void 0:Ce.attachment)!=null&&fe.att_video?(It=(rt=(ye=e.source)==null?void 0:ye.ext)==null?void 0:rt.attachment)==null?void 0:It.att_video:(Rt=(Ot=(At=e.source)==null?void 0:At.ext)==null?void 0:Ot.attachment)==null?void 0:Rt.att_clouddisk;window.MainWindowHelper.showItemInFolder("",Wt,ss)}}})):h.push(ee({icon:"download",name:n("message.download"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.DOWNLOAD_EVENT}),u!=null&&u.att_clouddisk?ft(u==null?void 0:u.att_clouddisk,"att_clouddisk"):u!=null&&u.att_video&&ft(u==null?void 0:u.att_video,"att_video")}})),h.push(ee({icon:"save",name:n("message.saveas"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_AS_EVENT}),u!=null&&u.att_clouddisk?ft(u==null?void 0:u.att_clouddisk,"att_clouddisk",!0):u!=null&&u.att_video&&ft(u==null?void 0:u.att_video,"att_video",!0)}})))),u!=null&&u.att_cloudFolder){const R=ee({icon:"save",name:n("message.saveas"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_AS_EVENT}),ft(u,"att_cloudFolder",!0)}});(E=e.source)!=null&&E.isDownLoad?h.push(ee({icon:"download-folder",name:n("message.openFolder"),menuHandler:()=>{if(t("mouse-menu-handler",{event:oe.ENTER_DOWNLOAD_FOLDER}),u!=null&&u.att_cloudFolder){const{resid:M}=u==null?void 0:u.att_cloudFolder;window.MainWindowHelper.showItemInFolder("",M)}}}),R):h.push(ee({icon:"download",name:n("message.download"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.DOWNLOAD_EVENT}),ft(u,"att_cloudFolder")}}),R)}(e==null?void 0:e.source.chatType)===Me.GROUP&&f.push(Ke),t("mouse-menu",{menuList:[w,h,f],event:d}),Re.value=!0,he.windowClickOnce(()=>Re.value=!1)},Is=()=>{y.value=!y.value,t("change",{val:y.value,source:pe.cloneDeep(e.source)})};let Ct=J(()=>{var d;return uo(e.attachment,(d=e.source)==null?void 0:d.id)});rs(()=>{var d,u;be(),st(),(u=(d=e.source)==null?void 0:d.ext)!=null&&u.atToInfo&&t("at-to-info",e.source)}),Ve(()=>e.isMultipleChoice,()=>{e.isMultipleChoice||(y.value=!1)}),Ve(()=>e.checkMsgIds,()=>{e.isOnlyRead&&(y.value=e.checkMsgIds.includes(e.source.id))},{deep:!0,immediate:!0});async function Ts(d){var w,i;const u=d.target;if(u.tagName.toLowerCase()==="a"){d.preventDefault();const a=u.href,c=hn(e.source.from),f={messageId:e.source.id,chatId:c,chatName:((i=(w=g.getCurrentConversation)==null?void 0:w.conversationInfo)==null?void 0:i.name)??"",bePuid:g.getTargetPuid,originalUrl:a};if(e.source.chatType==="groupChat"){const h=await window.MessageDbHelper.queryGroupOwner(e.source.to);h&&(f.groupOwner=h.name,f.groupOwnerPuid=h.puid)}window.MainWindowHelper.openNewSubTab(a,null,{id:Ao().replaceAll("-",""),extStore:f})}}return(d,u)=>{var c,f,h,v,T,S,_,$,A,x,E,R,M,j,z,se,ne,ve,Ce;const w=pn,i=js,a=po;return p(),b(at,null,[(c=e.source)!=null&&c.isRecall?Y("",!0):(p(),b("div",{key:0,class:D([o(l).b(),o(l).is("multipleChoice",d.isMultipleChoice),o(l).is("checked",d.isMultipleChoice&&y.value),"other-msg"]),id:(f=e.source)==null?void 0:f.id},[Be(we(w,{onChange:B,modelValue:y.value,"onUpdate:modelValue":u[0]||(u[0]=fe=>y.value=fe),size:"large"},null,8,["modelValue"]),[[Ue,d.isMultipleChoice]]),Be(H("div",{onClick:Is,class:D(o(l).e("checkboxCover"))},null,2),[[Ue,d.isMultipleChoice]]),H("div",{class:D([o(l).e("avatar")]),onClick:u[1]||(u[1]=fe=>_e(fe)),onContextmenu:I},[e.avatar=="default"||e.avatar=="cximg://default"||e.avatar=="headerimg://default"?(p(),b("img",{key:0,ref_key:"avatarImg",ref:F,src:rr,onError:G,referrerPolicy:"no-referrer"},null,544)):(p(),b("img",{key:1,ref_key:"avatarImg",ref:F,src:e.avatar,onError:G,referrerPolicy:"no-referrer"},null,40,Xi))],34),H("div",{class:D([o(l).e("message")])},[H("div",{class:D(o(l).e("name"))},Q(e.name),3),H("div",{class:D([o(l).e("message_content")])},[!o(N)&&e.msgType!==o(Fe).IMAGE&&!((v=(h=e.source)==null?void 0:h.ext)!=null&&v.textMixings)&&!(e!=null&&e.attachment)||e!=null&&e.defaultContent?(p(),b("div",{key:0,onContextmenu:Qt,class:D([o(l).e("popover"),o(l).is("isGifEmoji",!!de()),o(l).is("cover",o(Re))])},[o(xe)?(p(),b("div",{key:0,onClick:je(Ee,["stop"]),class:D([o(l).e("reply"),"reply-msg-container"])},[_t(Q((T=o(xe))==null?void 0:T.name)+" "+Q(o(Fs)((S=o(xe))==null?void 0:S.timestamp))+" ",1),o(xe).isImg?(p(),b("img",{key:0,onClick:u[2]||(u[2]=fe=>Ae(o(ie)?o(ie):"",!0,fe)),src:o(ie),onError:u[3]||(u[3]=fe=>ue(fe)),onLoad:$e},null,40,Zi)):(p(),b("div",{key:1,class:D([o(l).e("replyText"),"reply-msg-text"]),innerHTML:(_=o(xe))==null?void 0:_.content},null,10,Qi)),e.source.chatType==o(Me).SINGLE&&o(xe).isGroup?Y("",!0):(p(),Ne(i,{key:2,class:"top_icon","icon-class":"toTop_blue",width:"16px",height:"16px",color:"#3A8BFF"}))],10,Ji)):Y("",!0),o(xn)(d.source)?(p(),Ne(Lo,{key:1,source:d.source},null,8,["source"])):o(Vs)(e.source)?(p(),Ne(No,{key:2,source:e.source,"is-self-send":!1},null,8,["source"])):o(yr)(e.source)?(p(),Ne(zi,{key:3,source:e.source,ref_key:"robotMessageRef",ref:L},null,8,["source"])):e.msgType===o(Fe).TEXT&&!e.source.ext.QAData&&!((A=($=e.source)==null?void 0:$.ext)!=null&&A.textMixings)?(p(),b("span",{key:4,onClick:Ts,class:D(o(l).e("text")),innerHTML:o(Ie)},null,10,el)):e.msgType===o(Fe).TEXT&&e.source.ext.QAData?(p(),b("span",tl,[e.source.ext.QAData.answerType=="MENU"?(p(),b("span",sl,[H("span",{class:D(o(l).e("text")),innerHTML:o(he).hyperLink(o(r)(e.source.ext.QAData.answer))},null,10,nl),ol,(p(!0),b(at,null,Nt(e.source.ext.QAData.items,fe=>(p(),b("div",{style:{color:"#3a8bff",cursor:"pointer",display:"block"},onClick:ye=>ge(fe)},[H("span",{class:D(o(l).e("text"))},Q(o(he).hyperLink(fe.content)),3)],8,rl))),256))])):(p(),b("span",{key:1,class:D(o(l).e("text")),innerHTML:o(he).hyperLink(o(r)(e.source.msg))},null,10,al))])):e.msgType===o(Fe).AUDIO?(p(),b("span",il,[e.source.ext.voiceToText?(p(),b("div",ll,Q(e.source.ext.voiceToText),1)):Y("",!0),H("span",{onClick:u[4]||(u[4]=(...fe)=>o(U)&&o(U)(...fe)),style:Qe({width:`${60+(o(P)-1)*2}px`}),class:D(o(l).e("audio"))},[H("i",{class:D({play:o(te)})},null,2),H("span",null,Q(o(P))+"″",1)],6),Be(H("div",{class:D(o(l).e("v-to-text"))},[_t(Q(Lt.value)+" ",1),Be(H("div",cl,ul,512),[[Ue,Xe.value==0]]),Be(H("div",fl,[we(i,{"icon-class":"to_text_fail",style:{"margin-right":"4px"},width:"14px",height:"14px",color:"#ACB4BF"}),_t(" 未识别到有效文字 ")],512),[[Ue,Xe.value===1]]),Be(H("div",gl,[we(i,{"icon-class":"check_mark_round",style:{"margin-right":"4px"},width:"12px",height:"12px",color:"#ACB4BF"}),_t(" 转换完成 ")],512),[[Ue,Xe.value===2]])],2),[[Ue,Xe.value!==-1]])])):(p(),b("span",hl,Q(o(n)(o(Qn).UNSUPPORTED.key)),1)),de()?Y("",!0):(p(),b("span",{key:8,class:D([o(l).e("arrow"),o(l).is("cover",o(Re))])},null,2)),e.msgType==o(Fe).AUDIO&&!e.source.isplay?(p(),b("div",ml)):Y("",!0)],34)):Y("",!0),e.msgType===o(Fe).TEXT&&((E=(x=e.source)==null?void 0:x.ext)!=null&&E.textMixings)?(p(),b("div",{key:1,class:D(["rich-message",[o(l).e("popover"),o(l).is("isGifEmoji",!!de()),o(l).is("cover",o(Re))]]),onContextmenu:wt},[o(xe)?(p(),b("div",{key:0,class:D([o(l).e("reply"),"reply-msg-container"])},[_t(Q((R=o(xe))==null?void 0:R.name)+" "+Q(o(Fs)((M=o(xe))==null?void 0:M.timestamp))+" ",1),o(xe).isImg?(p(),b("img",{key:0,onClick:u[5]||(u[5]=fe=>Ae(o(ie)?o(ie):"",!0,fe)),src:o(ie),onError:u[6]||(u[6]=fe=>ue(fe)),onLoad:$e},null,40,pl)):(p(),b("div",{key:1,class:D([o(l).e("replyText"),"reply-msg-text"])},Q((j=o(xe))==null?void 0:j.content),3)),e.source.chatType==o(Me).SINGLE&&o(xe).isGroup?Y("",!0):(p(),Ne(i,{key:2,class:"top_icon","icon-class":"toTop_blue",width:"16px",height:"16px",color:"#3A8BFF",onClick:je(Ee,["stop"])},null,8,["onClick"]))],2)):Y("",!0),(p(!0),b(at,null,Nt((se=(z=d.source)==null?void 0:z.ext)==null?void 0:se.textMixings,(fe,ye)=>(p(),b("span",{class:D(["rich-message-items",o(l).e("text_img")]),key:ye},[fe.type=="text"?(p(),b("div",vl,[H("span",{onClick:Ts,innerHTML:ae(fe.content),class:D(o(l).e("text"))},null,10,yl)])):fe.type=="image"?(p(),b("div",wl,[we(a,{src:o(bo)(fe.image),onContextmenu:je(dt,["stop"]),style:Qe(Ge(fe.image)),fit:"contain",onClick:rt=>Ae(`cxmsgimg://${fe.image}`,!1,rt,fe.preview),onLoad:$e},null,8,["src","onContextmenu","style","onClick"])])):Y("",!0)],2))),128))],34)):Y("",!0),o(N)?(p(),Ne(To,{key:2,source:e.source,onContextmenu:es},null,8,["source"])):Y("",!0),H("span",{onContextmenu:ls,onMousedown:Ye,onMousemove:it,onMouseup:Bt,style:{display:"block"},id:"attContextId"},[(p(),Ne(_s((ne=o(Ct))==null?void 0:ne.component),$s(Ps((ve=o(Ct))==null?void 0:ve.props)),null,16))],32),e.msgType===o(Fe).IMAGE?(p(),b("div",{key:3,class:D([o(l).e("imgWrapper"),o(l).is("cover",o(Re))]),id:"imgContextId",onClick:u[7]||(u[7]=fe=>Ae(o(Te),!1,fe)),onContextmenu:Dt,onMousedown:Ye,onMousemove:Je,onMouseup:Bt},[Be(we(a,{src:o(W),style:Qe(o(et)),fit:"contain",onError:Oe,onLoad:$e},null,8,["src","style"]),[[Ue,!o(X)&&!o(O)]]),Be(H("div",{class:D(o(l).e("imgState")),style:Qe({...o(et),"min-width":"68px","min-height":"68px","flex-direction":!o(X)&&o(O)?"column":"initial"})},[o(X)?(p(),b("i",{key:0,class:D(o(l).e("sending"))},null,2)):Y("",!0),!o(X)&&o(O)?(p(),Ne(i,{key:1,"icon-class":"error_img",width:"20",height:"20",style:{"margin-bottom":"4px"}})):Y("",!0),!o(X)&&o(O)?(p(),b("span",xl,Q(o(n)("message.msgImgOutOfDate")),1)):Y("",!0)],6),[[Ue,o(X)||o(O)]])],34)):Y("",!0),d.source.chatType==o(Me).GROUP&&e.isShowAddOne?(p(),b("div",{key:4,class:D(o(l).e("addOne")),onClick:ce},null,2)):Y("",!0)],2)],2)],10,qi)),(Ce=e.source)!=null&&Ce.isRecall?(p(),b("div",{key:1,class:D(o(l).e("revocation"))},[H("span",kl,Q(o(n)("message.withdrew")),1)],2)):Y("",!0)],64)}}}),Oc=as(Cl,[["__scopeId","data-v-9f6a4dbb"]]);function _l(s){return s&&s.image}const bl=s=>(un("data-v-47c7e571"),s=s(),fn(),s),Il=["onClick"],Tl=["onClick"],El=["src"],Ml=["innerHTML"],Nl=["innerHTML"],Sl={key:0,class:"text-with-audio self"},Dl={class:"to-text-loading"},Ll=bl(()=>H("i",{class:"loading"},null,-1)),Al=[Ll],Ol={class:"to-text-fail"},Rl={class:"to-text-complete"},Hl={key:5},$l=["onClick"],Pl=["src"],Fl={key:0,class:"rich-message-item rich-message-text-item"},Bl=["innerHTML"],Wl={key:1,class:"rich-message-item rich-message-image-item"},Ul={style:{display:"none"}},Kl={key:2,style:{"user-select":"none"}},zl=["src"],Gl={style:{"user-select":"none"}},Gn=280,Rs=240,jl=qe({__name:"msg-render-self",props:{...xo,sendType:{type:String,default:"",validator:s=>["success","failed","sending"].includes(s)},memberList:{type:Array,default:()=>[]},attUploadProgress:{type:Number,default:0},isShowAddOne:{type:Boolean,default:!1},changeDownloadState:Object},emits:{...ko,"re-edit":s=>s},setup(s,{emit:t}){var ds,us,fs,gs,hs,ms,ps,d,u,w;const e=s,{t:r}=bs(),n=gn("receive"),l=is(),m=eo(),g=Z(!1),k=J(()=>e.source.ext.onlineFileTransferSuccess===!0),C=i=>{ls(e.source)?t("change",{val:i,source:pe.cloneDeep(e.source)}):g.value=!1},y=Z(null),L=()=>{var i,a;(i=y.value)!=null&&i.src.startsWith("headerimg://")?y.value.src=(a=y.value)==null?void 0:a.src.replace("headerimg://",""):y.value.src=mn},{isPlay:N,playAudio:B,audioUrl:F,voiceToText:G}=Eo(e,l,i=>{t("audio-event",i)}),{memberList:te,source:U}=or(e),le=J(()=>{var i;return((i=U.value.ext.groupMemberList)==null?void 0:i.length)||te.value.length}),V=J(()=>{var i;return((i=l.getSelfUserInfoDetail)==null?void 0:i.unitConfigInfos.length)===0}),We=J(()=>te.value.length>0&&Le()<le.value-1);function Le(){var i,a;return((a=(i=U.value.ext)==null?void 0:i.readList)==null?void 0:a.length)||Math.max(le.value-(U.value.unreadCount?U.value.unreadCount:0)-1,0)}const _e=J(()=>{let i=Le();return te.value.length>0?`${i}/${i>le.value-1?i:le.value-1}`:""}),me=J(()=>{var i,a;return e.isOnlyRead?!1:(l.loginId!=l.chatTargetId&&(!(e!=null&&e.sendType)||(e==null?void 0:e.sendType)=="success")&&e.source.chatType==Me.SINGLE||e.source.chatType==Me.GROUP&&((i=e.source.ext)==null?void 0:i.showRead)==1&&((a=l.getSelfUserInfoDetail)==null?void 0:a.unitConfigInfos.length)!==0)&&!e.isMultipleChoice}),re=async i=>{var R;const{x:a,y:c}=await window.RendererHelper.getMousePointInScreen(),{x:f,y:h,width:v,height:T}=await window.RendererHelper.getScreenWorkArea(),S=a-i.x,_=c-i.y,$=f+v,A=h+T,x=a+255>$?$-260-S+120:a-S+120,E=c+354>A?c-354-_+44-10:c-_+44+10;window.RendererHelper.openWindow("sview:/#/msgReadList",{width:255,height:354,resizable:!1,marginLeft:x,marginTop:E,subWindow:!0,frame:!1,id:"previewReadList"},{readList:JSON.parse(JSON.stringify(U.value.ext.readList||[])),oldMemberList:JSON.parse(JSON.stringify(((R=U.value.ext)==null?void 0:R.groupMemberList)||[])).filter(M=>M!=U.value.from),memberList:JSON.parse(JSON.stringify(te.value)).filter(M=>M.uid!=U.value.from)})},I=J(()=>{var i,a,c;return Number((i=e.audio)==null?void 0:i.length)>1?Math.floor(Number((a=e.audio)==null?void 0:a.length)):Math.ceil(Number((c=e.audio)==null?void 0:c.length))}),P=()=>{var i,a;return(a=(i=e.source)==null?void 0:i.ext)==null?void 0:a.expression_id},ce=i=>{let a=he.htmlEncodeByRegExp(i);return a=he.hyperLink(a).replace(/\n/g,"<br/>"),Ws.forEach(c=>{if(a.indexOf(c.msg)!==-1){const f=`${Us}${c.fileName}.png`,h=new URL(f,import.meta.url).href;a=a.replaceAll(c.msg,`<img src="${h}" alt="cxemoji-${c.msg}" width="20" height="20" style="vertical-align: bottom;"/>`)}}),a},de=J(()=>{let i=he.htmlEncodeByRegExp(e.contents);return i=he.hyperLink(i).replace(/\n/g,"<br/>"),P()?go.forEach(a=>{var c,f;if(((f=(c=e.source)==null?void 0:c.ext)==null?void 0:f.expression_id)==a.expression_id){const h=`${ho}${a.fileName}.gif`;i=`<img src="${new URL(h,import.meta.url).href}" alt="cxemoji-${a.msg}" width="70" height="70" style="vertical-align: bottom;user-select: none;-webkit-user-drag: none;"/>`}}):Ws.forEach(a=>{if(i.indexOf(a.msg)!==-1){const c=`${Us}${a.fileName}.png`,f=new URL(c,import.meta.url).href;i=i.replaceAll(a.msg,`<img src="${f}" alt="cxemoji-${a.msg}" width="20" height="20" style="vertical-align: bottom;"/>`)}}),i});let ae=Z("cxmsgimg://"+((ds=e.imgs)==null?void 0:ds.thumb)),ge=Z("cxmsgimg://"+((us=e.imgs)==null?void 0:us.url)),Ie=Z(!1),W=Z(!0);const Te=()=>{var i,a,c,f,h,v,T,S,_,$,A;ae.value==((i=e.imgs)==null?void 0:i.thumb)?(c=(a=e.imgs)==null?void 0:a.url)!=null&&c.startsWith("http")||(h=(f=e.imgs)==null?void 0:f.url)!=null&&h.startsWith("file")?ae.value=(v=e.imgs)==null?void 0:v.url:ae.value=`file://${(T=e.imgs)==null?void 0:T.url}`:ae.value==((S=e.imgs)==null?void 0:S.url)||ae.value===`file://${(_=e.imgs)==null?void 0:_.url}`?(console.log("[message][msg-render-self.vue][imgError]",($=e.imgs)==null?void 0:$.url),Ie.value=!0,W.value=!1):ae.value=(A=e.imgs)==null?void 0:A.thumb},O=()=>{W.value=!1},X=(i,a,c,f)=>{var T,S;if(!i)return;if(console.log("[previewImg] imgUrl:",i),Ie.value){Pe({content:r("message.msgImgOutOfDate"),duration:2e3});return}if(W.value){Pe({content:r("message.imgLoading"),duration:2e3});return}const h={};let v=!1;if(c){const _=c.target;if(i.startsWith("cxmsgimg://")){v=!0;const $=new Image;$.src=i,$.onload=A=>{var E;const x=A.target;h.width=x==null?void 0:x.width,h.height=x==null?void 0:x.height,(E=e.callback)==null||E.call(e,i,a,h,f)},$.onerror=()=>{var A;(A=e.callback)==null||A.call(e,i,a,h,f)}}else if((T=_==null?void 0:_.src)!=null&&T.includes("rw"))try{const A=new URL(_.src).searchParams,x=A.get("rw"),E=A.get("rh");x&&(h.width=parseInt(x)),E&&(h.height=parseInt(E))}catch($){console.error($)}else h.width=_.naturalWidth,h.height=_.naturalHeight}console.log("[previewImg] imageSize.width:",h.width,"imageSize.height:",h.height),v||(S=e.callback)==null||S.call(e,i,a,h)},Oe=J(()=>{var i,a;return st((i=e.imgs)==null?void 0:i.height,(a=e.imgs)==null?void 0:a.width)}),$e=i=>{const a=i.image;let c=i.width,f=i.height;if(!c&&!f){const h=new URLSearchParams(new URL(a).search);c=h.get("rw")?Number(h.get("rw")):void 0,f=h.get("rh")?Number(h.get("rh")):void 0}if(c&&f)return st(f,c);console.error("未找到宽度和高度参数",a)},Ae=J(()=>e.source.chatType===Me.GROUP&&l.hasUnreadReminderPermission&&me.value&&We.value),st=(i,a)=>!i||i===0?{height:`${Rs}px`,...$t}:a<=Gn&&i<=Rs?{height:`${i}px`,width:`${a}px`,...$t}:a>i?{height:`${i/a*Gn}px`,...$t}:{width:`${a/i*Rs}px`,height:`${Rs}px`,...$t},et=i=>{if(i.target.src&&(i.target.src.indexOf("cximg://")>=0||i.target.src.indexOf("cxmsgimg://")>=0)){let a=i.target.src.replace("cximg://","");a=a.replace("cxmsgimg://",""),i.target.src=a}else i.target.src=to},Ge=Z(""),q=async()=>{var c,f,h,v,T,S,_,$,A,x,E,R,M,j,z,se,ne;if(!((f=(c=e.source)==null?void 0:c.ext)!=null&&f.replyInfo)){Ge.value="";return}const i=!((S=(T=(v=(h=e.source)==null?void 0:h.ext)==null?void 0:v.replyInfo)==null?void 0:T.body)!=null&&S.isText)&&((x=(A=($=(_=e.source)==null?void 0:_.ext)==null?void 0:$.replyInfo)==null?void 0:A.body)==null?void 0:x.content)=="[图片]";let a=(j=(M=(R=(E=e.source)==null?void 0:E.ext)==null?void 0:R.replyInfo)==null?void 0:M.body)==null?void 0:j.remotePath;if(i&&(!a||a.indexOf("http")==-1)){const ve=await window.MessageDbHelper.queryOneMessageById((ne=(se=(z=e.source)==null?void 0:z.ext)==null?void 0:se.replyInfo)==null?void 0:ne.messageId);if(ve.success&&ve.data.msgbody){const Ce=JSON.parse(ve.data.msgbody);a=Ce.url.indexOf("cxmsgimg")>=0?Ce.url:"cxmsgimg://"+Ce.url}}Ge.value=a?a.indexOf("cxmsgimg")>=0?a:"cxmsgimg://"+a:""},ue=J(()=>{var i,a,c,f,h,v,T,S,_,$,A,x,E,R,M,j,z,se,ne,ve,Ce,fe,ye,rt;return(a=(i=e.source)==null?void 0:i.ext)!=null&&a.replyInfo?{isImg:!((v=(h=(f=(c=e.source)==null?void 0:c.ext)==null?void 0:f.replyInfo)==null?void 0:h.body)!=null&&v.isText)&&(($=(_=(S=(T=e.source)==null?void 0:T.ext)==null?void 0:S.replyInfo)==null?void 0:_.body)==null?void 0:$.content)=="["+r("message.image")+"]",remotePath:(R=(E=(x=(A=e.source)==null?void 0:A.ext)==null?void 0:x.replyInfo)==null?void 0:E.body)==null?void 0:R.remotePath,name:(z=(j=(M=e.source)==null?void 0:M.ext)==null?void 0:j.replyInfo)==null?void 0:z.name,content:so(((se=e.source)==null?void 0:se.ext)??{}),timestamp:(Ce=(ve=(ne=e.source)==null?void 0:ne.ext)==null?void 0:ve.replyInfo)==null?void 0:Ce.timestamp,isGroup:(rt=(ye=(fe=e.source)==null?void 0:fe.ext)==null?void 0:ye.replyInfo)==null?void 0:rt.isGroup}:!1}),ie=()=>{var i,a;e.isMultipleChoice||t("reply-handler",(a=(i=e.source)==null?void 0:i.ext)==null?void 0:a.replyInfo)},be=ee({icon:"delete",name:r("message.delete"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.DELETE_EVENT});const{destroy:i}=gt(ws,{title:r("message.reminder"),content:r("message.deleteMessage"),cancelBtn:{text:r("message.cancel"),callback(){i()}},confirmBtn:{text:r("message.delete"),callback(){var a,c,f,h;e.source.sendType=="upload"&&((a=e.source.ext)!=null&&a.uploadId)&&window.MainWindowHelper.cancelUploadToCloudDisk((c=e.source.ext)==null?void 0:c.uploadId),l.delMessage((f=e.source)==null?void 0:f.id,(h=e.source)==null?void 0:h.to),i()}}})}}),xe=ee({icon:"reply",name:r("message.reply"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.REPLY_EVENT,data:on(e.source)})}}),Ee=ee({icon:"multiple-choice",name:r("message.multiplechoice"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.MULTIPLE_CHOICE}),ls(e.source)&&(g.value=!0,t("change",{val:!0,source:pe.cloneDeep(e.source)}))}}),Se=ee({icon:"revocation",name:r("message.withdraw"),menuHandler:()=>{var i,a,c,f,h,v,T,S;t("mouse-menu-handler",{event:oe.REVOCATION_EVENT}),(i=e.source)!=null&&i.id&&he.getDaysSince((a=e.source)==null?void 0:a.time)<=1||((c=e==null?void 0:e.source)==null?void 0:c.chatType)==Me.GROUP&&((f=e==null?void 0:e.groupSelf)!=null&&f.owner||(h=e==null?void 0:e.groupSelf)!=null&&h.admin)?(setTimeout(()=>{Is.value=!1},1e3*60*10),l.recallMessage({mid:(v=e.source)==null?void 0:v.id,to:(T=e.source)==null?void 0:T.to,chatType:(S=e.source)==null?void 0:S.chatType,isPcRecall:!0,updateStore:!0},e.source)):Pe({content:r("message.onlyWithdraw24Hours"),duration:2e3})}}),Ke=i=>{e.msgType===Fe.TEXT?nt(i):e.msgType===Fe.AUDIO&&Lt(i)},ct=i=>{i.preventDefault();const a=ee({icon:"download-folder",name:r("transferFile.openFolder"),menuHandler:async()=>{let c=e.source.ext.localPath;if(c){const f=await window.RendererHelper.openFileInManagerAndSelect(c);console.log("callResult:",f),(f==null?void 0:f.code)!==0&&Pe({content:r("transferFile.notFoundTip"),duration:2e3})}else console.error("[onlineFileCard openFolder] no onlineFilePath")}});t("mouse-menu",{menuList:[[a],[be]],event:i})},tt=J(()=>{const i=["failed","upload","sending"];return!(e.source.sendType&&i.includes(e.source.sendType))}),nt=i=>{i.preventDefault();let a;if(tt.value){const c=ee({icon:"copy",name:r("message.Copy"),menuHandler:()=>{var T,S;if(t("mouse-menu-handler",{event:oe.COPY_EVENT}),So(e.source))Do(e.source).then(()=>{Pe({content:r("message.copied"),duration:2e3})}).catch(_=>{console.error("copySpecialMessage error:",_)});else{let _=e.contents;const $=Array.isArray((S=(T=e==null?void 0:e.source)==null?void 0:T.ext)==null?void 0:S.textMixings),A=window.getSelection(),x=A==null?void 0:A.getRangeAt(0),E=x==null?void 0:x.cloneContents(),R=(E==null?void 0:E.childNodes.length)??0;if(R===0&&$){const z=e.source.ext.textMixings,se=zs(z),ne=Ks(z);window.RendererHelper.setClipboardByMainProcess(se,ne),Pe({content:r("message.copied"),duration:2e3});return}const M=E==null?void 0:E.querySelectorAll("img"),j=M?Array.from(M).filter(z=>!(z.alt&&z.alt.startsWith("cxemoji-"))).length>0:!1;if($&&j)if(R>0){const z=Io(E);window.RendererHelper.setClipboardByMainProcess(z,"")}else{const z=e.source.ext.textMixings,se=zs(z),ne=Ks(z);window.RendererHelper.setClipboardByMainProcess(se,ne)}else{let z=no();z&&(_=z),_=he.htmlDecodeByRegExp(_),_=_.replace(/<br>/g,`
`),console.log("复制下来的内容",_),window.RendererHelper.setClipboardByMainProcess(void 0,_)}Pe({content:r("message.copied"),duration:2e3})}}}),f=ee({icon:"forward",name:r("message.retransmission"),menuHandler:async()=>{oo(pe.cloneDeep(e.source),`[${r("message.retransmission")}]${e.source.sendName}的聊天记录`)}}),h=[xe],v=[be];!P()&&tt.value&&(h.unshift(c),h.push(f),v.push(Ee),v.push(Se)),Ae.value&&h.splice(1,0,wt()),a=[h,v]}else a=[[be]];t("mouse-menu",{menuList:a,event:i}),Re.value=!0,he.windowClickOnce(()=>Re.value=!1)};let Re=Z(!1);const Qt=i=>{i.preventDefault();let a;if(tt.value){const c=[ee({icon:"copy",name:r("message.Copy"),menuHandler:async()=>{var f,h;t("mouse-menu-handler",{event:oe.COPY_EVENT}),await window.RendererHelper.isFileExists((f=e.imgs)==null?void 0:f.url)?window.RendererHelper.setClipboardByMainProcess(null,null,{localPath:(h=e.imgs)==null?void 0:h.url}):i&&window.RendererHelper.copyImageAt(i==null?void 0:i.x,i==null?void 0:i.y),Pe({content:r("message.copied"),duration:2e3})}}),ee({icon:"cloud",name:r("message.savetoclouddrive"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_TO_CLOUD});const{destroy:f}=gt(Ht,{msgList:[pe.cloneDeep(e.source)],cancelBtn:{text:r("message.cancel"),callback(){f()}},confirmBtn:{text:r("message.done"),callback(){f()}}})}}),xe,ee({icon:"forward",name:r("message.retransmission"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.FORWARD_EVENT}),Bs(pe.cloneDeep(e.source),null)}})];if(Ae.value){const f=wt();c.splice(1,0,f)}a=[c,[ee({icon:"save",name:r("message.saveas"),menuHandler:async()=>{var f,h,v,T;t("mouse-menu-handler",{event:oe.SAVE_AS_EVENT}),await window.RendererHelper.isFileExists((f=e.imgs)==null?void 0:f.url)?window.MainWindowHelper.saveLocalFileAs((h=e.imgs)==null?void 0:h.url,`img_${new Date().getTime()}.png`):window.MainWindowHelper.saveFileAs(((v=e.imgs)==null?void 0:v.imUrl)||((T=e.imgs)==null?void 0:T.url),`img_${new Date().getTime()}.png`)}})],[be,Se,Ee]]}else a=[[be]];t("mouse-menu",{menuList:a,event:i}),Re.value=!0,he.windowClickOnce(()=>Re.value=!1)},es=i=>{i.preventDefault();const a=i.target;let c;a.tagName.toLowerCase()==="img"&&(c=a.getAttribute("src"),c!=null&&c.startsWith(Xt)?c=c.replace(Xt,Yt):c!=null&&c.startsWith(Jt)&&(c=c.replace(Jt,qt)));let f;if(tt.value){const h=[ee({icon:"copy",name:r("message.Copy"),menuHandler:async()=>{if(t("mouse-menu-handler",{event:oe.COPY_EVENT}),i){if(c!=null&&c.startsWith(Yt)||c!=null&&c.startsWith(qt)){const v=await he.convertImgToBase64(c);window.RendererHelper.setClipboardByMainProcess(null,null,{base64Url:v})}else window.RendererHelper.copyImageAt(i==null?void 0:i.x,i==null?void 0:i.y);Pe({content:r("message.copied"),duration:2e3})}}}),ee({icon:"cloud",name:r("message.savetoclouddrive"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_TO_CLOUD});const{destroy:v}=gt(Ht,{msgList:[pe.cloneDeep(e.source)],mixImgUrl:c,cancelBtn:{text:r("message.cancel"),callback(){v()}},confirmBtn:{text:r("message.done"),callback(){v()}}})}}),xe,ee({icon:"forward",name:r("message.retransmission"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.FORWARD_EVENT}),Bs(pe.cloneDeep(e.source),c)}})];if(Ae.value){const v=wt();h.splice(1,0,v)}f=[h,[ee({icon:"save",name:r("message.saveas"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.SAVE_AS_EVENT}),c&&window.MainWindowHelper.saveFileAs(c,`img_${new Date().getTime()}.png`)}})],[be,Se,Ee]]}else f=[[be]];t("mouse-menu",{menuList:f,event:i})};function wt(){const i=Zn(e.source.ext.groupMemberList??[]),a=(e.source.ext.readList??[]).map(c=>c.fromUid);return a.push(String(l.loginId)),Vo({groupId:e.source.to,groupMemberUids:i,readMessageUids:a,messageId:e.source.id,groupName:m.groupsInfos.name})}const Dt=Z(""),dt=Z(-1),Lt=i=>{i.preventDefault();const a=[ee({icon:"cloud",name:r("message.savetoclouddrive"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_TO_CLOUD});const{destroy:f}=gt(Ht,{msgList:[{...pe.cloneDeep(e.source),url:F}],cancelBtn:{text:r("message.cancel"),callback(){f()}},confirmBtn:{text:r("message.done"),callback(){f()}}})}}),ee({icon:"forward",name:r("message.retransmission"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.FORWARD_EVENT}),ro({...pe.cloneDeep(e.source),url:F==null?void 0:F.value})}})];Zs(e.source.sendType)&&a.splice(2,0,xe);const c=[a,[be,Se,Ee]];if(!Mo(e.source)){const f=ee({icon:"voice-to-text",name:r("message.voiceToText"),menuHandler:async()=>{dt.value==-1&&(dt.value=0,Dt.value="",G&&G(h=>{console.log("语音转文字res",h),h.success?(dt.value=2,Dt.value=h.data):dt.value=1,t("mouse-menu-handler",{event:oe.VOICE_TO_TEXT})}))}});c.push([f])}Ae.value&&c[0].unshift(wt()),t("mouse-menu",{menuList:c,event:i}),Re.value=!0,he.windowClickOnce(()=>Re.value=!1)},Xe=Gt({}),Tt=Gt({}),ut=Gt({});bt("attCustomize",Xe),bt("attOperation",Tt),bt("attProgress",ut);const ht=(i,a,c,f,h,v,T)=>{Xe.content=i,Xe.style=a,Xe.fn=c,Tt.content=f,Tt.fn=h,ut.showProgressBar=v,ut.progressBarWidth=T},xt=i=>{let a="",c="",f="";return i!=null&&i.att_video?(a=i.att_video.resid,c="att_video",f=i==null?void 0:i.att_video):i!=null&&i.att_clouddisk?(a=i.att_clouddisk.resid||i.att_clouddisk.objectId,c="att_clouddisk",f=i==null?void 0:i.att_clouddisk):i!=null&&i.att_cloudFolder&&(a=i.att_cloudFolder.resid,c="att_cloudFolder",f=i),{resid:a,attType:c,att:f}},ot=(i,a,c,f)=>{var S,_,$;const{resid:h,attType:v,att:T}=xt((_=(S=e.source)==null?void 0:S.ext)==null?void 0:_.attachment);switch(i){case 2:ht(r("header.Paused"),"","",v=="att_video"?`<svg class="svg-icon" aria-hidden="true" style="width:36px;height:36px">
          <use xlink:href="#icon-stop_download_video"></use>
        </svg>`:`<svg class="svg-icon" aria-hidden="true" style="width:10px;height:10px;margin-right:4px">
          <use xlink:href="#icon-stop_download"></use>
        </svg> ${r("message.start")}`,async()=>{let E=(await window.MainWindowHelper.loadDownloadList()).filter(R=>R.resId==h);E&&(window.MainWindowHelper.resumeDownload([E[0].id]),window.MainWindowHelper.checkDiskFileDownloadChanged(h,R=>{const{downloadSpeed:M,receivedBytes:j,totalSize:z,state:se}=R,ne=he.byteConvert(M),ve=`${Math.ceil(j/z*100)}%`;ot(se,ne,ve,!0)}))},!0,c);break;case 3:ht(`<span style="margin-right:6px">${r("message.Downloading")}</span>
          <span>${a||"0B"}/S</span>`,"","",v=="att_video"?`<svg class="svg-icon" aria-hidden="true" style="width:36px;height:36px">
          <use xlink:href="#icon-start_download_video"></use>
        </svg>`:`<svg class="svg-icon" aria-hidden="true" style="width:10px;height:10px;margin-right:4px">
          <use xlink:href="#icon-start_download"></use>
        </svg> ${r("message.pause")}`,async()=>{let E=(await window.MainWindowHelper.loadDownloadList()).filter(R=>R.resId==h);E&&window.MainWindowHelper.pauseDownload([E[0].id])},!0,c),f&&window.MainWindowHelper.checkDiskFileDownloadChanged(h,x=>{const{downloadSpeed:E,receivedBytes:R,totalSize:M,state:j}=x,z=he.byteConvert(E),se=`${Math.ceil(R/M*100)}%`;ot(j,z,se,!1)});break;case 4:if(ht(r("message.downloaded"),"","","","",!1,""),!f)for(let x of Ft)(($=e.source)==null?void 0:$.id)==(x==null?void 0:x.id)&&(x.isDownLoad=!0);break;case 6:let A;v=="att_clouddisk"&&(A={color:"#3A8BFF"}),ht(v=="att_video"?`${r("message.redownload")}`:`<svg class="svg-icon" aria-hidden="true" style="width:10px;height:10px;margin-right:4px">
        <use xlink:href="#icon-reload"></use>
        </svg> ${r("message.redownload")}`,A,v=="att_video"?"":async()=>{let E=(await window.MainWindowHelper.loadDownloadList()).filter(R=>R.resId==h);E&&(window.MainWindowHelper.resumeDownload([E[0].id]),f&&window.MainWindowHelper.checkDiskFileDownloadChanged(h,R=>{const{downloadSpeed:M,receivedBytes:j,totalSize:z,state:se}=R,ne=he.byteConvert(M),ve=`${Math.ceil(j/z*100)}%`;ot(se,ne,ve,!1)}))},v=="att_video"?`<svg class="svg-icon" aria-hidden="true" style="width:36px;height:36px">
          <use xlink:href="#icon-redownload_video"></use>
        </svg>`:"",v=="att_video"?async()=>{let E=(await window.MainWindowHelper.loadDownloadList()).filter(R=>R.resId==h);E&&(window.MainWindowHelper.resumeDownload([E[0].id]),f&&window.MainWindowHelper.checkDiskFileDownloadChanged(h,R=>{const{downloadSpeed:M,receivedBytes:j,totalSize:z,state:se}=R,ne=he.byteConvert(M),ve=`${Math.ceil(j/z*100)}%`;ot(se,ne,ve,!1)}))}:"",!1,"");break}},Pt=(gs=(fs=e.source)==null?void 0:fs.downLoadState)==null?void 0:gs.state,mt=he.byteConvert((ms=(hs=e.source)==null?void 0:hs.downLoadState)==null?void 0:ms.downloadSpeed),ts=`${Math.ceil(((d=(ps=e.source)==null?void 0:ps.downLoadState)==null?void 0:d.receivedBytes)/((w=(u=e.source)==null?void 0:u.downLoadState)==null?void 0:w.totalSize)*100)}%`;ot(Pt,mt,ts,!0);const Ft=l.messageList[l.chatTargetId];Ve(()=>e.changeDownloadState,(i,a)=>{var f,h,v,T;if(!((h=(f=e.source)==null?void 0:f.ext)!=null&&h.attachment)||!i)return;const c=new Set((v=i==null?void 0:i.resIds)==null?void 0:v.filter(S=>typeof S=="string"));for(let S of Ft){if(!S)continue;const{resid:_}=xt((T=S==null?void 0:S.ext)==null?void 0:T.attachment);_&&c.has(_)&&((i==null?void 0:i.type)=="delete"&&(S.isDownLoad=!1,Xe.content="",Tt.content="",ut.showProgressBar=!1),(i==null?void 0:i.type)=="start"&&window.MainWindowHelper.checkDiskFileDownloadChanged(_,$=>{const{downloadSpeed:A,receivedBytes:x,totalSize:E,state:R}=$,M=he.byteConvert(A),j=`${Math.ceil(x/E*100)}%`;ot(R,M,j,!1)}))}},{deep:!0,immediate:!0});const kt=(i,a,c=!1)=>{fo(i,a,f=>{const{downloadSpeed:h,receivedBytes:v,totalSize:T,state:S}=f,_=he.byteConvert(h),$=`${Math.ceil(v/T*100)}%`;ot(S,_,$,!1)},c)};let pt=!1,ft=0,K=0;const De=async i=>{i.button===0&&(pt=!0,ft=i.clientX,K=i.clientY)},He=async i=>{var f,h,v,T,S,_,$,A,x,E;let a=Math.abs(i.clientX-ft),c=Math.abs(i.clientY-K);if(pt&&(a-5>0||c-5>0)&&((f=e.source)!=null&&f.isDownLoad||(h=e.imgs)!=null&&h.url||(T=(v=e.source)==null?void 0:v.ext)!=null&&T.textMixings)&&!W.value&&!Ie.value){const R=i.target;pt=!1;const M=/^(http:\/\/|https:\/\/)/;let j;if(M.test((S=e.imgs)==null?void 0:S.url)?j=await window.RendererHelper.getMessageImageCachePath((_=e.imgs)==null?void 0:_.url):j=($=e.imgs)==null?void 0:$.url,R.tagName.toLowerCase()==="img"&&((x=(A=e.source)==null?void 0:A.ext)!=null&&x.textMixings)){const Ce=R.getAttribute("src");if(!Ce)return;j=await window.RendererHelper.getMessageImageCachePath(Ce)}const z=document.createElement("canvas");z.width=120,z.height=120;const se=z.toDataURL("image/png");let ne=(E=Ct.value)==null?void 0:E.props.attachment.resid,ve={dragImgUrl:se,resId:ne,filePath:j};window.MainWindowHelper.dragDownloadFile(ve),t("drop-start",!0)}},Ye=()=>{pt=!1},Je=async i=>{var f,h,v,T;let a=Math.abs(i.clientX-ft),c=Math.abs(i.clientY-K);if(pt&&(a-5>0||c-5>0)&&((f=e.source)!=null&&f.isDownLoad||(h=e.imgs)!=null&&h.url)){pt=!1;let S=(v=Ct.value)==null?void 0:v.props.attachment.resid,_=(T=Ct.value)==null?void 0:T.props.attachment.objectId,$=document.getElementById(`${e.source.id}`),A=$==null?void 0:$.querySelector("#attContextId"),x=A==null?void 0:A.querySelector("img");if(console.log("attContextDom",x==null?void 0:x.clientWidth,x==null?void 0:x.src),x==null)return;let E=document.createElement("canvas"),R=E.getContext("2d");const M=document.createElement("canvas"),j=M.getContext("2d");M.width=120,M.height=120;let z=new Image;z.crossOrigin="Anonymous",z.src=x==null?void 0:x.src,z.onload=function(){E.width=44,E.height=44,x.clientWidth<=120&&(R==null||R.drawImage(z,0,0,44,44));const se=(M.width-E.width)/2,ne=(M.height-E.height)/2;j==null||j.drawImage(E,se,ne);let Ce={dragImgUrl:M.toDataURL("image/png"),resId:S,objectId:_};window.MainWindowHelper.dragDownloadFile(Ce),t("drop-start",!0)}}},it=i=>{var x,E,R;i.preventDefault();let a=e.attachment;typeof a=="string"&&(a=JSON.parse(a));const c=[];Zs(e.source.sendType)&&c.push(xe);const f=ao(a);f&&c.push(ee({icon:"forward",name:r("message.retransmission"),menuHandler:async()=>{t("mouse-menu-handler",{event:oe.FORWARD_EVENT}),io(pe.cloneDeep(a))}}));const h=(x=lo[(a==null?void 0:a.attachmentType)||-1])==null?void 0:x.insertNote,v=ee({icon:"copy",name:r("message.Copy"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.COPY_EVENT}),co(a)}});h&&c.unshift(v);const T=[];if(((a==null?void 0:a.att_clouddisk)||(a==null?void 0:a.att_video)||(a==null?void 0:a.att_voice))&&(c.unshift(ee({icon:"cloud",name:r("message.savetoclouddrive"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_TO_CLOUD});const{destroy:M}=gt(Ht,{msgList:[pe.cloneDeep(e.source)],cancelBtn:{text:r("message.cancel"),callback(){M()}},confirmBtn:{text:r("message.done"),callback(){M()}}})}})),a!=null&&a.att_voice||((E=e.source)!=null&&E.isDownLoad?T.push(ee({icon:"download-folder",name:r("message.openFolder"),menuHandler:()=>{var M,j,z,se,ne,ve,Ce,fe,ye,rt,It,At,Ot,Rt,Wt;if(t("mouse-menu-handler",{event:oe.ENTER_DOWNLOAD_FOLDER}),(z=(j=(M=e.source)==null?void 0:M.ext)==null?void 0:j.attachment)!=null&&z.att_video||(ve=(ne=(se=e.source)==null?void 0:se.ext)==null?void 0:ne.attachment)!=null&&ve.att_clouddisk){const{resid:ss,objectId:Ns}=(ye=(fe=(Ce=e.source)==null?void 0:Ce.ext)==null?void 0:fe.attachment)!=null&&ye.att_video?(At=(It=(rt=e.source)==null?void 0:rt.ext)==null?void 0:It.attachment)==null?void 0:At.att_video:(Wt=(Rt=(Ot=e.source)==null?void 0:Ot.ext)==null?void 0:Rt.attachment)==null?void 0:Wt.att_clouddisk;window.MainWindowHelper.showItemInFolder("",ss,Ns)}}})):T.push(ee({icon:"download",name:r("message.download"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.DOWNLOAD_EVENT}),a!=null&&a.att_clouddisk?kt(a==null?void 0:a.att_clouddisk,"att_clouddisk"):a!=null&&a.att_video&&kt(a==null?void 0:a.att_video,"att_video")}})),T.push(ee({icon:"save",name:r("message.saveas"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_AS_EVENT}),a!=null&&a.att_clouddisk?kt(a==null?void 0:a.att_clouddisk,"att_clouddisk",!0):a!=null&&a.att_video&&kt(a==null?void 0:a.att_video,"att_video",!0)}})))),a!=null&&a.att_cloudFolder){const M=ee({icon:"save",name:r("message.saveas"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.SAVE_AS_EVENT}),kt(a,"att_cloudFolder",!0)}});(R=e.source)!=null&&R.isDownLoad?T.push(ee({icon:"download-folder",name:r("message.openFolder"),menuHandler:()=>{if(t("mouse-menu-handler",{event:oe.ENTER_DOWNLOAD_FOLDER}),a!=null&&a.att_cloudFolder){const{resid:j}=a==null?void 0:a.att_cloudFolder;window.MainWindowHelper.showItemInFolder("",j)}}}),M):T.push(ee({icon:"download",name:r("message.download"),menuHandler:()=>{t("mouse-menu-handler",{event:oe.DOWNLOAD_EVENT}),kt(a,"att_cloudFolder")}}),M)}const{resid:_}=xt(a);let $=f?[be,Se,Ee]:[be,Se],A=(a==null?void 0:a.att_clouddisk)||(a==null?void 0:a.att_cloudFolder)||(a==null?void 0:a.att_video)||(a==null?void 0:a.att_voice);Ae.value&&c.splice(1,0,wt()),t("mouse-menu",{menuList:A&&!_||(e==null?void 0:e.sendType)=="failed"?[[be,Ee]]:[c,T,$],event:i})},Bt=()=>{ls(e.source)&&(g.value=!g.value,t("change",{val:g.value,source:pe.cloneDeep(e.source)}))},ls=i=>{var f,h,v,T;const a=(f=i==null?void 0:i.ext)==null?void 0:f.attachment,c=(i==null?void 0:i.sendType)==="failed";return a!=null&&a.att_video&&(((h=a==null?void 0:a.att_video)==null?void 0:h.objectId2)===""||c)?(Pe({content:r("message.videoNotUpload"),duration:2e3}),!1):a!=null&&a.att_clouddisk&&(((v=a==null?void 0:a.att_clouddisk)==null?void 0:v.objectId)===""||c)||a!=null&&a.att_cloudFolder&&(((T=a==null?void 0:a.att_cloudFolder)==null?void 0:T.resid)===""||c)?(Pe({content:r("message.attNotUpload"),duration:2e3}),!1):!0};let Is=Z(!0),Ct=J(()=>{var i,a;return uo(e.attachment,(i=e.source)==null?void 0:i.id,(a=e.source)==null?void 0:a.isDownLoad)});const Ts=()=>{const{destroy:i}=gt(ws,{title:r("message.reminder"),content:r("message.resendthatmessage"),cancelBtn:{text:r("message.cancel"),callback(){i()}},confirmBtn:{text:r("message.Resend"),async callback(){var j,z,se,ne,ve,Ce,fe,ye,rt,It,At,Ot,Rt,Wt,ss,Ns,kn,Cn,_n,bn,In,Tn,En,Mn,Nn;i();const{chatType:a,ext:c,to:f,msg:h,type:v,id:T}=e.source;let S=pe.cloneDeep({to:f,chatType:a,ext:c,msg:h,from:String(l.loginId)});if(v===Fe.IMAGE){S.url=e.source.url,S.file=e.source.file;let ke=await he.convertImgToBase64(S.url),vt=await xr().getImgFileUrl(ke);pe.assign(S,{file:vt,url:vt.url})}const{textMixings:_}=S.ext;if(_){for(const ke of _)if(_l(ke)&&ke.notUploaded){const{data:vt}=await kr(ke.image);if(vt.previewUrl&&vt.preview&&(ke.image=vt.previewUrl,ke.preview=vt.preview,delete ke.notUploaded),ke.width&&ke.height&&!ke.image.includes("rw=")&&!ke.image.includes("rh=")){const Ss=ke.image.includes("?")?"&":"?";ke.image=`${ke.image}${Ss}rw=${ke.width}&rh=${ke.height}`,delete ke.width,delete ke.height}}}console.log("重发消息>>>>>>>>",S),l.delMessage(e.source.id,e.source.to);const{msg:$}=await l.saveMsg({msgType:v,msgOptions:S});l.sendShowTypeMessage({msg:$,isFailed:!1},!1,!0);let A=((z=(j=c==null?void 0:c.attachment)==null?void 0:j.att_clouddisk)==null?void 0:z.filePath)||((ne=(se=c==null?void 0:c.attachment)==null?void 0:se.att_video)==null?void 0:ne.filePath)||((Ce=(ve=c==null?void 0:c.attachment)==null?void 0:ve.att_cloudFolder)==null?void 0:Ce.filePath)||"",x="att_clouddisk",E=!1;(fe=c==null?void 0:c.attachment)!=null&&fe.att_video?x="att_video":(ye=c==null?void 0:c.attachment)!=null&&ye.att_cloudFolder&&(x="att_cloudFolder",E=!0);const R=l.getSelfUserInfoDetail;let M=l.messageList[l.chatTargetId][l.messageList[l.chatTargetId].length-1];if(((It=(rt=c==null?void 0:c.attachment)==null?void 0:rt.att_clouddisk)==null?void 0:It.objectId)===""||((Ot=(At=c==null?void 0:c.attachment)==null?void 0:At.att_cloudFolder)==null?void 0:Ot.resid)===""||((Wt=(Rt=c==null?void 0:c.attachment)==null?void 0:Rt.att_video)==null?void 0:Wt.objectId2)==="")try{let ke=await Mr(A,E,(Ds,Ro)=>{var Sn;const Ho=new CustomEvent("attachmentProgress",{detail:{progress:Ds}});(Sn=document.getElementById(M.id))==null||Sn.dispatchEvent(Ho),M.ext&&(M.ext.uploadId=Ro,l.updateMsgValue({conversationKey:M.to,messageId:M.id,message:{ext:M.ext}}))});if(console.log("重发后上传成功的cloud",ke),(ss=c==null?void 0:c.attachment)!=null&&ss.att_clouddisk||(Ns=c==null?void 0:c.attachment)!=null&&Ns.att_cloudFolder){const Ds=await qr({data:ke.data,file:A,type:x});c.attachment=Ds}else c.attachment.att_video.coverUrl=(kn=ke.data)==null?void 0:kn.thumbnail,c.attachment.att_video.createTime=new Date((Cn=ke.data)==null?void 0:Cn.uploadDate).getTime(),c.attachment.att_video.objectId=(_n=ke.data)==null?void 0:_n.objectId,c.attachment.att_video.objectId2=(bn=ke.data)==null?void 0:bn.objectId2,c.attachment.att_video.resid=(In=ke.data)==null?void 0:In.residstr,c.attachment.att_video.thumbnails_url=(Tn=ke.data)==null?void 0:Tn.thumbnail,c.attachment.att_video.type=(En=ke.data)==null?void 0:En.suffix,c.attachment.att_video.url=(Mn=ke.data)==null?void 0:Mn.preview,c.attachment.att_video.filePath=(Nn=ke.data)==null?void 0:Nn.file;M.sendType="sending",S=pe.cloneDeep({to:f,chatType:a,ext:c,msg:h,from:String(l.loginId)}),l.delMessage(M.id,M.to);const{msg:vt}=await l.saveMsg({msgType:v,msgOptions:S});let Ss=!1;(R==null?void 0:R.unitConfigInfos.length)===0&&(Ss=!0,Pe({content:r("message.noUnitTip"),duration:2e3}));try{await l.sendShowTypeMessage({msg:vt,isFailed:Ss},!1)}catch{console.error("Sending show type newMsg failed")}}catch{console.error("Sending show type resendMsg failed"),l.updateMsgValue({conversationKey:M.to,messageId:M.id,message:{sendType:"failed"}}),await l.updateConversationDataInDb(String(l.chatTargetId),{latestMessageSendType:"failed"}),await l.gatherConversation(String(l.chatTargetId))}else{l.delMessage(M.id,M.to);const{msg:ke}=await l.saveMsg({msgType:v,msgOptions:S});let vt=!1;(R==null?void 0:R.unitConfigInfos.length)===0&&(vt=!0,Pe({content:r("message.noUnitTip"),duration:2e3})),l.sendShowTypeMessage({msg:ke,isFailed:vt},!1)}}}})},Es=()=>{const{destroy:i}=gt(ws,{title:r("message.reminder"),content:"确认取消发送?",cancelBtn:{text:r("message.cancel"),callback(){i()}},confirmBtn:{text:r("message.confirm"),async callback(){i();const{ext:a}=e.source;a!=null&&a.uploadId&&window.MainWindowHelper.cancelUploadToCloudDisk(a==null?void 0:a.uploadId)}}})};async function cs(i){const a=i.target;if(a.tagName.toLowerCase()==="a"){i.preventDefault();const c=a.href,f=hn(e.source.from),h={messageId:e.source.id,chatId:f,chatName:l.selfUserInfo.name,bePuid:l.selfUserInfo.puid,originalUrl:c};if(e.source.chatType==="groupChat"){const v=await window.MessageDbHelper.queryGroupOwner(e.source.to);v&&(h.groupOwner=v.name,h.groupOwnerPuid=v.puid)}window.MainWindowHelper.openNewSubTab(c,null,{id:Ao().replaceAll("-",""),extStore:h})}}const Ms=async()=>{var _,$;console.log("props.source",e.source);const{chatType:i,ext:a,to:c,msg:f,type:h,id:v}=e.source;let T=pe.cloneDeep({to:c,chatType:i,ext:a,msg:f,from:String(l.loginId)});console.log("消息+1>>>>>>>>",T),(($=(_=T.ext)==null?void 0:_.readList)==null?void 0:$.length)>0&&(T.ext.readList=[]);const{msg:S}=await l.saveMsg({msgType:h,msgOptions:T});l.sendShowTypeMessage({msg:S},!1)};return rs(()=>{q()}),Ve(()=>e.isMultipleChoice,()=>{e.isMultipleChoice||(g.value=!1)}),Ve(()=>e.checkMsgIds,()=>{e.isOnlyRead&&(g.value=e.checkMsgIds.includes(e.source.id))},{deep:!0,immediate:!0}),(i,a)=>{var v,T,S,_,$,A,x,E,R,M,j,z,se,ne,ve,Ce,fe;const c=pn,f=js,h=po;return p(),b(at,null,[(v=e.source)!=null&&v.isRecall?Y("",!0):(p(),b("div",{key:0,class:D([o(n).b(),o(n).is("multipleChoice",i.isMultipleChoice),o(n).is("checked",i.isMultipleChoice&&g.value)])},[Be(we(c,{onChange:C,modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=ye=>g.value=ye),size:"large"},null,8,["modelValue"]),[[Ue,i.isMultipleChoice]]),Be(H("div",{onClick:Bt,class:D(o(n).e("checkboxCover"))},null,2),[[Ue,i.isMultipleChoice]]),H("div",{class:D([o(n).e("message")])},[o(me)?(p(),b("div",{key:0,class:D(o(n).e("read"))},[o(U).chatType==o(Me).SINGLE?(p(),b("span",{key:0,style:Qe({color:o(U).unreadCount?"#3A8BFF":"","user-select":"none"})},Q(o(U).unreadCount?o(r)("message.unreadbyrecipient"):o(r)("message.read")),5)):(p(),b("span",{key:1,class:D(o(n).m("group")),onClick:je(re,["stop"])},Q(`${o(r)("message.read")}:${o(_e)}`),11,Il))],2)):Y("",!0),o(U).chatType==o(Me).GROUP&&e.isShowAddOne&&!o(V)&&o(Zs)(e.sendType)?(p(),b("div",{key:1,class:D(o(n).e("addOne")),onClick:Ms},null,2)):Y("",!0),H("i",{class:D(o(n).e("sendType"))},[(e==null?void 0:e.sendType)=="sending"?(p(),b("i",{key:0,class:D(o(n).e("sending"))},null,2)):Y("",!0),(e==null?void 0:e.sendType)=="failed"?(p(),Ne(f,{key:1,onClick:Ts,"icon-class":"msg_failed",width:"20",height:"20"})):Y("",!0),(e==null?void 0:e.sendType)=="upload"?(p(),Ne(f,{key:2,onClick:Es,"icon-class":"msg_cancel_upload",width:"18",height:"18"})):Y("",!0)],2),!o(k)&&e.msgType!==o(Fe).IMAGE&&!((S=(T=e.source)==null?void 0:T.ext)!=null&&S.textMixings)&&!(e!=null&&e.attachment)||e!=null&&e.defaultContent?(p(),b("div",{key:2,onContextmenu:Ke,class:D([o(n).e("popover"),o(n).is("isGifEmoji",!!P()),o(n).is("cover",o(Re))])},[o(ue)?(p(),b("div",{key:0,onClick:je(ie,["stop"]),class:D([o(n).e("reply"),"reply-msg-container"])},[_t(Q((_=o(ue))==null?void 0:_.name)+" "+Q(o(Fs)(($=o(ue))==null?void 0:$.timestamp))+" ",1),o(ue).isImg?(p(),b("img",{key:0,onClick:a[1]||(a[1]=ye=>X(o(Ge)?o(Ge):"",!0,ye)),src:o(Ge),onError:a[2]||(a[2]=ye=>et(ye)),onLoad:O},null,40,El)):(p(),b("div",{key:1,class:D([o(n).e("replyText"),"reply-msg-text"]),innerHTML:(A=o(ue))==null?void 0:A.content},null,10,Ml)),e.source.chatType==o(Me).SINGLE&&o(ue).isGroup?Y("",!0):(p(),Ne(f,{key:2,class:"top_icon","icon-class":"toTop",width:"16px",height:"16px",color:"#FFF",onClick:je(ie,["stop"])},null,8,["onClick"]))],10,Tl)):Y("",!0),o(xn)(o(U))?(p(),Ne(Lo,{key:1,source:o(U)},null,8,["source"])):o(Vs)(e.source)?(p(),Ne(No,{key:2,source:e.source,"is-self-send":!0},null,8,["source"])):e.msgType===o(Fe).TEXT?(p(),b("span",{key:3,onClick:cs,class:D(o(n).e("text")),innerHTML:o(de)},null,10,Nl)):e.msgType===o(Fe).AUDIO?(p(),b("span",{key:4,class:D(o(n).e("audio-wrapper"))},[e.source.ext.voiceToText?(p(),b("div",Sl,Q(e.source.ext.voiceToText),1)):Y("",!0),H("span",{onClick:a[3]||(a[3]=(...ye)=>o(B)&&o(B)(...ye)),style:Qe({width:`${60+(o(I)-1)*2}px`}),class:D(o(n).e("audio"))},[H("i",{class:D({play:o(N)})},null,2),H("span",null,Q(o(I))+"″",1)],6),Be(H("div",{class:D(o(n).e("v-to-text"))},[_t(Q(Dt.value)+" ",1),Be(H("div",Dl,Al,512),[[Ue,dt.value==0]]),Be(H("div",Ol,[we(f,{"icon-class":"to_text_fail",style:{"margin-right":"4px"},width:"14px",height:"14px",color:"rgba(255, 255, 255, 0.7)"}),_t(" 未识别到有效文字 ")],512),[[Ue,dt.value===1]]),Be(H("div",Rl,[we(f,{"icon-class":"check_mark_round",style:{"margin-right":"4px"},width:"12px",height:"12px",color:"rgba(255, 255, 255, 0.7)"}),_t(" 转换完成 ")],512),[[Ue,dt.value===2]])],2),[[Ue,dt.value!==-1]])],2)):(p(),b("span",Hl,Q(o(r)(o(Qn).UNSUPPORTED.key)),1)),P()?Y("",!0):(p(),b("span",{key:6,class:D([o(n).e("arrow"),o(n).is("cover",o(Re))])},null,2))],34)):Y("",!0),e.msgType===o(Fe).TEXT&&((E=(x=o(U))==null?void 0:x.ext)!=null&&E.textMixings)?(p(),b("div",{key:3,class:D(["rich-message",[o(n).e("popover"),o(n).is("isGifEmoji",!!P()),o(n).is("cover",o(Re))]]),onContextmenu:nt},[o(ue)?(p(),b("div",{key:0,onClick:je(ie,["stop"]),class:D([o(n).e("reply"),"reply-msg-container"])},[_t(Q((R=o(ue))==null?void 0:R.name)+" "+Q(o(Fs)((M=o(ue))==null?void 0:M.timestamp))+" ",1),o(ue).isImg?(p(),b("img",{key:0,onClick:a[4]||(a[4]=ye=>X(o(Ge)?o(Ge):"",!0,ye)),src:o(Ge),onError:a[5]||(a[5]=ye=>et(ye)),onLoad:O},null,40,Pl)):(p(),b("div",{key:1,class:D([o(n).e("replyText"),"reply-msg-text"])},Q((j=o(ue))==null?void 0:j.content),3)),e.source.chatType==o(Me).SINGLE&&o(ue).isGroup?Y("",!0):(p(),Ne(f,{key:2,class:"top_icon","icon-class":"toTop",width:"16px",height:"16px",color:"#FFF",onClick:je(ie,["stop"])},null,8,["onClick"]))],10,$l)):Y("",!0),(p(!0),b(at,null,Nt((se=(z=o(U))==null?void 0:z.ext)==null?void 0:se.textMixings,(ye,rt)=>(p(),b("span",{class:D(["rich-message-items",o(n).e("text_img")]),key:rt},[ye.type=="text"?(p(),b("div",Fl,[H("span",{onClick:cs,innerHTML:ce(ye.content),class:D(o(n).e("text"))},null,10,Bl)])):ye.type=="image"?(p(),b("div",Wl,[we(h,{src:o(bo)(ye.image),style:Qe($e(ye)),fit:"contain",onClick:It=>X(`cxmsgimg://${ye.image}`,!1,It,ye.preview),onContextmenu:je(es,["stop"]),onMousedown:De,onMousemove:He,onMouseup:Ye,onLoad:O},null,8,["src","style","onClick","onContextmenu"])])):Y("",!0)],2))),128))],34)):Y("",!0),o(k)?(p(),Ne(To,{key:4,source:e.source,onContextmenu:ct},null,8,["source"])):Y("",!0),H("span",{onContextmenu:it,onMousedown:De,onMousemove:Je,onMouseup:Ye,style:{display:"block"},id:"attContextId"},[(p(),Ne(_s((ne=o(Ct))==null?void 0:ne.component),$s(Ps((ve=o(Ct))==null?void 0:ve.props)),null,16))],32),e.msgType===o(Fe).IMAGE?(p(),b("div",{key:5,class:D([o(n).e("imgWrapper"),o(n).is("cover",o(Re))]),id:"imgContextId",onClick:a[6]||(a[6]=ye=>X(o(ge),!1,ye)),onContextmenu:Qt,onMousedown:De,onMousemove:He,onMouseup:Ye},[H("div",Ul,Q(o(ae)),1),Be(we(h,{src:o(ae),style:Qe(o(Oe)),fit:"contain",onError:Te,onLoad:O},null,8,["src","style"]),[[Ue,!o(W)&&!o(Ie)]]),Be(H("div",{class:D(o(n).e("imgState")),style:Qe({...o(Oe),"min-width":"68px","min-height":"68px","flex-direction":!o(W)&&o(Ie)?"column":"initial"})},[o(W)?(p(),b("i",{key:0,class:D(o(n).e("sending"))},null,2)):Y("",!0),!o(W)&&o(Ie)?(p(),Ne(f,{key:1,"icon-class":"error_img",width:"20",height:"20",style:{"margin-bottom":"4px"}})):Y("",!0),!o(W)&&o(Ie)?(p(),b("span",Kl,Q(o(r)("message.msgImgOutOfDate")),1)):Y("",!0)],6),[[Ue,o(W)||o(Ie)]])],34)):Y("",!0)],2),H("div",{class:D([o(n).e("avatar")])},[H("img",{ref_key:"avatarImg",ref:y,src:e.avatar,onError:L,referrerPolicy:"no-referrer"},null,40,zl)],2)],2)),(Ce=e.source)!=null&&Ce.isRecall?(p(),b("div",{key:1,class:D(o(n).e("revocation"))},[H("span",Gl,Q(o(r)("message.withdrewMessage")),1),e.source.recallTimestamp&&o(he).getMinutesSince(e.source.recallTimestamp)<=10&&e.msgType===o(Fe).TEXT&&((fe=e.source)!=null&&fe.isPcRecall)&&!(e!=null&&e.attachment)&&o(Is)?(p(),b("span",{key:0,class:D(o(n).e("reedit")),onClick:a[7]||(a[7]=ye=>t("re-edit",e.source))},Q(o(r)("message.reedit")),3)):Y("",!0)],2)):Y("",!0)],64)}}}),Rc=as(jl,[["__scopeId","data-v-47c7e571"]]);export{po as E,oe as M,To as O,xo as P,Ht as _,ko as a,zs as b,Ac as c,Ks as d,Io as e,Rc as f,bo as g,Oc as h,$t as i};
