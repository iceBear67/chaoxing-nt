import{D as Fe}from"./index-d3d722e6.js";import"./base-82955267.js";/* empty css                     */import{E as Ft}from"./el-input-983a785f.js";import{r as c,o as $e,x as La,a as be,u as Be,c as Ee,l as n,b as u,e as p,j as k,h as t,y as ye,p as E,i as ee,J as we,f as y,m as B,F as se,k as Ze,_ as We,q as Ce,g as ue,t as Wt,s as mt,n as lt,I as ve,D as Jt,z as Vt,A as Kt,C as Yt,w as vt,$ as Ea,S as Oa,a0 as Ga,T as Ha,v as Rt,M as Lt}from"./index-26603ea5.js";import{_ as Qt}from"./loading-6f16a8c7.js";import{B as et}from"./index-94663b0f.js";import{d as Na}from"./avatar-d72faaaf.js";import{M as it,G as qt}from"./message-4d42f580.js";import{u as ze}from"./index-46519fef.js";import{E as Pa,P as Fa}from"./index-b0e9d890.js";import{T as _e,c as Et}from"./index-b0b4f58c.js";import{_ as V}from"./lodash-4dfbea43.js";import{o as jt}from"./index-fb2938e5.js";import{E as ft}from"./index-853a0f6e.js";import{I as Wa,a as Ja,_ as Va}from"./class-fce5a8f7.js";import{G as Le,O as Pe,C as nt}from"./message-fe5b63d1.js";import{i as Ka}from"./group-chat-b264d087.js";import{a as Ya}from"./avatar_group-d33fd388.js";import{M as Ot}from"./index-ab028c07.js";import{_ as Gt}from"./index.vue_vue_type_style_index_0_lang-dc190aa5.js";import{F as Qa}from"./forward-bb18e89e.js";import{c as qa}from"./createAttachment-a64a5f42.js";import{u as ja}from"./usePersonalCard-1d04f272.js";/* empty css                   */import"./index-7e6c4fb9.js";import"./vnode-45baa450.js";import"./index-12f9ba11.js";import"./aria-60e0cdc6.js";import"./index-952b158c.js";import"./icon-803f5cc0.js";import"./index-e5f0a9f0.js";import"./_baseGet-ad9634b7.js";import"./event-9519ab40.js";import"./index-15f48857.js";import"./index-57013d5d.js";import"./index-08289d2b.js";import"./use-global-config-c67545e0.js";import"./index-f81182f6.js";/* empty css                                                              */import"./index-9c66cebd.js";import"./typescript-defaf979.js";import"./use-form-common-props-325f2441.js";import"./constants-84857360.js";import"./_commonjsHelpers-de833af9.js";import"./validate-f7672251.js";import"./el-popper-548470bb.js";import"./woman-a84999f1.js";import"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";/* empty css                                                              *//* empty css                                                              */const Xa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAOdSURBVHgB7Zo/TBNRAMa/O/njHwQXCSTWMLQTDAUWJUEok+BgTQxsDrgaUKMDYaAMSKILxs0E4oossggbKAYnoIMuQiKKCQYXEIjUgfN9fX30Wkp7VzC5Xu6XXNp3f9/3vve+99qchjSuPjVadANhQ0dYFGvgTKIwxKYjMv9I+2Y+oKkvrRHjQuwcBsSO+yggjH2MlP7B4GxE22Q5Lohi/p7FjCgFUZhES3YRoiidJTpTwGJIMHZGaBBoV4aNGr0IX+ECDAOtun5KKnMDuoawXuBdLQXhUJhjyDWChDk1OlyGJ8jpeIKcjifI6XiCnI7rBBVZOamsFDhfirzYjgE7sez3Wf+d/B6oBDobgLefgKUfsI0lQZ2NwN0m5MXoPDA2L7/3tgEdtYfPuf0yKYqiO+qAxTVR+F+CFOMLydbORVU5cKMu87HRhECKKzstXTy4rgLHwpagiYXU7mGm/7qsXN8bWa73HS1ozCRobiVzI/084jm5OLFQqL8s+v9FG+cLwdUVcqyYqS7HsbDlEOkNAf7Kw/tZEXadF12yxV8vZL9Pe610e2ktdX9ZnuGjyMshLW1r8Mn9TDCWd/ayX6/Gl+p6ZpRD9T7khW2Hns+klrub5EBmy1LIvfHcFQokHK7K0L2qK3Jfn41jjSGKYZyzpa2mH2EQMDE5HZhFsVGUWLoeqIRt8hLEB/eEpBhGcPrAtsJB0pmSULnyfkV+NvthG9uC+NBXd4CuxtRJ0y50dGVDuqRQAnhPhgWP2Q0J24LoCucbjqV8xSi295JLIRUUX34ByxuysXis2+YKxXYoDE3Lz/UtOe8M35JhwHRaXLN2D1byml+OETVR97TJz4lE3NMhbuwJU5+lSCvYdohCuJFl0ZpL3+XDOI6eTFu7B8+ny6wwVxYU2OKXZfN4VEuk4ZvWu54th5oDqesusmhaQAZ9ciPZZnym3Fxi4HP5w25Mp4bSGoQCmYZ0qb89uazKhi1BXCWcJOyyrCgbiZVVzpvhOGWEs4tyjsp0jhlLgphI8RacEovGLViCyyP+XDDPT+o+CnZZhgvdOqqivKZvUqTrpdxiiNb0TPzF7SK8/xScjifI6XiCnI4nyOm4UtAq3ENUF//SWFjDFgiaELR/ykWCgIj+8aH2Trg0ggKHGvjuXDwUioswCL5UV7hEi3fjGmTKzT7QNkuKECpEp1hn9a5copxK/HWzYgxoBoKGc98DWmWYiW3yw2Nt1nzgH5kBGDC2JfdeAAAAAElFTkSuQmCC",Ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAOlSURBVHgB7Zo/TNRQHMd/LX9VQBcRhjMMd5MMJy56CQJOgssNBDYHSJwI/gkOJiYciYZEFzRMGo0rhAEWcAMFcdK7ASZMRDQBdUGEKA7U3/feNe3V3vX1Iknb9JM0d++99nfv+35/+nqpQhYuPNDaVI2SmkpJbjaRN8mQxodKqeUh5ZN5QNG/tKe0E/vHaJg7bpCP0A5orOoXjSyklG20s4Ig5s9RmudWnPxJpnKPOiBKRQue8bEYEN8/whoY5fyo1qSW00cKAJpG7apaJpQFAVWhpOrzUMuDPZREDgVGEDunSaWAEQryOqEgrxMK8jqhIK8TCqqpIupLEHWd+Xesk/tG+Tk3Wu9spzUq7MCe2fZgh7BTKuVUAhd5Mg3Hida+8/HN6O/HBKuJ9vadbVzniTeyjcl3Rt8uX9fVzJ+/ieZWqSRcewg/emdGfMZMnsCq6hPc/FHcBryDc2dXhR0zsytirLGOSkJJPORNtwSdvHJ3L5Mr7s3Zr/SLq2IxBiaJxntICixS91Pn81yH3LNlNr5jtBE64NG80Rc7SdR7zv56eBJi4J21r8IjMvyUCGPgWlD6szh0kDf8lxLNmSa2FbEX1FCXO5/EiiPc7r80CsOuzaTPRkSe7h6WoPFe+/43Q+TI4CWRH1amrhEtrglxZuBp/N4E5+XjeZLCtSCEijnpe3KeMFcreOJKc/51KARtUbHaMUtZ32J7rTH+YhHUkBOf/kLSuBe0kh9yKLMIuefLRh/CxCpID1XkoNXL77m/t15UNnN+wg7YcqiaZlwLwo3THM96eUXYFCNb7qftb7oQipyLs4BNU1VsiQiB5nudE9KCsEp2FakmlpvURn5/Gtfs5PcVqlS6xyFAL/MoFAjN1x/IFdKCrNVNZ+o0ZUPOmtBugPfgiegpo08Pt8XDEFQsnGRCrvsJOYLFwv4QnoFAFBG93w1SgoolJSZQW+Uuce1AnqR5cWqrhSCEH4rFpku7UoIGJgqPwTPYTBY7pxDIEd0TAAKwk0DZx/0KYdiXMMYRfk4FoqTd9v8CFa8/UXgcXmqJGG1469AFIdSkdrc54E2sPMJqiXcH3RsurpXY/kjvtv1C+AjudUJBXicU5HVCQV4nkILWKThkVIVomoKCwoIOygIkiCilvr2lvGIvjZHPgQa8O5ctChXlNEJ4qc6/ZCr2shpElVu4qWxXllOHHz2FOevvyuXa+WRfN6ugYUWjuObd94DWUcz4mFm6rSyYB/4CHtEnF+n4rIIAAAAASUVORK5CYII=",Za="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQlSURBVHgB7Vo7TBRBGP53efk40QZyJGgojkqKAxvF8DgroPEKIp1GjFYG0WCC0YSjwqgFqJVGpBSkgAY7wRdW4hXYCIkYiiPQAELkLFjnu9lh9/ZuvTmBZG+zX7K5ee3sfP/jm7nNKmTBmQdag6pRWFMpzKoV5ExESWOXSpHpLuWnuUMRhcaIdix+mHpYQyflELRt6i/6Tb1TEWUV9QQhkPlziCZZLUi5iWjhJoVASkUNnslhMkAwfpBxYFBO92kVaj79IBdA06hRVfM4MzdAVSis5nioJYF5KIwccg0h5pwKlVwGj5DT4RFyOjxCTodHyOlwHaF8mUG+IqIjRen7Yuu8v7mKaH6Z6Osib68L8OvxJNFGnLeVFdvPIVB9nMjPxr35Rv8FKUIXThFdqU1tj60RtT7n5TY2hv0t3qljvO+AicxRotGr6efvHudGaTlJVMMIfV8hWlrndYE51jbyhTJCKuRgrevDRBO61VD+MG/0Y9GD03zRIF9Zwq5Sw1vAry3j/hds7MAkL79n8/gKie418XvQ1/GKeYnN1VLF26pPcG/LQIoQPIHFYVFAohw3+puZJQMlvIwFdJwz+kBQkJ5ZNO4XBplb5t4A7ozxel2lcT/azIbJBKmQ+9RlX0cYYUGIfcAcJijHylNDJVDKPZAO9ZU8hyb2M4cQBmKBeK0yMcseHOCLGplhITnLcwDoC3MvtT6zn68zRPsGKUKDOiGQgCKJfAEJYX0RgkIEzMplBfJnaY2T32tIEUKOiAQFiSdtvLyh5xTCTYSaX5fmu038F0lvFhDAnDd7DSlCimLsQ/AAXuZhz4FYAEKRzBB1eMpKCH1CYPYaUoSQM8Fy7hVI9kY8uR85hAt42sY9dvaR/Xxm4TAD+5a/mHYFKUJAja5iQ5eS2wfepnogE2AUhJzYaAWJ++f570wWMm2FFKH2Wi4CAPIGOQBrQiSQU/CKkGGhdqPXjPvF/pIOkHB4HoBUYwO1GyuDjIRgPRxj8DCECpJcqFx9mt073ZnPZ2kT5zWggc3RPcbVEjmJZ8yvGGMvs2dXl/9bNbMihHzBTg0SdrGPEBIQOWTdh9B2Q99/YCAh82YVbNfPi3heUA/xYhYJUKHXEuc4aULmBYMUFmd3+rYDwgjKiF+QwLxDF43wwrwiEuApQQg5GstC4qVFYQcKl22r0mWC1TBlpqNPR4if1sWmvRtkRQihAAtCxrEgbJ7WDRKL8ktaFPMt6f+nhllIvZw2nTi2Ug/BMlBqH7JX3C6C907B6fAIOR0eIafDI+R0uJLQArkHUZUdNMfILVAYoe08FxEiiqifbynvmJf6KccBDvh2LiEKBfnUS/ioLncRLdhMcOAqN3VTWS3Mp1AuegprFt/K6fVkJD43K6AeRaOg5tzvgBYgZuwa/3hbmTJ3/AUJI2GzZyZ3IQAAAABJRU5ErkJggg==",Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANOSURBVHgB7Zo7TBRBGMf/sxwPlYeVgUQSCqmg4NEoRuQ6D5srFDo12voOVpBwJBgSbVCpNKixg0oLPTrwBRXcFVhJIkohoQKB6FmwznffTdi7W7i5eFx2N/tLJrczO7M7//m++Wb2MgIZnHpgnjVMhE0DYZltgDOJw5TJQGS2T3y33hDqoitiHk0cwaAsuA0XYe5gtPw3hmYiYp3ySUEk5u9hTMtcC9xJvGwbQRJlUI4s42IxREvikNQgESdHzAYjgG/wAKaJLsMoYWVewBAIGy53tTSkhcI0hzwjSBqnwYDH8AU5HV+Q0/EFOR1fkNPxBd0MAk96s8sry4G6avuUSU878PIStyk0AZ1K1k5RJ9rqgcZjwNYfLttMAGcagYFz2W1/bgAXnmWXU/sR+ZF/Y4Lzn/uwL8NRIPoFOdES1B8CWuvTy2iEFQsrwLvUy8ZnpYhfQJUUfivI15lMzvPzOk/IgZDp45Jsvwhbamt4AHXREvR2kTu9F6uWTsdWOIWaOG8dVRJxtQN4PM2JrFRVwffuT9k/m9q09UIbLUHUKZo7NKJW9xnrZXd7Lq0Sak5vQ3WJmGUg1GiT235dk896ioKjHRTICnU1u65XW83XW4nsunSvs5GtSnOomGhZiDquOqZc6WI7/y78yJ5fKq8ziQtNTkFklTGLD59v5qQYCLHY8bn0NkSxrUPkFLQpQ/Pw1P51KHxXVuzmaU7RHOqXYfzKK3u3PChyziHqTFRGudWNvVPMJgI+mmZL9bSjqOgtrBlul8n1iewyFb5JEFmsWGgJUnxY4qQgt1Lh2Q5aVClA0E7DboE9CPISRGtH1LKiU0ftBKmtUutx/i2WGCIvQTrQovniMm99iIl5FJW8BHU3pa85djtpCiKTKRFqHv0P+e7I8xJEoblO5H5ZIYIALeDXTu++Y1XTbbUFxVI7auuuuLuZrUZWobUo11zRqaNYWuMlgfaK+VhadDyUf3F7CP8T3On4gpyOL8jp+IKcjicFLcM7xA2513wNryCkoJ0SDwkCIsbcXfFeWmkULoc00Nm5ZFAoDWAIdKjOvcRLt5MaOMrN3BHrZQEE3Wgp6rM6K5fKp5M8blaKQWGixXTuOaBlCmYyvfl0T8xYb/wDOvj/B1obrG8AAAAASUVORK5CYII=",Te={DELETE:1,UPDATE:2,EXIT:3,SORT:4};function za(){const H=c(!1),_=c(null),s=()=>{H.value=!0},i=()=>{H.value=!1};return $e(()=>{_.value&&(_.value.addEventListener("mouseenter",s),_.value.addEventListener("mouseleave",i))}),La(()=>{_.value&&(_.value.removeEventListener("mouseenter",s),_.value.removeEventListener("mouseleave",i))}),{elementRef:_,isHovered:H}}const $a={class:"base-info"},eo=["src"],to=["innerHTML"],ao={key:0,class:"self_tag"},oo={key:1,class:"self_tag"},so={key:2,class:"deptdesc"},no={key:0,class:"peopleNumber"},lo={key:1,class:"right"},io={key:0,class:"btnGroup"},ro=["onClick"],co=["onClick"],uo=["onClick"],po=["onClick"],mo={key:1,class:"peopleNumber"},vo={key:2,class:"btnGroup"},fo=be({__name:"ContactItem",props:{itemInfo:{type:Object,default:{},require:!0},currentDeptData:{type:Object,default:{},require:!1},isTeam:{type:Boolean,default:!1},isSort:{type:Boolean,default:!1},isCreator:{type:Boolean,default:!1},keyword:{type:String,default:""},updateAvatorTimeStamp:{type:Number,default:0},type:{type:Number,default:0}},emits:["item-click","item-change","update-time","click-avatar","removeTeamMember"],setup(H,{emit:_}){const s=H,{t:i}=Be(),G=et("contactitem"),{isHovered:Q,elementRef:M}=za(),A=it(),O=c(Ht);$e(()=>{var F;switch(s.type){case 0:O.value=Ht;break;case 1:O.value=Nt;break;case 2:O.value=((F=s.itemInfo)==null?void 0:F.level)==1?Xa:Nt;break;case 3:O.value=Za;break}});const X=Ee(()=>{var F;return(F=s.itemInfo)!=null&&F.puid?ze.getLocalUserAvatar({puid:s.itemInfo.puid,timeStamp:s.updateAvatorTimeStamp}):"cximg://"+s.itemInfo.pic}),W=Ee(()=>{var q,fe;const F=((q=A.getSelfUserInfoDetail)==null?void 0:q.uid)==((fe=s.currentDeptData)==null?void 0:fe.creatorid);return s.type===2&&s.isTeam===!1&&F}),T=async F=>{_("update-time"),_("click-avatar",F,A.getUserInfo.puid,s.itemInfo.puid);const q=setTimeout(()=>{_("update-time"),clearTimeout(q)},2e3)},P=F=>{if(F.target.src&&(F.target.src.indexOf("cximg://")>=0||F.target.src.indexOf("headerimg://")>=0)){let q=F.target.src.replace("cximg://","");q=q.replace("headerimg://",""),F.target.src=q}else F.target.src=Na},S=()=>{_("item-click",s.itemInfo)},Z=F=>F?ze.htmlEncodeByRegExp(F).replaceAll(s.keyword,`<span style='color: #3A8BFF'>${s.keyword}</span>`):"",f=()=>{_("item-change",{...s.itemInfo,_type:Te.SORT})},K=()=>{_("item-change",{...s.itemInfo,_type:Te.UPDATE})},Y=()=>{_("item-change",{...s.itemInfo,_type:Te.DELETE})},ne=()=>{_("item-change",{...s.itemInfo,_type:Te.EXIT})},he=Ee(()=>s.isTeam?s.itemInfo.usercount:s.itemInfo.peopleNumber),N=Ee(()=>s.isTeam?!s.isSort:!!he.value);return(F,q)=>{var de,ae,z,m,r,U,v;const fe=We;return n(),u("div",{class:k([t(G).b()]),style:Ze({height:(de=s==null?void 0:s.itemInfo)!=null&&de.pic?"56px":"48px",cursor:(ae=s==null?void 0:s.itemInfo)!=null&&ae.pic?"auto":"pointer"}),onClick:S,ref_key:"elementRef",ref:M},[p("div",$a,[s.itemInfo.pic?(n(),u("img",{key:0,class:k([t(G).e("img")]),src:t(X),alt:"",onClick:q[0]||(q[0]=ye(g=>T(g),["stop"])),onError:q[1]||(q[1]=g=>P(g))},null,42,eo)):E("",!0),s.isSort?(n(),ee(fe,{key:1,"icon-class":"sort_icon",class:"sort_icon",width:"20",height:"20"})):E("",!0),p("div",{class:k([t(G).e("desc"),{dept:s.itemInfo.ppath,team:s.isTeam}])},[H.keyword?(n(),u("span",{key:0,class:k([t(G).e("name")]),innerHTML:Z(s.itemInfo.name)},null,10,to)):(n(),u("span",{key:1,class:k([t(G).e("name")])},[we(y(s.itemInfo.name)+" ",1),s.isTeam&&((z=s.itemInfo)==null?void 0:z.creatorid)==((m=t(A).getSelfUserInfoDetail)==null?void 0:m.uid)?(n(),u("span",ao,y(t(i)("message.selfbuilt")),1)):E("",!0),s.isCreator?(n(),u("span",oo,y(t(i)("message.Creator")),1)):E("",!0)],2)),(r=s.itemInfo)!=null&&r.description?(n(),u("span",so,y((U=s.itemInfo)==null?void 0:U.description),1)):E("",!0)],2)]),!s.isTeam&&t(N)?(n(),u("span",no,[we(y(t(i)("department.peopleNumber",{value:t(he)}))+" ",1),B(fe,{"icon-class":"rightArrow",width:"12px",height:"12px",style:{"margin-left":"4px"}})])):E("",!0),s.isTeam?(n(),u("div",lo,[s.isSort?E("",!0):(n(),u("div",io,[p("div",{class:"btn",onClick:ye(f,["stop"])},y(t(i)("message.sort")),9,ro),t(A).getSelfUserInfoDetail.uid==((v=s.itemInfo)==null?void 0:v.creatorid)?(n(),u(se,{key:0},[p("div",{class:"btn",onClick:ye(K,["stop"])},y(t(i)("message.rename")),9,co),p("div",{class:"btn",onClick:ye(Y,["stop"])},y(t(i)("message.delete")),9,uo)],64)):(n(),u("div",{key:1,class:"btn",onClick:ye(ne,["stop"])},y(t(i)("message.exit")),9,po))])),t(N)?(n(),u("div",mo,[we(y(t(i)("department.peopleNumber",{value:t(he)}))+" ",1),B(fe,{"icon-class":"rightArrow",width:"12px",height:"12px",style:{"margin-left":"4px"}})])):E("",!0)])):E("",!0),t(W)?(n(),u("div",vo,[p("div",{class:"btn",onClick:q[2]||(q[2]=ye(g=>_("removeTeamMember",s.itemInfo),["stop"]))},y(t(i)("message.delete")),1)])):E("",!0)],6)}}});const Ie=Ce(fo,[["__scopeId","data-v-f05285be"]]),go=["onClick"],ho=be({__name:"BreadCrumb",props:{breadcrumbArray:{type:Array,default:()=>[]}},emits:["item-click"],setup(H,{emit:_}){const s=H,i=et("breadcrumb"),G=(Q,M)=>{M+1!=(s==null?void 0:s.breadcrumbArray.length)&&_("item-click",Q)};return(Q,M)=>{const A=We;return n(),u("div",{class:k([t(i).b()])},[(n(!0),u(se,null,ue(s.breadcrumbArray,(O,X)=>(n(),u("div",{class:k([t(i).e("breadcrumbItem")]),key:X},[p("span",{class:"name",onClick:W=>G(O,X)},y(O.name),9,go),X<s.breadcrumbArray.length-1?(n(),ee(A,{key:0,style:{margin:"0 2px"},"icon-class":"msg_arrow_r",width:"10px",height:"10px",color:"#ACB4BF"})):E("",!0)],2))),128))],2)}}});const Pt=Ce(ho,[["__scopeId","data-v-c418067b"]]),yo=["onClick"],_o=["src"],wo=be({__name:"member-list",props:{memberList:{type:Array,default:()=>[]},teamInfo:{type:Object,default:()=>{}},comkey:{type:String,default:""}},emits:["choose"],setup(H,{emit:_}){const s=H,i=et("member"),{memberList:G,comkey:Q,teamInfo:M}=Wt(s),A=Ee(()=>G.value),O=W=>{},X=W=>{var T;return((T=M.value)==null?void 0:T.creatorid)==W.uid?"创建人":""};return(W,T)=>(n(),u("div",{class:k([t(i).b()])},[(n(!0),u(se,null,ue(t(A),P=>{var S;return n(),u("div",{class:k([t(i).e("memberItem")]),key:P.uid,onClick:Z=>O()},[p("img",{class:k([t(i).e("img")]),src:P.pic,alt:""},null,10,_o),p("span",{class:k([t(i).e("name")])},y(P.name),3),((S=t(M))==null?void 0:S.creatorid)==P.uid?(n(),u("span",{key:0,class:k([t(i).e("role"),"admin"])},y(X(P)),3)):E("",!0)],10,yo)}),128))],2))}});const Ao=Ce(wo,[["__scopeId","data-v-7183a7ba"]]),bo=H=>(Vt("data-v-866d9580"),H=H(),Kt(),H),Co={class:"form"},ko={class:"group_content"},Io={class:"group_form"},Do={class:"group_form_edit_name group_form_item"},xo={class:"group_form_name"},Uo={class:"group_form_btn"},So={key:0,class:"team_name"},To={class:"group_form_invite group_form_item"},Bo={class:"group_form_name"},Mo={class:"group_form_btn"},Ro={key:0,class:"form_invite"},Lo={class:"code"},Eo={class:"code_num"},Oo={class:"desc"},Go={class:"code_img"},Ho=["src"],No={class:"group_form_addmember group_form_item"},Po={class:"group_form_name"},Fo={class:"group_form_btn"},Wo=bo(()=>p("div",{class:"drive"},null,-1)),Jo={class:"memberlist"},Vo={class:"title"},Ko=be({__name:"index",props:{addTeamVisible:{type:Boolean,default:!1}},emits:["close","change"],setup(H,{emit:_}){const{t:s}=Be(),i=it(),G=qt();mt(G);const{getSelfUserInfoDetail:Q}=mt(i);Jt();const M=c([]),A=c(""),O=c(""),X=c(""),W=c(),T=c(),P=c(!0),S=c(!1),Z=c({}),f=c({}),K=c(!1),Y=c(!1);$e(()=>{lt(()=>{const v=setTimeout(()=>{W.value.focus(),clearTimeout(v)})})});const ne=V.debounce(()=>{_e({content:s("message.nameCannotExceed"),zIndex:2024,duration:2e3})},200),he=()=>{A.value.trim().length>16&&(ne(),A.value=A.value.trim().slice(0,16))},N=()=>{K.value=!0,lt(()=>{var v;(v=T.value)==null||v.focus()})},F=()=>{if(K.value=!1,O.value.trim()==A.value.trim())return;let v={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/updateDept",getParams:{deptid:X.value,name:A.value},postParams:{},tokenSign:!0};window.MainWindowHelper.genRequest(v).then(async g=>{console.log("请求结果",g),g.result==1&&(_("change",{...f.value,name:A.value,fullname:A.value,hideUser:0},!0),await window.MainWindowHelper.deleteDeptDataByDeptid(X.value),await window.MainWindowHelper.insertDeptInContact([{...JSON.parse(JSON.stringify(f.value)),name:A.value,fullname:A.value,hideUser:0}]))})},q=v=>{v?ae():de()},fe=()=>{navigator.clipboard.writeText(Z.value.incode),_e({content:s("message.ichbCopied"),zIndex:2147483647,duration:2e3})},de=async()=>{let v={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/closeDeptIncode",getParams:{deptid:X.value},postParams:{},tokenSign:!0};const g=await window.MainWindowHelper.genRequest(v);console.log(g),g.result==1&&(Z.value={})},ae=async()=>{let v={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/createDeptIncode",getParams:{deptid:X.value},postParams:{},tokenSign:!0};const g=await window.MainWindowHelper.genRequest(v);g.result==1&&(Z.value=g.data)},z=()=>{if(!A.value.trim())return;Y.value=!0;let v={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/createDept",getParams:{name:A.value,needCode:1,pid:""},postParams:{},tokenSign:!0,allParamSign:!0};window.MainWindowHelper.genRequest(v).then(g=>{console.log(g),g.result==1?(S.value=!0,X.value=g.data.id,f.value=g.data,O.value=A.value,Z.value=g.data.deptConfig,M.value.push(Q.value),_("change",{...f.value,fullname:f.value.name,hideUser:0}),window.MainWindowHelper.insertDeptInContact([{...JSON.parse(JSON.stringify(f.value)),fullname:f.value.name,hideUser:0}])):g.errorMsg&&_e({content:g.errorMsg,zIndex:2147483647,duration:2e3})}).finally(()=>{Y.value=!1})},m=async()=>{const v=M.value.map(J=>({uid:Number(J.uid),name:J.name,puid:Number(J.puid)}));let g=[];try{g=(await jt({peopleList:v})).filter(J=>J.uid!=null)}catch(J){console.error(J)}if(!g||(g==null?void 0:g.length)<1)return;let I=g.filter(J=>!M.value.some(ce=>ce.uid==String(J.uid))),j=I.map(J=>({uid:String(J.uid),name:J.name,phone:""}));if(!j.length)return;let le={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/addUserDeptV2",getParams:{deptid:X.value},postParams:{users:JSON.stringify(j)},tokenSign:!0,allParamSign:!0};const $=await window.MainWindowHelper.genRequest(le);console.log($),$.result==1&&(M.value=M.value.concat(I))},r=()=>{_("close")},U=()=>{window.MainWindowHelper.updateTeamUnitData(),A.value="",_("close")};return(v,g)=>{const I=Ft,j=We,le=Pa,$=ft;return n(),u(se,null,[B(Fe,{visible:!0,options:{"close-on-click-modal":!1},width:"440","confirm-text":Y.value?t(s)("message.creating"):t(s)("message.done"),title:t(s)("message.newDepartment"),"close-text":t(s)("message.cancel"),"disabeld-confirm":Y.value,onClose:r,onConfirm:z},{default:ve(()=>[p("div",Co,[B(I,{ref_key:"teamNameRef",ref:W,modelValue:A.value,"onUpdate:modelValue":g[0]||(g[0]=J=>A.value=J),placeholder:t(s)("message.enterTeamName"),onInput:he},null,8,["modelValue","placeholder"])])]),_:1},8,["confirm-text","title","close-text","disabeld-confirm"]),S.value?(n(),ee(Fe,{key:0,visible:!0,options:{"close-on-click-modal":!1},width:"640","confirm-text":t(s)("message.done"),"close-text":t(s)("message.cancel"),title:t(s)("message.newDepartment"),onClose:U,onConfirm:U},{default:ve(()=>[B($,{class:"group_init"},{default:ve(()=>{var J,ce;return[p("div",ko,[p("div",Io,[p("div",Do,[p("div",xo,y(t(s)("message.teamName")),1),p("div",Uo,[K.value?(n(),ee(I,{key:1,ref_key:"editNameInput",ref:T,modelValue:A.value,"onUpdate:modelValue":g[1]||(g[1]=te=>A.value=te),placeholder:t(s)("message.enterTeamName"),onInput:he,onBlur:F},null,8,["modelValue","placeholder"])):(n(),u("div",So,[p("span",null,y(A.value),1),B(j,{class:"edit","icon-class":"edit",width:"16px",height:"16px",onClick:N})]))])]),p("div",To,[p("div",Bo,y(t(s)("message.invitationCode")),1),p("div",Mo,[B(le,{modelValue:P.value,"onUpdate:modelValue":g[2]||(g[2]=te=>P.value=te),class:"ml-2",size:"small",style:{"--el-switch-on-color":"#3A8BFF","--el-switch-off-color":"#D0D5DB"},onChange:q},null,8,["modelValue"])])]),Z.value&&((J=Z.value)!=null&&J.incode)?(n(),u("div",Ro,[p("div",Lo,[we(y(t(s)("message.invitationCode"))+": ",1),p("span",Eo,[we(y((ce=Z.value)==null?void 0:ce.incode)+" ",1),B(j,{"icon-class":"copy_code",width:"14px",height:"14px",onClick:fe,style:{cursor:"pointer"}})])]),p("div",Oo,y(t(s)("message.enterRightHome")),1),p("div",Go,[p("img",{src:Z.value.config.code2Url,alt:""},null,8,Ho)])])):E("",!0),p("div",No,[p("div",Po,y(t(s)("message.addMembers")),1),p("div",Fo,[p("div",{class:"add_btn",onClick:m},[B(j,{"icon-class":"group_add",width:"10px",height:"10px",color:"#3A8BFF"}),p("span",null,y(t(s)("message.add")),1)])])])]),Wo,p("div",Jo,[p("div",Vo,y(t(s)("message.members"))+"("+y(t(M).length)+")",1),B(Ao,{"member-list":t(M),"team-info":f.value},null,8,["member-list","team-info"])])])]}),_:1})]),_:1},8,["confirm-text","close-text","title"])):E("",!0)],64)}}});const Yo=Ce(Ko,[["__scopeId","data-v-866d9580"]]),Qo=["onClick"],qo={key:0,src:"",alt:""},jo={key:1,src:Ja,alt:""},Xo={key:2,src:Va,alt:""},Zo=["src"],zo=["innerHTML"],$o=20,es=40,ts=be({__name:"index",props:{keyword:{type:String,default:""}},setup(H){const _=H,s=it(),i=qt(),G=Jt(),{conversationListData:Q,getCurrentChatId:M,getUserInfo:A,autoReconnectNumMax:O}=mt(s),X={[Le.NORMAL]:(m,r)=>de(r,m),[Le.COURSE]:(m,r)=>ae(m,Pe.COURSE,r),[Le.GROUP]:(m,r)=>de(r,m),[Le.DEPT]:(m,r)=>de(r,m),[Le.CLASS]:(m,r)=>ae(m,Pe.CLASS,r),[Le.INTERACTION]:(m,r)=>de(r,m)},W=et("joingroup"),T=c(0),P=c([]),S=c(1),Z=c(),f=c([]),K=c([]);Yt(()=>_.keyword,async()=>{if(_.keyword.trim()){let m=[];for(let r=0;r<P.value.length;r++){const U=P.value[r];f.value.every(g=>g.id!=U.id)&&m.push(U)}for(let r of m){const U=await window.MessageDbHelper.queryGroupMembers(r.id);if(U.success){const v=await fe({groupDetail:r,allMembers:U.rows});r.groupName=v.groupName,r.groupImgs=v.groupImgs}}f.value=f.value.concat(m),f.value=V.uniqBy(f.value,"id"),K.value=f.value.filter(r=>r.groupName&&r.groupName.indexOf(_.keyword.trim())>=0)}else K.value=f.value},{immediate:!0});const Y=m=>m?ze.htmlEncodeByRegExp(m).replaceAll(_.keyword,`<span style='color: #3A8BFF'>${_.keyword}</span>`):"",ne=async m=>{let r=m.id;if(Q.value[r])s.setChatTargetId(String(r)),G.push({path:"/message/conversation",query:{id:String(r),chatType:nt.GROUP,t:new Date().getTime()}});else{const U=await s.getLastMessage(String(r)),v=U.success&&U.data&&U.data.msg||"";await s.gatherConversation(String(r),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:m.groupName,pic:m.groupImgs,chatType:nt.GROUP,msg:v}}),s.setChatTargetId(String(r)),G.push({path:"/message/conversation",query:{id:String(r),chatType:nt.GROUP,t:new Date().getTime()}})}},he=(m,r)=>{const U=[];for(let v=0;v<r.length;v++){const g=r[v];m.every(j=>j.id!=g.chatid)&&U.push(g)}return U},N=async()=>{var U,v,g,I,j,le;let m=1,r=0;for(;r<1;){const $=await z(m);if(console.log("获取所有我加入的群聊",$),($==null?void 0:$.result)==1){const J=(v=(U=$==null?void 0:$.data)==null?void 0:U.list)==null?void 0:v.filter(te=>{if(te.description){const Me=ze.isJSONString(te.description)?JSON.parse(te.description):{};return!(Me&&Me.groupType==Le.INTERACTION)}else return!0}),ce=he(P.value,J);if(console.debug("newGroup",J),!ce.length&&J.length>$o)break;console.debug("diffGroupArray",ce);for(let te of ce){const Me=await i.fetchGoupsMember(te.chatid)??[],tt=te.owner;let ge=Me.map(oe=>oe.member||oe.owner);const at=((await window.MessageDbHelper.queryGroupMembers(te.chatid)).rows||[]).filter(oe=>oe.status).map(oe=>oe.uid),Oe=ge.filter(oe=>!at.includes(String(oe)));let Ue=Oe.length?await window.RendererHelper.getUsersByTuids(Oe.join(",")):[],ot=((g=te==null?void 0:te.roles)==null?void 0:g.map(oe=>oe.admin).filter(Boolean))||[],Ge=[];Ue&&Ue.forEach(oe=>{Ge.push({groupid:te.chatid,name:oe.name,pic:oe.pic,puid:oe.puid,uid:oe.uid,mute:!1,muteRole:"",muteTimeStamp:-1,owner:oe.uid==tt,admin:ot.includes(String(oe.uid)),desc:"",deptDesc:oe.deptDesc,fullpinyin:oe.fullpinyin,simplepinyin:oe.simplepinyin,status:1,role:oe.role,createTime:new Date().getTime()})}),console.debug("addMembers",Ge),Ge.length&&await i.addGroupMemberPuid(Ge),P.value.push({...te,id:te.chatid}),await window.MessageDbHelper.insetGroupDetail({...te,id:te.chatid})}m==1&&(T.value=(I=$==null?void 0:$.data)==null?void 0:I.allCount,f.value.length<20&&q()),m++,((j=$.data)==null?void 0:j.pageCount)<=((le=$.data)==null?void 0:le.page)&&(r=1)}else break}},F=V.debounce(m=>{f.value.length!=P.value.length&&lt(()=>{const r=Z.value;r.wrapRef.scrollHeight-m.scrollTop-r.wrapRef.clientHeight<=r.wrapRef.scrollHeight*60/r.wrapRef.clientHeight&&q()})},50),q=async()=>{P.value=V.uniqBy(P.value,"id");let m=P.value.slice(f.value.length,S.value*20);m.length&&S.value++;for(let r of m){const U=await window.MessageDbHelper.queryGroupMembers(r.id);if(U.success){const v=await fe({groupDetail:r,allMembers:U.rows});r.groupName=v.groupName,r.groupImgs=v.groupImgs}}f.value=f.value.concat(m),f.value=V.uniqBy(f.value,"id"),K.value=f.value},fe=async m=>{let r={},U=[];r=(m==null?void 0:m.groupDetail)||{},U=V.orderBy((m==null?void 0:m.allMembers)||[],[I=>I.owner?-1:1,I=>I.admin?-1:1,I=>String(I.uid)]);let v=[],g="";if(!(r!=null&&r.description))v=U.slice(0,4).map(I=>I.pic),g=r.name?r.name:U.length<=1?"未命名":U.slice(0,4).map(I=>I.name).join("、");else{let I=ze.isJSONString(r.description)?JSON.parse(r.description):{},j={};Object.keys(X).includes(String(I.groupType))?(j=X[I.groupType](r,U),v=j.groupImgs,g=j.groupName):(j=de(U,r),v=j.groupImgs,g=j.groupName)}return{groupImgs:v,groupName:g}},de=(m,r)=>{const U=V.orderBy(m,[I=>I.owner?-1:1,I=>I.admin?-1:1,I=>String(I.uid)]);let v=[];Ka(r.description)?v=[Pe.GROUP]:v=U.slice(0,4).map(I=>I.pic);const g=r.name?r.name:U.length<=1?"未命名":U.slice(0,4).map(I=>I.name).join("、");return{groupImgs:v,groupName:g}},ae=(m,r,U)=>{const v=V.orderBy(U,[le=>le.owner?-1:1,le=>le.admin?-1:1,le=>String(le.uid)]),g=[r],I=JSON.parse(m.description);let j=m.name?m.name:I&&I.courseInfo&&I.courseInfo.coursename?I.courseInfo.coursename:v.slice(0,4).map(le=>le.name).join("、");return!m.name&&!(I&&I.courseInfo&&I.courseInfo.coursename)&&v.length<=1&&(j="未命名"),{groupImgs:g,groupName:j}},z=async m=>{let r={baseUrl:"https://learn.chaoxing.com",url:"/apis/im/getJoinedChatgroups",getParams:{puid:s.getSelfUserInfoDetail.puid,size:es,vs:1,page:m},postParams:{},tokenSign:!0};return await window.MainWindowHelper.genRequest(r)};return $e(async()=>{const m=await window.MessageDbHelper.queryGroup();m.success&&(P.value=V.orderBy(V.uniqBy(m.rows||[],"id")||[],[r=>r!=null&&r.created?-(r==null?void 0:r.created):1,r=>-Number(r.id)]),console.log(m,P.value.length),q(),N())}),(m,r)=>{const U=ft;return n(),u("div",{class:k([t(W).b()])},[B(U,{ref_key:"ScrollbarRef",ref:Z,style:{height:"100%"},onScroll:t(F)},{default:ve(()=>[(n(!0),u(se,null,ue(t(K),v=>(n(),u("div",{class:k([t(W).e("group_item")]),key:v.id,onClick:g=>ne(v)},[p("div",{class:k([t(W).e("img")])},[v.groupImgs?v.groupImgs[0]==t(Pe).CLASS?(n(),u("img",jo)):v.groupImgs[0]==t(Pe).COURSE?(n(),u("img",Xo)):v.groupImgs[0]==t(Pe).GROUP?(n(),u("img",{key:3,src:t(Ya),alt:""},null,8,Zo)):(n(),ee(Wa,{ref_for:!0,ref:"imgAvatorRef",key:v.id,"img-list":v.groupImgs},null,8,["img-list"])):(n(),u("img",qo))],2),_.keyword?(n(),u("span",{key:0,class:k([t(W).e("name")]),innerHTML:Y(v.groupName||"")},null,10,zo)):(n(),u("span",{key:1,class:k([t(W).e("name")])},y(v.groupName||v.name),3))],10,Qo))),128))]),_:1},8,["onScroll"])],2)}}});const as=Ce(ts,[["__scopeId","data-v-ce300790"]]),os={class:"passcode-input"},ss={class:"inputs"},ns=["onUpdate:modelValue","onInput","onKeydown","onPaste","tabindex"],ls=be({__name:"index",setup(H,{expose:_}){const s=c(!1),i=c([]),G=c([]),{t:Q}=Be(),M=Q("createGroup.passwordErrorTip"),A=Ee(()=>s.value?M:Q("createGroup.joinGroupAfterPasswordHint"));function O(){s.value&&(s.value=!1)}function X(f){console.log("handleInput"),O(),f<5&&G.value[f+1].focus()}function W(f,K){console.log("handleDelete"),O(),f>=0&&(i.value[f]="",f>=1&&G.value[f-1].focus()),K.preventDefault()}const T=(f,K)=>{var ne;const Y=(ne=K.clipboardData)==null?void 0:ne.getData("text/plain");if(Y){const he=Y.substring(f,6);i.value.splice(f,he.length,...he.split("")),O()}K.preventDefault()};async function P(){return new Promise((f,K)=>{const Y=S();return Y.length<6?(s.value=!0,K("password error")):(s.value=!1,f(Y))})}function S(){return i.value.join("")}function Z(f){s.value=f}return _({getValue:S,validate:P,setHasError:Z}),(f,K)=>(n(),u("div",os,[p("div",ss,[(n(),u(se,null,ue(6,Y=>vt(p("input",{ref_for:!0,ref_key:"inputRefs",ref:G,key:Y,type:"password",maxlength:"1","onUpdate:modelValue":ne=>i.value[Y-1]=ne,class:k([{error:s.value}]),onInput:ne=>X(Y-1),onKeydown:Oa(ne=>W(Y-1,ne),["delete"]),onPaste:ne=>T(Y-1,ne),tabindex:Y+1},null,42,ns),[[Ea,i.value[Y-1]]])),64))]),p("div",{class:k(["tip",{error:s.value}])},y(t(A)),3)]))}});const is=Ce(ls,[["__scopeId","data-v-d8d09f0f"]]),rs={class:"createGroupDialog"},cs={key:1,class:"content"},us=be({__name:"index",props:{open:{type:Boolean,default:!1}},emits:["close","cancel","confirm","clickTitleIcon","createGroupChatWithPassword","setHasError"],setup(H,{expose:_,emit:s}){const{t:i}=Be(),G=c(i("createGroup.prompt")),Q=c(i("createGroup.confirm")),M=i("createGroup.cancel"),A=c(!1),O=c(),X=()=>{s("close")},W=()=>{s("cancel")},T=async()=>{var Z;if(A.value===!0)try{const f=await((Z=O.value)==null?void 0:Z.validate());s("createGroupChatWithPassword",f),console.log("password",f)}catch(f){console.error(f,f)}else s("confirm")},P=()=>{G.value=i("createGroup.permissionPassword"),Q.value=i("createGroup.send"),A.value=!0};function S(Z){var f;(f=O.value)==null||f.setHasError(Z)}return _({setHasError:S}),(Z,f)=>{const K=We;return n(),u("div",rs,[B(Fe,{closeText:t(M),bottomBorder:!1,width:"440px",onClose:X,visible:H.open,title:G.value,onCancel:W,onConfirm:T,onClickTitleIcon:X,confirmText:Q.value},Ga({default:ve(()=>[p("div",{class:k(["dialog-content",{passcode:A.value}])},[A.value?(n(),ee(is,{key:0,ref_key:"passcodeInputRef",ref:O},null,512)):(n(),u("div",cs,y(t(i)("createGroup.largeGroupTip")),1))],2)]),_:2},[A.value?void 0:{name:"titleIcon",fn:ve(()=>[B(K,{"icon-class":"info",onClick:P,class:"title-icon",width:"16px",height:"16px"})]),key:"0"}]),1032,["closeText","visible","title","confirmText"])])}}});const ds=Ce(us,[["__scopeId","data-v-8e81d5cb"]]),ps={class:"content"},ms=be({__name:"index",props:{visible:{type:Boolean},options:null,title:null,width:null,confirmText:null,closeText:null,exBtn:null,bottomBorder:{type:Boolean},headerBorder:{type:Boolean},bottomVisible:{type:Boolean},topVisible:{type:Boolean},disabeldConfirm:{type:Boolean},style:null},emits:["close","cancel","confirm"],setup(H,{emit:_}){const s=H,{t:i}=Be(),{visible:G}=Wt(s);return(Q,M)=>(n(),ee(Fe,{onCancel:M[0]||(M[0]=A=>_("cancel")),onConfirm:M[1]||(M[1]=A=>_("confirm")),onClose:M[2]||(M[2]=A=>_("close")),width:440,visible:t(G),title:t(i)("team.removeMemberDialogTitle"),"confirm-text":t(i)("team.removeMemberDialogConfirm"),"close-text":t(i)("team.removeMemberDialogCancel")},{default:ve(()=>[p("div",ps,y(t(i)("team.removeMemberDialogContent")),1)]),_:1},8,["visible","title","confirm-text","close-text"]))}});const vs=Ce(ms,[["__scopeId","data-v-f78114d0"]]),fs={key:0,class:"form_invite"},gs={class:"code"},hs={class:"code_num"},ys={class:"desc"},_s={class:"code_img"},ws=["src"],As=be({__name:"invite-code",props:{inviteCodeInfo:{type:Object,default:()=>{}},groupName:{type:String,default:""}},emits:["close"],setup(H,{emit:_}){const s=H,{t:i}=Be(),G=()=>{navigator.clipboard.writeText(s.inviteCodeInfo.incode),_e({content:i("message.ichbCopied"),zIndex:2147483647,duration:2e3})},Q=()=>{const A=qa({data:{groupId:s.inviteCodeInfo.chatgroupId,groupName:s.groupName,inviteCode:s.inviteCodeInfo.inviteCode,listPic:s.inviteCodeInfo.groupAvatarList}});window.RendererHelper.openWindow("https://im.chaoxing.com/res/studyForward/index.html",{width:640,height:Qa,frame:!1,modal:!0,resizable:!1,subWindow:!0,id:"studyForward"},{attachment:V.cloneDeep(A)})},M=()=>{_("close")};return(A,O)=>{const X=We;return n(),ee(Fe,{visible:!0,options:{"close-on-click-modal":!1},width:"640","bottom-visible":!0,"close-text":"",title:s.groupName,onClose:M,onConfirm:Q},{default:ve(()=>{var W;return[s.inviteCodeInfo&&Object.keys(s.inviteCodeInfo).length?(n(),u("div",fs,[p("div",gs,[we(y(t(i)("message.invitationCode"))+": ",1),p("span",hs,[we(y((W=s.inviteCodeInfo)==null?void 0:W.incode)+" ",1),B(X,{"icon-class":"copy_code",width:"14px",height:"14px",onClick:G,style:{cursor:"pointer"}})])]),p("div",ys,y(t(i)("message.enterRightHome")),1),p("div",_s,[p("img",{src:s.inviteCodeInfo.config.code2Url,alt:""},null,8,ws)])])):E("",!0)]}),_:1},8,["title"])}}});const bs=Ce(As,[["__scopeId","data-v-f942b5e7"]]),Cs={class:"toast"},ks=be({__name:"index",props:{visible:{type:Boolean,default:!1}},setup(H){const{t:_}=Be();return(s,i)=>H.visible?(n(),ee(Ha,{key:0,to:"main.el-main"},[p("div",Cs,y(t(_)("message.updatingTipContent")),1)])):E("",!0)}});const Is=Ce(ks,[["__scopeId","data-v-bdd4b978"]]),Ds="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAVHSURBVHgB3ZhdbBRVFMf/d+7sbgsUWgRBrAj4DQJBsLQ2JLwZhJDwgD5oTDAYFQUCxGDiC74RMUWElJCAiCbGAIkmvJKQqP3CVAwSNGKi2EZBFGih7W535h7/Z7Zbuy2Wfu3G8M/u3p2Pnfubc84958wC/zMZjFBL35dpLoYHPId7jMEET8AXbpoQl1OCC81bzB8YgYYFVLVX5ouHSgiqPWAGATxewBMHbvItsBwtr2pEcJk7v005HBgO3JCAln0gU0OLzZxkoQI4vjmZdQJDIsv9niGMAvZCctv0fOd5J1IW+89sNL+PGqiiVlbytl/i3asVbBbIOHTRVb9ysss89qdk4CYR6GGe8xi3SxQ6C6agcKht2Gr2jQho8QEZF3fYRnc8rhdUGGTcct55+KxpgzmLQVRdI0ucxWr+do1kbsaoFZ3BSZvCW3XbzY0hAylMwuFt3tXsnjv3OZ6nRY7Vv2bOYRiqqpF7iXOEE5X3ibkfXBueb3rHtA8JqHK/bOKBJcjEhdr78/rXzXGMQpV7ZCOvs7nHdTrvabrvuf7neQN+WCuruXMRYWgbhLTK8dHCqBo3m720zN7oqjqvwVOV78n6/uflWKhin9zlW+zU1UMQwx+faNhgvsAYqrJGtnDYSt9pPJq0YOk320xL9niOhbiWV4mB4+jE4spYw6gat5rdnLQpCnSGhA/syWHIfqk6KJO5VUGgkCc7141dyJN4/ZoojdALdNGyyt1SPQBI0ljBo1yVhAHqTr9h/kae1LDN1DMFNGYzPHPaygFAxsccDWKugpBjI/Isa/GuDpJhWJUDNL9WykhcahSGBbLpVXMBedZXW0ydzmUymXx29U6Z2QtU5FgoJbKOZogWFEoG56SnOKdjWKC7fP2wRZF1nAYPx1YUSJyrJap1DG7rMKsXiBk0QduE0UIM0YVCSfAbMp2BLrfSiEU/QoKwzwnVSl6MaAWSC9Fieoo23aZwGQv5bCUYzVomhAcmokBq3G6OVO9iwnGw9dvNJ71AtNM1T6IVph8lKKDq3jSf9t2OXJYMcIn1y6mVWDamoFDawUBZK3YAUPMrpo3DNcs4Ipj/5IdyH/Itwjw4GbG5a2GXnxI/B0hl4/hR15iWjxgfKpBnzbof8Y4E7CROfaPk366jFyjoxgUWMieZWJpRtZ+dXr7ENT0thngQwKNrbPNiBAOAml42rczhF7WWaQpwPjvGPGnOMZSk0vBmTqWFWrV2GhkApApiOMkGzbH6Os9i+pKDsghjrAUfy3i6Kd49Hl6c1mloR6rv8RygphdMexjg61AyPVHMxxMVh2QhxkiPHJKSRBFK4nRVqQ+/+xqS2GFyEvEtm/ylh+UZkk7XzK0dJIP9TMM68z1GoeWHpbSDMIGmlgASTkDXd2vM9f7n3RJo7lGJT0ziabKXORe1tKGxaE914hRTRCeGofKjUjw1RFnMIpFmTvbZHhd1IfnlOvxl+sTOoEBZqEk3UcU6N8PT1ZcpLS4Q/BJL42LDenMVg0hjxY7HFC+FYp8hwIbMdXJMCLpW/IQrO/q56rZAWVV/JPOYB+YpEANdYytUq3E7Sbde57424yGdTnFfAlqaY5w8IVw7zMEBn7uFaS9g0mWbjivNz0ZJ+D81pD8b9G4nWjzKScvZ6kbW8pCB0+98dNAMH7JuB2EYPbEEalWaIOQicVy5N1w7LtHd6dvNNay/Y/QRu3gcHmJCK2Owxz0FIYCVKG9l4BSCML6hBUNcbRO0n33RdAx1jhH/YcVn9mK/HBO66R6bhE3TJR1JpO8uRbK1BV0/bzIp3An6B0nHP/gdzd/DAAAAAElFTkSuQmCC";function xs(H,_){const s={baseUrl:"https://contactsyd.chaoxing.com",url:"/apis/dept/deleteUserDept4Server",getParams:{deptid:H,userids:encodeURIComponent(JSON.stringify(_))},postParams:{},tokenSign:!0};return window.MainWindowHelper.genRequest(s)}const gt=H=>(Vt("data-v-4135b0ea"),H=H(),Kt(),H),Us=["src"],Ss={key:2,class:"first-loading"},Ts=gt(()=>p("img",{class:"rotate",src:Qt,alt:""},null,-1)),Bs={class:"title-text"},Ms={class:"title-text"},Rs={class:"title-text"},Ls={class:"contact_contain",id:"letterIndex"},Es={class:"title-text"},Os=["id"],Gs=["onClick"],Hs=gt(()=>p("div",{class:"tip"},null,-1)),Ns={class:"sort_tip"},Ps={key:3,class:"breadcrumb_scrollbar"},Fs={class:"user_contain"},Ws=["id"],Js={class:"letterAside"},Vs=["onClick"],Ks={key:0,class:"empty"},Ys={key:1,class:"loading"},Qs=gt(()=>p("img",{class:"rotate",src:Qt,alt:""},null,-1)),qs=["id"],js={key:4,class:"breadcrumb_scrollbar"},Xs={key:0,class:"empty"},Zs={class:"form"},zs=be({__name:"index",setup(H){const _=c(!1);let s=null;const{t:i}=Be(),G=it(),Q=c(!0),M=c(!1),A=c(!1),O=c(""),X=c(),W=c({}),T=et("contacts"),P=c(!1),S=c(""),Z=c(!1),f=c([]),K=c([]),Y=c(1),ne=c(!1),he=c([]),N=c([]),F=c([]),q=c({}),fe=c([]),de=c(!1),ae=c({}),z=c([{name:i("message.contacts"),level:0}]),m=c(""),r=c(" "),U=c(),v=c(),g=c(!0),I=c(),j=c(!1),le=c(!1),$=c(!1),J=c(null),ce=c(null),te=c({}),Me=c({}),tt=c(),ge=c(!1),Je=c(!1);let rt;const at=c(),Oe=c(!1),Ue=e=>{Oe.value=e},ot=e=>{Je.value=e},Ge=async()=>{try{await ut(void 0),Ue(!1)}catch(e){console.error(e)}},oe=async()=>{if(Mt(D.value)&&Ra(D.value)){await Bt();const e=await pt(D.value.id,D.value.fid);if(console.log("team people count: ",e),e>20)Ue(!0);else try{await ut(void 0)}catch(a){console.error(a)}}},Xt=async e=>{try{await ut(e),Ue(!1)}catch{at.value.setHasError(!0)}},Zt=async(e={})=>{Je.value=!0,rt=e},zt=async()=>{var a;console.log("confirmDelete");const{puid:e}=rt;try{const o=(a=D.value)==null?void 0:a.id,l=await xs(o,[e]);if(l.result==1)console.log("remove team member success",l.msg),await Bt(),pt(o,"-1").then();else throw new Error(l.errorMsg)}catch(o){console.error("remove team member failed",o),_e({content:i("team.removeMemberFailed"),zIndex:2147483647,duration:2e3})}finally{Je.value=!1}};c(0);const{top:ht,left:yt,visible:_t,myPuid:wt,puid:At,handleClose:bt}=ja({container:tt});function De(e,a,o){window.RendererHelper.off("UPDATE_USER_NAME_BY_CARD","updateMsgContact"),window.RendererHelper.on("UPDATE_USER_NAME_BY_CARD",async C=>{C.tuid&&C.name&&(await window.MessageDbHelper.updatePeopleNameInMsgContact(C.tuid,C.name),dt(!0))},"updateMsgContact");const{x:l,y:h}=e;wt.value=a,At.value=o,yt.value=l+30;const R=window.innerHeight-350;ht.value=h>R?R:h,_t.value=!0}const Ae=c(0),xe=()=>{Ae.value=new Date().getTime()},$t=e=>{console.log(e),g.value=!1,r.value=e;const a=document.getElementById(e);a&&a.scrollIntoView({behavior:"instant",block:"start"})},ea=e=>{const a=document.getElementById(e);a&&a.scrollIntoView({behavior:"instant",block:"start"}),m.value=e},ta=V.throttle(({scrollTop:e})=>{const a={};Object.keys(ae.value).forEach(l=>{var R;const h=(R=document.getElementById(l+"user"))==null?void 0:R.offsetTop;a[l]=h});let o="";Object.entries(a).forEach(([l,h])=>{if(e>=h){o=l;return}}),o===""||(m.value=o+"user")},300);let Ve=c();const Ct=({scrollTop:e})=>{var h,R;if(!g.value){g.value=!0;const C=(h=document.getElementById("letterIndex"))==null?void 0:h.offsetTop;C&&e>=C-118?Ve.value=!0:Ve.value=!1;return}const a=(R=document.getElementById("letterIndex"))==null?void 0:R.offsetTop;a&&e>=a-118?Ve.value=!0:Ve.value=!1;const o={};Object.keys(q.value).forEach(C=>{var d;const b=(d=document.getElementById(C))==null?void 0:d.offsetTop;o[C]=b});let l="";Object.entries(o).forEach(([C,b])=>{if(a!==void 0&&e-a>=b){l=C;return}}),l===""||(r.value=l)},kt=Ee(()=>{var e,a;return((e=D==null?void 0:D.value)==null?void 0:e.fid)=="-1"&&((a=D.value)==null?void 0:a.creatorid)==G.loginId&&de.value}),st=c(!1),ct=c(!1),It=c({}),aa=async()=>{var o;let e={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/createDeptIncode",getParams:{deptid:(o=D.value)==null?void 0:o.id},postParams:{},tokenSign:!0};const a=await window.MainWindowHelper.genRequest(e);a.result==1&&(It.value=a.data,ct.value=!0)},ut=async e=>{var l,h;if(st.value)return;st.value=!0;let a={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/creatCustomDeptChatGroups",getParams:{owner:G.loginId,public:!0,approval:!1,deptid:(l=D.value)==null?void 0:l.id,maxusers:2e3},postParams:{desc:JSON.stringify({groupType:103}),groupname:(h=D.value)==null?void 0:h.name,code:e===void 0?"":e},tokenSign:!0};const o=await window.MainWindowHelper.genRequest(a);return o.result==1?(_e({content:o.msg.text,zIndex:2147483647,duration:2e3}),st.value=!1,window.RendererHelper.sendToView("openImChatPage","tab_message",{groupId:o.msg.groupid}),Promise.resolve()):(st.value=!1,Promise.reject(o.errorMsg))};function oa(){if(ge.value){Se();return}A.value=!0}const sa=async()=>{var w,x;const a=(pe.value?[pe.value]:[]).concat(Dt(ae.value));let o=[];try{o=(await jt({peopleList:a.map(L=>({puid:Number(L.puid),name:L.name}))})).filter(L=>L.uid!=null)}catch(L){console.error(L)}if(!o||(o==null?void 0:o.length)<1)return;const h=(pe.value?[pe.value]:[]).concat(Dt(ae.value)).map(L=>V.get(L,"uid"));let R=o.filter(L=>!h.includes(String(L.uid))),C=R.map(L=>({uid:String(L.uid),name:L.name,phone:"",email:""}));if(!C.length)return;let b={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/addUserDept",getParams:{deptid:(w=D.value)==null?void 0:w.id},postParams:{users:JSON.stringify(C)},tokenSign:!0};const d=await window.MainWindowHelper.genRequest(b);if(d.result==1){const L=R,me=V.cloneDeep(ae.value);L.forEach(ie=>{var je,Xe;const re=(Xe=(je=ie.simplepinyin)==null?void 0:je[0])==null?void 0:Xe.toLocaleUpperCase();re&&(me[re]||(me[re]=[]),me[re].push(ie))}),ae.value=qe(me),await window.MainWindowHelper.updateTeamUnitData(),pt((x=D.value)==null?void 0:x.id,"-1")}else console.error("添加团队成员失败",d.errorMsg)};function Dt(e){return V.values(e).reduce((a,o)=>a.concat(o),[])}const na=e=>{J.value=e},la=e=>{e.preventDefault()},ia=e=>{e.preventDefault(),ce.value=e.target.dataset.index};let He=[],ke=null;const ra=()=>{if(console.log("dragEnd团队排序","from"+J.value,"to"+ce.value),J.value===null||!ce.value||J.value==ce.value){J.value=null,ce.value=null;return}ce.value=Number(ce.value),ca(J.value,ce.value),J.value=null,ce.value=null},ca=(e,a)=>{var C,b;let o={sort:0,...N.value[e]};N.value.splice(e,1),N.value.splice(a,0,o);const l=N.value[a-1],h=N.value[a+1],R=N.value.length;if(a>0&&a>e&&o.sort!==0?h?ke=(((l==null?void 0:l.sort)||0)+((h==null?void 0:h.sort)||0))/2:ke=(((C=N.value[R-2])==null?void 0:C.sort)||0)+1:a<e&&o.sort!==0&&(l?ke=(((l==null?void 0:l.sort)||0)+((h==null?void 0:h.sort)||0))/2:ke=(((b=N.value[1])==null?void 0:b.sort)||0)/2),console.log("新排序的值",ke),ke&&ke!==0){N.value[a].sort=ke,o={sort:0,...N.value[a]};const d=He.findIndex(w=>(w==null?void 0:w.id)===o.id);d!==-1&&He.splice(d,1),He.push(N.value[a])}};function ua(){return N.value.some((e,a,o)=>{var R;let l=e.sort??0;if(l===0||l.toString().length>16)return!0;let h=((R=o[a-1])==null?void 0:R.sort)??0;return da(h,l)})}function da(e,a){return Math.abs(a-e)<1e-12}const pa=async()=>{let e=[];ua()?(N.value.forEach((o,l)=>{o.sort=(l+1)*1}),e=N.value.map(o=>({deptId:o.id,sort:o.sort}))):e=He.map(o=>({deptId:o.id,sort:o.sort}));let a={baseUrl:"https://contactsyd.chaoxing.com",url:"/apis/dept/updateSort",getParams:{puid:G.puid},postParams:{sortStr:JSON.stringify(e)},genSign:!0,tokenSign:!0};window.MainWindowHelper.genRequest(a).then(o=>{console.log("对团队进行拖拽排序结果",o),o.result==1?(e.forEach(async(l,h)=>{await window.MainWindowHelper.updateDeptSort(l.deptId,l.sort)}),Qe(),$.value=!1,He=[],ke=null):_e({content:o.msg||"排序失败",zIndex:999,duration:2e3})})},ma=()=>{Qe(),$.value=!1,He=[],ke=null},va=e=>{if(ge.value){Se();return}if(e._type==Te.DELETE){const{destroy:a}=Et(Ot,{title:i("message.reminder"),content:i("message.confirmdeletion"),cancelBtn:{text:i("message.cancel"),callback(){a()}},confirmBtn:{text:i("message.delete"),callback(){let o={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/deleteDept",getParams:{deptid:e.id},postParams:{},tokenSign:!0};window.MainWindowHelper.genRequest(o).then(async l=>{console.log(l),l.result==1&&(await window.MainWindowHelper.deleteDeptDataByDeptid(e.id),N.value=N.value.filter(h=>h.id!=e.id),a()),(l.msg||l.errorMsg)&&_e({content:l.msg||l.errorMsg,zIndex:2147483647,duration:2e3})})}}})}else if(e._type==Te.UPDATE)O.value=e.name,W.value=e,P.value=!0;else if(e._type==Te.EXIT){const{destroy:a}=Et(Ot,{title:i("message.reminder"),content:i("message.allExit"),cancelBtn:{text:i("message.cancel"),callback(){a()}},confirmBtn:{text:i("message.exit"),callback(){let o={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/deleteUserDept",getParams:{deptid:e.id},postParams:{userids:JSON.stringify([G.getSelfUserInfoDetail.uid])},tokenSign:!0};window.MainWindowHelper.genRequest(o).then(async l=>{console.log(l),l.result==1&&(await window.MainWindowHelper.deleteDeptDataByDeptid(e.id),N.value=N.value.filter(h=>h.id!=e.id),_e({content:i("message.exitSuccessful"),zIndex:2147483647,duration:2e3}),a()),l.errorMsg&&_e({content:l.errorMsg,zIndex:2147483647,duration:2e3})})}}})}else e._type==Te.SORT&&($.value=!0)},fa=()=>{Q.value=!1,M.value=!0,z.value.push({name:i("message.myGroupChat"),level:z.value.length,fid:"-2"})},D=c({}),pe=c(),ga=e=>{if(ge.value){Se();return}Q.value=!1,te.value=Me.value,D.value=e,Ye({fid:e.fid,pid:e.id,hideUser:0,addressbookDataType:0}),z.value.push({name:e.name,level:z.value.length,fid:e.fid,deptid:e.id,currentDeptData:e})},ha=e=>{if(ge.value){Se();return}te.value=e,Q.value=!1,D.value=e,Ye({fid:e.fid,hideUser:0,addressbookDataType:e.addressbookDataType}),z.value.push({name:e.name,level:z.value.length,fid:e.fid,currentDeptData:e})};function Se(){_.value=!0,s&&clearTimeout(s),s=setTimeout(()=>{_.value=!1},2*1e3)}const ya=e=>{if(ge.value){Se();return}"pid"in e&&(D.value=e,Ye({fid:e.fid,pid:e.id,hideUser:e.hideUser,addressbookDataType:e.addressbookDataType}),z.value.push({name:e.name,level:z.value.length,fid:e.fid,deptid:e.id,currentDeptData:e}))},xt=e=>{var a;if(ge.value){Se();return}if(e.level==0)ba();else{z.value=z.value.slice(0,e.level+1),D.value=e.currentDeptData;let o=0;e&&e.currentDeptData&&"hideUser"in e.currentDeptData&&(o=e.currentDeptData.hideUser),Ye({fid:e.fid,pid:e.deptid,hideUser:o,addressbookDataType:(a=e.currentDeptData)==null?void 0:a.addressbookDataType})}},_a=V.debounce(()=>{_e({content:i("message.nameCannotExceed"),zIndex:2024,duration:2e3})},200),wa=()=>{O.value.trim().length>16&&(_a(),O.value=O.value.trim().slice(0,16))},Aa=()=>{var a;if(ge.value){Se();return}if(((a=W.value)==null?void 0:a.name.trim())==O.value.trim()){P.value=!1;return}let e={baseUrl:"https://learn.chaoxing.com",url:"/apis/dept/updateDept",getParams:{deptid:W.value.id,name:O.value},postParams:{},tokenSign:!0};window.MainWindowHelper.genRequest(e).then(async o=>{console.log("请求结果",o,W.value),o.result==1&&(await window.MainWindowHelper.deleteDeptDataByDeptid(W.value.id),await window.MainWindowHelper.insertDeptInContact([{...JSON.parse(JSON.stringify(W.value)),name:O.value,fullname:O.value,hideUser:0}]),Ut({...W.value,name:O.value,fullname:O.value,hideUser:0},!0)),(o.msg||o.errorMsg)&&_e({content:o.msg||o.errorMsg,zIndex:2147483647,duration:2e3})}).finally(()=>{P.value=!1})},Ut=(e,a)=>{if(ge.value){Se();return}if(a){const o=N.value.findIndex(l=>l.id===e.id);o!==-1&&(N.value[o]=e)}else N.value.unshift(e)},ba=()=>{Q.value=!0,de.value=!1,M.value=!1,ae.value={},F.value=[],te.value={},z.value=[{name:i("message.contacts"),level:0}],pe.value=void 0},Ca=V.debounce(()=>{S.value&&!M.value?(Y.value=1,ne.value=!1,f.value=[],K.value=[],Ua()):(Y.value=1,ne.value=!1,K.value=[],f.value=[])},200,{leading:!0}),ka=()=>{S.value=""},Ia=e=>{var a=/^[a-zA-Z\s]+$/;return a.test(e)},Da=(e,a)=>{let o=e.split(" ");const h=o.join("").replace(a,",").split(",");if(!h.length)return-1;const R=h[h.length-1];if(!R)return-1;let C="",b=1;for(let d=o.length-1;d>=0;d--)if(C+=o[d],C==R)return b=-1,b;return b},xa=(e,a)=>e.replaceAll(" ","").indexOf(a),Ua=async()=>{const e=z.value[z.value.length-1],a=await window.ContactsDbHelper.searchLocalUser(S.value.toLowerCase(),{fid:e==null?void 0:e.fid,deptid:e==null?void 0:e.deptid,level:e==null?void 0:e.level})||[];console.log(a);const o=S.value?fe.value.filter(b=>b.name.indexOf(S.value)>=0||b.fullpinyin.indexOf(S.value.toLocaleLowerCase())>=0||b.name.indexOf(S.value.toLocaleLowerCase())>=0):[];let l=await window.RendererHelper.getUser();const[h,R]=V.partition(a.concat(o),{fid:"-1"});R.sort((b,d)=>(b==null?void 0:b.fid)==(l==null?void 0:l.fid)&&(d==null?void 0:d.fid)!=(l==null?void 0:l.fid)?-1:(b==null?void 0:b.fid)!=(l==null?void 0:l.fid)&&(d==null?void 0:d.fid)==(l==null?void 0:l.fid)?1:Number(b==null?void 0:b.fid)-Number(d==null?void 0:d.fid));const C=V.uniqBy([...R,...h],"puid");if(console.log(C,fe.value),Ia(S.value)){let b=V.orderBy(C,[x=>xa(x.fullpinyin,S.value.toLowerCase())]);S.value.length>=2&&(b=V.orderBy(b,[x=>Da(x.fullpinyin,S.value.toLowerCase())]));const d=b.filter(x=>x.name.indexOf(S.value)>=0||x.name.indexOf(S.value.toLowerCase())>=0||x.name.indexOf(S.value.toUpperCase())>=0)||[],w=b.filter(x=>x.name.indexOf(S.value)==-1)||[];K.value=d.concat(w)}else K.value=C;St()},St=()=>{f.value=K.value.slice(0,Y.value*20),Y.value++,f.value.length==K.value.length&&(ne.value=!0)},Tt=c(),Sa=V.debounce(e=>{!ne.value&&S.value&&lt(()=>{const a=Tt.value;a.wrapRef.scrollHeight-e.scrollTop-a.wrapRef.clientHeight<=a.wrapRef.scrollHeight*60/a.wrapRef.clientHeight&&St()})},50),Ne=c(!1),Ke=async e=>{var C,b;const{deptid:a,fid:o,hideUser:l}=e;Ne.value=!0;let h=0;const R=await window.ContactsDbHelper.queryUserListByDeptId(a,o);if(R!=null&&R.success){let d={},w=l===1?[]:(C=R.data)==null?void 0:C.userList,x=V.uniqBy(w,"puid");h=x.length,((b=D.value)==null?void 0:b.fid)=="-1"?(pe.value=x.find(ie=>{var re;return ie.uid==((re=D.value)==null?void 0:re.creatorid)}),x=x.filter(ie=>{var re;return ie.uid!=((re=D.value)==null?void 0:re.creatorid)})):pe.value=void 0;const L=V.orderBy(x.filter(ie=>ie.category)||[],ie=>ie.category);L.length&&(d["#"]=L),x.filter(ie=>!ie.category).forEach(ie=>{var je,Xe;const re=(Xe=(je=ie.simplepinyin)==null?void 0:je[0])==null?void 0:Xe.toLocaleUpperCase();re&&(d[re]||(d[re]=[]),d[re].push(ie))}),ae.value=qe(d),m.value=Object.keys(qe(d))[0]+"user"}return Ne.value=!1,h},Ye=async e=>{var h,R;const{fid:a,pid:o="-1",hideUser:l}=e;if("subdeptcount"in D.value&&((h=D.value)==null?void 0:h.subdeptcount)==0){de.value=!0;const C=await Ke({deptid:o,fid:a,hideUser:l});if(console.log("团队部门人数与实际人数是否相等",D.value.usercount,C,D.value.usercount==C),a=="-1"&&((R=D.value)==null?void 0:R.usercount)!=C){Ne.value=!0;const b=V.cloneDeep(D.value);if((await window.MainWindowHelper.updateCurrentFidUsers(V.cloneDeep(te.value))).success){const w=setTimeout(async()=>{var x;"id"in D.value&&b.id==((x=D.value)==null?void 0:x.id)&&await Ke({deptid:o,fid:a,hideUser:l}),Ne.value=!1,clearTimeout(w)},500)}else Ne.value=!1}}else{const C=await window.ContactsDbHelper.queryDeptListByFid(a,o,e.addressbookDataType);C!=null&&C.success&&(F.value=V.uniqBy(C.data.deptList||[],"id"),ae.value={},Ke({deptid:o,fid:a,hideUser:l}),de.value=!1);for(const b of F.value)"ppath"in b&&(b.peopleNumber=await window.RendererHelper.invokeToMainProcess("_countDeptPeople",b.ppath))}},Qe=async(e=!0)=>{e&&(le.value=!0);const a=await window.ContactsDbHelper.queryUnitAndTeamList();a!=null&&a.success&&(he.value=a.data.unitList.filter(o=>o.fid!="-1"),Me.value=a.data.unitList.find(o=>o.fid=="-1")||{},N.value=V.orderBy(a.data.teamList,[o=>o.sort])),e&&(le.value=!1)},qe=e=>{const a=Object.keys(e).sort(),o={};for(const l of a)o[l]=e[l];return o},dt=async(e=!1)=>{var l;e||(j.value=!0);let a=await window.MessageDbHelper.queryAllMsgContacts(),o=await window.MessageDbHelper.queryConversationData();if(o.success){const h=(a==null?void 0:a.rows)||[],R=(l=o.rows)==null?void 0:l.filter(L=>L.conversationType==nt.SINGLE),C=new Set;h.forEach(L=>{C.add(L.uid)});const b=[];R.forEach(L=>{C.has(L.conversationKey)||b.push(L.conversationKey)});let d=b.length?await window.RendererHelper.getUsersByTuids(b.join(",")):[],w=h.concat(d);fe.value=w;let x={};w.forEach(L=>{var ie,re;const me=(re=(ie=L.simplepinyin)==null?void 0:ie[0])==null?void 0:re.toLocaleUpperCase();me&&(x[me]||(x[me]=[]),x[me].push(L))}),q.value=qe(x),r.value=Object.keys(qe(x))[0],await window.MessageDbHelper.insertMsgContacts(d),j.value=!1}},Re=(e,a)=>{let o=e.target;o instanceof HTMLElement&&(o.closest("img")||(window.RendererHelper.sendToView("SEND_NOTICE_OR_MESSAGE","tab_message",{type:"message",tuid:String(a.uid)}),window.MainWindowHelper.openChatPage({personId:String(a.uid)})))};$e(async()=>{Ae.value=new Date().getTime(),G.sqlReady?dt():Yt(()=>G.sqlReady,async e=>{e&&dt()},{immediate:!0}),G.getIsContactDbLoaded?Qe():(window.MainWindowHelper.useMode("contactsDb"),(await window.ContactsDbHelper.loadContactsDb()).success&&(G.setIsContactDbLoaded(!0),Qe())),I.value=await window.MainWindowHelper.getLanguage(),window.addEventListener("scroll",Ct)});async function Ta(){if(ge.value!==!0)try{const e=D.value.fid;if(ge.value=!0,e)if(Mt(D.value)){let a=Lt(D.value);delete a.deptConfig;const{state:o=0}=await window.MainWindowHelper.syncContacts(a,!1);if(o==1){const l=D.value.id;Ma(l),Ke({deptid:l,fid:e,hideUser:D.value.hideUser});const h=await window.ContactsDbHelper.queryDeptInfoById(l),R=V.first(h);if(R){const C=R.name;Ba(C,l)}}}else{const{state:a=0}=await window.MainWindowHelper.syncContacts(Lt(D.value),!0);a==1&&Ye({fid:e,hideUser:0,addressbookDataType:D.value.addressbookDataType})}else{window.ContactsDbHelper.clearDeptPeopleCountCache();const{state:a=0}=await window.MainWindowHelper.syncAllContacts(!1);a==1&&Qe(!1)}}catch(e){console.error("handleUpdate error:",e)}finally{ge.value=!1}}async function Ba(e,a){var l;const o=z.value.length-1;((l=z.value[o])==null?void 0:l.deptid)===a&&(z.value[o].name=e)}async function Ma(e){const a=await window.ContactsDbHelper.querySubDepts(e)??[];for(const[o,l]of a.entries())for(const h of F.value)h.id===l.id&&(F.value[o]=l)}async function Bt(){await window.MainWindowHelper.updateTeamUnitData()}async function pt(e,a){return Ke({deptid:e,fid:a,hideUser:0})}function Mt(e){return e&&"id"in e}function Ra(e){return"fid"in e&&e.fid==="-1"}return(e,a)=>{var C,b;const o=We,l=Ft,h=ft,R=Fe;return n(),u("div",{class:k([t(T).b()]),ref_key:"container",ref:tt},[$.value?E("",!0):(n(),u("div",{key:0,class:k([t(T).e("head")])},[Q.value?(n(),u("div",{key:0,class:k([t(T).e("add_team")]),onClick:oa,style:Ze(I.value=="en_US"?{fontSize:"12px"}:{fontSize:"14px"})},[B(o,{"icon-class":"contact_add",width:"12px",height:"12px",color:"#fff"}),we(" "+y(t(i)("message.newDepartment")),1)],6)):(n(),u("div",{key:1,class:k([t(T).e("contact_title")])},y(t(i)("message.contacts")),3)),p("div",{class:k([t(T).e("actions")])},[!M.value&&!S.value?(n(),u("div",{key:0,onClick:Ta,style:{cursor:"pointer",display:"flex","align-items":"center",gap:"4px"}},[ge.value?(n(),u("img",{key:1,src:t(Ds),alt:"loading",class:"loading-image"},null,8,Us)):(n(),ee(o,{key:0,"icon-class":"refresh3",width:"16px",height:"16px",color:"#6B89B3",style:{"margin-top":"1px"}})),p("span",{class:k([t(T).e("update")])},y(ge.value?t(i)("message.updating"):t(i)("message.update")),3)])):E("",!0),p("div",{class:k([t(T).e("search")])},[B(l,{ref:"searchRef",modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=d=>S.value=d),modelModifiers:{trim:!0},class:"search_input",placeholder:t(i)("message.search"),onBlur:a[1]||(a[1]=d=>Z.value=!1),onFocus:a[2]||(a[2]=d=>Z.value=!0),onInput:t(Ca)},{suffix:ve(()=>[S.value.length?(n(),ee(o,{key:0,class:"clear","icon-class":"input_clear",width:"14px",height:"14px",onClick:ka})):E("",!0),B(o,{"icon-class":"search",width:"18px",height:"18px",color:Z.value?"#3A8BFF":"rgba(172, 180, 191, 1)"},null,8,["color"])]),_:1},8,["modelValue","placeholder","onInput"])],2)],2)],2)),$.value?(n(),u("div",{key:1,class:k([t(T).e("head")])},[B(o,{"icon-class":"sort_back",width:"18",height:"18",style:{cursor:"pointer"},onClick:ma}),p("div",{class:k([t(T).e("sort_finish")]),onClick:pa},y(t(i)("message.complete")),3)],2)):E("",!0),le.value&&j.value?(n(),u("div",Ss,[Ts,we(" "+y(t(i)("message.loadingWait"))+"… ",1)])):E("",!0),vt(B(h,{class:"contact_scrollbar",ref_key:"contactScrollRef",ref:v,onScroll:Ct},{default:ve(()=>[p("div",{class:k([t(T).e("title")])},[B(o,{"icon-class":"contact/unit",width:"14",height:"14"}),p("div",Bs,y(t(i)("message.unitAddressBook")),1)],2),(n(!0),u(se,null,ue(t(he),d=>(n(),ee(t(Ie),{key:d.fid,onClickAvatar:De,"item-info":{...d},"update-avator-time-stamp":Ae.value,type:0,onItemClick:ha,onUpdateTime:xe},null,8,["item-info","update-avator-time-stamp"]))),128)),t(N).length?(n(),u("div",{key:0,class:k([t(T).e("title")])},[B(o,{"icon-class":"contact/team",width:"14",height:"14"}),p("div",Ms,y(t(i)("message.team")),1)],2)):E("",!0),(n(!0),u(se,null,ue(t(N),d=>(n(),ee(t(Ie),{key:d.id,onClickAvatar:De,"item-info":{...d},"update-avator-time-stamp":Ae.value,type:2,isTeam:"",onItemClick:ga,onItemChange:va,onUpdateTime:xe},null,8,["item-info","update-avator-time-stamp"]))),128)),p("div",{class:k([t(T).e("title")])},[B(o,{"icon-class":"contact/group",width:"14",height:"14"}),p("div",Rs,y(t(i)("message.groupsChat")),1)],2),p("div",{class:k([t(T).e("joingroup")]),onClick:fa},y(t(i)("message.myGroupChat")),3),p("div",Ls,[p("div",{class:k([t(T).e("title")])},[B(o,{"icon-class":"contact/people",width:"14",height:"14"}),p("div",Es,y(t(i)("message.contactPeople")),1)],2),(n(!0),u(se,null,ue(Object.keys(t(q)),d=>(n(),u("div",{class:k([t(T).e("msg_contact")]),key:d},[p("div",{class:"word",id:d},y(d),9,Os),(n(!0),u(se,null,ue(t(q)[d],w=>(n(),ee(t(Ie),{key:w.uid,onClickAvatar:De,"item-info":{...w},"update-avator-time-stamp":Ae.value,onUpdateTime:xe,onDblclick:ye(x=>Re(x,w),["stop"])},null,8,["item-info","update-avator-time-stamp","onDblclick"]))),128))],2))),128)),p("ul",{class:"letterAside",style:Ze(t(Ve)?{position:"fixed",top:"50%",transform:"translateY(-50%)"}:{position:"absolute",top:"100px"})},[(n(!0),u(se,null,ue(Object.keys(t(q)),d=>(n(),u("li",{key:d,onClick:w=>$t(d),class:k(["letter",r.value==d?"activeletter":""])},[we(y(d),1),Hs],10,Gs))),128))],4)])]),_:1},512),[[Rt,!le.value&&!j.value&&Q.value&&!S.value&&!$.value]]),vt(B(h,{class:k([t(T).e("sort_team")])},{default:ve(()=>[p("div",Ns,y(t(i)("message.dragToSort")),1),(n(!0),u(se,null,ue(t(N),(d,w)=>(n(),ee(t(Ie),{key:d.id,"item-info":{...d},type:2,isTeam:!0,isSort:!0,draggable:!0,index:w,"data-index":w,onDragstart:x=>na(w),onDragover:la,onDrop:ia,onDragend:ra},null,8,["item-info","index","data-index","onDragstart"]))),128))]),_:1},8,["class"]),[[Rt,!le.value&&!j.value&&Q.value&&!S.value&&$.value]]),!Q.value&&!S.value&&!M.value?(n(),u("div",Ps,[B(t(Pt),{"breadcrumb-array":t(z),onItemClick:xt},null,8,["breadcrumb-array"]),((C=t(D))==null?void 0:C.fid)=="-1"?(n(),u("div",{key:0,class:k([t(T).e("team_admin")])},[t(kt)?(n(),u("div",{key:0,class:k([t(T).e("add_team")]),style:Ze(I.value=="en_US"?{fontSize:"12px"}:{fontSize:"14px"}),onClick:sa},[B(o,{"icon-class":"contact_add",width:"12px",height:"12px",color:"#fff"}),we(" "+y(t(i)("message.addMembers")),1)],6)):E("",!0),p("div",{class:k([t(T).e("team_opr_btn")])},[t(kt)?(n(),ee(Gt,{key:0,title:t(i)("message.toGroupChat"),"text-color":"#6B89B3",style:{"margin-right":"20px"},onClick:oe},{prefix:ve(()=>[B(o,{"my-style":{"margin-right":"4px"},"icon-class":"contact_chat",width:"16px",height:"16px"})]),_:1},8,["title"])):E("",!0),B(Gt,{title:t(i)("message.invitationCode"),"text-color":"#6B89B3",style:{margin:"0"},onClick:aa},{prefix:ve(()=>[B(o,{"my-style":{"margin-right":"4px"},"icon-class":"contact_qrcode",width:"16px",height:"16px"})]),_:1},8,["title"])],2)],2)):E("",!0),B(h,{class:"breadcrumb_contact_scrollbar",style:Ze({height:((b=t(D))==null?void 0:b.fid)=="-1"?"calc(100% - 86px)":"calc(100% - 36px)"}),ref_key:"userScrollRef",ref:U,onScroll:t(ta)},{default:ve(()=>{var d;return[de.value?(n(),u(se,{key:0},[p("div",Fs,[pe.value?(n(),u("div",{key:pe.value.uid,class:k([t(T).e("msg_contact")])},[B(t(Ie),{onClickAvatar:De,"item-info":{...pe.value},"update-avator-time-stamp":Ae.value,isCreator:"",onUpdateTime:xe,onDblclick:a[3]||(a[3]=ye(w=>Re(w,pe.value),["stop"]))},null,8,["item-info","update-avator-time-stamp"])],2)):E("",!0),(n(!0),u(se,null,ue(Object.keys(ae.value),w=>(n(),u("div",{class:k([t(T).e("msg_contact")]),key:w},[p("div",{class:"word",id:w+"user"},y(w),9,Ws),(n(!0),u(se,null,ue(ae.value[w],x=>{var L;return n(),ee(t(Ie),{key:x.uid,onClickAvatar:De,"item-info":{...x},type:((L=t(D))==null?void 0:L.fid)=="-1"?2:1,"current-dept-data":t(D),"update-avator-time-stamp":Ae.value,onUpdateTime:xe,onDblclick:ye(me=>Re(me,x),["stop"]),onRemoveTeamMember:Zt},null,8,["item-info","type","current-dept-data","update-avator-time-stamp","onDblclick"])}),128))],2))),128)),p("ul",Js,[(n(!0),u(se,null,ue(Object.keys(ae.value),w=>(n(),u("li",{key:w,onClick:x=>ea(w+"user"),class:k(["letter",m.value==w+"user"?"activeletter":""])},y(w),11,Vs))),128))])]),!Object.keys(ae.value).length&&!pe.value?(n(),u("div",Ks,y(t(i)("message.nomembers")),1)):E("",!0),Ne.value&&!Object.keys(ae.value).length?(n(),u("div",Ys,[Qs,we(" "+y(t(i)("message.loadingWait"))+"… ",1)])):E("",!0)],64)):(n(),u(se,{key:1},[(n(!0),u(se,null,ue(t(F),w=>{var x;return n(),ee(t(Ie),{key:w.id,onClickAvatar:De,"item-info":{...w},type:((x=t(D))==null?void 0:x.fid)=="-1"?2:1,"update-avator-time-stamp":Ae.value,onItemClick:ya,onUpdateTime:xe,onDblclick:ye(L=>Re(L,w),["stop"])},null,8,["item-info","type","update-avator-time-stamp","onDblclick"])}),128)),pe.value?(n(),u("div",{key:pe.value.uid,class:k([t(T).e("msg_contact")])},[B(t(Ie),{onClickAvatar:De,"item-info":{...pe.value},type:((d=t(D))==null?void 0:d.fid)=="-1"?2:1,"update-avator-time-stamp":Ae.value,isCreator:"",onUpdateTime:xe,onDblclick:a[4]||(a[4]=ye(w=>Re(w,pe.value),["stop"]))},null,8,["item-info","type","update-avator-time-stamp"])],2)):E("",!0),(n(!0),u(se,null,ue(Object.keys(ae.value),w=>(n(),u("div",{class:k([t(T).e("msg_contact")]),key:w},[p("div",{class:"word",id:w+"user"},y(w),9,qs),(n(!0),u(se,null,ue(ae.value[w],x=>{var L;return n(),ee(t(Ie),{key:x.uid,onClickAvatar:De,"item-info":{...x},type:((L=t(D))==null?void 0:L.fid)=="-1"?2:1,"current-dept-data":t(D),"update-avator-time-stamp":Ae.value,onUpdateTime:xe,onDblclick:ye(me=>Re(me,x),["stop"])},null,8,["item-info","type","current-dept-data","update-avator-time-stamp","onDblclick"])}),128))],2))),128))],64))]}),_:1},8,["style","onScroll"])])):E("",!0),!Q.value&&M.value?(n(),u("div",js,[B(t(Pt),{"breadcrumb-array":t(z),onItemClick:xt},null,8,["breadcrumb-array"]),B(t(as),{keyword:S.value},null,8,["keyword"])])):E("",!0),S.value&&!M.value?(n(),ee(h,{key:5,ref_key:"ScrollbarRef",ref:Tt,class:"contact_scrollbar",onScroll:t(Sa)},{default:ve(()=>[(n(!0),u(se,null,ue(t(f),d=>(n(),ee(t(Ie),{key:d.uid,onClickAvatar:De,"item-info":{...d},"update-avator-time-stamp":Ae.value,keyword:S.value,onUpdateTime:xe,onDblclick:ye(w=>Re(w,d),["stop"])},null,8,["item-info","update-avator-time-stamp","keyword","onDblclick"]))),128)),t(f).length?E("",!0):(n(),u("div",Xs,y(t(i)("message.noSearchResults")),1))]),_:1},8,["onScroll"])):E("",!0),A.value?(n(),ee(t(Yo),{key:6,"add-team-visible":A.value,onClose:a[5]||(a[5]=d=>A.value=!1),onChange:Ut},null,8,["add-team-visible"])):E("",!0),B(R,{visible:P.value,options:{"close-on-click-modal":!1},width:"440","confirm-text":t(i)("message.done"),"close-text":t(i)("message.cancel"),title:t(i)("message.rename"),onClose:a[7]||(a[7]=d=>P.value=!1),onConfirm:Aa},{default:ve(()=>[p("div",Zs,[B(l,{ref_key:"teamNameRef",ref:X,modelValue:O.value,"onUpdate:modelValue":a[6]||(a[6]=d=>O.value=d),placeholder:t(i)("message.enterTeamName"),onInput:wa},null,8,["modelValue","placeholder"])])]),_:1},8,["visible","confirm-text","close-text","title"]),ct.value?(n(),ee(bs,{key:7,"group-name":t(i)("message.invitationCode"),"invite-code-info":It.value,onClose:a[8]||(a[8]=d=>ct.value=!1)},null,8,["group-name","invite-code-info"])):E("",!0),t(_t)?(n(),ee(Fa,{key:8,position:"absolute",top:t(ht),left:t(yt),"is-sub-component":!0,myPuid:t(wt),puid:t(At),onClose:t(bt),onBlur:t(bt)},null,8,["top","left","myPuid","puid","onClose","onBlur"])):E("",!0),B(Is,{visible:_.value},null,8,["visible"]),Oe.value?(n(),ee(t(ds),{key:9,open:Oe.value,ref_key:"createGroupDialogRef",ref:at,onClose:a[9]||(a[9]=d=>Ue(!1)),onCancel:a[10]||(a[10]=d=>Ue(!1)),onConfirm:Ge,onCreateGroupChatWithPassword:Xt},null,8,["open"])):E("",!0),B(t(vs),{onCancel:a[11]||(a[11]=d=>ot(!1)),onClose:a[12]||(a[12]=d=>ot(!1)),visible:Je.value,onConfirm:zt},null,8,["visible"])],2)}}});const Zn=Ce(zs,[["__scopeId","data-v-4135b0ea"]]);export{Zn as default};
