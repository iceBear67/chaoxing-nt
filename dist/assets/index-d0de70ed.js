import{a as U,r as _,c as g,C as N,o as z,n as p,b as d,e as u,m as y,I as A,h as s,a1 as P,j as h,p as f,M as X,l as c,y as k,k as E,f as j,_ as q,q as G}from"./index-26603ea5.js";import{d as O}from"./vuedraggable.umd-b9153632.js";import"./_commonjsHelpers-de833af9.js";const Y=""+new URL("fixed_tab_icon-0cffb739.svg",import.meta.url).href,J={class:"tagview"},K=["data-id","onClick","title"],Q={class:"tagview_fixed"},Z=["src","onError"],ee={key:0,class:"right_border"},te=["data-id","onClick"],ie={class:"tagview_item_box"},oe={class:"tagview_item_box_title"},ae=["onClick"],ne={key:1,class:"right_border"},se={key:0,class:"tagview_arrow"},x=200,r=60,re=U({__name:"index",setup(le){const a=_([]),v=_(),l=_(0),n=_(""),m=_(0),w={},T=g(()=>{let e=l.value/a.value.length;return e=e>x?x:e,e=e<r?r:e,Math.floor(e*a.value.length)>Math.floor(l.value)});N(T,()=>{p(()=>{l.value=v.value.clientWidth})},{immediate:!0});const H=e=>!(e.relatedContext.index==0||e.relatedContext.element.fixed),B=e=>{const t=a.value[e.oldIndex];t&&n.value!=t.id&&b(t.id)},V=()=>{const e=a.value.map(t=>t.id);window.MainWindowHelper.updateTabBarList(e)},R=e=>{e.isErrorFavicon=!0},I=g(()=>e=>{if(e.fixed)return{width:"40px"};if(l.value){let t=(l.value-m.value*40)/(a.value.length-m.value);return t=t>x?x:t,t=t<r?r:t,{width:t+"px"}}return{width:"200px"}}),M=g(()=>{if(!n.value)return[];let e=[n.value];const t=a.value.findIndex(o=>o.id==n.value);return t>-1&&t!=0&&e.push(a.value[t-1].id),e});g(()=>n.value?a.value.find(t=>t.id==n.value):null);const S=e=>w[e]?w[e].src:e;z(()=>{window.RendererHelper.setBlockRefresh(!0),l.value=v.value.clientWidth,window.RendererHelper.on("updateTabBar",e=>{console.log("updateTabBar",e),a.value=e,a.value.forEach(t=>{t.isErrorFavicon=!1}),m.value=a.value.reduce((t,o)=>o.fixed?t+1:t,0),e.forEach(t=>{if(t.favicon&&!t.isErrorFavicon&&!w[t.favicon]){const o=new Image;o.src=t.favicon,o.onload=()=>{w[t.favicon]=o}}})}),window.RendererHelper.on("tabSelectChanged",e=>{console.log("currentTagId",e),n.value=e;let t=setTimeout(()=>{W(e),clearTimeout(t)},500);console.log("tabSelectChanged:",e)}),window.RendererHelper.on("pageTitleUpdate",e=>{$(e),console.log(`pageTitleUpdate:id:${e.id},title:${e.title}`)}),document.addEventListener("contextmenu",function(e){e.preventDefault(),console.log("contextmenu:",e);let t=e.target;if(t instanceof HTMLElement||t instanceof SVGElement){let o=t.closest(".tagview_item.tagview_item_active, .tagview_item_fixed.tagview_item_fixed_active")||t.closest(".svg-icon");if(o){let i=o.getAttribute("data-id");i&&window.MainWindowHelper.showTabItemMenu(i,{x:e.screenX,y:e.screenY})}}})});const $=e=>{const t=a.value.findIndex(o=>o.id==e.id);t>=0&&(a.value[t]={...a.value[t],title:e.title})},L=e=>{window.MainWindowHelper.closeSubTab(e)},b=e=>{if(e==n.value)return;n.value=e;let t=setTimeout(()=>{W(e),clearTimeout(t)},500);window.MainWindowHelper.selectSubTab(e)},W=e=>{const t=a.value.findIndex(i=>i.id==e),o=v.value;t<=3?p(()=>{o.scrollTo({left:0,behavior:"smooth"})}):a.value.length-1-t<=4?p(()=>{o.scrollTo({left:o.scrollWidth,behavior:"smooth"})}):(r*t-o.scrollLeft<3*r||o.scrollLeft+o.clientWidth-r*t<3*r)&&p(()=>{o.scrollTo({left:(t-3)*r,behavior:"smooth"})})},D=()=>{window.MainWindowHelper.openTabPanel({list:X(a.value),curId:n.value})};return window.onresize=()=>{l.value=v.value.clientWidth},(e,t)=>{const o=q;return c(),d("div",J,[u("div",{class:h(["tagview_wrapper",s(T)?"dynamics_tagview ":""]),ref_key:"tagview",ref:v},[y(s(O),{modelValue:s(a),"onUpdate:modelValue":t[0]||(t[0]=i=>P(a)?a.value=i:null),animation:"300",style:{display:"flex"},filter:".unmover",move:H,onStart:B,onEnd:V},{item:A(({element:i,index:F})=>[i.fixed?(c(),d("div",{"data-id":i.id,class:h(["tagview_item_fixed",i.id==n.value?"tagview_item_fixed_active":"",i.fixed?"unmover":""]),key:"fixed-"+i.id,onClick:k(C=>b(i.id),["stop"]),style:E(s(I)(i)),title:i.title},[u("div",Q,[u("img",{src:i.favicon&&!i.isErrorFavicon?S(i.favicon):s(Y),class:"favicon_icon",referrerPolicy:"no-referrer",onError:C=>R(i),draggable:"false"},null,40,Z),s(M).includes(i.id)?f("",!0):(c(),d("span",ee))])],14,K)):i.fixed?f("",!0):(c(),d("div",{"data-id":i.id,class:h(["tagview_item",i.id==n.value?"tagview_item_active":"",F==0?"unmover":""]),style:E(s(I)(i)),key:"item-"+i.id,onClick:k(C=>b(i.id),["stop"])},[u("div",ie,[u("span",oe,j(i.title||"新窗口"),1),i!=null&&i.canDel?(c(),d("div",{key:0,class:h(["item_close",i.id==n.value?"close_active":""]),onClick:k(C=>L(i.id),["stop"])},[y(o,{"icon-class":"close",width:"12px",height:"12px",color:"#8A8B99"})],10,ae)):f("",!0),s(M).includes(i.id)?f("",!0):(c(),d("span",ne))])],14,te))]),_:1},8,["modelValue"])],2),s(T)?(c(),d("div",se,[u("div",{class:"tagview_arrow_svg",onClick:t[1]||(t[1]=i=>D())},[y(o,{"icon-class":"arrow_under",width:"12px",height:"12px"})])])):f("",!0)])}}});const ve=G(re,[["__scopeId","data-v-1e1ba779"]]);export{ve as default};
