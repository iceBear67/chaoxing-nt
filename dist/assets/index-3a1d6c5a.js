var Ba=Object.defineProperty;var La=(a,i,r)=>i in a?Ba(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r;var vn=(a,i,r)=>(La(a,typeof i!="symbol"?i+"":i,r),r);import{u as nn,_ as on,w as Ua,a as Nn}from"./base-82955267.js";import{a as Pe,E as Da,c as Re,l as I,b as E,G as an,j as H,h as n,k as dt,H as Ms,r as R,C as Et,i as Me,I as He,e as p,m as Te,f as L,J as gt,q as It,s as Ot,p as re,F as Ke,g as ot,_ as Gt,u as ts,D as Rs,o as ls,w as Ct,K as Ro,L as Eo,z as ss,A as ns,t as rn,n as mt,v as xt,M as Oo,y as rs,x as Fa,N as Go,O as pt,P as Ha,Q as Pa,R as Oa}from"./index-26603ea5.js";import{M as _t,P as js,u as Ga,G as Es,s as Zt,m as hn,R as jn,J as Ka,C as Ko,W as bo,b as xo,i as No,a as Qa,c as ko,d as Va,e as Wa,h as Ja,g as qa,f as Xa,j as $a,k as za,l as Ya,S as Za,n as ja,o as qt,p as ei,q as ti,r as si,t as ni,v as oi,w as ai,x as ii,y as ri,z as li,A as ci,B as ui,I as di}from"./message-4d42f580.js";import gi from"./index-e2b8a06e.js";import{_ as Qo,a as lo,I as co}from"./class-fce5a8f7.js";import{d as vs}from"./avatar-d72faaaf.js";import{B as bs}from"./index-94663b0f.js";import{_ as j,l as _n}from"./lodash-4dfbea43.js";/* empty css                     */import{t as Vo}from"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";import{T as vt,c as Lt}from"./index-b0b4f58c.js";import{E as Wo,s as fi,P as Jo,c as pi,g as mi,a as vi,b as hi}from"./index-b0e9d890.js";import{E as Vs}from"./el-input-983a785f.js";import{D as Ts}from"./index-d3d722e6.js";import{u as yi,a as wi,m as Ci,d as uo,b as Ps,E as An,c as eo,g as Ii}from"./emoji-f1b6b027.js";import{F as Pt,A as z,C as ge,a as Xt,O as at,I as Ss,G as qe,s as tn,M as jt,E as _i,D as Ai,b as Bo,c as yn,L as Ls,d as Si,e as Ti}from"./message-fe5b63d1.js";import{E as Ws}from"./index-853a0f6e.js";import{M as Tn}from"./index-51260f4b.js";import{_ as go}from"./loading-6f16a8c7.js";import{M as Fs}from"./index-403401b5.js";import{u as qo}from"./usePersonalCard-1d04f272.js";import{u as xe}from"./index-46519fef.js";import{f as to}from"./time-f90370a8.js";import{c as Xo,a as Mi}from"./createAttachment-a64a5f42.js";import{F as fo}from"./forward-bb18e89e.js";import{o as $o}from"./index-fb2938e5.js";import{g as zo,i as Lo,u as Ri,Q as Ei,a as bi,A as xi,b as Ni}from"./group-show-read-64a7166f.js";import{i as Hs}from"./type-6514e97f.js";import{a as po}from"./avatar_group-d33fd388.js";import{C as ki,a as Bi,b as Li,c as Ui,d as Di,e as Fi,f as Hi,M as Pi,g as Oi,h as Gi,i as Ki,j as Qi,k as Vi,l as Wi,m as Ji,n as qi,o as Xi,p as $i,q as zi,r as Yi,s as Zi,t as ji,u as er}from"./func-names-7e1de6f6.js";import{i as tr}from"./group-chat-b264d087.js";import{_ as sr}from"./inbox-09c94a1c.js";import"./_commonjsHelpers-de833af9.js";import"./validate-f7672251.js";import"./el-popper-548470bb.js";import"./index-15f48857.js";import"./_baseGet-ad9634b7.js";import"./index-12f9ba11.js";import"./aria-60e0cdc6.js";import"./index-9c66cebd.js";import"./index-08289d2b.js";import"./index-57013d5d.js";import"./constants-84857360.js";import"./el-button-bd85f610.js";import"./index-952b158c.js";import"./index-f81182f6.js";import"./use-global-config-c67545e0.js";import"./index-e5f0a9f0.js";import"./icon-803f5cc0.js";import"./use-form-common-props-325f2441.js";/* empty css                                                              */import"./woman-a84999f1.js";import"./event-9519ab40.js";import"./typescript-defaf979.js";/* empty css                   */import"./index-7e6c4fb9.js";import"./vnode-45baa450.js";/* empty css                                                              */import"./index-ab028c07.js";/* empty css                                                              */import"./dayjs.min-d6672770.js";const nr=Pe({name:"ElContainer"}),or=Pe({...nr,props:{direction:{type:String}},setup(a){const i=a,r=Da(),l=nn("container"),o=Re(()=>i.direction==="vertical"?!0:i.direction==="horizontal"?!1:r&&r.default?r.default().some(t=>{const f=t.type.name;return f==="ElHeader"||f==="ElFooter"}):!1);return(u,t)=>(I(),E("section",{class:H([n(l).b(),n(l).is("vertical",n(o))])},[an(u.$slots,"default")],2))}});var ar=on(or,[["__file","container.vue"]]);const ir=Pe({name:"ElAside"}),rr=Pe({...ir,props:{width:{type:String,default:null}},setup(a){const i=a,r=nn("aside"),l=Re(()=>i.width?r.cssVarBlock({width:i.width}):{});return(o,u)=>(I(),E("aside",{class:H(n(r).b()),style:dt(n(l))},[an(o.$slots,"default")],6))}});var Yo=on(rr,[["__file","aside.vue"]]);const lr=Pe({name:"ElFooter"}),cr=Pe({...lr,props:{height:{type:String,default:null}},setup(a){const i=a,r=nn("footer"),l=Re(()=>i.height?r.cssVarBlock({height:i.height}):{});return(o,u)=>(I(),E("footer",{class:H(n(r).b()),style:dt(n(l))},[an(o.$slots,"default")],6))}});var Zo=on(cr,[["__file","footer.vue"]]);const ur=Pe({name:"ElHeader"}),dr=Pe({...ur,props:{height:{type:String,default:null}},setup(a){const i=a,r=nn("header"),l=Re(()=>i.height?r.cssVarBlock({height:i.height}):{});return(o,u)=>(I(),E("header",{class:H(n(r).b()),style:dt(n(l))},[an(o.$slots,"default")],6))}});var jo=on(dr,[["__file","header.vue"]]);const gr=Pe({name:"ElMain"}),fr=Pe({...gr,setup(a){const i=nn("main");return(r,l)=>(I(),E("main",{class:H(n(i).b())},[an(r.$slots,"default")],2))}});var ea=on(fr,[["__file","main.vue"]]);const pr=Ua(ar,{Aside:Yo,Footer:Zo,Header:jo,Main:ea}),mr=Nn(Yo);Nn(Zo);Nn(jo);const vr=Nn(ea),hr="forward";const yr=""+new URL("tip-78e40e88.wav",import.meta.url).href,ta="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABJCAYAAACesWDiAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHMSURBVHgB7dtNLixRGMbx5z3q3ps7uncJtQTEzAArsAS9BAlmEmWACQkr0HZgB5qZAXoH2gp8zeiuV5FUaVLyTEQd+vmN3qr06J/Tp04NChAREREZTfb+xuLRdZqEsGDu4w78xydyWC8Yunny+3Bn+u8VvoE3gZaO74ow+W5x+1PD1POO//rTij1UFehl5Vi4xFczZNsz/9YRqVAOidk+muDIlo9v1xCp8DraOJpSRFo5uZ9BhIYC4Qv2nY/l+aCNCAVEwmDp8sndPCITTaBnluctRCaqQHmT++AH4lpBQIrIVOeg7PTBEYFkLHTQBLMuLOyuTtqbg2sVaONsEEWgprl7a3UqOSivo/qLxcDM2pvnXp3JFKhGcSbLylmB6tjr01SBatjQW4UCEQpEKBChQIQCEQpEKBChQIQCEQpEKBChQIQCEQpEKBChQIQCEQpEKBChQIQCEQpEKBChQIQCEQpEKBChQIQCEQpEKBChQIQCEQpEKBChQIQCEQpEVIHMrAcp9cqhCuTubciLokWnnKtAjyHsYajcCOshjGXlRRUom7CbEMJcMbYxooptpuMWZoc/ibK6H25deNrv91OMkEGSdJ8XCURERH6MJ2KyYENNzquwAAAAAElFTkSuQmCC",mo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAABICAYAAAC6L9h5AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMtSURBVHgB7Zy/b1JRFMe/99I2xljtoEM7WAbTOGJwcdDSdNQm1cbB0UVXh+7AH2DStS5OtpO/gruogw4Q2Fw02g4w6NAE66DynvcALwUscvDd2/ci55O0wOMONx/Oue+cC7kKfVx44i+qJlahsaqAJMYBH1Uf5k8hV1lTO/1vq+BJ6qE/o08iay7cwxjje9jwviFfva32gmstSSQoMY2X5lUKQiuymg0sBaJ065+JIBHUhXGhTxgnwcvUtp9MTOEThD/wFDKVG+qV1pMHxoReWjcwgzaLkqTZIHRHkqxFgwlKIA1hKCKJgUhiIJIYiCQGIomBSGIgkhiIJAYiicEEHDB7HJFQ/w4nWJM0Z8Rk08DCDDA9icgomM3XB+/tCrOSbgungEfLQPpMtIKIlXlga7k9J1uElkQRdP9S9HK6oblsXrE3p9CSFueiW4P+Bgm6dQ5WCC0pM4vYYivl/usSYHoKVpA6iYFIYiCSGIgkBiKJwZFIavxstwvFuvsxLnDS4HZT2wfuvjnopahCp2q4uwC1NcYVziNp+2Nvs1kzz7c+uBnjCueS6vvDr9ka4wrnkqi36ycz52aMK5yvSbR1QZ84pQtx5zxwbd7NGFeo9GPfRwg2L7f3keJI+atZ7F8jFOU1paROYiCSGIgkBiKJgUhiIJIYhJbk6gtBGzR+wAqhJRV2EFuKNVghtCQq2MpfEDtoXi92YQUra9L6OzOhGEUUCVp/C2tY6d1oMyxXNqm32/4ejn4PMIj0aYSCBAyaA/V2tCFnO7KtNrg0uWETXDkLZC/in8iV7KXQKBx5CUDRli9hZKISRERSJ40qKkpBRGTFJFdU1IKISCvuYaLiIIiIvC0ZJCougohY9G79ouIkiHC+x82l0JFCe8lxEkTERhJRiJmcANkqYSCSGIgkBiKJgUhiIJIYiCQGIomBNhXuZwiH46NKDxRJzyAcjupI8pVIGoR3DDl61HQ+kEm5DQg90LFllavt891aC7enkQ/yTzBZZlx4E8ZJh5ak6nW110xgSSKqHUG/jAtyElxT/YNST/1kwuuc8eaPx9lKdIfXdAPz8Lx0UxX73/8NCccPWcYtpqQAAAAASUVORK5CYII=",vo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAABJCAYAAABxcwvcAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAASLSURBVHgB7Zw9aBRbFMf/d15AUN7DwlTvgcuzitV7PEGrJK9QVBTUBIyKX5UWYtReVBS0Mqa00aigFq6NhYJNkkpBMFVSqYkfVSxEUbTQ6/3vZHTcndm5OzP3ZjXnB5v93uz85p5zzz07DCBkouof2DKkly4OsPezRm8A/INfnzfaXJTCiPoNo9cPqZn6F/wgaeewHtQaJ83NpVigaIWTNwfVqfhj3yQNXNCXzZ19EGBG1sjNI2p/dD/gn4FhfUIEfYcutpuo+nZ/YEhXTDw+g9CA6kCFOSow2k5ASOTL5zC6ArUwZrBcKD0nCSKpGRX+CSBkIpIsEEkWiCQLRJIFIskCkWSBSLJAJFkgkiwQSRZ0oM1ZvsxcOoH3n4DXb4GZ1/BO20rathrY+C+weNGPj88aUdUHwPgUvNF2kijl2CZg5V/Jz3f+ARxcBywz17cfwgttl5N2d6cLitO/BljvqcnTVpK6/gR6Vtq/vm9NYzi6oK0kdbcgiCwxglb9Dee0laRKJ1pmeY73tEpbScoTOks8hJuz2Y0bzMTK2eiDqXHuPjZ1zjuUDusn1ziRxOn5eF8oKGKDqXmujgH3JtLf9+hJ+LpWmHoJ5zgJt3pBEXt6mocUJbUCC8tHT+Gc0iUxkSYJiujuSn9u6lUYlrZcvA8veK+4sxLttfHwulnYMccxdCc9hBopXRJDgBuRFlYcLVlQ1MxsWFh2xapvfi7FXDOCZh1MAmmULokbcutBmH/qYZK13ftcwPJC2dEMyR0wHzgJN85g3CguG+IlwN2J1j+L7+Womk+c5aT4SPjgoZZxifPEnSWITbX/VoRLkjxLDJYNrgrViHnrJ7HgPLjWri2SBPMTSwAfM1ypktjqYA5KqpO4UVE3kaPn2Obm9VQzpk2OOlP1F8alSOIarT+jtzN4KbzmCCoiiLKH7iQLovz1pr6697jcXnhhSQfWZjfK2JOO6pq0JYst8c+qh21d5jWG8OBllEahZQmb9VmCuEofnwxvc0lSRFA8ZJNw1aXMLYlhwxDLggVktOdb7TzW0+oCuCxyh1vfarvXxWefvDNZRH1RyR11bmfjCOJovT53FDZH3/k7xXJU7pFk22p9PvflioRZGj1d2SHG/7tqBQqReyT56C1nwfwUH538TpG0qBkXz4l5yS2p2UrfFbUdE0vcDKXT1e/3h/eH36n+8aLkDjeu9H3DxO97x5DcI4krffaGsn73ev8RpcGG3QZTuFZTft7mCIq6DmVSqJjkbGPbxshqxtnCinpsMnlBy7Ucc9TkC5SK19/dyghRjqbj/Wb6/73xOe4ICiy7a+lVEkO0WoIohtTZXf4OmPDeKmE+YYeyUlIJQWGu27rz0k+KGvo/C3LMpAUiyQKRZIFIskAkWSCSLBBJFogkC0SSBSLJApFkASVNQ0ijdrBQoIFRCInoSJIKMAIhGY0rvApuHFZjkNHUQO1sXEfVKG/XEvcija2Q3BRnOuionduuRk3SyFH1Rmv8DxlRZFR1oDd+lsCGUyjuGNZ7EZ5cqRcLBBWeRnHCDJRTUYjF+QrWy0U9ApQ8jQAAAABJRU5ErkJggg==",ho="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAS5SURBVHgB7ZxbTlNRFIYX4j1YS0RFbROMJBrURBNN6IPPMIEyAZgATkCcAEwAJkAnAC+++FASTDAhVAgkEEu4CIZbw02I7n+V3ZQGugrss3sw60tID6e0+5zvrH1foebJ6Je/pJzKFVLKooIEVJCAChJQQQIqSEAFCaggARUkoIIEVJCAChJQQQIqSEAFCYRGUKT2Kn183ES9TS/4OCyEQlBbtIEGml9RemudRnLrfJy810hhoKaaK4qJO1GOmontHPUuzhGZK9k8PKD4jZt8Pnb9JvUuzLG4alEVQVaMKZ66537Q/N4un+sz1QsXk5z6TvP7u8dE9S/P0/D6KvnGm6CYudkOU2067j2ioY0VGl5b5chAe/M53kzJhkfH/n5wdZGjp1hUa12UBoyoISMK530QiCDIuGtu/OWtOmqNRPl18/DQRMAKDf5eos2DAxbT9TBGXQ/iFLl6eqNcKgqRljSSI7W1XDUhGe/hGNXTNc4EDbe8w9fxRWb3d/gVVQcXPrGTYynAVq/EnfqzfD2LShm5tj2CVIh/ebuOH0jcVMNI7TVT7h+ukm2Zb+QCZ4Iybz9Qy9jXwu+4aICbwMUnTCQl6urLRkslQHQ6t0bpzfW8eDwQ8yCKo2fkdYJax9PkAmcDjo2iCEk9f0tBAcFt0fv8U0pbZpQj1iX/1Ug6iAGmTjUEVJCAChJQQQIqSOBSCcJYB6NxX9MMEJ6FF4GskZKcGuPROaYcwy3vvawbXYoIKpbDv5vX9NYa+cCbINxk58x4/kbPUEVK5QBMXTCF8YE3QT0/p3k9B5PNSiWdJif1/I2Z690iH3gTVNxeoIpIksIgB3gTZFcGLeUkhUUO8CYobm6Mb1CQFCY5wGsvJkkKmxzgTlBNft1NWvYsJ+micmzZF12UK8aZILvOXMna8GmSLioHZeMasnvuRtrOBKH7xmoiwHRA4iRJhffOUa2GjsrENUzsbJErnAnCGMcKGlxdqugzJ0k6b5uTOiqz3ezSpiosvxLcRpBZmEeI47jS3VArKcl7Zo3nkoNpB8qD3NZIvdOdWKf7Yh0NjYXtYmzHYELpA+xgoP3CWAs9YSgjCKBq8T6VkYQGsyc7TUHTuzCbn+GbMrE761IOcD4OQvT0PX3Bx9hPT5kNv6BAZ4DyuFxTJoYJrnEuCJGDBjufnED0KTtjzrnrVQrlmJ6qe26Sj1EWb0E77N4tgYykETn5kG/k8QmyNVxKghx8J8ZeyC1Cx2AjyTWBTTXwdNHlok2ykvqXs3RRUGWtHKwJoWPoMVEaFIHOxbpnJ6nzYYzHR5CEG0Gjeh7yn59m8ZDDSRBPmgrVLCi85Af1xJt5MoqqB7Cm3P/sNUdXJaB9gRy77460GfSUQUaOxVsCFRpS21bYuRqqB3J97Ai8FIhBxBVSXo4SPYtlB43XFDxEDrJYS9PpcB6NrU2ZQW/EWWRFvRIkInIg2HUGRzmqkqNohwAYWEpr0yzmQYxzgYLqqcpRtSxXm06HvENUoYwRYCMDkdR+t+FoZp6j/l/zhQw139SE4R8LQIRNpUM7k9nOFfIPq00oBIUZTV4QUEECKkhABQmoIAEVJKCCBFSQgAoSUEECKkhABQmoIIF/jd2vGQWAkMcAAAAASUVORK5CYII=",yo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAjJSURBVHgB7Zw9bBRHGIZn98734zPGjhQJybZ0SqpAQ5XgCpAA0xChIGjSBJkiRMoPLqAgko1EAwUmSUEKEDRpsECJaGKCFFOZpHKD0yDZCCPSoBj/+3y3m3nHnvPcdzO7c+ddMIcfCeHzjvdu3v2+d76ZnT2HEf7bkd9bdNyjruMcZQ7Ls3cB3x/zGRtL+P5A+4uJp+ohR/4w0ZZva825/fxX37F3GM/zryYXvQvt05PTeC0EEuI0u38yx9nNthAR5S54+yGSi9cicrbEWYdrUcwim/iPL3bk86lEYoJtUYVbKu1zm9xEP2sAErs+YlHjrQ5WfkOkVsv1a8zt7GCR4rCj3IMaw3sSXZ2s5cY15rRuY5HhOHmXNRDJXTtZ88D3LEoaSiCQPnGMZfq+YVHRcAKBZi5Q6vgx6/ZuZ6cQ1WltrT7GGpTchfOBI5sUZdvQL6zt0QhL8Nf+zExVO+dlx4c+awDem3pS9bvSsyk2e/xz5k09F69h4EjBpp6DrKn7k3I779lzNiPaTVWdI8kaGDmyFYbuVomisnjlR604oKEjyIbi43E20/Op8XjDepAtc71fBR5/61MswWufpp4DrB4WAlJL8lamGMw22b2HZU59YfSVMGDM0917Q9u9VREkoyXLhdHVLLUAY7Zh0wsURbRQVkb/YstDd6zablqBRM1y6mQk0UKB0En+r8iFCv0cm82D8MGzvMKl0bJ8+66odFOHD0ayrEGLSOPnYZsEkzC4ynNnzonRBlHlcZGaI5iMoojMDV4WIgV+LvaGwXwJSxQ6YWCkK2tpkDrxmRAQcyaAUWh+4CJjiCo+fUjxSrnWtSC8Z5qn8PL1W8Y2b0wgdCbT963wGBV/ZpYL8wNbWvvQushaun6Tt/lJpJzb1SFSrt6Fshy/OKXH/xj96I14UAbm2/d1lfkWhh+w+TNnRcd1Aoqo6TtbjioM+S08TcJMHD4T5Fvwo5meI+LiUF6rQLjauSuXq9IJH2yOC7My/Id4jajJDV4qpxNQxQNZfuWpeDg/Bb9/xTsvzsvTGeeWo5gKRNf50WsTyBQ1qgkD2nGwwL1GphwVGeLO91/ky8e++D1les8+43QC50DxmeKRiP8XeGpTP4rdg0xRAzAXWlqraHXtRGT1fllOKbTBApeMLBzHOk6Jz8jT3MR15w+aa+G8+AdPAxCJEqtAulQBNKUwkmHdRm1HF7HQppWLIyOQHqdpgMhcspxOSCA0JbblDqRUq3K1JcITDh0pi4O14+3D9wLFQZsgcXC8RUkvHEfaRkEsEaTzEUA7huE7S4o+bed5FEpkWgWdY9FiGcOWSAXC0Nxy42et3xR5rTHXe7omcZCiqjgAniSPrxp/5TngO7YTURsiEwgGitu/SY3RoeMYQstDtIU4wpC5L6ksKJU1aqDmgfNV56jVd8KIRCA6uqjIjgeJA2ZPna4UR/EcgMmqOuKhQFSRqRc1GzZpG3GC0gqgzlFHEEQiNW11gYuKJ87Ba6GofEdlQwIJzyGdkVAzlXMqiogMpThDG5qmqumqE1b1HFH6jsqGBIIh6zwHYMKppkyOmC2gkaETEW1k53EenciLEfuOSt0CZTVLFBJRIStRYUpBOhzrRJzjk9PyexoiMI7UktQlkPASTZ0D6EiiSwlA00LXDucqKtOMtGZDwtKNmyxOahbIFOYSdSQJaqumBdplNIIvEqEpEBBrOXFSk0ByxDJBJ4emtjQtsoatJ4Xh++WfUz2HAo/HRU0CmdIF0NTCEqmpLY0eXedREMoFLHidbsWwOPo3ixtrgdDhdMCmJNppU2qh42r0JA2dl5NZgJ0ZOjzNfp6osRIIHQjyHXUoBhDSFD0Fnl4qmd6T2nZFxVuSho1QeN+4sRIIk0JThwGtQ1KaxSuJ6huINFPnK9ZmIr5xWAuhAoWNWjR6grxH9RWQDLiVrLZzt0e4tbdGQgXKhtyko9FjShmg+gpIGbzFt/QW5zUIFyiQqTiToCO2KQOKpGZxA9LWhuTO6B8/oAQKFBY9hd8fVKRCOmTrLV3zNYlJayLv1ay2HXZ9xI1RoLDoATRlTMMxQLRV+EpXcPSo0VUa11fLqcMHon30QPc5TAfCogcUFIFw1YPSiw7JYR1Tz2WaToj3jGjPkAmjQGFvvELuZSdDHkeiRZ0bMnQnuz8u/1wgkaqCEiROtAKJO44hBkpv9td6JUsh+3LUm3gev3du2lwgd2jEhVagoEJPQiMo6gfa6PxreeiusS32C0X+rNgaWoFsooGOSGEpQ48jKnS7KVTSSvos375j3A0GL8oNXmZxUCWQTXrREUmcqCv4CupMGdtOgqCLctjdYQKfO8rHoCRVAiUMa8wqukliWNGHYZ2KFLaJEpGROr6e7khrbIMxgVSLWqQqgVIWu9brXWagtU9pfDz0b1YX09aFRRQFbbyMWqTIIsgGusiPSjwMbLZUvQjpPctvYQf5F0Sid13rpUIgjERxVqaJnZXio7M2e5XR4URF4Ti+uoEzANRH20dHNjy6VQjkbmDdxebWC6YGFNt7WrhBqV68Ah/V5vqCt7gg+rbfv7ehOolEUHh6mTBNKFV0U4PVJdjwlEVn6RPNECks3UQJwP+u3mhyK09Wf3qZJpSUsNs7QeBxSuotmDBjk2aYyBC47dFDlrtyqSahKlOsy259Rr+b1O7upm7DN4pAGy8C8JZM1e3pKXE/LqjalkBkKZRNQewyn03KFwlLZXXtijXcwEtrJpjwk7DKWgLTpt+yAJFQAsz3nbNKWQiFbX1IPdRa+qjyx5yXHR8Myi9VEovzlqt0832VVS1y3fZbDzB6LWhGIXzo5B77SW+JDwy6DVPIhExv7U8JFUcfiUJ0fcnXv+XgK7m8RGKEbVFFs+fl3fZ/Jx9ypa6yLSrx/KvZFxNPhUm7Td4F5BvbYg1/zF2EJmujWPvk5DQXaf9WJDEROe786veX4aVDj3NPynNP6neYv9tvkO8WCsPhI7nv+L96jvvb+1NPRtRj/wPKFWss8U3a+QAAAABJRU5ErkJggg==",wr={class:"form"},Cr={class:"switch"},Ir={class:"label"},_r=Pe({__name:"index",props:{addClassVisible:{type:Boolean,default:!1},folderInfo:{type:Object||void 0,default:void 0}},emits:["close"],setup(a,{emit:i}){const r=a,l=Ms.global.t,o=_t(),u=R(0),t=R(!1),f=R(""),v=R("");Et(()=>r.folderInfo,M=>{M&&(f.value=M.name,u.value=M.ignored)},{immediate:!0});const h=j.debounce(()=>{vt({content:l("message.folderNameCannotExceed"),zIndex:2024,duration:2e3})},200),A=()=>{f.value.trim().length>16&&(h(),f.value=f.value.trim().slice(0,16))},y=()=>{i("close")},b=async()=>{var N;if(!(r!=null&&r.folderInfo)&&o.getMsgFolderList.some(G=>{var Z;return G.name==((Z=f.value)==null?void 0:Z.trim())})){vt({content:l("message.theFolderIsRepeated"),zIndex:2024,duration:3e3});return}t.value=!0;const M=r.folderInfo?await yi({id:r.folderInfo.id,name:f.value,ignored:u.value}):await wi({puid:o.puid,ignored:u.value,name:f.value});if(M.result==1){if(r.folderInfo){if(await o.updateMsgFolderInfo(r.folderInfo.id,{name:f.value,ignored:u.value}),console.log(u.value,r.folderInfo.ignored),u.value!=r.folderInfo.ignored)for(let G of o.getMsgFolderConversations)G.folderId==((N=r.folderInfo)==null?void 0:N.id)&&G.type==Pt.GROUP&&await o.updateDisturb(G.msgId,!!u.value)}else{const G={...M.data,puid:o.puid,isTop:0};o.setMsgFolderList([...o.getMsgFolderList,G]),await window.MessageDbHelper.insertSingleMsgFolder(G)}y()}else M.errorMsg=="文件夹不存在"&&r.folderInfo&&o.deleteMsgFolderInfo(r.folderInfo.id),vt({content:M.errorMsg,zIndex:2024,duration:3e3}),y();t.value=!1};return(M,N)=>{const G=Vs,Z=Wo;return I(),Me(Ts,{visible:!0,options:{"close-on-click-modal":!1},width:"440","confirm-text":r.folderInfo||!t.value?n(l)("message.done"):n(l)("message.creating"),title:n(l)("message.newfolder"),"close-text":n(l)("message.cancel"),"disabeld-confirm":t.value,onClose:y,onConfirm:b},{default:He(()=>[p("div",wr,[Te(G,{ref_key:"folderNameRef",ref:v,modelValue:f.value,"onUpdate:modelValue":N[0]||(N[0]=W=>f.value=W),placeholder:n(l)("message.enterFoldername"),onInput:A},null,8,["modelValue","placeholder"]),p("div",Cr,[p("span",Ir,L(n(l)("message.muteNotifications")),1),gt(),Te(Z,{modelValue:u.value,"onUpdate:modelValue":N[1]||(N[1]=W=>u.value=W),class:"ml-2","active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"#3A8BFF","--el-switch-off-color":"#D0D5DB"}},null,8,["modelValue"])])])]),_:1},8,["confirm-text","title","close-text","disabeld-confirm"])}}});const wo=It(_r,[["__scopeId","data-v-17e0ecdd"]]),Ar=["onClick"],sa=Pe({__name:"index",props:{conversationInfo:{type:Array,required:!0},cancelBtn:{type:Object,default:{text:"取消",callback:()=>!0}},confirmBtn:{type:Object,default:{text:"确定",callback:()=>!0}}},setup(a){const i=a,r=Ms.global.t,l=_t(),o=bs("MoveToFolder"),{getMsgFolderList:u,getMsgFolderConversations:t,showFolderId:f}=Ot(l),v=R(!1),h=R(null),A=()=>{v.value=!0},y=()=>{v.value=!1},b=G=>{G!=f.value&&(h.value=G)},M=R(!1),N=async()=>{var G;if(!M.value){M.value=!0;try{for(let Z of i.conversationInfo){let W=Z.conversationKey!=z.REPLY&&Z.conversationKey!=z.GROUP&&Z.conversationKey!=z.VERIFY&&Z.conversationKey!=z.CXOFFICIAL;Z.type==10&&(W=!1);const Q=W?Z.conversationType==ge.SINGLE?Pt.SINGLE:Pt.GROUP:Pt.SYSTEM,V=Z.conversationKey;let X=W?String(V):Z.type==10?Z.conversationKey:Xt[String(V)];const $=await Ci({type:Q,msgId:X,folderId:h.value,puid:l.puid});if($.result==1){if(await l.moveToSingleFolder({type:Q,folderId:h.value,insertTime:new Date().getTime(),msgId:X,status:1}),Z.conversationType==ge.GROUP&&h.value!="0"){const U=u.value.find(le=>le.id==h.value);U!=null&&U.ignored&&(js().setSilentModeForConversation({conversationId:Z.conversationKey,type:"groupChat",isSilentMode:!!U.ignored}),await l.updateDisturb(Z.conversationKey,!!U.ignored))}}else vt({content:$==null?void 0:$.errorMsg,zIndex:2024,duration:3e3})}(G=i.confirmBtn)==null||G.callback(),M.value=!1}catch(Z){M.value=!1,console.error("confirmHandler error",Z)}}};return(G,Z)=>{const W=Gt,Q=Ws;return I(),Me(Vo,{center:!0,shouldWrapper:!1},{default:He(()=>[v.value?re("",!0):(I(),E("div",{key:0,class:H(n(o).e("cover"))},null,2)),v.value?re("",!0):(I(),E("div",{key:1,class:H(n(o).b())},[p("header",{class:H(n(o).e("header"))},[p("span",{class:H(n(o).e("title"))},L(n(r)("message.moveTo")),3),p("i",{onClick:Z[0]||(Z[0]=()=>{var V,X;(X=(V=i.cancelBtn).callback)==null||X.call(V)}),class:H(n(o).e("close"))},[Te(W,{class:"close_btn","icon-class":"dialog_close",width:"20px",height:"20px"})],2)],2),p("main",{class:H(n(o).e("main"))},[Te(Q,null,{default:He(()=>[p("div",{class:H(["custom-List",n(h)=="0"?"active":""]),onClick:Z[1]||(Z[1]=V=>b("0"))},[p("div",{class:H([n(o).e("treeLabel"),n(f)=="0"?"disabledSelect":""])},"根目录",2)],2),(I(!0),E(Ke,null,ot(n(u),V=>(I(),E("div",{key:V.id,class:H(["custom-List",n(h)==V.id?"active":""]),onClick:X=>b(V.id)},[p("div",{class:H([n(o).e("treeLabel"),n(f)==V.id?"disabledSelect":""])},[gt(L(V.name)+" ",1),V!=null&&V.ignored?(I(),Me(W,{key:0,class:"no_disturb","icon-class":"no_disturb",width:"14px",height:"14px"})):re("",!0)],2)],10,Ar))),128))]),_:1})],2),p("footer",{class:H(n(o).e("footer"))},[p("span",{onClick:A,class:H(n(o).e("createFolder"))},[Te(W,{"icon-class":"create-folder",width:"14",height:"14",color:"#3A8BFF"}),p("span",null,L(n(r)("message.newfolder")),1)],2),p("span",{class:H(n(o).e("right"))},[p("div",{onClick:Z[2]||(Z[2]=()=>{var V,X;(X=(V=i.cancelBtn).callback)==null||X.call(V)}),class:H(n(o).e("cancel"))},L(i.cancelBtn.text),3),p("div",{onClick:N,class:H([n(o).e("confirm"),n(o).is("disabled",!n(h))])},L(i.confirmBtn.text),3)],2)],2)],2)),v.value?(I(),Me(wo,{key:2,onClose:y})):re("",!0)]),_:1})}}});const na=a=>(ss("data-v-c7bc1a11"),a=a(),ns(),a),Sr={class:"check_btn"},Tr={class:"common_checkbox allCheck"},Mr=na(()=>p("label",{class:"icon_checkbox"},null,-1)),Rr=["disabled"],Er=["disabled"],br={class:"common_checkbox"},xr=["onUpdate:modelValue"],Nr=na(()=>p("label",{class:"icon_checkbox"},null,-1)),kr={key:0,class:"avator",src:ta,alt:"",draggable:"false"},Br={key:1,class:"avator",src:mo,alt:"",draggable:"false"},Lr={key:2,class:"avator",src:vo,alt:"",draggable:"false"},Ur={key:3,class:"avator",src:ho,alt:"",draggable:"false"},Dr={key:4,class:"avator",src:yo,alt:"",draggable:"false"},Fr={key:5,class:"avator",src:Qo,alt:"",draggable:"false"},Hr={key:6,class:"avator",src:lo,alt:"",draggable:"false"},Pr={key:7,src:vs,class:"avator",alt:"",draggable:"false"},Or={class:"name"},Gr={key:9,class:"remark"},Kr=Pe({__name:"index",setup(a){const{t:i}=ts(),r=Rs(),l={reply:i("message.comments"),verify:i("message.vinformation"),group:i("message.groupInvitation"),cxofficial:i("message.cxofficial")},o=bs("multiple"),u=R(!0),t=_t(),{conversationListData:f,getReplyConversation:v,getGroupConversation:h,showFolderId:A,getCxofficialConversation:y,getVerifyConversation:b,getMsgFolderConversations:M,getMsgFolderList:N}=Ot(t),G=Re(()=>$.value.filter(te=>te.isChecked).some(te=>"id"in te)),Z=Re(()=>{const te=$.value.filter(ae=>ae.isChecked),P=Object.keys(l);return te.length==0||te.some(ae=>P.includes(ae.conversationKey))}),W=()=>{if(G.value)return;const{destroy:te}=Lt(sa,{conversationInfo:$.value.filter(P=>P.isChecked),cancelBtn:{text:i("message.cancel"),callback(){te()}},confirmBtn:{text:i("message.done"),callback(){$.value=U(),te()}}})},Q=()=>{if(Z.value)return;const{destroy:te}=Lt(Tn,{title:i("message.reminder"),content:i("message.batchDelete"),cancelBtn:{text:i("message.cancel"),callback(){te()}},confirmBtn:{text:i("message.delete"),async callback(){for(let P of $.value.filter(ae=>ae.isChecked))"id"in P?(await uo({id:P.id,puid:t.puid})).result==1&&t.deleteMsgFolderInfo(P.id):(t.getCurrentChatId==P.conversationKey&&(r.push("/message/msgcover"),t.setChatTargetId(0)),await t.deleteConversationItem(P.conversationKey,P.conversationType==ge.GROUP),await Ps({msgId:P.conversationKey,puid:t.puid,type:P.conversationType==ge.GROUP?Pt.GROUP:Pt.SINGLE,status:0}));$.value=U(),te()}}})},V=()=>{$.value.forEach(te=>te.isChecked=u.value)},X=()=>{t.setMultipleEditStatus(!1)},$=R([]),U=()=>{let te=[];try{te=j.values(f.value).concat(v.value).concat(h.value).concat(b.value),t.hasCxOfficial&&(te=te.concat(y.value))}catch{te=j.values(f.value)}if(A.value!="0"){let P=le(A.value,te);return P.forEach(ae=>ae.isChecked=!1),j.sortBy(P,[ae=>!ae.isTop,ae=>ae.isTop?(ae==null?void 0:ae.sort)||0:-Math.max(ae==null?void 0:ae.latestSendTime,(ae==null?void 0:ae.draftTime)||0,(ae==null?void 0:ae.topTime)||0)])}else{let P=[];N.value.forEach(_=>{var pe;let F={};const K=le(_.id,te);F={..._,unreadMessageNum:j.sumBy(K.filter(J=>!J.isNoDisturb),J=>J.unreadMessageNum)||0,latestSendTime:((pe=j.maxBy(K,J=>J.latestSendTime))==null?void 0:pe.latestSendTime)||_.updateTime},P.push(F)});let ae=te.filter(_=>!M.value.some(F=>_.conversationKey==Ss[F.msgId]||_.conversationKey==F.msgId)),ue=[];ue=[...P,...ae],ue.forEach(_=>_.isChecked=!1);let x={};for(let _ of ue)_.isTop=0,"id"in _?x[_.id]=_:_.conversationKey&&(x[_.conversationKey]=_);for(let _ of t.getTopConversation){let F=x[_.sessionId];F&&(F.isTop=1,F.sort=_.sort||0)}return j.sortBy(ue,[_=>!_.isTop,_=>_.isTop?(_==null?void 0:_.sort)||0:"id"in _?-Math.max(_.latestSendTime||_.updateTime):-Math.max(_==null?void 0:_.latestSendTime,(_==null?void 0:_.draftTime)||0,(_==null?void 0:_.topTime)||0)])}},le=(te,P)=>{let ae=[];M.value.forEach(x=>{x.folderId==te&&(x.msgId in Ss?ae.push(Ss[x.msgId]):ae.push(x.msgId))});const ue=P.filter(x=>ae.includes(x.conversationKey));for(let x of ue){x.isTop=0;for(let _ of t.getTopConversation)x.conversationKey==_.sessionId&&(x.isTop=1,_.sort=x.sort||0)}return ue},he=Re(()=>$.value.every(te=>te.isChecked));Et(()=>he.value,te=>{u.value=te},{immediate:!0});const{list:ce,containerProps:O,wrapperProps:ie}=Ga($,{itemHeight:64,overscan:5});return console.log(111,ce),ls(()=>{$.value=U()}),(te,P)=>{const ae=co,ue=Gt;return I(),E("div",{class:H(n(o).b())},[p("div",{class:H([n(o).e("header")])},[p("div",Sr,[p("span",Tr,[Ct(p("input",{type:"checkbox","onUpdate:modelValue":P[0]||(P[0]=x=>u.value=x),onChange:V},null,544),[[Ro,u.value]]),Mr]),gt(" "+L(n(i)("message.all")),1)]),p("div",{class:H([n(o).e("btn")])},[p("button",{onClick:W,disabled:n(G),class:H(n(G)?"move_disabled":"move")},L(n(i)("message.move")),11,Rr)],2),p("div",{class:H([n(o).e("btn")])},[p("button",{onClick:Q,disabled:n(Z),class:H([n(Z)?"delete_disabled":"delete","delete"])},L(n(i)("message.delete")),11,Er)],2),p("div",{class:H([n(o).e("quit")]),onClick:X},L(n(i)("message.exit")),3)],2),p("div",Eo({class:[n(o).e("content")]},n(O)),[p("div",Eo({class:n(o).e("wrapper")},n(ie)),[(I(!0),E(Ke,null,ot(n(ce),x=>{var _,F,K,pe,J,fe,oe,_e,At,Nt,Oe,Ne,De,Ze,St;return I(),E("div",{key:"id"in x.data?x.data.id:x.data.conversationKey,class:H(n(o).e("multiple_item"))},[p("span",br,[Ct(p("input",{type:"checkbox","onUpdate:modelValue":kt=>x.data.isChecked=kt},null,8,xr),[[Ro,x.data.isChecked]]),Nr]),"id"in x.data?(I(),E("img",kr)):x.data.conversationKey==n(z).REPLY?(I(),E("img",Br)):x.data.conversationKey==n(z).GROUP?(I(),E("img",Lr)):x.data.conversationKey==n(z).VERIFY?(I(),E("img",Ur)):x.data.conversationKey==n(z).CXOFFICIAL?(I(),E("img",Dr)):((F=(_=x.data)==null?void 0:_.conversationInfo)==null?void 0:F.avatarUrl[0])==n(at).COURSE?(I(),E("img",Fr)):((pe=(K=x.data)==null?void 0:K.conversationInfo)==null?void 0:pe.avatarUrl[0])==n(at).CLASS?(I(),E("img",Hr)):((fe=(J=x.data)==null?void 0:J.conversationInfo)==null?void 0:fe.avatarUrl[0])=="default"||((_e=(oe=x.data)==null?void 0:oe.conversationInfo)==null?void 0:_e.avatarUrl[0])=="cximg://default"||((Nt=(At=x.data)==null?void 0:At.conversationInfo)==null?void 0:Nt.avatarUrl[0])=="headerimg://default"?(I(),E("img",Pr)):(I(),Me(ae,{ref_for:!0,ref:"imgAvatorRef",key:x.data.conversationKey,"img-list":(Oe=x.data)==null?void 0:Oe.conversationInfo.avatarUrl,style:{margin:"0 10px","flex-shrink":"0"}},null,8,["img-list"])),p("div",Or,L("id"in x.data?x.data.name:((De=(Ne=x.data)==null?void 0:Ne.conversationInfo)==null?void 0:De.name)||l[x.data.conversationKey]),1),x.data.isTop?(I(),E("div",Gr,L(n(i)("message.top")),1)):re("",!0),("id"in x.data?(Ze=x.data)!=null&&Ze.ignored:(St=x.data)!=null&&St.isNoDisturb)?(I(),Me(ue,{key:10,class:"no_disturb","icon-class":"no_disturb",width:"14px",height:"14px"})):re("",!0)],2)}),128))],16)],16)],2)}}});const Qr=It(Kr,[["__scopeId","data-v-c7bc1a11"]]),Vr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAABICAYAAAC6L9h5AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQbSURBVHgB7Zy/TxRBFMffLGD8AUoBhRRCohKl0NOzsVCgFhKUWFDaYGvkD+DoJaGFxpLKX8Fe0JYLF038QUyU5ii0gCA0yq7z3b3Jzi57MuLOXAzvkyx3t8tdbj+Z9+bN28sKSnHladAvdmmEPBoRRD10GAioEpDcBJVWRsVa+rBQTwqPg3bvJE3KHQ/oEBP4NOP/oKnKPbGh9oWSIKipjV7JVwViwpG1u0WDSpQX/pEjiAVpSBdeq3SiXhbmg56mI/SFmD34ggZW7oglz2uJjTFJwglM4smkxGFWD68miXNRfVQJ5BGzLyzJAJZkAEsygCUZwJIMYEkGsCQDWJIBLMkAlmQASzKAJRnQTA2grYVooIvoagfRtU6i1pZoH1iVDdPqDtFilaj8nWh9hxqOU0kQMXZWbudjKWl626MNEsGCvHYx96GxspxJGjpDNHE5W44u4PTx5LHh7mibey+3j9QQnEgavyC3vuS+xXWi+c9ReG39jPdDIkbSsJQ61K19Rl90bPodOUcUnwQBWSQtCHmmtGwWPl1yVI1fTMpC+E2VyRnlUSGszm4IE10Qcsv91+b5BQm8VI7ep38m8ppLrElSo0CBE9VP9m/A+6bfxq+R23pPkTOsSYIglYQRYgcVpED+wqaYuETOsCIJo0jPI8hBeQDRKskXO92NJiuScAIKJNq8ahwI0keTqqVsY0VSv/bll6qUKy+1H8YUO8gJdsLtWPwc+ShPMOOpkEM95QIrktSXx8nohWJerG9Hjygu0xW6DazWSTYE2fzcenCrxAArktRshlKg3mr/X9BzkYvugBVJnzbj53nXMrr41Q1yghVJ5W/x87xrGb0Gy3vmrIcVSXotg8o7z5DT14Not7jAiiTMPkoUBD3MaZ2Ftou+HtRHrE2szW76OiuP9gaqa73toncFbGNNEipjfeWP9sZBRUHQo+vxa6wHXSVtYLVOwmJUz08QNVk0r5IRqgix2ZvJvIbJwGU/yXr7FpSKydZJdTvKKWGPe3Pv/0Mietx/uqqCUEaXM+v9eYL2rRNJALOSPjMpcLJ66HSdyB5pEIrwnb2RXBvaFuVUEshq7O+H6mqqmQwjy6Uo55IUkDV2LjrRrJ4QThhSUAdlTfMuRTVMUho9vEzXYq5EWb+kZArEqM2UUMqbOJ+p3xfY4L9ulShRKDOQuxbWyAoN+VVJnkBUyfIVXW66GcCSDGBJBrAkA1iSASzJAJZkAEsygCUZwJIMYEkGsCQDWJIBnuy4fSUmm4AqeMBIek5MNqImKRAsqR7+USrh0cP9gWTIzRCTALctW7kV3d8tTNy+R1Mq/hgZZdKF3yyd1AglVW6Ljd0mGuQRFY2gX9IFnKh9Iv1PhWdBT5Nfu8dbcDjurYQZ3sME5tOL5btiMX38N6/KV9iDcG2qAAAAAElFTkSuQmCC",Wr=a=>(ss("data-v-7a56a463"),a=a(),ns(),a),Jr=["id"],qr={class:"affix_box_img"},Xr=Wr(()=>p("img",{src:ta,alt:"",draggable:"false"},null,-1)),$r={key:0,class:H(["badge"])},zr={class:"affix_box_text"},Yr={class:"affix_box_text_main"},Zr={class:"vin_text"},jr={key:0,class:"remark"},el={class:"time"},tl=Pe({__name:"index",props:{folderInfo:{type:Object,default:()=>{}},isHoverBorder:{type:Boolean,default:!0}},emits:["rightClick","handleClick"],setup(a,{emit:i}){const r=a,{t:l}=ts(),o=window.RendererHelper.getPlatform()!="darwin";let u=R(!1);const t=v=>{v.preventDefault(),i("rightClick",v,r.folderInfo),r.isHoverBorder&&(u.value=!0),xe.windowClickOnce(()=>u.value=!1)},f=()=>{i("handleClick",r.folderInfo)};return(v,h)=>{var y,b,M,N;const A=Gt;return I(),E("div",{id:r.folderInfo.id,class:H(["affix_box",n(u)?"affix_box_cover":""]),onClick:f,onContextmenu:t},[p("div",qr,[Xr,(y=r.folderInfo)!=null&&y.unreadMessageNum?(I(),E("div",$r,[p("div",{class:H(["text",o?"":"lineHeight16",r.folderInfo.unreadMessageNum>99?"b-number":""])},L(r.folderInfo.unreadMessageNum>99?"99+":r.folderInfo.unreadMessageNum),3)])):re("",!0)]),p("div",zr,[p("div",Yr,[p("div",Zr,L(r.folderInfo.name),1),(b=r.folderInfo)!=null&&b.isTop?(I(),E("div",jr,L(n(l)("message.top")),1)):re("",!0),r.folderInfo.ignored?(I(),Me(A,{key:1,class:"no_disturb","icon-class":"no_disturb",width:"14px",height:"14px"})):re("",!0)]),p("div",el,L((M=r.folderInfo)!=null&&M.latestSendTime?n(xe).timeago((N=r.folderInfo)==null?void 0:N.latestSendTime):n(l)("message.folder")),1)])],42,Jr)}}});const oa=It(tl,[["__scopeId","data-v-7a56a463"]]);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const aa=Symbol("Comlink.proxy"),sl=Symbol("Comlink.endpoint"),nl=Symbol("Comlink.releaseProxy"),qn=Symbol("Comlink.finalizer"),Sn=Symbol("Comlink.thrown"),ia=a=>typeof a=="object"&&a!==null||typeof a=="function",ol={canHandle:a=>ia(a)&&a[aa],serialize(a){const{port1:i,port2:r}=new MessageChannel;return la(a,i),[r,[r]]},deserialize(a){return a.start(),ua(a)}},al={canHandle:a=>ia(a)&&Sn in a,serialize({value:a}){let i;return a instanceof Error?i={isError:!0,value:{message:a.message,name:a.name,stack:a.stack}}:i={isError:!1,value:a},[i,[]]},deserialize(a){throw a.isError?Object.assign(new Error(a.value.message),a.value):a.value}},ra=new Map([["proxy",ol],["throw",al]]);function il(a,i){for(const r of a)if(i===r||r==="*"||r instanceof RegExp&&r.test(i))return!0;return!1}function la(a,i=globalThis,r=["*"]){i.addEventListener("message",function l(o){if(!o||!o.data)return;if(!il(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:u,type:t,path:f}=Object.assign({path:[]},o.data),v=(o.data.argumentList||[]).map(As);let h;try{const A=f.slice(0,-1).reduce((b,M)=>b[M],a),y=f.reduce((b,M)=>b[M],a);switch(t){case"GET":h=y;break;case"SET":A[f.slice(-1)[0]]=As(o.data.value),h=!0;break;case"APPLY":h=y.apply(A,v);break;case"CONSTRUCT":{const b=new y(...v);h=fa(b)}break;case"ENDPOINT":{const{port1:b,port2:M}=new MessageChannel;la(a,M),h=dl(b,[b])}break;case"RELEASE":h=void 0;break;default:return}}catch(A){h={value:A,[Sn]:0}}Promise.resolve(h).catch(A=>({value:A,[Sn]:0})).then(A=>{const[y,b]=En(A);i.postMessage(Object.assign(Object.assign({},y),{id:u}),b),t==="RELEASE"&&(i.removeEventListener("message",l),ca(i),qn in a&&typeof a[qn]=="function"&&a[qn]())}).catch(A=>{const[y,b]=En({value:new TypeError("Unserializable return value"),[Sn]:0});i.postMessage(Object.assign(Object.assign({},y),{id:u}),b)})}),i.start&&i.start()}function rl(a){return a.constructor.name==="MessagePort"}function ca(a){rl(a)&&a.close()}function ua(a,i){return so(a,[],i)}function wn(a){if(a)throw new Error("Proxy has been released and is not useable")}function da(a){return Ds(a,{type:"RELEASE"}).then(()=>{ca(a)})}const Mn=new WeakMap,Rn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(a=>{const i=(Mn.get(a)||0)-1;Mn.set(a,i),i===0&&da(a)});function ll(a,i){const r=(Mn.get(i)||0)+1;Mn.set(i,r),Rn&&Rn.register(a,i,a)}function cl(a){Rn&&Rn.unregister(a)}function so(a,i=[],r=function(){}){let l=!1;const o=new Proxy(r,{get(u,t){if(wn(l),t===nl)return()=>{cl(o),da(a),l=!0};if(t==="then"){if(i.length===0)return{then:()=>o};const f=Ds(a,{type:"GET",path:i.map(v=>v.toString())}).then(As);return f.then.bind(f)}return so(a,[...i,t])},set(u,t,f){wn(l);const[v,h]=En(f);return Ds(a,{type:"SET",path:[...i,t].map(A=>A.toString()),value:v},h).then(As)},apply(u,t,f){wn(l);const v=i[i.length-1];if(v===sl)return Ds(a,{type:"ENDPOINT"}).then(As);if(v==="bind")return so(a,i.slice(0,-1));const[h,A]=Uo(f);return Ds(a,{type:"APPLY",path:i.map(y=>y.toString()),argumentList:h},A).then(As)},construct(u,t){wn(l);const[f,v]=Uo(t);return Ds(a,{type:"CONSTRUCT",path:i.map(h=>h.toString()),argumentList:f},v).then(As)}});return ll(o,a),o}function ul(a){return Array.prototype.concat.apply([],a)}function Uo(a){const i=a.map(En);return[i.map(r=>r[0]),ul(i.map(r=>r[1]))]}const ga=new WeakMap;function dl(a,i){return ga.set(a,i),a}function fa(a){return Object.assign(a,{[aa]:!0})}function En(a){for(const[i,r]of ra)if(r.canHandle(a)){const[l,o]=r.serialize(a);return[{type:"HANDLER",name:i,value:l},o]}return[{type:"RAW",value:a},ga.get(a)||[]]}function As(a){switch(a.type){case"HANDLER":return ra.get(a.name).deserialize(a.value);case"RAW":return a.value}}function Ds(a,i,r){return new Promise(l=>{const o=gl();a.addEventListener("message",function u(t){!t.data||!t.data.id||t.data.id!==o||(a.removeEventListener("message",u),l(t.data))}),a.start&&a.start(),a.postMessage(Object.assign({id:o},i),r)})}function gl(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const fl=["onClick"],pl=["src"],ml=Pe({__name:"member-list",props:{memberList:{type:Array,default:()=>[]},comkey:{type:String,default:""}},emits:["choose"],setup(a,{emit:i}){const r=a,l=Ms.global.t,o=bs("member"),{memberList:u,comkey:t}=rn(r),f=Re(()=>{const A=u.value.filter(N=>N.role==3),y=u.value.filter(N=>N.owner),b=u.value.filter(N=>N.admin),M=u.value.filter(N=>!N.admin&&!N.owner&&N.role!=3);return j.uniqBy(A.concat(y).concat(b).concat(M),"uid")}),v=A=>{},h=A=>A.role==3?l("message.iCService"):A.admin?l("message.admin"):A.owner?l("message.owner"):"";return(A,y)=>(I(),E("div",{class:H([n(o).b()])},[(I(!0),E(Ke,null,ot(n(f),b=>(I(),E("div",{class:H([n(o).e("memberItem")]),key:b.uid,onClick:M=>v()},[p("img",{class:H([n(o).e("img")]),src:b.pic,alt:""},null,10,pl),p("span",{class:H([n(o).e("name")])},L(b.name),3),p("span",{class:H([n(o).e("role"),b.admin?"admin":"",b.owner?"creator":"",b.role==3?"kefu":""])},L(h(b)),3)],10,fl))),128))],2))}});const vl=It(ml,[["__scopeId","data-v-4e43cbba"]]),hl=a=>(ss("data-v-a18ed116"),a=a(),ns(),a),yl={class:"form"},wl={class:"group_content"},Cl={class:"group_form"},Il={key:0,class:"form_invite"},_l={class:"code"},Al={class:"code_num"},Sl={class:"desc"},Tl={class:"code_img"},Ml=["src"],Rl={class:"expire"},El={class:"group_form_addmember group_form_item"},bl={class:"group_form_name"},xl={class:"group_form_btn"},Nl=hl(()=>p("div",{class:"drive"},null,-1)),kl={class:"memberlist"},Bl={class:"title"},Ll=Pe({__name:"index",props:{addClassVisible:{type:Boolean,default:!1}},emits:["close"],setup(a,{emit:i}){const{t:r}=ts(),l=_t(),o=Es(),{getAddGroupsMember:u}=Ot(o),{getUserInfo:t}=Ot(l),f=Rs(),v=R(""),h=R(""),A=R({}),y=R();R(!1);const b=R(!1),M=R({}),N=R(!1);ls(()=>{mt(()=>{const x=setTimeout(()=>{y.value.focus(),clearTimeout(x)})})});const G=Re(()=>u.value||[]),Z=j.debounce(()=>{vt({content:r("message.nameCannotExceed"),zIndex:2024,duration:2e3})},200),W=()=>{v.value.trim().length>16&&(Z(),v.value=v.value.trim().slice(0,16))},Q=()=>{navigator.clipboard.writeText(M.value.invitecode),vt({content:r("message.ichbCopied"),zIndex:2147483647,duration:2e3})},V=()=>{const x=G.value.slice(0,4).map(F=>F.pic),_=Xo({data:{groupId:h.value,groupName:v.value,inviteCode:M.value.invitecode,listPic:x}});window.RendererHelper.openWindow("https://im.chaoxing.com/res/studyForward/index.html",{width:640,height:fo,frame:!1,modal:!0,resizable:!1,subWindow:!0,id:"studyForward"},{attachment:j.cloneDeep(_)})},X=async x=>{let _={baseUrl:"https://mooc1-api.chaoxing.com",url:"/clazz/getinvitationcode",getParams:{},postParams:{courseId:A.value.courseid,clazzId:A.value.clazzid,cpi:""},tokenSign:!0};const F=await window.MainWindowHelper.genRequest(_);if(F.result==1){M.value=F.data,M.value.expireTimeText=r("message.invitationCodeEffectiveTime",{expireTime:to(F.data.validtime)});try{const J=await window.RendererHelper.downloadImage(F.data.cls2dbcurl,"png"),fe=await xe.ImgToBase64(J);M.value.codeUrl=fe}catch(J){console.log("请求班级邀请码",J)}let K={};$.value.description?K={...JSON.parse($.value.description),showQRCode:1}:K={showQRCode:1};let pe={baseUrl:"https://learn.chaoxing.com",url:"/apis/im/updatetChatGroupsInfo",getParams:{groupid:x},postParams:{desc:JSON.stringify(K)},tokenSign:!0};window.MainWindowHelper.genRequest(pe).then(J=>{console.log("已开启班级邀请码",J)})}},$=R({}),U=async(x,_=!1)=>{let F={},K=[];if(_){const fe=l.getCurrentChatId,oe=await o.updateGroupInfo(x,t.value.loginId,String(fe));F=oe.groupDetail,K=oe.allMembers}else{const fe=l.getCurrentChatId,oe=await o.initGroupInfo(x,t.value.loginId,String(fe));F=oe.groupDetail,K=oe.allMembers}$.value=F,K=j.orderBy(K,[fe=>fe.owner?-1:1,fe=>fe.admin?-1:1,fe=>String(fe.uid)]);let pe=[],J="";if(!F.description)pe=K.slice(0,4).map(fe=>fe.pic),J=F.name?F.name:K.slice(0,4).map(fe=>fe.name).join("、");else{let fe=JSON.parse(F.description),oe={};Object.keys(le).includes(String(fe.groupType))?(oe=le[fe.groupType](F,K),pe=oe.groupImgs,J=oe.groupName):(oe=he(K,F),pe=oe.groupImgs,J=oe.groupName)}return{groupName:J,groupImgs:pe}},le={[qe.NORMAL]:(x,_)=>he(_,x),[qe.COURSE]:(x,_)=>ce(x,at.COURSE,_),[qe.GROUP]:(x,_)=>he(_,x),[qe.DEPT]:(x,_)=>he(_,x),[qe.CLASS]:(x,_)=>ce(x,at.CLASS,_),[qe.INTERACTION]:(x,_)=>he(_,x)},he=(x,_)=>{const F=j.orderBy(x,[J=>J.owner?-1:1,J=>J.admin?-1:1,J=>String(J.uid)]),K=F.slice(0,4).map(J=>J.pic),pe=_.name?_.name:F.slice(0,4).map(J=>J.name).join("、");return{groupImgs:K,groupName:pe}},ce=(x,_,F)=>{const K=j.orderBy(F,[oe=>oe.owner?-1:1,oe=>oe.admin?-1:1,oe=>String(oe.uid)]),pe=[_],J=JSON.parse(x.description),fe=x.name?x.name:J&&J.courseInfo&&J.courseInfo.coursename?J.courseInfo.coursename:K.slice(0,4).map(oe=>oe.name).join("、");return{groupImgs:pe,groupName:fe}},O=()=>{N.value=!0;let x={baseUrl:"https://cv-p.chaoxing.com",url:"/classSpace/addChat",getParams:{},postParams:{className:v.value},tokenSign:!0,allParamSign:!0};window.MainWindowHelper.genRequest(x).then(async _=>{if(console.log(_),_.result==1){o.setAddGroupId(String(_.info.chatId));const{groupName:F,groupImgs:K}=await U(String(_.info.chatId),!0);await l.gatherConversation(String(_.info.chatId),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:F,pic:K,chatType:ge.GROUP}}),b.value=!0,h.value=String(_.info.chatId),A.value=_.info,X(h.value)}}).finally(()=>{N.value=!1})},ie=R([]),te=async()=>{const x=G.value.map(J=>({uid:Number(J.uid),name:J.name,puid:Number(J.puid)}));let _=[];try{_=(await $o({peopleList:x})).filter(J=>J.uid!=null)}catch(J){console.error(J)}if(!_||(_==null?void 0:_.length)<1)return;let F=_.map(J=>({puid:J.puid}));const K=ie.value.filter(J=>F.some(fe=>fe.puid==J.thePuid));if(K.length&&vt({content:K.map(J=>J.name).join("、")+r("message.groupDeclineInvite"),zIndex:2024,duration:2e3}),F=F.filter(J=>!G.value.some(fe=>fe.puid==J.puid)&&!ie.value.some(fe=>fe.thePuid==J.puid)),!F.length)return;let pe={baseUrl:"https://cv-p.chaoxing.com",url:"/classSpace/addSpaceUser",getParams:{opUser:l.puid},postParams:{role:3,chatId:h.value,userIds:F.map(J=>J.puid).join(",")},genSign:!0,tokenSign:!0};window.MainWindowHelper.genRequest(pe).then(async J=>{if(J.result==1){let oe={baseUrl:"https://learn.chaoxing.com",url:"/apis/im/addUsersToGroupBatchFor104V2",getParams:await zo({isAttachChatHistory:!1,groupId:h.value}),postParams:{users:JSON.stringify(F)},tokenSign:!0,allParamSign:!0};window.MainWindowHelper.genRequest(oe).then(_e=>{console.log(_e)})}}),await P()},P=async()=>{try{const x=await window.MainWindowHelper.searchLocalShieldMeData();if(ie.value=x&&x.length?x:[],(await window.MainWindowHelper.syncAllBlacklist()).state==0){console.log("增量更新完毕");const F=await window.MainWindowHelper.searchLocalShieldMeData();ie.value=F&&F.length?F:[]}}catch{}},ae=()=>{i("close")},ue=()=>{l.setChatTargetId(h.value),f.push({path:"/message/conversation",query:{id:h.value,chatType:ge.GROUP,t:new Date().getTime()}}),v.value="",o.initAddGroupMember(),i("close")};return(x,_)=>{const F=Vs,K=Gt,pe=Ws;return I(),E(Ke,null,[Te(Ts,{visible:!0,options:{"close-on-click-modal":!1},width:"440","confirm-text":N.value?n(r)("message.creating"):n(r)("message.done"),title:n(r)("message.newClass"),"close-text":n(r)("message.cancel"),"disabeld-confirm":N.value,onClose:ae,onConfirm:O},{default:He(()=>[p("div",yl,[Te(F,{ref_key:"groupNameRef",ref:y,modelValue:v.value,"onUpdate:modelValue":_[0]||(_[0]=J=>v.value=J),placeholder:n(r)("message.writeClassName"),onInput:W},null,8,["modelValue","placeholder"])])]),_:1},8,["confirm-text","title","close-text","disabeld-confirm"]),b.value?(I(),Me(Ts,{key:0,visible:!0,options:{"close-on-click-modal":!1},width:"640","confirm-text":n(r)("message.done"),"close-text":"",title:v.value,onClose:ue,onConfirm:ue,exBtn:[{text:n(r)("message.retransmission"),callback:V}]},{default:He(()=>[Te(pe,{class:"group_init"},{default:He(()=>[p("div",wl,[p("div",Cl,[M.value&&Object.keys(M.value).length?(I(),E("div",Il,[p("div",_l,[gt(L(n(r)("message.calssInvitationCode"))+": ",1),p("span",Al,[gt(L(M.value.invitecode)+" ",1),Te(K,{"icon-class":"copy_code",width:"14px",height:"14px",onClick:Q,style:{cursor:"pointer"}})])]),p("div",Sl,L(n(r)("message.enterRightHome")),1),p("div",Tl,[p("img",{src:M.value.codeUrl,alt:""},null,8,Ml)]),p("div",Rl,L(n(r)("message.invitationCodeEffectiveTime",{expireTime:n(to)(M.value.validtime)})),1)])):re("",!0),p("div",El,[p("div",bl,L(n(r)("message.addMembers")),1),p("div",xl,[p("div",{class:"add_btn",onClick:te},[Te(K,{"icon-class":"group_add",width:"10px",height:"10px",color:"#3A8BFF"}),p("span",null,L(n(r)("message.add")),1)])])])]),Nl,p("div",kl,[p("div",Bl,L(n(r)("message.members"))+"("+L(n(G).length)+")",1),Te(vl,{"member-list":n(G)},null,8,["member-list"])])])]),_:1})]),_:1},8,["confirm-text","title","exBtn"])):re("",!0)],64)}}});const Ul=It(Ll,[["__scopeId","data-v-a18ed116"]]);var ln={},Dl=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},pa={},Ut={};let Co;const Fl=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];Ut.getSymbolSize=function(i){if(!i)throw new Error('"version" cannot be null or undefined');if(i<1||i>40)throw new Error('"version" should be in range from 1 to 40');return i*4+17};Ut.getSymbolTotalCodewords=function(i){return Fl[i]};Ut.getBCHDigit=function(a){let i=0;for(;a!==0;)i++,a>>>=1;return i};Ut.setToSJISFunction=function(i){if(typeof i!="function")throw new Error('"toSJISFunc" is not a valid function.');Co=i};Ut.isKanjiModeEnabled=function(){return typeof Co<"u"};Ut.toSJIS=function(i){return Co(i)};var kn={};(function(a){a.L={bit:1},a.M={bit:0},a.Q={bit:3},a.H={bit:2};function i(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return a.L;case"m":case"medium":return a.M;case"q":case"quartile":return a.Q;case"h":case"high":return a.H;default:throw new Error("Unknown EC Level: "+r)}}a.isValid=function(l){return l&&typeof l.bit<"u"&&l.bit>=0&&l.bit<4},a.from=function(l,o){if(a.isValid(l))return l;try{return i(l)}catch{return o}}})(kn);function ma(){this.buffer=[],this.length=0}ma.prototype={get:function(a){const i=Math.floor(a/8);return(this.buffer[i]>>>7-a%8&1)===1},put:function(a,i){for(let r=0;r<i;r++)this.putBit((a>>>i-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(a){const i=Math.floor(this.length/8);this.buffer.length<=i&&this.buffer.push(0),a&&(this.buffer[i]|=128>>>this.length%8),this.length++}};var Hl=ma;function cn(a){if(!a||a<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=a,this.data=new Uint8Array(a*a),this.reservedBit=new Uint8Array(a*a)}cn.prototype.set=function(a,i,r,l){const o=a*this.size+i;this.data[o]=r,l&&(this.reservedBit[o]=!0)};cn.prototype.get=function(a,i){return this.data[a*this.size+i]};cn.prototype.xor=function(a,i,r){this.data[a*this.size+i]^=r};cn.prototype.isReserved=function(a,i){return this.reservedBit[a*this.size+i]};var Pl=cn,va={};(function(a){const i=Ut.getSymbolSize;a.getRowColCoords=function(l){if(l===1)return[];const o=Math.floor(l/7)+2,u=i(l),t=u===145?26:Math.ceil((u-13)/(2*o-2))*2,f=[u-7];for(let v=1;v<o-1;v++)f[v]=f[v-1]-t;return f.push(6),f.reverse()},a.getPositions=function(l){const o=[],u=a.getRowColCoords(l),t=u.length;for(let f=0;f<t;f++)for(let v=0;v<t;v++)f===0&&v===0||f===0&&v===t-1||f===t-1&&v===0||o.push([u[f],u[v]]);return o}})(va);var ha={};const Ol=Ut.getSymbolSize,Do=7;ha.getPositions=function(i){const r=Ol(i);return[[0,0],[r-Do,0],[0,r-Do]]};var ya={};(function(a){a.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const i={N1:3,N2:3,N3:40,N4:10};a.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},a.from=function(o){return a.isValid(o)?parseInt(o,10):void 0},a.getPenaltyN1=function(o){const u=o.size;let t=0,f=0,v=0,h=null,A=null;for(let y=0;y<u;y++){f=v=0,h=A=null;for(let b=0;b<u;b++){let M=o.get(y,b);M===h?f++:(f>=5&&(t+=i.N1+(f-5)),h=M,f=1),M=o.get(b,y),M===A?v++:(v>=5&&(t+=i.N1+(v-5)),A=M,v=1)}f>=5&&(t+=i.N1+(f-5)),v>=5&&(t+=i.N1+(v-5))}return t},a.getPenaltyN2=function(o){const u=o.size;let t=0;for(let f=0;f<u-1;f++)for(let v=0;v<u-1;v++){const h=o.get(f,v)+o.get(f,v+1)+o.get(f+1,v)+o.get(f+1,v+1);(h===4||h===0)&&t++}return t*i.N2},a.getPenaltyN3=function(o){const u=o.size;let t=0,f=0,v=0;for(let h=0;h<u;h++){f=v=0;for(let A=0;A<u;A++)f=f<<1&2047|o.get(h,A),A>=10&&(f===1488||f===93)&&t++,v=v<<1&2047|o.get(A,h),A>=10&&(v===1488||v===93)&&t++}return t*i.N3},a.getPenaltyN4=function(o){let u=0;const t=o.data.length;for(let v=0;v<t;v++)u+=o.data[v];return Math.abs(Math.ceil(u*100/t/5)-10)*i.N4};function r(l,o,u){switch(l){case a.Patterns.PATTERN000:return(o+u)%2===0;case a.Patterns.PATTERN001:return o%2===0;case a.Patterns.PATTERN010:return u%3===0;case a.Patterns.PATTERN011:return(o+u)%3===0;case a.Patterns.PATTERN100:return(Math.floor(o/2)+Math.floor(u/3))%2===0;case a.Patterns.PATTERN101:return o*u%2+o*u%3===0;case a.Patterns.PATTERN110:return(o*u%2+o*u%3)%2===0;case a.Patterns.PATTERN111:return(o*u%3+(o+u)%2)%2===0;default:throw new Error("bad maskPattern:"+l)}}a.applyMask=function(o,u){const t=u.size;for(let f=0;f<t;f++)for(let v=0;v<t;v++)u.isReserved(v,f)||u.xor(v,f,r(o,v,f))},a.getBestMask=function(o,u){const t=Object.keys(a.Patterns).length;let f=0,v=1/0;for(let h=0;h<t;h++){u(h),a.applyMask(h,o);const A=a.getPenaltyN1(o)+a.getPenaltyN2(o)+a.getPenaltyN3(o)+a.getPenaltyN4(o);a.applyMask(h,o),A<v&&(v=A,f=h)}return f}})(ya);var Bn={};const ms=kn,Cn=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],In=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Bn.getBlocksCount=function(i,r){switch(r){case ms.L:return Cn[(i-1)*4+0];case ms.M:return Cn[(i-1)*4+1];case ms.Q:return Cn[(i-1)*4+2];case ms.H:return Cn[(i-1)*4+3];default:return}};Bn.getTotalCodewordsCount=function(i,r){switch(r){case ms.L:return In[(i-1)*4+0];case ms.M:return In[(i-1)*4+1];case ms.Q:return In[(i-1)*4+2];case ms.H:return In[(i-1)*4+3];default:return}};var wa={},Ln={};const en=new Uint8Array(512),bn=new Uint8Array(256);(function(){let i=1;for(let r=0;r<255;r++)en[r]=i,bn[i]=r,i<<=1,i&256&&(i^=285);for(let r=255;r<512;r++)en[r]=en[r-255]})();Ln.log=function(i){if(i<1)throw new Error("log("+i+")");return bn[i]};Ln.exp=function(i){return en[i]};Ln.mul=function(i,r){return i===0||r===0?0:en[bn[i]+bn[r]]};(function(a){const i=Ln;a.mul=function(l,o){const u=new Uint8Array(l.length+o.length-1);for(let t=0;t<l.length;t++)for(let f=0;f<o.length;f++)u[t+f]^=i.mul(l[t],o[f]);return u},a.mod=function(l,o){let u=new Uint8Array(l);for(;u.length-o.length>=0;){const t=u[0];for(let v=0;v<o.length;v++)u[v]^=i.mul(o[v],t);let f=0;for(;f<u.length&&u[f]===0;)f++;u=u.slice(f)}return u},a.generateECPolynomial=function(l){let o=new Uint8Array([1]);for(let u=0;u<l;u++)o=a.mul(o,new Uint8Array([1,i.exp(u)]));return o}})(wa);const Ca=wa;function Io(a){this.genPoly=void 0,this.degree=a,this.degree&&this.initialize(this.degree)}Io.prototype.initialize=function(i){this.degree=i,this.genPoly=Ca.generateECPolynomial(this.degree)};Io.prototype.encode=function(i){if(!this.genPoly)throw new Error("Encoder not initialized");const r=new Uint8Array(i.length+this.degree);r.set(i);const l=Ca.mod(r,this.genPoly),o=this.degree-l.length;if(o>0){const u=new Uint8Array(this.degree);return u.set(l,o),u}return l};var Gl=Io,Ia={},hs={},_o={};_o.isValid=function(i){return!isNaN(i)&&i>=1&&i<=40};var os={};const _a="[0-9]+",Kl="[A-Z $%*+\\-./:]+";let sn="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";sn=sn.replace(/u/g,"\\u");const Ql="(?:(?![A-Z0-9 $%*+\\-./:]|"+sn+`)(?:.|[\r
]))+`;os.KANJI=new RegExp(sn,"g");os.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");os.BYTE=new RegExp(Ql,"g");os.NUMERIC=new RegExp(_a,"g");os.ALPHANUMERIC=new RegExp(Kl,"g");const Vl=new RegExp("^"+sn+"$"),Wl=new RegExp("^"+_a+"$"),Jl=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");os.testKanji=function(i){return Vl.test(i)};os.testNumeric=function(i){return Wl.test(i)};os.testAlphanumeric=function(i){return Jl.test(i)};(function(a){const i=_o,r=os;a.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},a.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},a.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},a.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},a.MIXED={bit:-1},a.getCharCountIndicator=function(u,t){if(!u.ccBits)throw new Error("Invalid mode: "+u);if(!i.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?u.ccBits[0]:t<27?u.ccBits[1]:u.ccBits[2]},a.getBestModeForData=function(u){return r.testNumeric(u)?a.NUMERIC:r.testAlphanumeric(u)?a.ALPHANUMERIC:r.testKanji(u)?a.KANJI:a.BYTE},a.toString=function(u){if(u&&u.id)return u.id;throw new Error("Invalid mode")},a.isValid=function(u){return u&&u.bit&&u.ccBits};function l(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"numeric":return a.NUMERIC;case"alphanumeric":return a.ALPHANUMERIC;case"kanji":return a.KANJI;case"byte":return a.BYTE;default:throw new Error("Unknown mode: "+o)}}a.from=function(u,t){if(a.isValid(u))return u;try{return l(u)}catch{return t}}})(hs);(function(a){const i=Ut,r=Bn,l=kn,o=hs,u=_o,t=7973,f=i.getBCHDigit(t);function v(b,M,N){for(let G=1;G<=40;G++)if(M<=a.getCapacity(G,N,b))return G}function h(b,M){return o.getCharCountIndicator(b,M)+4}function A(b,M){let N=0;return b.forEach(function(G){const Z=h(G.mode,M);N+=Z+G.getBitsLength()}),N}function y(b,M){for(let N=1;N<=40;N++)if(A(b,N)<=a.getCapacity(N,M,o.MIXED))return N}a.from=function(M,N){return u.isValid(M)?parseInt(M,10):N},a.getCapacity=function(M,N,G){if(!u.isValid(M))throw new Error("Invalid QR Code version");typeof G>"u"&&(G=o.BYTE);const Z=i.getSymbolTotalCodewords(M),W=r.getTotalCodewordsCount(M,N),Q=(Z-W)*8;if(G===o.MIXED)return Q;const V=Q-h(G,M);switch(G){case o.NUMERIC:return Math.floor(V/10*3);case o.ALPHANUMERIC:return Math.floor(V/11*2);case o.KANJI:return Math.floor(V/13);case o.BYTE:default:return Math.floor(V/8)}},a.getBestVersionForData=function(M,N){let G;const Z=l.from(N,l.M);if(Array.isArray(M)){if(M.length>1)return y(M,Z);if(M.length===0)return 1;G=M[0]}else G=M;return v(G.mode,G.getLength(),Z)},a.getEncodedBits=function(M){if(!u.isValid(M)||M<7)throw new Error("Invalid QR Code version");let N=M<<12;for(;i.getBCHDigit(N)-f>=0;)N^=t<<i.getBCHDigit(N)-f;return M<<12|N}})(Ia);var Aa={};const no=Ut,Sa=1335,ql=21522,Fo=no.getBCHDigit(Sa);Aa.getEncodedBits=function(i,r){const l=i.bit<<3|r;let o=l<<10;for(;no.getBCHDigit(o)-Fo>=0;)o^=Sa<<no.getBCHDigit(o)-Fo;return(l<<10|o)^ql};var Ta={};const Xl=hs;function Os(a){this.mode=Xl.NUMERIC,this.data=a.toString()}Os.getBitsLength=function(i){return 10*Math.floor(i/3)+(i%3?i%3*3+1:0)};Os.prototype.getLength=function(){return this.data.length};Os.prototype.getBitsLength=function(){return Os.getBitsLength(this.data.length)};Os.prototype.write=function(i){let r,l,o;for(r=0;r+3<=this.data.length;r+=3)l=this.data.substr(r,3),o=parseInt(l,10),i.put(o,10);const u=this.data.length-r;u>0&&(l=this.data.substr(r),o=parseInt(l,10),i.put(o,u*3+1))};var $l=Os;const zl=hs,Xn=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Gs(a){this.mode=zl.ALPHANUMERIC,this.data=a}Gs.getBitsLength=function(i){return 11*Math.floor(i/2)+6*(i%2)};Gs.prototype.getLength=function(){return this.data.length};Gs.prototype.getBitsLength=function(){return Gs.getBitsLength(this.data.length)};Gs.prototype.write=function(i){let r;for(r=0;r+2<=this.data.length;r+=2){let l=Xn.indexOf(this.data[r])*45;l+=Xn.indexOf(this.data[r+1]),i.put(l,11)}this.data.length%2&&i.put(Xn.indexOf(this.data[r]),6)};var Yl=Gs,Zl=function(i){for(var r=[],l=i.length,o=0;o<l;o++){var u=i.charCodeAt(o);if(u>=55296&&u<=56319&&l>o+1){var t=i.charCodeAt(o+1);t>=56320&&t<=57343&&(u=(u-55296)*1024+t-56320+65536,o+=1)}if(u<128){r.push(u);continue}if(u<2048){r.push(u>>6|192),r.push(u&63|128);continue}if(u<55296||u>=57344&&u<65536){r.push(u>>12|224),r.push(u>>6&63|128),r.push(u&63|128);continue}if(u>=65536&&u<=1114111){r.push(u>>18|240),r.push(u>>12&63|128),r.push(u>>6&63|128),r.push(u&63|128);continue}r.push(239,191,189)}return new Uint8Array(r).buffer};const jl=Zl,ec=hs;function Ks(a){this.mode=ec.BYTE,typeof a=="string"&&(a=jl(a)),this.data=new Uint8Array(a)}Ks.getBitsLength=function(i){return i*8};Ks.prototype.getLength=function(){return this.data.length};Ks.prototype.getBitsLength=function(){return Ks.getBitsLength(this.data.length)};Ks.prototype.write=function(a){for(let i=0,r=this.data.length;i<r;i++)a.put(this.data[i],8)};var tc=Ks;const sc=hs,nc=Ut;function Qs(a){this.mode=sc.KANJI,this.data=a}Qs.getBitsLength=function(i){return i*13};Qs.prototype.getLength=function(){return this.data.length};Qs.prototype.getBitsLength=function(){return Qs.getBitsLength(this.data.length)};Qs.prototype.write=function(a){let i;for(i=0;i<this.data.length;i++){let r=nc.toSJIS(this.data[i]);if(r>=33088&&r<=40956)r-=33088;else if(r>=57408&&r<=60351)r-=49472;else throw new Error("Invalid SJIS character: "+this.data[i]+`
Make sure your charset is UTF-8`);r=(r>>>8&255)*192+(r&255),a.put(r,13)}};var oc=Qs,Ma={exports:{}};(function(a){var i={single_source_shortest_paths:function(r,l,o){var u={},t={};t[l]=0;var f=i.PriorityQueue.make();f.push(l,0);for(var v,h,A,y,b,M,N,G,Z;!f.empty();){v=f.pop(),h=v.value,y=v.cost,b=r[h]||{};for(A in b)b.hasOwnProperty(A)&&(M=b[A],N=y+M,G=t[A],Z=typeof t[A]>"u",(Z||G>N)&&(t[A]=N,f.push(A,N),u[A]=h))}if(typeof o<"u"&&typeof t[o]>"u"){var W=["Could not find a path from ",l," to ",o,"."].join("");throw new Error(W)}return u},extract_shortest_path_from_predecessor_list:function(r,l){for(var o=[],u=l;u;)o.push(u),r[u],u=r[u];return o.reverse(),o},find_path:function(r,l,o){var u=i.single_source_shortest_paths(r,l,o);return i.extract_shortest_path_from_predecessor_list(u,o)},PriorityQueue:{make:function(r){var l=i.PriorityQueue,o={},u;r=r||{};for(u in l)l.hasOwnProperty(u)&&(o[u]=l[u]);return o.queue=[],o.sorter=r.sorter||l.default_sorter,o},default_sorter:function(r,l){return r.cost-l.cost},push:function(r,l){var o={value:r,cost:l};this.queue.push(o),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};a.exports=i})(Ma);var ac=Ma.exports;(function(a){const i=hs,r=$l,l=Yl,o=tc,u=oc,t=os,f=Ut,v=ac;function h(W){return unescape(encodeURIComponent(W)).length}function A(W,Q,V){const X=[];let $;for(;($=W.exec(V))!==null;)X.push({data:$[0],index:$.index,mode:Q,length:$[0].length});return X}function y(W){const Q=A(t.NUMERIC,i.NUMERIC,W),V=A(t.ALPHANUMERIC,i.ALPHANUMERIC,W);let X,$;return f.isKanjiModeEnabled()?(X=A(t.BYTE,i.BYTE,W),$=A(t.KANJI,i.KANJI,W)):(X=A(t.BYTE_KANJI,i.BYTE,W),$=[]),Q.concat(V,X,$).sort(function(le,he){return le.index-he.index}).map(function(le){return{data:le.data,mode:le.mode,length:le.length}})}function b(W,Q){switch(Q){case i.NUMERIC:return r.getBitsLength(W);case i.ALPHANUMERIC:return l.getBitsLength(W);case i.KANJI:return u.getBitsLength(W);case i.BYTE:return o.getBitsLength(W)}}function M(W){return W.reduce(function(Q,V){const X=Q.length-1>=0?Q[Q.length-1]:null;return X&&X.mode===V.mode?(Q[Q.length-1].data+=V.data,Q):(Q.push(V),Q)},[])}function N(W){const Q=[];for(let V=0;V<W.length;V++){const X=W[V];switch(X.mode){case i.NUMERIC:Q.push([X,{data:X.data,mode:i.ALPHANUMERIC,length:X.length},{data:X.data,mode:i.BYTE,length:X.length}]);break;case i.ALPHANUMERIC:Q.push([X,{data:X.data,mode:i.BYTE,length:X.length}]);break;case i.KANJI:Q.push([X,{data:X.data,mode:i.BYTE,length:h(X.data)}]);break;case i.BYTE:Q.push([{data:X.data,mode:i.BYTE,length:h(X.data)}])}}return Q}function G(W,Q){const V={},X={start:{}};let $=["start"];for(let U=0;U<W.length;U++){const le=W[U],he=[];for(let ce=0;ce<le.length;ce++){const O=le[ce],ie=""+U+ce;he.push(ie),V[ie]={node:O,lastCount:0},X[ie]={};for(let te=0;te<$.length;te++){const P=$[te];V[P]&&V[P].node.mode===O.mode?(X[P][ie]=b(V[P].lastCount+O.length,O.mode)-b(V[P].lastCount,O.mode),V[P].lastCount+=O.length):(V[P]&&(V[P].lastCount=O.length),X[P][ie]=b(O.length,O.mode)+4+i.getCharCountIndicator(O.mode,Q))}}$=he}for(let U=0;U<$.length;U++)X[$[U]].end=0;return{map:X,table:V}}function Z(W,Q){let V;const X=i.getBestModeForData(W);if(V=i.from(Q,X),V!==i.BYTE&&V.bit<X.bit)throw new Error('"'+W+'" cannot be encoded with mode '+i.toString(V)+`.
 Suggested mode is: `+i.toString(X));switch(V===i.KANJI&&!f.isKanjiModeEnabled()&&(V=i.BYTE),V){case i.NUMERIC:return new r(W);case i.ALPHANUMERIC:return new l(W);case i.KANJI:return new u(W);case i.BYTE:return new o(W)}}a.fromArray=function(Q){return Q.reduce(function(V,X){return typeof X=="string"?V.push(Z(X,null)):X.data&&V.push(Z(X.data,X.mode)),V},[])},a.fromString=function(Q,V){const X=y(Q,f.isKanjiModeEnabled()),$=N(X),U=G($,V),le=v.find_path(U.map,"start","end"),he=[];for(let ce=1;ce<le.length-1;ce++)he.push(U.table[le[ce]].node);return a.fromArray(M(he))},a.rawSplit=function(Q){return a.fromArray(y(Q,f.isKanjiModeEnabled()))}})(Ta);const Un=Ut,$n=kn,ic=Hl,rc=Pl,lc=va,cc=ha,oo=ya,ao=Bn,uc=Gl,xn=Ia,dc=Aa,gc=hs,zn=Ta;function fc(a,i){const r=a.size,l=cc.getPositions(i);for(let o=0;o<l.length;o++){const u=l[o][0],t=l[o][1];for(let f=-1;f<=7;f++)if(!(u+f<=-1||r<=u+f))for(let v=-1;v<=7;v++)t+v<=-1||r<=t+v||(f>=0&&f<=6&&(v===0||v===6)||v>=0&&v<=6&&(f===0||f===6)||f>=2&&f<=4&&v>=2&&v<=4?a.set(u+f,t+v,!0,!0):a.set(u+f,t+v,!1,!0))}}function pc(a){const i=a.size;for(let r=8;r<i-8;r++){const l=r%2===0;a.set(r,6,l,!0),a.set(6,r,l,!0)}}function mc(a,i){const r=lc.getPositions(i);for(let l=0;l<r.length;l++){const o=r[l][0],u=r[l][1];for(let t=-2;t<=2;t++)for(let f=-2;f<=2;f++)t===-2||t===2||f===-2||f===2||t===0&&f===0?a.set(o+t,u+f,!0,!0):a.set(o+t,u+f,!1,!0)}}function vc(a,i){const r=a.size,l=xn.getEncodedBits(i);let o,u,t;for(let f=0;f<18;f++)o=Math.floor(f/3),u=f%3+r-8-3,t=(l>>f&1)===1,a.set(o,u,t,!0),a.set(u,o,t,!0)}function Yn(a,i,r){const l=a.size,o=dc.getEncodedBits(i,r);let u,t;for(u=0;u<15;u++)t=(o>>u&1)===1,u<6?a.set(u,8,t,!0):u<8?a.set(u+1,8,t,!0):a.set(l-15+u,8,t,!0),u<8?a.set(8,l-u-1,t,!0):u<9?a.set(8,15-u-1+1,t,!0):a.set(8,15-u-1,t,!0);a.set(l-8,8,1,!0)}function hc(a,i){const r=a.size;let l=-1,o=r-1,u=7,t=0;for(let f=r-1;f>0;f-=2)for(f===6&&f--;;){for(let v=0;v<2;v++)if(!a.isReserved(o,f-v)){let h=!1;t<i.length&&(h=(i[t]>>>u&1)===1),a.set(o,f-v,h),u--,u===-1&&(t++,u=7)}if(o+=l,o<0||r<=o){o-=l,l=-l;break}}}function yc(a,i,r){const l=new ic;r.forEach(function(v){l.put(v.mode.bit,4),l.put(v.getLength(),gc.getCharCountIndicator(v.mode,a)),v.write(l)});const o=Un.getSymbolTotalCodewords(a),u=ao.getTotalCodewordsCount(a,i),t=(o-u)*8;for(l.getLengthInBits()+4<=t&&l.put(0,4);l.getLengthInBits()%8!==0;)l.putBit(0);const f=(t-l.getLengthInBits())/8;for(let v=0;v<f;v++)l.put(v%2?17:236,8);return wc(l,a,i)}function wc(a,i,r){const l=Un.getSymbolTotalCodewords(i),o=ao.getTotalCodewordsCount(i,r),u=l-o,t=ao.getBlocksCount(i,r),f=l%t,v=t-f,h=Math.floor(l/t),A=Math.floor(u/t),y=A+1,b=h-A,M=new uc(b);let N=0;const G=new Array(t),Z=new Array(t);let W=0;const Q=new Uint8Array(a.buffer);for(let le=0;le<t;le++){const he=le<v?A:y;G[le]=Q.slice(N,N+he),Z[le]=M.encode(G[le]),N+=he,W=Math.max(W,he)}const V=new Uint8Array(l);let X=0,$,U;for($=0;$<W;$++)for(U=0;U<t;U++)$<G[U].length&&(V[X++]=G[U][$]);for($=0;$<b;$++)for(U=0;U<t;U++)V[X++]=Z[U][$];return V}function Cc(a,i,r,l){let o;if(Array.isArray(a))o=zn.fromArray(a);else if(typeof a=="string"){let h=i;if(!h){const A=zn.rawSplit(a);h=xn.getBestVersionForData(A,r)}o=zn.fromString(a,h||40)}else throw new Error("Invalid data");const u=xn.getBestVersionForData(o,r);if(!u)throw new Error("The amount of data is too big to be stored in a QR Code");if(!i)i=u;else if(i<u)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+u+`.
`);const t=yc(i,r,o),f=Un.getSymbolSize(i),v=new rc(f);return fc(v,i),pc(v),mc(v,i),Yn(v,r,0),i>=7&&vc(v,i),hc(v,t),isNaN(l)&&(l=oo.getBestMask(v,Yn.bind(null,v,r))),oo.applyMask(l,v),Yn(v,r,l),{modules:v,version:i,errorCorrectionLevel:r,maskPattern:l,segments:o}}pa.create=function(i,r){if(typeof i>"u"||i==="")throw new Error("No input text");let l=$n.M,o,u;return typeof r<"u"&&(l=$n.from(r.errorCorrectionLevel,$n.M),o=xn.from(r.version),u=oo.from(r.maskPattern),r.toSJISFunc&&Un.setToSJISFunction(r.toSJISFunc)),Cc(i,o,l,u)};var Ra={},Ao={};(function(a){function i(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let l=r.slice().replace("#","").split("");if(l.length<3||l.length===5||l.length>8)throw new Error("Invalid hex color: "+r);(l.length===3||l.length===4)&&(l=Array.prototype.concat.apply([],l.map(function(u){return[u,u]}))),l.length===6&&l.push("F","F");const o=parseInt(l.join(""),16);return{r:o>>24&255,g:o>>16&255,b:o>>8&255,a:o&255,hex:"#"+l.slice(0,6).join("")}}a.getOptions=function(l){l||(l={}),l.color||(l.color={});const o=typeof l.margin>"u"||l.margin===null||l.margin<0?4:l.margin,u=l.width&&l.width>=21?l.width:void 0,t=l.scale||4;return{width:u,scale:u?4:t,margin:o,color:{dark:i(l.color.dark||"#000000ff"),light:i(l.color.light||"#ffffffff")},type:l.type,rendererOpts:l.rendererOpts||{}}},a.getScale=function(l,o){return o.width&&o.width>=l+o.margin*2?o.width/(l+o.margin*2):o.scale},a.getImageWidth=function(l,o){const u=a.getScale(l,o);return Math.floor((l+o.margin*2)*u)},a.qrToImageData=function(l,o,u){const t=o.modules.size,f=o.modules.data,v=a.getScale(t,u),h=Math.floor((t+u.margin*2)*v),A=u.margin*v,y=[u.color.light,u.color.dark];for(let b=0;b<h;b++)for(let M=0;M<h;M++){let N=(b*h+M)*4,G=u.color.light;if(b>=A&&M>=A&&b<h-A&&M<h-A){const Z=Math.floor((b-A)/v),W=Math.floor((M-A)/v);G=y[f[Z*t+W]?1:0]}l[N++]=G.r,l[N++]=G.g,l[N++]=G.b,l[N]=G.a}}})(Ao);(function(a){const i=Ao;function r(o,u,t){o.clearRect(0,0,u.width,u.height),u.style||(u.style={}),u.height=t,u.width=t,u.style.height=t+"px",u.style.width=t+"px"}function l(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}a.render=function(u,t,f){let v=f,h=t;typeof v>"u"&&(!t||!t.getContext)&&(v=t,t=void 0),t||(h=l()),v=i.getOptions(v);const A=i.getImageWidth(u.modules.size,v),y=h.getContext("2d"),b=y.createImageData(A,A);return i.qrToImageData(b.data,u,v),r(y,h,A),y.putImageData(b,0,0),h},a.renderToDataURL=function(u,t,f){let v=f;typeof v>"u"&&(!t||!t.getContext)&&(v=t,t=void 0),v||(v={});const h=a.render(u,t,v),A=v.type||"image/png",y=v.rendererOpts||{};return h.toDataURL(A,y.quality)}})(Ra);var Ea={};const Ic=Ao;function Ho(a,i){const r=a.a/255,l=i+'="'+a.hex+'"';return r<1?l+" "+i+'-opacity="'+r.toFixed(2).slice(1)+'"':l}function Zn(a,i,r){let l=a+i;return typeof r<"u"&&(l+=" "+r),l}function _c(a,i,r){let l="",o=0,u=!1,t=0;for(let f=0;f<a.length;f++){const v=Math.floor(f%i),h=Math.floor(f/i);!v&&!u&&(u=!0),a[f]?(t++,f>0&&v>0&&a[f-1]||(l+=u?Zn("M",v+r,.5+h+r):Zn("m",o,0),o=0,u=!1),v+1<i&&a[f+1]||(l+=Zn("h",t),t=0)):o++}return l}Ea.render=function(i,r,l){const o=Ic.getOptions(r),u=i.modules.size,t=i.modules.data,f=u+o.margin*2,v=o.color.light.a?"<path "+Ho(o.color.light,"fill")+' d="M0 0h'+f+"v"+f+'H0z"/>':"",h="<path "+Ho(o.color.dark,"stroke")+' d="'+_c(t,u,o.margin)+'"/>',A='viewBox="0 0 '+f+" "+f+'"',b='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+A+' shape-rendering="crispEdges">'+v+h+`</svg>
`;return typeof l=="function"&&l(null,b),b};const Ac=Dl,io=pa,ba=Ra,Sc=Ea;function So(a,i,r,l,o){const u=[].slice.call(arguments,1),t=u.length,f=typeof u[t-1]=="function";if(!f&&!Ac())throw new Error("Callback required as last argument");if(f){if(t<2)throw new Error("Too few arguments provided");t===2?(o=r,r=i,i=l=void 0):t===3&&(i.getContext&&typeof o>"u"?(o=l,l=void 0):(o=l,l=r,r=i,i=void 0))}else{if(t<1)throw new Error("Too few arguments provided");return t===1?(r=i,i=l=void 0):t===2&&!i.getContext&&(l=r,r=i,i=void 0),new Promise(function(v,h){try{const A=io.create(r,l);v(a(A,i,l))}catch(A){h(A)}})}try{const v=io.create(r,l);o(null,a(v,i,l))}catch(v){o(v)}}ln.create=io.create;ln.toCanvas=So.bind(null,ba.render);ln.toDataURL=So.bind(null,ba.renderToDataURL);ln.toString=So.bind(null,function(a,i,r){return Sc.render(a,r)});const Tc={key:0,class:"form_invite"},Mc={class:"code"},Rc={class:"code_num"},Ec={class:"desc"},bc={class:"code_img"},xc=["src"],Nc={class:"expire"},kc=Pe({__name:"invite-code",props:{inviteCodeInfo:{type:Object,default:()=>{}}},emits:["close"],setup(a,{emit:i}){const r=a,l=Ms.global.t,o=R("");ls(()=>{u(r.inviteCodeInfo.inviteCodeUrl)});const u=async h=>{try{o.value=await ln.toDataURL(h)}catch(A){console.error(A)}},t=()=>{navigator.clipboard.writeText(r.inviteCodeInfo.inviteCode),vt({content:l("message.ichbCopied"),zIndex:2147483647,duration:2e3})},f=()=>{const h=Mi({data:r.inviteCodeInfo});window.RendererHelper.openWindow("https://im.chaoxing.com/res/studyForward/index.html",{width:640,height:hr,frame:!1,modal:!0,resizable:!1,subWindow:!0,id:"studyForward"},{attachment:j.cloneDeep(h)})},v=()=>{i("close")};return(h,A)=>{const y=Gt;return I(),Me(Ts,{visible:!0,options:{"close-on-click-modal":!1},width:"640","confirm-text":n(l)("message.retransmission"),"close-text":"",title:n(l)("message.mycard"),onClose:v,onConfirm:f},{default:He(()=>[r.inviteCodeInfo&&Object.keys(r.inviteCodeInfo).length?(I(),E("div",Tc,[p("div",Mc,[gt(L(n(l)("message.invitationCode"))+": ",1),p("span",Rc,[gt(L(r.inviteCodeInfo.inviteCode)+" ",1),Te(y,{"icon-class":"copy_code",width:"14px",height:"14px",onClick:t,style:{cursor:"pointer"}})])]),p("div",Ec,L(n(l)("message.enterRightHome")),1),p("div",bc,[p("img",{src:o.value,alt:""},null,8,xc)]),p("div",Nc,L(n(l)("message.invitationCodeEffectiveTime",{expireTime:n(to)(r.inviteCodeInfo.expireTime)})),1)])):re("",!0)]),_:1},8,["confirm-text","title"])}}});const Bc=It(kc,[["__scopeId","data-v-29b2defe"]]),Lc=a=>(ss("data-v-620970df"),a=a(),ns(),a),Uc={class:"search_history"},Dc={class:"title search_history_title"},Fc={class:"search_history_list"},Hc=["onClick"],Pc={key:0,class:"search_content"},Oc={class:"title"},Gc=["src"],Kc={class:"content_text"},Qc={class:"name"},Vc={class:"btn"},Wc={key:1,class:"search_empty"},Jc={key:2,class:"loading"},qc=Lc(()=>p("img",{class:"rotate",src:go,alt:""},null,-1)),Xc=Pe({__name:"index",props:{cancelBtn:{type:Object,default:{text:"取消",callback:()=>!0}},confirmBtn:{type:Object,default:{text:"确定",callback:()=>!0}}},setup(a){const i=a,r=Ms.global.t,l=_t(),o=bs("addFriend"),{getAddUserHistorySearch:u}=Ot(l),t=R(!1),f=R(""),v=R([]),h=R(!1),A=R(!1),y=Re(()=>u.value),b=async()=>{const $=await window.RendererHelper.getMousePointInWindow(),U=await window.RendererHelper.getMousePointInScreen(),{width:le,height:he}=await window.RendererHelper.getScreenWorkArea(),ce=U.x+340>le?$.x-340:$.x,O=U.y+200>he?$.y-200:$.y;window.RendererHelper.openWindow("sview:/#/personalCard",{width:340,height:200,resizable:!1,marginLeft:ce,marginTop:O,subWindow:!0,frame:!1,id:"id_PersonInfoWindow"},{myPuid:l.getUserInfo.puid,puid:v.value[0].puid})},M=()=>{A.value=!1,f.value="",v.value=[]},N=async()=>{var $;try{A.value=!0,Q(),t.value=!0;const U=await fi(f.value);U.result==1&&(v.value=(($=U==null?void 0:U.data)==null?void 0:$.list)||[]),t.value=!1}catch{t.value=!1}},G=()=>{h.value=!1},Z=()=>{l.clearAddUserHistory()},W=$=>{f.value=$,N()},Q=()=>{if(f.value){const $=j.cloneDeep(Oo(y.value));if(($.length===0||$===null)&&y.value.unshift(f.value),$.length>0){const U=$.findIndex(le=>le===f.value);U===-1?($.length>30&&y.value.pop(),y.value.unshift(f.value)):(y.value.splice(U,1),y.value.unshift(f.value))}}},V=R({}),X=async()=>{try{let $={baseUrl:"https://useryd.chaoxing.com",url:"/apis/user/getUser",getParams:{puid:Number(l.puid),myPuid:Number(l.puid),uid:l.loginId},postParams:{},tokenSign:!0};const U=await window.MainWindowHelper.genRequest($);(U==null?void 0:U.result)==1&&(V.value=U.msg)}catch($){console.log($)}};return ls(()=>{X()}),($,U)=>{const le=Gt,he=Vs;return I(),Me(Vo,{center:!0,shouldWrapper:!1},{default:He(()=>{var ce,O,ie;return[h.value?re("",!0):(I(),E("div",{key:0,class:H(n(o).e("cover"))},null,2)),h.value?re("",!0):(I(),E("div",{key:1,class:H(n(o).b())},[p("header",{class:H(n(o).e("header"))},[p("span",{class:H(n(o).e("title"))},L(n(r)("message.addFriends")),3),p("i",{onClick:U[0]||(U[0]=()=>{var te,P;(P=(te=i.cancelBtn).callback)==null||P.call(te)}),class:H(n(o).e("close"))},[Te(le,{class:"close_btn","icon-class":"dialog_close",width:"20px",height:"20px"})],2)],2),p("main",{class:H(n(o).e("main"))},[p("div",{class:H(n(o).e("search"))},[Te(he,{modelValue:f.value,"onUpdate:modelValue":U[1]||(U[1]=te=>f.value=te),modelModifiers:{trim:!0},class:"search_input",placeholder:`${n(r)("setting.phone")}/${n(r)("setting.cxstudy")}`,onChange:N,onInput:U[2]||(U[2]=te=>A.value=!1)},{suffix:He(()=>[f.value.length?(I(),Me(le,{key:0,class:"clear","icon-class":"input_clear",width:"14px",height:"14px",onClick:M})):re("",!0),Te(le,{"icon-class":"search",width:"18px",height:"18px",color:"rgba(172, 180, 191, 1)",style:{cursor:"pointer"},onClick:N})]),_:1},8,["modelValue","placeholder"])],2),Ct(p("div",Uc,[p("div",Dc,[p("span",null,L(n(r)("message.recentSearches")),1),Te(le,{class:"clear_search_history","icon-class":"delete",width:"15px",height:"15px",onClick:Z})]),p("div",Fc,[n(y).length>0?(I(!0),E(Ke,{key:0},ot(n(y),(te,P)=>(I(),E("span",{class:"search_history_item",key:te+P,onClick:ae=>W(te)},[p("span",null,L(te),1)],8,Hc))),128)):re("",!0)])],512),[[xt,!A.value&&!((ce=v.value)!=null&&ce.length)]]),(O=v.value)!=null&&O.length?(I(),E("div",Pc,[p("div",Oc,[p("span",null,L(n(r)("message.recentSearches")),1)]),p("div",{class:"content_box",onClick:b},[p("img",{src:v.value[0].pic,alt:""},null,8,Gc),p("div",Kc,[p("div",Qc,L(v.value[0].name),1),p("div",Vc,L(n(r)("message.viewUserCard")),1)])])])):re("",!0),A.value&&!((ie=v.value)!=null&&ie.length)?(I(),E("div",Wc,L(n(r)("message.noSearchResults")),1)):re("",!0),t.value?(I(),E("div",Jc,[qc,gt(" "+L(n(r)("message.loadingWait"))+"… ",1)])):re("",!0)],2),p("footer",{class:H(n(o).e("footer"))},[p("div",{class:"code",onClick:U[3]||(U[3]=te=>h.value=!0)},[gt(L(n(r)("message.mycxstudy"))+": ",1),Te(le,{"icon-class":"qr_code",width:"16px",height:"16px",color:"#ACB4BF",style:{margin:"0 6px",cursor:"pointer"}})])],2)],2)),h.value?(I(),Me(Bc,{key:2,"invite-code-info":V.value,onClose:G},null,8,["invite-code-info"])):re("",!0)]}),_:1})}}});const $c=It(Xc,[["__scopeId","data-v-620970df"]]),zc=["onClick"],Yc=["src"],Zc=Pe({__name:"member-list",props:{memberList:{type:Array,default:()=>[]},comkey:{type:String,default:""}},emits:["choose"],setup(a,{emit:i}){const r=a,l=Ms.global.t,o=bs("member"),{memberList:u,comkey:t}=rn(r),f=Re(()=>{const A=u.value.filter(N=>N.role==3),y=u.value.filter(N=>N.owner),b=u.value.filter(N=>N.admin),M=u.value.filter(N=>!N.admin&&!N.owner&&N.role!=3);return j.uniqBy(A.concat(y).concat(b).concat(M),"uid")}),v=A=>{},h=A=>A.role==3?l("message.iCService"):A.admin?l("message.admin"):A.owner?l("message.owner"):"";return(A,y)=>(I(),E("div",{class:H([n(o).b()])},[(I(!0),E(Ke,null,ot(n(f),b=>(I(),E("div",{class:H([n(o).e("memberItem")]),key:b.uid,onClick:M=>v()},[p("img",{class:H([n(o).e("img")]),src:b.pic,alt:""},null,10,Yc),p("span",{class:H([n(o).e("name")])},L(b.name),3),p("span",{class:H([n(o).e("role"),b.admin?"admin":"",b.owner?"creator":"",b.role==3?"kefu":""])},L(h(b)),3)],10,zc))),128))],2))}});const jc=It(Zc,[["__scopeId","data-v-3f9dc1eb"]]),eu=a=>(ss("data-v-d82abeca"),a=a(),ns(),a),tu={class:"form"},su={class:"group_content"},nu={class:"group_form"},ou={class:"group_form_invite group_form_item"},au={class:"group_form_name"},iu={class:"group_form_btn"},ru={key:0,class:"form_invite"},lu={class:"code"},cu={class:"code_num"},uu={class:"desc"},du={class:"code_img"},gu=["src"],fu={class:"expire"},pu={class:"group_form_addmember group_form_item"},mu={class:"group_form_name"},vu={class:"group_form_btn"},hu=eu(()=>p("div",{class:"drive"},null,-1)),yu={class:"memberlist"},wu={class:"title"},Cu=Pe({__name:"index",props:{addGroupVisible:{type:Boolean,default:!1}},emits:["close"],setup(a,{emit:i}){const{t:r}=ts(),l=_t(),o=Es(),{getAddGroupsMember:u}=Ot(o),{getUserInfo:t}=Ot(l),f=Rs(),v=R(""),h=R(""),A=R(),y=R(!1),b=R(!1),M=R(void 0),N=R(!1);ls(()=>{mt(()=>{const _=setTimeout(()=>{A.value.focus(),clearTimeout(_)})})});const G=Re(()=>u.value||[]),Z=j.debounce(()=>{vt({content:r("message.nameCannotExceed"),zIndex:2024,duration:2e3})},200),W=()=>{v.value.trim().length>16&&(Z(),v.value=v.value.trim().slice(0,16))},Q=_=>{_?U(h.value):$(h.value)},V=()=>{M.value?(navigator.clipboard.writeText(M.value.inviteCode),vt({content:r("message.ichbCopied"),zIndex:2147483647,duration:2e3})):console.error("[copyInviteCode][inviteCodeInfo=undefined]")},X=()=>{if(!M.value){console.error("[forwardCode][inviteCodeInfo=undefined]");return}const _=G.value.slice(0,4).map(K=>K.pic),F=Xo({data:{groupId:h.value,groupName:v.value,inviteCode:M.value.inviteCode,listPic:_}});window.RendererHelper.openWindow("https://im.chaoxing.com/res/studyForward/index.html",{width:640,height:fo,frame:!1,modal:!0,resizable:!1,subWindow:!0,id:"studyForward"},{attachment:j.cloneDeep(F)})},$=async _=>{if(!M.value){console.error("[closeInviteCode][inviteCodeInfo=undefined]");return}let F={baseUrl:"https://learn.chaoxing.com",url:"/apis/im/updateChatGroupIncode",getParams:{cgid:_},postParams:{incode:M.value.inviteCode,expireTime:1e3},tokenSign:!0};const K=await window.MainWindowHelper.genRequest(F);if(Hs(K)){M.value=K.data;let pe={baseUrl:"https://learn.chaoxing.com",url:"/apis/im/updatetChatGroupsInfo",getParams:{groupid:_},postParams:{desc:JSON.stringify({showQRCode:0})},tokenSign:!0};window.MainWindowHelper.genRequest(pe).then(J=>{Hs(J)?M.value=void 0:(vt({content:J.errorMsg??"关闭邀请码失败",zIndex:2147483647,duration:2e3}),console.error("closeInviteCode error",J.errorMsg))})}},U=async _=>{let F={baseUrl:"https://learn.chaoxing.com",url:"/apis/im/createChatGroupIncode",getParams:{op:0},postParams:{cg:JSON.stringify({id:_,name:v.value,logo:[]})},tokenSign:!0};const K=await window.MainWindowHelper.genRequest(F);if(Hs(K)){M.value=K.data;let pe={baseUrl:"https://learn.chaoxing.com",url:"/apis/im/updatetChatGroupsInfo",getParams:{groupid:_},postParams:{desc:JSON.stringify({showQRCode:1})},tokenSign:!0};window.MainWindowHelper.genRequest(pe).then(J=>{Hs(J)?y.value=!0:(vt({content:J.errorMsg??"开启邀请码失败",zIndex:2147483647,duration:2e3}),console.error("openInviteCode error",J.errorMsg))})}},le=async(_,F=!1)=>{let K={},pe=[];if(F){const oe=l.getCurrentChatId,_e=await o.updateGroupInfo(_,t.value.loginId,String(oe));K=_e.groupDetail,pe=_e.allMembers}else{const oe=l.getCurrentChatId,_e=await o.initGroupInfo(_,t.value.loginId,String(oe));K=_e.groupDetail,pe=_e.allMembers}pe=j.orderBy(pe,[oe=>oe.owner?-1:1,oe=>oe.admin?-1:1,oe=>String(oe.uid)]);let J=[],fe="";if(!K.description)J=pe.slice(0,4).map(oe=>oe.pic),fe=K.name?K.name:pe.slice(0,4).map(oe=>oe.name).join("、");else{let oe=JSON.parse(K.description),_e={};Object.keys(he).includes(String(oe.groupType))?(_e=he[oe.groupType](K,pe),J=_e.groupImgs,fe=_e.groupName):(_e=ce(pe,K),J=_e.groupImgs,fe=_e.groupName)}return{groupName:fe,groupImgs:J}},he={[qe.NORMAL]:(_,F)=>ce(F,_),[qe.COURSE]:(_,F)=>O(_,at.COURSE,F),[qe.GROUP]:(_,F)=>ce(F,_),[qe.DEPT]:(_,F)=>ce(F,_),[qe.CLASS]:(_,F)=>O(_,at.CLASS,F),[qe.INTERACTION]:(_,F)=>ce(F,_)},ce=(_,F)=>{const K=j.orderBy(_,[fe=>fe.owner?-1:1,fe=>fe.admin?-1:1,fe=>String(fe.uid)]),pe=K.slice(0,4).map(fe=>fe.pic),J=F.name?F.name:K.slice(0,4).map(fe=>fe.name).join("、");return{groupImgs:pe,groupName:J}},O=(_,F,K)=>{const pe=j.orderBy(K,[_e=>_e.owner?-1:1,_e=>_e.admin?-1:1,_e=>String(_e.uid)]),J=[F],fe=JSON.parse(_.description),oe=_.name?_.name:fe&&fe.courseInfo&&fe.courseInfo.coursename?fe.courseInfo.coursename:pe.slice(0,4).map(_e=>_e.name).join("、");return{groupImgs:J,groupName:oe}},ie=()=>{N.value=!0;let _={getParams:{owner:String(l.getUserInfo.loginId)},postParams:{groupname:v.value.trim()},tokenSign:!0};window.MainWindowHelper.createChatGroups(_).then(async F=>{if(console.log("添加成功",F),F.result==1){o.setAddGroupId(F.msg.groupid);const{groupName:K,groupImgs:pe}=await le(F.msg.groupid,!0);await l.gatherConversation(F.msg.groupid,{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:K,pic:pe,chatType:ge.GROUP}}),b.value=!0,h.value=F.msg.groupid,U(h.value)}}).finally(()=>{N.value=!1})},te=R([]),P=async()=>{let _=[];const F=G.value.map(oe=>({uid:Number(oe.uid),name:oe.name,puid:Number(oe.puid)}));try{_=(await $o({peopleList:F})).filter(oe=>oe.uid!=null)}catch(oe){console.error(oe)}if(!_||(_==null?void 0:_.length)<1)return;let K=_.map(oe=>({puid:oe.puid}));const pe=te.value.filter(oe=>K.some(_e=>_e.puid==oe.thePuid));if(pe.length&&vt({content:pe.map(oe=>oe.name).join("、")+r("message.groupDeclineInvite"),zIndex:2024,duration:2e3}),K=K.filter(oe=>!G.value.some(_e=>_e.puid==oe.puid)&&!te.value.some(_e=>_e.thePuid==oe.puid)),!K.length)return;let fe={baseUrl:"https://learn.chaoxing.com",url:"/apis/im/addUsersToGroupBatchV2",getParams:await zo({isAttachChatHistory:!1,groupId:h.value}),postParams:{users:JSON.stringify(K)},tokenSign:!0,allParamSign:!0};window.MainWindowHelper.genRequest(fe).then(oe=>{console.log("addUsersToGroupBatchV2 success",tn(oe)),oe.result===2&&vt({duration:2e3,content:r("message.invitationSent"),zIndex:2024})}),await ae()},ae=async()=>{try{const _=await window.MainWindowHelper.searchLocalShieldMeData();if(te.value=_&&_.length?_:[],(await window.MainWindowHelper.syncAllBlacklist()).state==0){console.log("增量更新完毕");const K=await window.MainWindowHelper.searchLocalShieldMeData();te.value=K&&K.length?K:[]}}catch{}},ue=()=>{i("close")},x=()=>{l.setChatTargetId(h.value),f.push({path:"/message/conversation",query:{id:h.value,chatType:ge.GROUP,t:new Date().getTime()}}),v.value="",o.initAddGroupMember(),i("close")};return(_,F)=>{const K=Vs,pe=Wo,J=Gt,fe=Ws;return I(),E(Ke,null,[Te(Ts,{visible:!0,options:{"close-on-click-modal":!1},width:"440","confirm-text":N.value?n(r)("message.creating"):n(r)("message.done"),title:n(r)("message.newChat"),"close-text":n(r)("message.cancel"),"disabeld-confirm":N.value,onClose:ue,onConfirm:ie},{default:He(()=>[p("div",tu,[Te(K,{ref_key:"groupNameRef",ref:A,modelValue:v.value,"onUpdate:modelValue":F[0]||(F[0]=oe=>v.value=oe),placeholder:n(r)("message.etnotgChat"),onInput:W},null,8,["modelValue","placeholder"])])]),_:1},8,["confirm-text","title","close-text","disabeld-confirm"]),b.value?(I(),Me(Ts,{key:0,visible:!0,options:{"close-on-click-modal":!1},width:"640","confirm-text":n(r)("message.done"),"close-text":"",title:v.value,onClose:x,onConfirm:x,exBtn:[{text:n(r)("message.retransmission"),callback:X}]},{default:He(()=>[Te(fe,{class:"group_init"},{default:He(()=>[p("div",su,[p("div",nu,[p("div",ou,[p("div",au,L(n(r)("message.chatInvitationCode")),1),p("div",iu,[Te(pe,{modelValue:y.value,"onUpdate:modelValue":F[1]||(F[1]=oe=>y.value=oe),class:"ml-2",size:"small",style:{"--el-switch-on-color":"#3a8bff","--el-switch-off-color":"#d0d5db"},onChange:Q},null,8,["modelValue"])])]),M.value&&Object.keys(M.value).length?(I(),E("div",ru,[p("div",lu,[gt(L(n(r)("message.invitationCode"))+": ",1),p("span",cu,[gt(L(M.value.inviteCode)+" ",1),Te(J,{"icon-class":"copy_code",width:"14px",height:"14px",onClick:V,style:{cursor:"pointer"}})])]),p("div",uu,L(n(r)("message.enterRightHome")),1),p("div",du,[p("img",{src:M.value.code2Url,alt:""},null,8,gu)]),p("div",fu,L(M.value.expireTimeText),1)])):re("",!0),p("div",pu,[p("div",mu,L(n(r)("message.addMembers")),1),p("div",vu,[p("div",{class:"add_btn",onClick:P},[Te(J,{"icon-class":"group_add",width:"10px",height:"10px",color:"#3A8BFF"}),p("span",null,L(n(r)("message.add")),1)])])])]),hu,p("div",yu,[p("div",wu,L(n(r)("message.members"))+"("+L(n(G).length)+") ",1),Te(jc,{"member-list":n(G)},null,8,["member-list"])])])]),_:1})]),_:1},8,["confirm-text","title","exBtn"])):re("",!0)],64)}}});const Iu=It(Cu,[["__scopeId","data-v-d82abeca"]]),_u={class:H(["badge"])},Au={key:0,src:lo,alt:"",draggable:"false"},Su={key:1,src:Qo,alt:"",draggable:"false"},Tu=["src"],Mu={key:3,src:vs,alt:"",draggable:"false"},Ru=["innerHTML"],Eu=["innerHTML"],bu=["aria-label"],xu=["innerHTML"],Nu=Pe({__name:"index",props:{isRemind:{type:Boolean,default:!1},isReply:{type:Boolean,default:!1},isCare:{type:Boolean,default:!1},isNewNotice:{type:Boolean,default:!1},isDraft:{type:Boolean,default:!1},isNoDisturb:{type:Boolean,default:!1},isTop:{type:Number,default:0},isHtml:{type:Boolean,default:!1},isConversation:{type:Boolean,default:!0},itemConfig:{type:Object,default:()=>{},required:!0},ext:{type:Object||void 0,default:()=>{}},userInfo:{type:Object,default:()=>{}},keyword:{type:String,default:""},clickDebounceTime:{type:Number,default:0}},emits:["handleClick","rightClick","avatorClick"],setup(a,{emit:i}){const r=a,{t:l}=ts(),o=bs("box"),u=_t(),t=R(),{isNoDisturb:f,isTop:v,itemConfig:h,keyword:A,isRemind:y,isReply:b,isCare:M,isNewNotice:N,isDraft:G,clickDebounceTime:Z}=rn(r),W=R(!0);W.value=window.RendererHelper.getPlatform()!="darwin";const Q=j.debounce(()=>{i("handleClick",h.value)},Z.value),V=le=>{var ce;(ce=t.value)==null||ce.changeImg(),i("avatorClick",h.value,le);const he=setTimeout(()=>{var O;console.log("点击"),u.getCurrentChatId==h.value.conversationKey&&u.setConversationToMessageCount(),(O=t.value)==null||O.changeImg(),clearTimeout(he)},1e3)},X=le=>{le.preventDefault(),i("rightClick",le,h.value)},$=le=>{let he=le?xe.htmlEncodeByRegExp(le).replaceAll(":","<strong>:</strong>"):"";if(he)return An.forEach(ce=>{if(he.indexOf(ce.msg)!==-1){const O=`${eo}${ce.fileName}.png`,ie=new URL(O,import.meta.url).href;he=he.replaceAll(ce.msg,`<img src="${ie}" alt="cxemoji-${ce.msg}" width="16" height="16" style="vertical-align: bottom;" draggable="false"/>`)}}),he},U=le=>{if(h.value.isHtml)return le;let he=An.some(O=>O.msg.indexOf(A.value)>=0),ce=xe.htmlEncodeByRegExp(le);return he&&le?(An.forEach(O=>{if(ce.indexOf(O.msg)!==-1){const ie=`${eo}${O.fileName}.png`,te=new URL(ie,import.meta.url).href;ce=ce.replaceAll(O.msg,`<img src="${te}" alt="cxemoji-${O.msg}" width="16" height="16" style="vertical-align: bottom;" draggable="false" />`)}}),ce):le?xe.htmlEncodeByRegExp(le).replaceAll(A.value,`<span style='color: #3A8BFF'>${A.value}</span>`):""};return(le,he)=>{const ce=Gt;return I(),E("div",{class:H(n(o).b()),onClick:he[1]||(he[1]=(...O)=>n(Q)&&n(Q)(...O)),onContextmenu:X},[p("div",{class:H(n(o).e("img")),onClick:he[0]||(he[0]=rs(O=>V(O),["stop"]))},[Ct(p("div",_u,[p("div",{class:H(["text",W.value?"":"lineHeight16",n(h).unreadMessageNum>99?"b-number":""])},L(n(h).unreadMessageNum>99?"99+":n(h).unreadMessageNum),3)],512),[[xt,n(h).unreadMessageNum&&!n(f)&&a.isConversation]]),n(h).chatIco[0]==n(at).CLASS?(I(),E("img",Au)):n(h).chatIco[0]==n(at).COURSE?(I(),E("img",Su)):n(h).chatIco[0]==n(at).GROUP?(I(),E("img",{key:2,src:n(po),alt:"",draggable:"false"},null,8,Tu)):n(h).chatIco[0]=="default"||n(h).chatIco[0]=="cximg://default"||n(h).chatIco[0]=="headerimg://default"?(I(),E("img",Mu)):(I(),Me(co,{ref_key:"imgAvatorRef",ref:t,key:n(h).conversationKey+n(h).title+n(h).chatIco.join(","),"img-list":n(h).chatIco},null,8,["img-list"]))],2),p("div",{class:H(n(o).e("content"))},[p("div",{class:H(n(o).e("content_top"))},[p("div",{class:H(n(o).e("info"))},[n(A)?(I(),E("div",{key:0,class:H(n(o).e("title")),innerHTML:U(n(h).title)},null,10,Ru)):(I(),E("div",{key:1,class:H(n(o).e("title"))},L(n(h).title||""),3)),n(v)?(I(),E("div",{key:2,class:H(n(o).m("remark"))},L(n(l)("message.top")),3)):re("",!0)],2),p("div",{class:H(n(o).e("time"))},L(n(h).time||n(h).module||""),3)],2),p("div",{class:H(n(o).e("content_bottom"))},[n(A)?(I(),E("div",{key:0,class:H(n(o).e("desc")),innerHTML:U(n(h).desc)},null,10,Eu)):(I(),E("div",{key:1,class:H(n(o).e("desc")),"aria-label":n(h).desc||""},[n(b)?(I(),E("span",{key:0,class:H([n(o).e("desc"),n(o).m("warning")])},"[有人回复我]",2)):n(y)?(I(),E("span",{key:1,class:H([n(o).e("desc"),n(o).m("warning")])},"[有人@我]",2)):n(G)?(I(),E("span",{key:2,class:H([n(o).e("desc"),n(o).m("warning")])},"[草稿]",2)):n(M)?(I(),E("span",{key:3,class:H([n(o).e("desc"),n(o).m("warning")])},"[特别关心]",2)):n(N)?(I(),E("span",{key:4,class:H([n(o).e("desc"),n(o).m("warning")])},"[有新公告]",2)):re("",!0),p("span",{innerHTML:$(n(h).desc||"")},null,8,xu)],10,bu)),p("div",{class:H(n(o).e("status"))},[n(f)?(I(),Me(ce,{key:0,class:"no_disturb","icon-class":"no_disturb",width:"14px",height:"14px"})):re("",!0),n(h).module&&n(h).time?(I(),E("span",{key:1,class:H(n(o).e("module_time"))},L(n(h).module),3)):re("",!0),n(h).folderName?(I(),E("span",{key:2,class:H(n(o).e("folder"))},L(n(h).folderName),3)):re("",!0)],2)],2)],2)],34)}}});const es=It(Nu,[["__scopeId","data-v-89ebf51e"]]);function xa(a){return window.MainWindowHelper.genRequest({baseUrl:"https://learn.chaoxing.com",url:"/apis/user/searchUserWithCnt",getParams:{...a},tokenSign:!0})}function ro(a){return!!(a&&a.trim().length===11&&/^\d+$/.test(a))}const ku=a=>(ss("data-v-cd241e56"),a=a(),ns(),a),Bu={class:"search"},Lu={class:"search_content"},Uu={class:"content_tab"},Du=["onClick"],Fu={class:"active_tab"},Hu={key:0,class:"loading"},Pu=ku(()=>p("img",{class:"rotate",src:go,alt:""},null,-1)),Ou={key:0,class:"empty"},Gu={key:0,class:"empty"},Ku={key:3,class:"record"},Qu={key:1,class:"message_wrap"},Vu={class:"msg_count"},Wu=["onClick"],Ju={class:"img"},qu=["src"],Xu={class:"content"},$u={class:"title"},zu={class:"time"},Yu=["innerHTML"],Zu={key:2,class:"empty"},ju={key:0,class:"empty"},ed=Pe({__name:"SearchDialog",props:{searchVisible:{type:Boolean,default:!1}},emits:["close"],setup(a,{emit:i}){const r=a,{t:l}=ts(),o=_t();Es();const{conversationListData:u,getHistorySearch:t,getUserInfo:f}=Ot(o),v=R({local:[],remote:[]}),h=R([]),A=R([]),y=R([]),b=R([]),M=R(""),N=R(null),G=R(0),Z=R(!1),W=Rs(),Q=R(""),V=R("contact"),X=R([{key:"contact",value:l("message.contactPeople")},{key:"group",value:l("message.groupsChat")},{key:"record",value:l("message.chatLog")},{key:"inbox",value:l("message.inbox")}]),$=Re(()=>j.values(u.value)),U=()=>{Q.value="",ue.value=1,v.value.remote=[],_.value=[],ae()},le=ee=>ee?xe.htmlEncodeByRegExp(ee).replaceAll(Q.value,`<span style='color: #3A8BFF'>${Q.value}</span>`):"",he=ee=>String(ee)==String(o.loginId),ce=new Date().getTime(),O=Re(()=>ee=>{var ne,be,Fe,ye,q,Be;if(he(ee==null?void 0:ee.from))return xe.getLocalUserAvatar({puid:o.puid});if((ee==null?void 0:ee.chatType)===((ne=ge)==null?void 0:ne.SINGLE)){let ke=(Fe=(be=u.value[ee.from])==null?void 0:be.conversationInfo)==null?void 0:Fe.avatarUrl[0],je=(ye=u.value[ee.from])==null?void 0:ye.puid;return ke=ke?"cximg://"+ke:vs,je?xe.getLocalUserAvatar({puid:je,timeStamp:ce}):ke}else{let ke=(q=St.value)==null?void 0:q.find(Tt=>Tt.uid==ee.from);ke==null||ke.pic;const je=((Be=ee.ext)==null?void 0:Be.fromPuid)||(ke==null?void 0:ke.puid);return je?xe.getLocalUserAvatar({puid:je,timeStamp:ce}):vs}}),ie=ee=>{var ne=/^[a-zA-Z\s]+$/;return ne.test(ee)},te=(ee,ne)=>{let be=ee.split(" ");const ye=be.join("").replace(ne,",").split(",");if(!ye.length)return-1;const q=ye[ye.length-1];if(!q)return-1;let Be="",ke=1;for(let je=be.length-1;je>=0;je--)if(Be+=be[je],Be==q)return ke=-1,ke;return ke},P=(ee,ne)=>ee.replaceAll(" ","").indexOf(ne),ae=j.debounce(async()=>{if(Q.value){Z.value=!0,pe.value=null,J.value=0,ue.value=1,x.value=!1,b.value=[],v.value.remote=[],_.value=[],N.value=null,G.value=0;let ee=[],ne=[];const be=j.filter($.value,ye=>{var q,Be;return(Be=(q=ye.conversationInfo)==null?void 0:q.name)==null?void 0:Be.includes(Q.value)});be.length>0&&be.forEach(ye=>{ye.conversationType==ge.SINGLE?ee.push(ye):ne.push(ye)}),ee=j.sortBy(ee,[ye=>!ye.isTop,ye=>-Math.max(ye.latestSendTime,(ye==null?void 0:ye.topTime)||0)]),v.value.local=ee,ne=j.sortBy(ne,[ye=>!ye.isTop,ye=>-Math.max(ye.latestSendTime,(ye==null?void 0:ye.topTime)||0)]),h.value=ne,await F();const Fe=await window.MessageDbHelper.queryMessageByMsg(Q.value,o.loginId);if(Fe.success&&Fe.rows.length){let ye=[];Fe.rows.forEach(q=>{const Be=q.conversationKey;u.value[Be]&&(q.msgCount==1?ye.push({...j.cloneDeep(u.value[Be]),queryMsg:q.msg}):ye.push({...j.cloneDeep(u.value[Be]),isHtml:!0,queryMsg:`<span style='color: #3A8BFF'>${q.msgCount}${l("message.relevantRecord")}</span>`}))}),y.value=ye}else A.value=[],y.value=[],M.value="";fe()}else Z.value=!1,v.value={local:[],remote:[]},h.value=[],A.value=[],y.value=[],b.value=[],M.value="",pe.value=null,J.value=0,ue.value=1,x.value=!1,_.value=[],N.value=null,G.value=0},200),ue=R(1),x=R(!1),_=R([]),F=async()=>{const ee=await window.MainWindowHelper.searchLocalUser(Q.value.toLowerCase());let ne=await window.MessageDbHelper.queryAllMsgContacts(),be=await window.RendererHelper.getUser(),Fe=Q.value?((ne==null?void 0:ne.rows)||[]).filter(q=>q.name.indexOf(Q.value)>=0||q.fullpinyin.indexOf(Q.value.toLocaleLowerCase())>=0||q.name.indexOf(Q.value.toLocaleLowerCase())>=0):[];Fe.forEach(q=>{try{q.description=q.deptDesc&&JSON.parse(q.deptDesc)[q.fid]||""}catch{q.description=""}});let ye=[];if(ro(Q.value)&&be.fid==1385){const q=await xa({kw:Q.value,pageSize:20,page:1});Hs(q)&&q.data.list.length>0&&(ye=q.data.list)}if(ee&&ee.length||Fe.length||ye.length){const q=[...ee,...Fe,...ye],[Be,ke]=j.partition(q,{fid:"-1"}),je=String(be==null?void 0:be.fid);ke.sort((et,rt)=>(et==null?void 0:et.fid)==je&&(rt==null?void 0:rt.fid)!=je?-1:(et==null?void 0:et.fid)!=je&&(rt==null?void 0:rt.fid)==je?1:Number(et==null?void 0:et.fid)-Number(rt==null?void 0:rt.fid));const Tt=j.uniqBy([...ke,...Be],"puid"),ds=j.reject(Tt,et=>j.some(v.value.local,rt=>et.uid==rt.conversationKey)),ws=j.orderBy(ds,[et=>P(et.fullpinyin,Q.value.toLowerCase()),et=>te(et.fullpinyin,Q.value.toLowerCase())]);_.value=ie(Q.value)?ws:ds,K()}},K=()=>{v.value.remote=_.value.slice(0,ue.value*20),ue.value++,v.value.remote.length==_.value.length&&(x.value=!0)},pe=R(null),J=R(0),fe=()=>{window.MainWindowHelper.searchLocalNotice(Q.value,pe.value).then(ee=>{var ne;ee&&ee.length&&(b.value.push(...ee),pe.value=(ne=ee[ee.length-1])==null?void 0:ne.insertTime,ee.length<20&&(J.value=1))}).finally(()=>{Z.value=!1})},oe=R(),_e=j.debounce(ee=>{!Z.value&&!x.value&&V.value=="contact"&&Q.value&&mt(()=>{const ne=oe.value;ne.wrapRef.scrollHeight-ee.scrollTop-ne.wrapRef.clientHeight<=100&&K()})},50),At=R(),Nt=j.debounce(ee=>{!Z.value&&!J.value&&V.value=="inbox"&&Q.value&&mt(()=>{const ne=At.value;ne.wrapRef.scrollHeight-ee.scrollTop-ne.wrapRef.clientHeight<=100&&fe()})},50),Oe=()=>{$e(),i("close")},Ne=ee=>{V.value=ee},De=async ee=>{if(ee.conversationType==ge.SINGLE){const ne=await window.RendererHelper.getMousePointInWindow(),be=await window.RendererHelper.getMousePointInScreen(),{width:Fe,height:ye}=await window.RendererHelper.getScreenWorkArea(),q=be.x+340>Fe?ne.x-340:ne.x,Be=be.y+200>ye?ne.y-200:ne.y;let ke=await window.RendererHelper.getUsersByTuids(String(ee.conversationKey));if(ke){const je=ke[0].puid;window.RendererHelper.openWindow("sview:/#/personalCard",{width:340,height:200,resizable:!1,marginLeft:q,marginTop:Be,subWindow:!0,frame:!1,id:"id_PersonInfoWindow"},{myPuid:o.getUserInfo.puid,puid:je})}}},Ze=async ee=>{const ne=await window.RendererHelper.getMousePointInWindow(),be=await window.RendererHelper.getMousePointInScreen(),{width:Fe,height:ye}=await window.RendererHelper.getScreenWorkArea(),q=be.x+340>Fe?ne.x-340:ne.x,Be=be.y+200>ye?ne.y-200:ne.y;window.RendererHelper.openWindow("sview:/#/personalCard",{width:340,height:200,resizable:!1,marginLeft:q,marginTop:Be,subWindow:!0,frame:!1,id:"id_PersonInfoWindow"},{myPuid:o.getUserInfo.puid,puid:ee.puid})},St=R([]),kt=async ee=>{if(N.value=null,G.value=0,A.value=[],await cs(ee.conversationKey),ee.conversationType==ge.GROUP){const ne=await window.MessageDbHelper.queryGroupMembers(ee.conversationKey);ne.success&&(St.value=ne.rows)}M.value=ee.conversationKey},Dt=R(!1),cs=async ee=>{var be,Fe,ye;Dt.value=!0;const ne=await window.MessageDbHelper.queryConversationMsgByMsg(ee,Q.value,N.value,o.loginId);ne!=null&&ne.success&&(ne!=null&&ne.rows.length)&&((be=A.value)!=null&&be.length?A.value.push(...ne==null?void 0:ne.rows):A.value=ne.rows,N.value=(Fe=ne.rows[ne.rows.length-1])==null?void 0:Fe.time,(ne.rows.length<20||((ye=ne.rows)==null?void 0:ye.length)==0)&&(G.value=1)),Dt.value=!1},tt=R(),ct=j.debounce(()=>{!Dt.value&&!G.value&&mt(()=>{const ee=tt.value;ee.wrapRef.scrollHeight-ee.wrapRef.scrollTop-ee.wrapRef.clientHeight<=100&&cs(M.value)})},50),$e=()=>{Q.value="",v.value={local:[],remote:[]},h.value=[],M.value="",A.value=[],b.value=[],y.value=[],Z.value=!1,pe.value=null,J.value=0,ue.value=1,x.value=!1,_.value=[],St.value=[],N.value=null,G.value=0},ht=ee=>{var be;const ne=Zt(ee);o.deleteStoreMsg(ne),Oe(),o.setChatTargetId(ne),W.push({path:"/message/conversation",query:{id:ne,chatType:ee.chatType,toMsgTime:ee.time,t:new Date().getTime()}}),(be=document.getElementById(ne))==null||be.scrollIntoView(),o.willToMessageId=ee.id},us=ee=>{$e(),Oe(),window.open(`https://notice.chaoxing.com/pc/notice/${ee.idCode}/detail`)},Kt=ee=>{var ne;o.deleteStoreMsg(ee.conversationKey),Oe(),o.setChatTargetId(ee.conversationKey),W.push({path:"/message/conversation",query:{id:ee.conversationKey,chatType:ee.conversationType,t:new Date().getTime()}}),(ne=document.getElementById(ee.conversationKey))==null||ne.scrollIntoView()},ys=async ee=>{Oe();const ne=String(ee.uid);if(ne){const be=await o.getLastMessage(String(ne)),Fe=be.success&&be.data?be.data.msg:"";await o.gatherConversation(String(ne),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:ee.name,pic:[ee.pic],chatType:ge.SINGLE,puid:String(ee.puid),msg:Fe}}),o.setChatTargetId(ne),W.push({path:"/message/conversation",query:{id:ne,chatType:ge.SINGLE,t:new Date().getTime()}}),mt(()=>{var ye;(ye=document.getElementById(ne))==null||ye.scrollIntoView()}),Ps({msgId:ne,puid:o.puid,type:Pt.SINGLE,status:1})}};return(ee,ne)=>{const be=Gt,Fe=Vs,ye=Ws;return I(),Me(Ts,{visible:r.searchVisible,"bottom-visible":!1,options:{"close-on-click-modal":!1},width:"70%","confirm-text":n(l)("message.done"),title:n(l)("message.filterby"),onClose:Oe,"close-text":n(l)("message.cancel")},{default:He(()=>[p("div",Bu,[Te(Fe,{modelValue:Q.value,"onUpdate:modelValue":ne[0]||(ne[0]=q=>Q.value=q),modelModifiers:{trim:!0},class:"search_input",placeholder:n(l)("message.search"),onInput:n(ae)},{suffix:He(()=>[Q.value.length?(I(),Me(be,{key:0,class:"clear","icon-class":"input_clear",width:"14px",height:"14px",onClick:U})):re("",!0),Te(be,{"icon-class":"search",width:"18px",height:"18px",color:"rgba(172, 180, 191, 1)"})]),_:1},8,["modelValue","placeholder","onInput"]),p("div",Lu,[p("div",Uu,[(I(!0),E(Ke,null,ot(X.value,q=>(I(),E("div",{class:"tab_item",key:q.key,onClick:Be=>Ne(q.key),style:dt({color:V.value==q.key?"#3A8BFF":"#474C59"})},[gt(L(q.value)+" ",1),Ct(p("div",Fu,null,512),[[xt,V.value==q.key]])],12,Du))),128))]),Z.value?(I(),E("div",Hu,[Pu,gt(L(n(l)("message.loadingWait"))+"… ",1)])):re("",!0),V.value=="contact"?(I(),Me(ye,{key:1,class:"search_scrollbar",ref_key:"contactScrollbarRef",ref:oe,onScroll:n(_e)},{default:He(()=>[(I(!0),E(Ke,null,ot(v.value.local,(q,Be)=>(I(),Me(es,{key:q.conversationKey,"is-conversation":!1,keyword:Q.value,"item-config":{title:q.conversationInfo.name,module:n(l)("message.messages"),time:n(xe).timeago(q.latestSendTime,!0),desc:q.latestMessage.msg,chatIco:q.conversationInfo.avatarUrl,...q},onHandleClick:ke=>Kt(q),onAvatorClick:De},null,8,["keyword","item-config","onHandleClick"]))),128)),(I(!0),E(Ke,null,ot(v.value.remote,(q,Be)=>(I(),Me(es,{key:q.uid,"is-conversation":!1,keyword:Q.value,"item-config":{title:q.name,module:n(l)("message.organisationalStructure"),desc:q.description,chatIco:[q.pic],...q},onHandleClick:ke=>ys(q),onAvatorClick:Ze},null,8,["keyword","item-config","onHandleClick"]))),128)),Q.value?re("",!0):(I(),E("div",Ou,L(n(l)("message.searchkeywords")),1))]),_:1},8,["onScroll"])):V.value=="group"?(I(),Me(ye,{key:2,class:"search_scrollbar"},{default:He(()=>[(I(!0),E(Ke,null,ot(h.value,(q,Be)=>(I(),Me(es,{key:q.conversationKey,"is-conversation":!1,keyword:Q.value,"item-config":{title:q.conversationInfo.name,module:n(l)("message.messages"),time:n(xe).timeago(q.latestSendTime,!0),desc:q.latestMessage.msg,chatIco:q.conversationInfo.avatarUrl,...q},onHandleClick:ke=>Kt(q)},null,8,["keyword","item-config","onHandleClick"]))),128)),Q.value?re("",!0):(I(),E("div",Gu,L(n(l)("message.searchkeywords")),1))]),_:1})):V.value=="record"?(I(),E("div",Ku,[Q.value?(I(),Me(ye,{key:0,class:"people_scrollbar"},{default:He(()=>[(I(!0),E(Ke,null,ot(y.value,(q,Be)=>(I(),Me(es,{key:q.conversationKey,"is-conversation":!1,keyword:Q.value,"item-config":{title:q.conversationInfo.name,isHtml:!!q.isHtml,desc:q.queryMsg,chatIco:q.conversationInfo.avatarUrl,...q},onHandleClick:ke=>kt(q),onAvatorClick:De,style:dt({background:M.value==q.conversationKey?"#E4ECFF":"#fff","border-radius":"4px"})},null,8,["keyword","item-config","onHandleClick","style"]))),128))]),_:1})):re("",!0),y.value.length?(I(),E("div",Qu,[p("div",Vu,L(n(l)("message.found"))+L(A.value.length)+L(n(l)("message.rcrecord")),1),Te(ye,{ref_key:"msgScrollbarRef",ref:tt,class:"message_scrollbar",onScroll:n(ct)},{default:He(()=>[(I(!0),E(Ke,null,ot(A.value,(q,Be)=>(I(),E("div",{key:q.id,class:"message_item",style:dt({"padding-top":Be==0?"0":"14px"}),onClick:ke=>ht(q)},[p("div",Ju,[p("img",{src:n(O)(q),alt:""},null,8,qu)]),p("div",Xu,[p("div",$u,[gt(L((q==null?void 0:q.sendName)||"")+" ",1),p("span",zu,L(n(xe).timeago(q.time,!0)),1)]),p("div",{class:"desc",innerHTML:le(q.msg)},null,8,Yu)])],12,Wu))),128))]),_:1},8,["onScroll"])])):re("",!0),Q.value?re("",!0):(I(),E("div",Zu,L(n(l)("message.searchkeywords")),1))])):V.value=="inbox"?(I(),Me(ye,{key:4,ref_key:"ScrollbarRef",ref:At,class:"search_scrollbar",onScroll:n(Nt)},{default:He(()=>[(I(!0),E(Ke,null,ot(b.value,(q,Be)=>(I(),Me(es,{key:q.idCode,"is-conversation":!1,keyword:Q.value,"item-config":{title:q.title,module:q.sendTime.substring(5),desc:`${q.toNames.join(",")}`,chatIco:[q.logo],...q},onHandleClick:ke=>us(q)},null,8,["keyword","item-config","onHandleClick"]))),128)),Q.value?re("",!0):(I(),E("div",ju,L(n(l)("message.searchkeywords")),1))]),_:1},8,["onScroll"])):re("",!0)])])]),_:1},8,["visible","confirm-text","title","close-text"])}}});const td=It(ed,[["__scopeId","data-v-cd241e56"]]);function sd(){return new Worker(""+new URL("msgSearch-ad197726.js",import.meta.url).href)}const To=a=>(ss("data-v-6a6e1f42"),a=a(),ns(),a),nd={class:"search"},od={key:0,class:"loading"},ad=To(()=>p("img",{class:"rotate",src:go,alt:""},null,-1)),id={key:0,class:"search_history"},rd={class:"title search_history_title"},ld={class:"search_history_list"},cd=["onClick"],ud=To(()=>p("div",{class:"drive"},null,-1)),dd=To(()=>p("div",{class:"img"},[p("img",{src:Vr,alt:""})],-1)),gd={class:"content"},fd={class:"title"},pd=["onContextmenu","onClick"],md={class:"affix_box_img"},vd=["src"],hd={class:"affix_box_text"},yd={class:"affix_box_text_main"},wd={class:"vin_text"},Cd={key:0,class:"remark"},Id={class:"desc"},_d={class:"time"},Ad={class:"folder"},Sd={key:0,class:"show_all"},Td={key:1,class:"suggest_type"},Md={key:2,class:"suggest_type"},Rd={key:3,class:"suggest_type"},Ed={key:1,class:"oneConversation"},bd={class:"suggest_type"},xd={class:"name"},Nd=["onClick"],kd={class:"img"},Bd=["src"],Ld={class:"content"},Ud={class:"title"},Dd={class:"time"},Fd=["innerHTML"],Zs=3,Hd=Pe({__name:"index",setup(a,{expose:i}){const{t:r}=ts(),l=Rs(),o=_t(),u=Es(),{conversationListData:t,getHistorySearch:f,getCurrentChatId:v,getMsgFolderList:h,getMsgFolderConversations:A,isMultipleEdit:y,subscribesConversations:b}=Ot(o),M=R({local:[],remote:[]}),N=R([]),G=R([]),Z=R([]),W=R(""),Q=R([]),V=R(!1),X=R([]),$=R([]),U=R(""),le=R("#1B1F26"),he=R("#474C59"),ce=R(!1),O=R(!1),ie=R(!1),te=R(!1),P=R(!1),ae=R(!1),ue=R(!1),x=R(!0),_=R(""),F=R(),{visible:K,top:pe,left:J,myPuid:fe,puid:oe,handleClose:_e}=qo({container:F}),At=R(!1),Nt=R(!1),Oe=R(!1),Ne=R(!1);function De(){if(!U.value){Ne.value=!1;return}if([At.value,Oe.value,Nt.value].some(c=>c)||ue.value){Ne.value=!1;return}const s=[tt.value,N.value,ke.value,je.value,G.value,X.value,Q.value].every(c=>c.length===0);console.log("searchResult",s),Ne.value=s}const Ze=Re(()=>o.getReplyConversation),St=Re(()=>o.getGroupConversation),kt=Re(()=>o.getVerifyConversation),Dt=Re(()=>o.getCxofficialConversation),cs=Re(()=>{let s=[Ze==null?void 0:Ze.value,St==null?void 0:St.value,kt==null?void 0:kt.value];return o.hasCxOfficial&&s.push(Dt.value),s.push(...j.cloneDeep(b.value)||[]),s}),tt=R([]),ct={[z.VERIFY]:r("message.vinformation"),[z.GROUP]:r("message.groupInvitation"),[z.REPLY]:r("message.comments"),[z.CXOFFICIAL]:r("message.cxofficial")},$e={[z.VERIFY]:ho,[z.GROUP]:vo,[z.REPLY]:mo,[z.CXOFFICIAL]:yo},ht=Re(()=>f.value),us=Re(()=>j.values(t.value)),Kt=Re(()=>s=>{var w;const c=A.value.find(S=>S.msgId==s.conversationKey||Ss[S.msgId]==s.conversationKey);return c&&((w=h.value.find(S=>S.id==c.folderId))==null?void 0:w.name)||""}),ys=Re(()=>{let s="214px";return V.value?_.value=="en_US"?s="212px":s="218px":s=`${254-(Number(u.getCreateNewChatGroup)+ +!V.value)*40}px`,{width:s}}),ee=s=>String(s)==String(o.loginId),ne=new Date().getTime(),be=s=>{s.target.src=vs},Fe=Re(()=>s=>{var c,w,S,k,C,de;if(ee(s==null?void 0:s.from))return xe.getLocalUserAvatar({puid:o.puid});if((s==null?void 0:s.chatType)===((c=ge)==null?void 0:c.SINGLE)){let we=(S=(w=t.value[s.from])==null?void 0:w.conversationInfo)==null?void 0:S.avatarUrl[0],Ae=(k=t.value[s.from])==null?void 0:k.puid;return we=we?"cximg://"+we:vs,Ae?xe.getLocalUserAvatar({puid:Ae,timeStamp:ne}):we}else{let we=(C=$s.value)==null?void 0:C.find(se=>se.uid==s.from);we==null||we.pic;const Ae=((de=s.ext)==null?void 0:de.fromPuid)||(we==null?void 0:we.puid);return Ae?xe.getLocalUserAvatar({puid:Ae,timeStamp:ne}):vs}}),ye=s=>s?xe.htmlEncodeByRegExp(s).replaceAll(U.value,`<span style='color: #3A8BFF'>${U.value}</span>`):"",q=Re(()=>{var c;let s=X.value.find(w=>w.conversationKey==W.value);return((c=s==null?void 0:s.conversationInfo)==null?void 0:c.name)+" "||""}),Be=Re(()=>{let s=$.value.find(c=>c.conversationKey==W.value);return(s==null?void 0:s.msgCount)||0}),ke=Re(()=>{const s=j.sortBy(M.value.local,[c=>!c.isTop,c=>-Math.max(c.latestSendTime,(c==null?void 0:c.topTime)||0)]);return Tt.value?Zs-N.value.length>0?s.slice(0,Zs-N.value.length):[]:s}),je=Re(()=>Tt.value?Zs-ke.value.length-N.value.length>0?M.value.remote.slice(0,Zs-ke.value.length-N.value.length):[]:M.value.remote),Tt=Re(()=>M.value.remote.length+M.value.local.length+N.value.length>3&&!P.value),ds=s=>{if(ce.value)return;s.preventDefault(),document.body.click(),le.value="#fff",ce.value=!0;const c=[];c.push([{name:r("message.newChat"),handler:()=>{O.value=!0,w()}},{name:r("message.newClass"),handler:()=>{ie.value=!0,w()}},{name:r("message.addFriends"),handler:()=>{ws(),w()}},{name:r("message.newFolder"),handler:()=>{Mt.value=void 0,te.value=!0,w()}},{name:r("message.batchEditing"),handler:()=>{o.setMultipleEditStatus(!0),w()}}]);const{destroy:w}=Lt(Fs,{menuList:c,left:204,top:52,itemHoverColor:"#F0F6FF",bottomBorder:!1}),S=()=>{le.value="#1B1F26",ce.value=!1,w()};xe.windowClickOnce(S)},ws=()=>{const{destroy:s}=Lt($c,{cancelBtn:{text:r("message.cancel"),callback(){s()}}})},et=()=>{le.value=ce.value?"#fff":"#1B1F26"};ls(async()=>{document.addEventListener("click",xs),_.value=await window.MainWindowHelper.getLanguage()}),Fa(()=>{document.removeEventListener("click",xs)});const rt=R(!1),Xe=R(),Ee=R({}),xs=s=>{Xe.value&&!Xe.value.contains(s.target)&&(rt.value=!1)},Cs=()=>{U.value="",Rt.value=[],$t.value=null,zt.value=0,Yt.value=null,Jt.value=0,Vt.value=1,Q.value=[],M.value.remote=[],Wt.value=!1,Ve(),De()},Ns=async()=>{var S,k;rt.value=!1,o.updateConversationTop(Ee.value.conversationKey,(S=Ee.value)!=null&&S.isTop?0:1,((k=Ee.value)==null?void 0:k.conversationType)==ge.SINGLE?1:2);let s=M.value.local.find(C=>C.conversationKey==Ee.value.conversationKey);s&&(s.isTop=s.isTop?0:1);let c=G.value.find(C=>C.conversationKey==Ee.value.conversationKey);c&&(c.isTop=c.isTop?0:1);let w=X.value.find(C=>C.conversationKey==Ee.value.conversationKey);w&&(w.isTop=w.isTop?0:1)},gs=async()=>{rt.value=!1,v.value==Ee.value.conversationKey&&(l.push("/message/msgcover"),o.setChatTargetId(0)),await o.deleteConversationItem(Ee.value.conversationKey,Ee.value.conversationType==ge.GROUP),G.value=G.value.filter(s=>s.conversationKey!=Ee.value.conversationKey),M.value.local=M.value.local.filter(s=>s.conversationKey!=Ee.value.conversationKey),X.value=X.value.filter(s=>s.conversationKey!=Ee.value.conversationKey)},ks=async(s,c)=>{if(s.conversationType==ge.SINGLE){const{x:w,y:S}=c;let k=await window.RendererHelper.getUsersByTuids(String(s.conversationKey));if(k){oe.value=String(k[0].puid),fe.value=o.getUserInfo.puid;const C=window.innerHeight-350;pe.value=S>C?C:S,J.value=w+30,K.value=!0}}},Ft=async(s,c)=>{const{x:w,y:S}=c;fe.value=o.getUserInfo.puid,oe.value=s.puid,J.value=w+30;const k=window.innerHeight-350;pe.value=S>k?k:S,K.value=!0},Qt=window.innerHeight,Mt=R({}),Is=async()=>{var s;o.updateMsgFolderInfo(Mt.value.id,{isTop:(s=Mt.value)!=null&&s.isTop?0:1})},_s=async()=>{te.value=!0},m=()=>{const{destroy:s}=Lt(Tn,{title:r("message.reminder"),content:"删除后，文件夹内的会话将移动到根目录下",cancelBtn:{text:r("message.cancel"),callback(){s()}},confirmBtn:{text:r("message.delete"),async callback(){(await uo({id:Mt.value.id,puid:o.puid})).result==1&&(o.deleteMsgFolderInfo(Mt.value.id),N.value=N.value.filter(w=>w.id!=Mt.value.id)),s()}}})},B=s=>{fs(),Bt(),o.setSearchFolderInfo(s)},T=(s,c)=>{s.preventDefault(),document.body.click(),Mt.value=c;const w=[[{icon:Mt.value.isTop?"unpin":"top",name:Mt.value.isTop?r("message.unpin"):r("message.top"),handler:()=>{k(),Is()}}],[{icon:"modify",name:r("message.modify"),handler:()=>{k(),_s()}}],[{icon:"delete_con",name:r("message.delete"),handler:()=>{k(),m()}}]],S=(s==null?void 0:s.y)+w.length*40+12>Qt?(s==null?void 0:s.y)-w.length*40-12:s==null?void 0:s.y,{destroy:k}=Lt(Fs,{menuList:w,left:s==null?void 0:s.x,top:S,bottomBorder:!1});xe.windowClickOnce(k)},D=(s,c)=>{s.preventDefault(),document.body.click(),Ee.value=c;let w=Ee.value.conversationKey!=z.REPLY&&Ee.value.conversationKey!=z.GROUP&&Ee.value.conversationKey!=z.VERIFY&&Ee.value.conversationKey!=z.CXOFFICIAL;c.type==10&&(w=!1);const S=[];S.push([{icon:Ee.value.isTop?"unpin":"top",name:Ee.value.isTop?r("message.unpin"):r("message.top"),handler:()=>{C(),w?Ns():Y()}}]),w&&S.push([{icon:"delete_con",name:r("message.delete"),handler:()=>{C(),gs()}}]);const k=(s==null?void 0:s.y)+S.length*40+12>Qt?(s==null?void 0:s.y)-S.length*40-12:s==null?void 0:s.y,{destroy:C}=Lt(Fs,{menuList:S,left:s==null?void 0:s.x,top:k,bottomBorder:!1});xe.windowClickOnce(C)},Y=async()=>{var s,c,w,S;if(Ee.value.conversationKey==z.REPLY)o.updateReplyConversationTop((s=Ee.value)!=null&&s.isTop?0:1,Xt[z.REPLY]);else if(Ee.value.conversationKey==z.GROUP)o.updateGroupConversationTop((c=Ee.value)!=null&&c.isTop?0:1,Xt[z.GROUP]);else if(Ee.value.conversationKey==z.VERIFY)o.updateVerifyConversationTop((w=Ee.value)!=null&&w.isTop?0:1,Xt[z.VERIFY]);else if(Ee.value.conversationKey==z.CXOFFICIAL)o.updateCxofficialConversationTop((S=Ee.value)!=null&&S.isTop?0:1,Xt[z.CXOFFICIAL]);else if(Ee.value.type==10){Ee.value.isTop=Ee.value.isTop?0:1;const k=Ee.value.isTop?new Date().getTime():0,C=Ee.value.isTop?1:2,de=b.value.find(we=>we.conversationKey==Ee.value.conversationKey);de&&(de.topTime=k,de.isTop=Ee.value.isTop),await o.updateTop(Ee.value.conversationKey,4,C,k)}},Se=()=>{P.value=!0,!Wt.value&&P.value&&Bs()},Ue=s=>{var k;s.preventDefault(),document.body.click();const c=s.target;let w=((k=c==null?void 0:c.value)==null?void 0:k.substring(c.selectionStart,c.selectionEnd))||"";const{destroy:S}=Lt(Fs,{menuList:[[hn({icon:w.length>0?"cut":"cut-disable",name:r("message.shear"),menuHandler:async()=>{var C,de;console.log("剪切选中的内容"),window.RendererHelper.setClipboardByMainProcess(`<p>${w}</p>`,w),U.value=((C=c==null?void 0:c.value)==null?void 0:C.slice(0,c.selectionStart))+((de=c==null?void 0:c.value)==null?void 0:de.slice(c.selectionEnd+1))}}),hn({icon:w.length>0?"copy":"copy-disable",name:r("message.Copy"),menuHandler:async()=>{window.RendererHelper.setClipboardByMainProcess(`<p>${w}</p>`,w)}}),hn({icon:"paste",name:r("message.paste"),menuHandler:async()=>{document.execCommand("paste")}}),hn({icon:U.value?"select-all":"select-all-disable",name:r("message.selectAll"),menuHandler:async()=>{c==null||c.select()}})]],left:s.x+10,top:s.y});xe.windowClickOnce(S)},Qe=async()=>await window.MessageDbHelper.queryMessageByMsg(U.value,o.loginId),Ge=async()=>await window.MainWindowHelper.searchLocalUser(U.value.toLowerCase()),lt=async()=>await window.MessageDbHelper.queryAllMsgContacts(),Ht=async()=>await window.RendererHelper.getUser();let ze;const Ve=j.debounce(async()=>{if(ze&&(ze==null||ze.terminate()),ze=null,U.value){let s=function(){console.log("queryUser 结束"),ue.value=!1,Ae=!0,Ae&&se&&w(),(Ae&&(!ro(U.value)||o.selfUserInfo.fid!=1385)||Ae&&me)&&(Nt.value=!1),De()},c=function(){console.log("queryMsg 结束"),ue.value=!1,se=!0,Oe.value=!1,Ae&&se&&w(),De()},w=function(){console.log("关闭 worker 线程"),ze==null||ze.terminate(),ze=null};$t.value=null,zt.value=0,Yt.value=null,Jt.value=0,Vt.value=1,M.value={local:[],remote:[]},G.value=[],Z.value=[],Q.value=[],X.value=[],$.value=[],W.value="",x.value=!0,Wt.value=!1,Rt.value=[],tt.value=[],N.value=[],ue.value=!0,Nt.value=!0,Oe.value=!0,tt.value=cs.value.filter(ve=>{var Ce;return ct[ve.conversationKey]&&((Ce=ct[ve.conversationKey])==null?void 0:Ce.indexOf(U.value))>=0||ve.name&&ve.name.indexOf(U.value)>=0});let S=[],k=[];const C=j.filter(us.value,ve=>{var Ce,ft;return(ft=(Ce=ve.conversationInfo)==null?void 0:Ce.name)==null?void 0:ft.includes(U.value)});C.length>0&&C.forEach(ve=>{ve.conversationType==ge.SINGLE?S.push(ve):k.push(ve)}),M.value.local=S,k=j.sortBy(k,[ve=>!ve.isTop,ve=>-Math.max(ve.latestSendTime,(ve==null?void 0:ve.topTime)||0)]),G.value=k,N.value=j.filter(h.value,ve=>{var Ce;return(Ce=ve.name)==null?void 0:Ce.includes(U.value)});for(let ve of N.value){ve.isTop=0;for(let Ce of o.getTopConversation)ve.id==Ce.sessionId&&(ve.isTop=1,Ce.sort=ve.sort||0)}Js(),De(),ze=new sd;const de=ua(ze);let we=await new de(fa({queryMessageByMsg:Qe,searchLocalUser:Ge,queryAllMsgContacts:lt,getUser:Ht})),Ae=!1,se=!1,me=!1;const We=we.queryUser(U.value,j.cloneDeep(M.value.local),String(o.selfUserInfo.fid)).then(ve=>{ve!=null&&ve.success&&(me?Rt.value=Rt.value.concat(ve.data):Rt.value=ve.data,Bs())}).finally(()=>{s()});Lo(We)===!1&&s(),ro(U.value)&&o.selfUserInfo.fid==1385&&xa({kw:U.value,pageSize:20,page:1}).then(ve=>{if(Hs(ve)){if(!(Array.isArray(ve.data.list)&&ve.data.list.length>0))return;if(Ae)for(const Ce of ve.data.list)Rt.value.find(it=>it.uid==Ce.uid)||Rt.value.push(Ce);else Rt.value=ve.data.list;Bs()}else console.error("[searchUserWithPhone] Error:",ve.errorMsg),vt({content:ve.errorMsg,duration:2e3})}).finally(()=>{me=!0,Ae&&me&&(Nt.value=!1)});const st=Date.now(),Le=j.cloneDeep(t.value);console.log("🚀 Perf: 克隆会话列表数据耗时：",Date.now()-st,"ms");const yt=we.queryMsg(U.value,Le).then(ve=>{var Ce,ft;ve!=null&&ve.success&&($.value=(Ce=ve.data)==null?void 0:Ce.queryConversationList,X.value=(ft=ve.data)==null?void 0:ft.msgConversiton)}).finally(()=>{c()});Lo(yt)===!1&&c()}else ue.value=!1,M.value={local:[],remote:[]},G.value=[],Z.value=[],Q.value=[],X.value=[],$.value=[],W.value="",x.value=!0,$t.value=null,zt.value=0,Yt.value=null,Jt.value=0,Vt.value=1,Wt.value=!1,Rt.value=[],tt.value=[],N.value=[]},300),Vt=R(1),Wt=R(!1),Rt=R([]),Bs=()=>{M.value.remote=Rt.value.slice(0,Vt.value*20),Vt.value++,M.value.remote.length==Rt.value.length&&(Wt.value=!0)},$t=R(null),zt=R(0),Js=()=>{console.log("开始查询收件箱数据"),ue.value=!0,At.value=!0;const s=Date.now();window.MainWindowHelper.searchLocalNotice(U.value,$t.value).then(c=>{var w;console.log("🚀 Perf: 查询收件箱数据耗时：",Date.now()-s,"ms"),c&&c.length&&(Q.value.push(...c),$t.value=(w=c[c.length-1])==null?void 0:w.insertTime,(c.length<20||(c==null?void 0:c.length)==0)&&(zt.value=1))}).finally(()=>{ue.value=!1,At.value=!1})},qs=R(),Xs=j.debounce(s=>{!ue.value&&(!zt.value||!Wt.value&&P.value)&&U.value&&x.value&&mt(()=>{const c=qs.value,w=c.wrapRef.scrollHeight-s.scrollTop-c.wrapRef.clientHeight;s.scrollTop>(M.value.remote.length-16)*64&&!Wt.value&&P.value?Bs():w<=c.wrapRef.scrollHeight*60/c.wrapRef.clientHeight&&Js()})},50),Fn=()=>{o.clearHistory()},un=s=>{console.log("Click Search History",s),Rt.value=[],$t.value=null,zt.value=0,Yt.value=null,Jt.value=0,Q.value=[],Vt.value=1,M.value.remote=[],Wt.value=!1,U.value=s,ue.value=!0,Ve(),De()},Hn=()=>{const s=j.sumBy(b.value,"unreadMessageNum");if(!(()=>j.values(t.value).filter(S=>S.unreadMessageNum&&!S.isNoDisturb).reduce((S,k)=>S+k.unreadMessageNum,0)+Number(o.getInboxUnreadCount)+Number(o.getGroupInviteCount)+Number(o.getVerifyMsgCount)+Number(o.getCxofficialMsgCount)+Number(o.getReplyMeCount)+s)()){vt({content:r("message.noUnreadDot"),zIndex:2024,duration:3e3});return}const{destroy:w}=Lt(Tn,{title:r("message.reminder"),content:r("message.clearUnread"),cancelBtn:{text:r("message.cancel"),callback(){w()}},confirmBtn:{text:r("message.cleanUp"),async callback(){o.setInboxUnreadCount(0);const S=j.values(t.value).filter(C=>C.unreadMessageNum&&!C.isNoDisturb);for(let C of S)await o.clearUnreadNum(C.conversationKey);const k=await pi(o.puid);k.result==1&&(o.setReplyMeCount(0),o.setVerifyMsgCount(0),o.setGroupInviteCount(0),o.setCxofficialMsgCount(0),b.value.forEach(C=>C.unreadMessageNum=0)),console.log("清除红点",k),w()}}})},Bt=()=>{ue.value=!1,X.value=[],$.value=[],W.value="",V.value=!1,U.value="",M.value={local:[],remote:[]},G.value=[],Z.value=[],Q.value=[],P.value=!1,x.value=!0,$t.value=null,zt.value=0,Vt.value=1,Yt.value=null,Jt.value=0,Wt.value=!1,Rt.value=[],tt.value=[],$s.value=[],N.value=[],ze&&(ze==null||ze.terminate()),ze=null},Pn=s=>{fs(),Bt(),window.open(`https://notice.chaoxing.com/pc/notice/${s.idCode}/detail`)},$s=R([]),Yt=R(null),Jt=R(0),On=async s=>{const c=$.value.find(w=>w.conversationKey==s.conversationKey);if(Yt.value=null,Jt.value=0,Z.value=[],c)if((c==null?void 0:c.msgCount)==1)fn({key:s.conversationKey,chatType:s.conversationType,time:c.time});else{if(s.conversationType==ge.GROUP){const w=await window.MessageDbHelper.queryGroupMembers(s.conversationKey);w.success&&($s.value=w.rows)}await dn(s.conversationKey),W.value=s.conversationKey,x.value=!1}else Ys(s)},zs=R(!1),dn=async s=>{var w,S,k;zs.value=!0;const c=await window.MessageDbHelper.queryConversationMsgByMsg(s,U.value,Yt.value,o.loginId);c!=null&&c.success&&(c!=null&&c.rows.length)&&((w=Z.value)!=null&&w.length?Z.value.push(...c==null?void 0:c.rows):Z.value=c.rows,Yt.value=(S=c.rows[c.rows.length-1])==null?void 0:S.time,(c.rows.length<20||((k=c.rows)==null?void 0:k.length)==0)&&(Jt.value=1)),zs.value=!1},gn=R(),Gn=j.debounce(()=>{!zs.value&&!Jt.value&&mt(()=>{const s=gn.value;s.wrapRef.scrollHeight-s.wrapRef.scrollTop-s.wrapRef.clientHeight<=100&&dn(W.value)})},50),fn=async s=>{var w;fs(),o.deleteStoreMsg(s.key),Bt(),o.setChatTargetId(s.key),l.push({path:"/message/conversation",query:{id:s.key,chatType:s.chatType,toMsgTime:s.time,t:new Date().getTime()}}),(w=document.getElementById(s.key))==null||w.scrollIntoView();let c;if(s.msgid)c=s.msgid;else{const S=await window.MessageDbHelper.queryMessageByKeyAndTime(s.key,s.time);c=S==null?void 0:S.msgid}c&&(o.willToMessageId=c)},Ys=s=>{var c;fs(),o.deleteStoreMsg(s.conversationKey),Bt(),o.setChatTargetId(s.conversationKey),l.push({path:"/message/conversation",query:{id:s.conversationKey,chatType:s.conversationType,t:new Date().getTime()}}),(c=document.getElementById(s.conversationKey))==null||c.scrollIntoView()},Kn=s=>s!=null&&s.puid?`https://photo.chaoxing.com/p/${s.puid}_80?flag=1&psize=100_100c&ext=jpg`:s.pic,pn=async s=>{fs(),Bt();const c=String(s.uid);if(c){const w=await o.getLastMessage(String(c)),S=w.success&&w.data?w.data.msg:"";await o.gatherConversation(String(c),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:s.name,pic:[Kn(s)],chatType:ge.SINGLE,puid:String(s.puid),msg:S}}),o.setChatTargetId(c),l.push({path:"/message/conversation",query:{id:c,chatType:ge.SINGLE,t:new Date().getTime()}}),mt(()=>{var k;(k=document.getElementById(c))==null||k.scrollIntoView()}),Ps({msgId:c,puid:o.puid,type:Pt.SINGLE,status:1})}},Qn=s=>{switch(fs(),Bt(),s.conversationKey){case z.GROUP:o.setGroupInviteCount(0),o.setChatTargetId(-4),l.push({path:"/message/group",query:{id:z.GROUP}});break;case z.VERIFY:o.setVerifyMsgCount(0),o.setChatTargetId(-5),l.push({path:"/message/verify",query:{id:z.VERIFY}});break;case z.REPLY:o.setReplyMeCount(0),o.setChatTargetId(-3),l.push({path:"/message/reply",query:{id:z.REPLY}});break;case z.CXOFFICIAL:o.setCxofficialMsgCount(0),o.setChatTargetId(-6),l.push({path:"/message/cxofficial",query:{id:z.CXOFFICIAL}});break;default:if(s.type==10){const c=b.value.find(w=>w.conversationKey==s.conversationKey);c&&(c.unreadMessageNum=0),o.setChatTargetId(s.conversationKey),o.setSubscribesUrl(s.messageListUrl),l.push({path:"/message/cxofficial",query:{id:s.conversationKey}})}break}mt(()=>{var c;(c=document.getElementById(s.conversationKey))==null||c.scrollIntoView()})},fs=()=>{if(U.value){const s=j.cloneDeep(Oo(ht.value));if((s.length===0||s===null)&&(console.log(">>>>>>_rawSearchHistory为空是新建一条"),ht.value.unshift(U.value)),s.length>0){console.log(">>>>>>_rawSearchHistory不为空时开始筛选");const c=s.findIndex(w=>w===U.value);c===-1||ht.value.splice(c,1),ht.value.unshift(U.value)}}},Vn=()=>{ie.value=!1},Wn=()=>{te.value=!1,Mt.value=void 0},Jn=()=>{O.value=!1},mn=()=>{Bt(),ae.value=!1},e=()=>{ae.value=!0},g=()=>{ce.value=!1,V.value=!0};return i({closeSearchVisible:mn,searchDialogVisible:ae,updateSearchResult:s=>{const{tuid:c,name:w}=s??{};Rt.value.forEach(S=>{S.uid===c&&(S.name=w)})}}),(s,c)=>{const w=Gt,S=Vs,k=Ws;return I(),E(Ke,null,[Ct(p("div",nd,[Te(S,{modelValue:U.value,"onUpdate:modelValue":c[0]||(c[0]=C=>U.value=C),modelModifiers:{trim:!0},class:"search_input",size:"small",placeholder:n(r)("message.search"),style:dt(n(ys)),onFocus:g,onInput:c[1]||(c[1]=()=>{n(Ve)(),De()}),onContextmenu:rs(Ue,["stop"])},{prefix:He(()=>[Te(w,{"icon-class":"search",width:"13px",height:"13px",color:"rgba(172, 180, 191, 1)"})]),suffix:He(()=>[U.value.length?(I(),Me(w,{key:0,class:"clear","icon-class":"input_clear",width:"14px",height:"14px",onClick:Cs})):re("",!0)]),_:1},8,["modelValue","placeholder","style","onContextmenu"]),V.value?re("",!0):(I(),E("div",{key:0,class:H(["search_ai","search_add"]),onMouseenter:c[2]||(c[2]=C=>he.value="#fff"),onMouseleave:c[3]||(c[3]=C=>he.value="#474C59"),onClick:Hn},[Te(w,{"icon-class":"clearunread",width:"18px",height:"18px",color:he.value},null,8,["color"])],32)),V.value?(I(),E("div",{key:1,class:"close_search",onClick:Bt,style:dt(_.value=="en_US"?{width:"39px"}:{})},L(n(r)("message.cancel")),5)):re("",!0),n(u).getCreateNewChatGroup&&!V.value?(I(),E("div",{key:2,class:H(["search_add",ce.value?"active":""]),onMouseenter:c[4]||(c[4]=C=>le.value="#fff"),onMouseleave:et,onClick:c[5]||(c[5]=rs(C=>ds(C),["stop"]))},[Te(w,{"icon-class":"msg_add",width:"16px",height:"16px",color:le.value},null,8,["color"])],34)):re("",!0)],512),[[xt,!n(y)]]),V.value&&ue.value?(I(),E("div",od,[ad,gt(" "+L(n(r)("message.loadingWait"))+"… ",1)])):re("",!0),V.value?(I(),E("div",{key:1,class:"search_content",ref_key:"container",ref:F},[U.value?re("",!0):(I(),E("div",id,[p("div",rd,[p("span",null,L(n(r)("message.recentSearches")),1),Te(w,{class:"clear_search_history","icon-class":"delete",width:"15px",height:"15px",onClick:Fn})]),p("div",ld,[n(ht).length>0?(I(!0),E(Ke,{key:0},ot(n(ht),(C,de)=>(I(),E("span",{class:"search_history_item",key:C+de,onClick:we=>un(C)},[p("span",null,L(C),1)],8,cd))),128)):re("",!0)]),ud,p("div",{class:"search_all",onClick:e},[dd,p("div",gd,[p("div",fd,L(n(r)("message.filterby")),1),p("div",{class:"desc",style:dt(_.value=="en_US"?{height:"17px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}:{})},L(n(r)("message.cgcchiEtc")),5)])])])),Ct(p("div",{class:"no-data"},L(n(r)("message.noDataAvailable")),513),[[xt,Ne.value]]),Ct(Te(k,{ref_key:"ScrollbarRef",ref:qs,class:"search_scrollbar",onScroll:n(Xs)},{default:He(()=>[(I(!0),E(Ke,null,ot(n(tt),C=>(I(),E("div",{key:C.conversationKey,class:"affix_box",onContextmenu:de=>D(de,C),onClick:de=>Qn(C)},[p("div",md,[p("img",{src:C.type==10?C.logo:$e[C.conversationKey],alt:"",draggable:"false"},null,8,vd)]),p("div",hd,[p("div",yd,[p("div",wd,L(C.type==10?C.name:ct[C.conversationKey]),1),C.isTop?(I(),E("div",Cd,L(n(r)("message.top")),1)):re("",!0)]),p("div",Id,[p("div",_d,L(C!=null&&C.latestSendTime?n(xe).timeago(C==null?void 0:C.latestSendTime):""),1),p("div",Ad,L(n(Kt)(C)),1)])])],40,pd))),128)),(I(!0),E(Ke,null,ot(n(Tt)?N.value.slice(0,Zs):N.value,C=>(I(),Me(oa,{"is-hover-border":!1,"folder-info":C,onRightClick:T,onHandleClick:B},null,8,["folder-info"]))),256)),(I(!0),E(Ke,null,ot(n(ke),(C,de)=>(I(),Me(es,{key:C.conversationKey,"is-conversation":!1,keyword:U.value,"is-top":C.isTop,"click-debounce-time":300,"item-config":{title:C.conversationInfo.name,time:n(xe).timeago(C.latestSendTime,!0),desc:C.latestMessage.msg,chatIco:C.conversationInfo.avatarUrl,folderName:n(Kt)(C),...C},onHandleClick:we=>Ys(C),onRightClick:D,onAvatorClick:ks},null,8,["keyword","is-top","item-config","onHandleClick"]))),128)),(I(!0),E(Ke,null,ot(n(je),(C,de)=>(I(),Me(es,{key:C.uid,"click-debounce-time":300,"is-conversation":!1,keyword:U.value,"item-config":{title:C.name,module:n(r)("message.organisationalStructure"),desc:(C==null?void 0:C.description)||"",chatIco:[C.pic],...C},onHandleClick:we=>pn(C),onAvatorClick:Ft},null,8,["keyword","item-config","onHandleClick"]))),128)),n(Tt)?(I(),E("div",Sd,[p("span",{class:"show_all_content",onClick:Se},[gt(L(n(r)("message.showAll"))+" ",1),Te(w,{class:"down_svg","icon-class":"msg_arrow_b",width:"12px",height:"12px",color:"#A3B9D9"})])])):re("",!0),G.value.length?(I(),E("div",Td,L(n(r)("message.groupsChat")),1)):re("",!0),(I(!0),E(Ke,null,ot(G.value,(C,de)=>(I(),Me(es,{key:C.conversationKey,"click-debounce-time":300,"is-conversation":!1,keyword:U.value,"is-top":C.isTop,"item-config":{title:C.conversationInfo.name,time:n(xe).timeago(C.latestSendTime,!0),desc:C.latestMessage.msg,chatIco:C.conversationInfo.avatarUrl,folderName:n(Kt)(C),...C},onHandleClick:we=>Ys(C),onRightClick:D},null,8,["keyword","is-top","item-config","onHandleClick"]))),128)),X.value.length?(I(),E("div",Md,L(n(r)("message.chatLog")),1)):re("",!0),(I(!0),E(Ke,null,ot(X.value,(C,de)=>(I(),Me(es,{key:C.conversationKey,"click-debounce-time":300,"is-conversation":!1,keyword:U.value,"is-top":C.isTop,"item-config":{title:C.conversationInfo.name,isHtml:!!C.isHtml,desc:C.queryMsg,chatIco:C.conversationInfo.avatarUrl,...C},onHandleClick:we=>On(C),onRightClick:D,onAvatorClick:ks},null,8,["keyword","is-top","item-config","onHandleClick"]))),128)),Q.value.length?(I(),E("div",Rd,L(n(r)("message.inbox")),1)):re("",!0),(I(!0),E(Ke,null,ot(Q.value,(C,de)=>{var we;return I(),Me(es,{key:C.idCode,"click-debounce-time":300,"is-conversation":!1,keyword:U.value,"item-config":{module:((we=C==null?void 0:C.sendTime)==null?void 0:we.substring(5))||"",desc:Array.isArray(C==null?void 0:C.toNames)?C==null?void 0:C.toNames.join(","):"",chatIco:[C.logo],...C},onHandleClick:Ae=>Pn(C)},null,8,["keyword","item-config","onHandleClick"])}),128))]),_:1},8,["onScroll"]),[[xt,!Ne.value&&U.value&&x.value]]),x.value?re("",!0):(I(),E("div",Ed,[p("div",bd,[p("span",{style:{color:"#3A8BFF",cursor:"pointer"},onClick:c[6]||(c[6]=C=>x.value=!0)},L(n(r)("message.chatLog")),1),Te(w,{"icon-class":"msg_arrow_r",width:"10px",height:"10px",color:"#ACB4BF",style:{margin:"0 2px"}}),p("div",xd,L(n(q)),1),gt(),p("span",null,L(n(Be))+L(`${n(r)("message.chatLogT")}`),1)]),Te(k,{ref_key:"msgScrollbarRef",ref:gn,class:"message_scrollbar",onScroll:n(Gn)},{default:He(()=>[(I(!0),E(Ke,null,ot(Z.value,(C,de)=>(I(),E("div",{key:C.id,class:"message_item",onClick:we=>fn({key:n(Zt)(C),time:C.time,chatType:C.chatType,msgid:C.id})},[p("div",kd,[p("img",{src:n(Fe)(C),alt:"",referrerPolicy:"no-referrer",onError:c[7]||(c[7]=we=>be(we))},null,40,Bd)]),p("div",Ld,[p("div",Ud,[gt(L((C==null?void 0:C.sendName)||"")+" ",1),p("span",Dd,L(n(xe).timeago(C.time,!0)),1)]),p("div",{class:"desc",innerHTML:ye(C.msg)},null,8,Fd)])],8,Nd))),128))]),_:1},8,["onScroll"])])),n(K)?(I(),Me(Jo,{key:2,position:"absolute","is-sub-component":!0,"my-puid":n(fe),puid:n(oe),left:n(J),top:n(pe),onClose:n(_e),onBlur:n(_e)},null,8,["my-puid","puid","left","top","onClose","onBlur"])):re("",!0)],512)):re("",!0),O.value?(I(),Me(Iu,{key:2,"add-group-visible":O.value,onClose:Jn},null,8,["add-group-visible"])):re("",!0),ie.value?(I(),Me(Ul,{key:3,"add-class-visible":ie.value,onClose:Vn},null,8,["add-class-visible"])):re("",!0),te.value?(I(),Me(wo,{key:4,"folder-info":n(Mt),"add-class-visible":te.value,onClose:Wn},null,8,["folder-info","add-class-visible"])):re("",!0),Te(td,{visible:ae.value,onClose:mn},null,8,["visible"])],64)}}});const Pd=It(Hd,[["__scopeId","data-v-6a6e1f42"]]);function Od(a){return!!_t().recallCmdMap.has(a)}function Gd(a){return _t().recallCmdMap.delete(a)}async function Us(a){var o;if(!a||Number(a)<=0){console.error("Invalid conversationKey");return}const i=_t(),r=Es(),l=i.conversationList[a];if(!l){console.error(`Conversation with key ${a} not found.`);return}if(l.conversationType===ge.SINGLE){const u=await i.getLastMessage(String(l.conversationKey));(l.unreadMessageNum>1||u.success&&!u.data.isread)&&(i.sendReadMessage(l.conversationKey,"channel"),i.updateSelfReadStatus(l.conversationKey))}if(l.unreadMessageNum>0){const u=await i.getLastMessage(String(l.conversationKey));if(u.success&&u.data.msgid){const t=String(i.getUserInfo.loginId);i.sendCMDMessage({chatType:ge.SINGLE,to:t,from:t,action:"CMD_READ_ACK",ext:{conversationId:l.conversationKey,conversationType:l.conversationType===ge.SINGLE?0:1,messageId:u.data.msgid,timestamp:String(l.latestSendTime),unreadCount:l.unreadMessageNum}})}}if(i.clearUnreadNum(l.conversationKey),l.isRemind&&i.clearAtStatus(l.conversationKey),l.isReply&&i.clearReplyStatus(l.conversationKey),l.isCare&&i.clearIsCareStatus(l.conversationKey),l.isNewNotice?(r.setIsHasNewAnnouce(!0),i.clearIsNewNoticeStatus(l.conversationKey)):r.setIsHasNewAnnouce(!1),l.conversationType===ge.GROUP){const u=f=>(f=f?String(f):"",f&&f.includes("/")&&(f=f.split("/")[0]),String(f)===String(i.loginId)),t=i.messageList[l.conversationKey]||[];for(const f of t)!u(f.from)&&!f.isread&&f.type!=jt.AUDIO&&(((o=f==null?void 0:f.ext)==null?void 0:o.showRead)==1||await window.MessageDbHelper.isDeptGroup(l.conversationKey))&&i.sendCMDMessage({chatType:ge.SINGLE,to:f.from,action:"CMD_GROUP_MSG_READ",ext:{fromPuid:String(i.puid),fromUid:String(i.loginId),groupId:a,msgId:f.id,time:String(new Date().getTime())},from:i.loginId}),f.isread||i.updateSelfReadStatus(a,!1,f.id)}}const Kd={appKey:"cx-dev#cxstudy",autoReconnectNumMax:3},Qd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAABICAYAAAC6L9h5AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAASTSURBVHgB7ZzLTlNRFIbXLi2KysV4Q6WmJCRe0ESMmBgHWh3o0Im+gH0A6QtQX0B9AHkBGKgjxYGXEYkOJFHURA2YVkGtsVykgIXt/k8tlNLL7tlnn1Ngf0nvTZP+XZf/rNUcRgW0vnx6njF+lTF2lXEK0SaAEw0T58PcT7HxU5e+FL7OcndaXt9v2Z5p6hVP3aRNzBLxu2m/71aqK5zKPWeJBIG2ZZqfiQcnyWBF1qyfhXNC+XCFCDICrQAtGjJLvcuPW4ceher8W0bJsIZFThcmzlx84fMF6nvJUBQ0L9z6GGcmzUrAOM+KRKYWlYSxrAXykaEiRiQJjEgSGJEkMCJJYESSwIgkgRFJAiOSBH7ygLONLXS5Zbd121wXsJ6LL6Rp8HeSHqeSlFiYo1qCHXz1lJNLBOu30u32I0KcnWXfd/vbqLiMUS3wtfsicy3dOht20OCx7ooCgeiBdvHe09QmRK0FXBEJETRwuIua/PLZ3bmtkfo6jlNTnScVYRWuiDRw+GRVAuWAUNEDIfIa7SJd39VKbVsayC6RfUEh1g7yEu0iOREJ14TQXqJVJLR4lSjKcX33fk9rk1aR4IWcAAJ5mXJaRULhde6zNqhIQQd9jpeeyXsTIkmhhUBkydSp+Pyc8mHOuhFpKpNZvg83Xk0q94y+p4FfE2QXrek2kp4mpxhJzyzfD1bZMVXrmdZIGppOiQ63h5wAn5Xj8rtX0t5pajFD/QpRBLSK1J+csA5WVT3O0PRvSsyv1BXUGTenBFrTDb/iYOonqaIaCapoPyxR/cXjojMNJDe4SNnUsP/PnsinN+Q1rliAe98T1vFXtYaw/9c4jczOlHxdZtIZn09T5PPbsp9TCVfmSahN8CrVgDSrlKowmJUmnbALqlME18wkWjgumAzIgBTN72jFQHTE4h/L2gwsGO79SJAKrjputHJZkSoJlAOpjItOXN27ySwBcng9jczHNZEQQbJRBG7sbds82xK4bYxwsS2pBhRcLBAi+9rIa7QuJyFOZG/Q1qYkH7TxWPyTcO/Jku+BHYgd6ih6CNQz+sH2uATLSS2FG2l1J3TEkfk2QFT1dZwQx4Ljli0o9oVviIgr1eWiB0MUFULZxVGR8CveCnbQNWEcdQBDemXnHtHN4ms8FOZFaAzNBZE0ufhX+dDIsXRD7Yjub1dOLVmccNIyOJJuSC3UnmrauxMgBfHfgnIp6BRK3S0mUgtdy22B8kEKPunsFimub4FpWySsr7GCrgVQC++EjmpbYNoW6WyTvDF0C10u3fwdUALbIk3mrXg2OrZF6hPjB8yJagWsr/I3Kk5iu9JhLIvVDtr/sYbGNSbOLTCcwwhGdWZUDqVvBqF6FOz+esEUbgmMSBIYkSQwIklgRJLAiCSBEUkCI5IERiQJfJzRGBlKMYwrnKvkARmKw1lWpEXOjUglWPLXx3Drw/mBxNLkLhlWsSQ0GT91zjq/m1W4A2JdRv/zz2AxnM5qYmGJNNYVTgX8LGwiKhtBf/LO5wZY4Ztah56F6gLUSxznVeKb4txKnLExxumBEONhojv8vPD1fx17dVwwTXfUAAAAAElFTkSuQmCC",Vd={class:"text-avatar"},Wd=Pe({__name:"index",props:{title:null},setup(a){const i=a,r=Re(()=>i.title.slice(0,4)),l=Re(()=>i.title.length>2?"long":"short");return(o,u)=>(I(),E("div",Vd,[p("div",{class:H(["text-avatar-content",n(l)])},L(n(r)),3)]))}});const Jd=It(Wd,[["__scopeId","data-v-ace4ca33"]]),qd={class:H(["badge"])},Xd={key:0,src:lo,alt:"",draggable:"false"},$d=["src"],zd={key:2,src:vs,alt:"",draggable:"false"},Yd=["innerHTML"],Zd=["innerHTML"],jd=["aria-label"],eg={key:5},tg=["innerHTML"],sg=Pe({__name:"index",props:{isRemind:{type:Boolean,default:!1},isReply:{type:Boolean,default:!1},isCare:{type:Boolean,default:!1},isNewNotice:{type:Boolean,default:!1},isDraft:{type:Boolean,default:!1},isNoDisturb:{type:Boolean,default:!1},isTop:{type:Number,default:0},isHtml:{type:Boolean,default:!1},isConversation:{type:Boolean,default:!0},itemConfig:{type:Object,default:()=>{},required:!0},ext:{type:Object||void 0,default:()=>{}},userInfo:{type:Object,default:()=>{}},keyword:{type:String,default:""},clickDebounceTime:{type:Number,default:0},checkedConverItemIndex:{type:String,default:null},msgSendType:{type:String,default:"success"}},emits:["handleClick","rightClick","avatorClick"],setup(a,{emit:i}){const r=a,l=Ms.global.t,o=_t(),u=bs("box"),t=R(),{isNoDisturb:f,isTop:v,itemConfig:h,keyword:A,isRemind:y,isReply:b,isCare:M,isNewNotice:N,isDraft:G,clickDebounceTime:Z,checkedConverItemIndex:W}=rn(r),Q=R(!0);Q.value=window.RendererHelper.getPlatform()!="darwin";const V=j.debounce(()=>{W.value!=h.value.conversationKey&&(te(),i("handleClick",h.value))},Z.value),X=P=>{te(),i("avatorClick",h.value,P);const ae=setTimeout(()=>{console.log("点击"),te(),o.getCurrentChatId==h.value.conversationKey&&o.setConversationToMessageCount(),clearTimeout(ae)},2e3)};Et(()=>o.getMessageToConversationCount,()=>{o.getCurrentChatId==h.value.conversationKey&&te()});let $=R(!1);const U=P=>{P.preventDefault(),i("rightClick",P,h.value),$.value=!0,xe.windowClickOnce(()=>$.value=!1)};function le(){return!!(h.value.ext.rejectOnlineFile||h.value.ext.cancelSendOnlineFile||h.value.ext.cancelSendOnlineFolder)}function he(){const P=h.value.ext.from===String(o.loginId);if(h.value.ext.rejectOnlineFile){const ae=l(P?"transferFile.you":"transferFile.theOtherParty");return l("transferFile.rejectOnlineFileTipMessage",{operator:ae,fileName:h.value.ext.onlineFileName,fileSize:h.value.ext.onlineFileRenderSize})}if(h.value.ext.cancelSendOnlineFile){const ae=l(P?"transferFile.you":"transferFile.theOtherParty");return l("transferFile.stopSendFileTipMessage",{operator:ae,fileName:h.value.ext.onlineFileName,fileSize:h.value.ext.onlineFileRenderSize})}if(h.value.ext.cancelSendOnlineFolder){const ae=l(P?"transferFile.you":"transferFile.theOtherParty");return l("transferFile.stopSendFileTipMessage",{operator:ae,fileName:h.value.ext.onlineFileName,fileSize:h.value.ext.onlineFileRenderSize})}}function ce(P,ae){return le()?he():O(P,ae)}const O=(P,ae)=>{var x;let ue=P?xe.htmlEncodeByRegExp(P).replaceAll(":","<strong>:</strong>"):"";if(ue)return(x=ae==null?void 0:ae.ext)!=null&&x.expression_id||An.forEach(_=>{if(ue.indexOf(_.msg)!==-1){const F=`${eo}${_.fileName}.png`,K=new URL(F,import.meta.url).href;ue=ue.replaceAll(_.msg,`<img src="${K}" alt="cxemoji-${_.msg}" width="16" height="16" style="vertical-align: bottom;" draggable="false" />`)}}),ue},ie=P=>h.value.isHtml?P:P?xe.htmlEncodeByRegExp(P).replaceAll(A.value,`<span style='color: #3A8BFF'>${A.value}</span>`):"",te=()=>{var P;(P=t.value)==null||P.changeImg()};return(P,ae)=>{const ue=Gt;return I(),E("div",{class:H([n(u).b(),n(u).is("cover",n($))]),onClick:ae[1]||(ae[1]=(...x)=>n(V)&&n(V)(...x)),onContextmenu:U},[p("div",{class:H(n(u).e("img")),onClick:ae[0]||(ae[0]=rs(x=>X(x),["stop"]))},[Ct(p("div",qd,[p("div",{class:H(["text",Q.value?"":"lineHeight16",n(h).unreadMessageNum>99?"b-number":""])},L(n(h).unreadMessageNum>99?"99+":n(h).unreadMessageNum),3)],512),[[xt,n(h).unreadMessageNum&&!n(f)&&a.isConversation]]),n(h).chatIco[0]==n(at).CLASS?(I(),E("img",Xd)):n(h).chatIco[0]==n(at).GROUP?(I(),E("img",{key:1,src:n(po),alt:"",draggable:"false"},null,8,$d)):n(h).chatIco[0]=="default"||n(h).chatIco[0]=="cximg://default"||n(h).chatIco[0]=="headerimg://default"?(I(),E("img",zd)):n(h).chatIco[0]==n(at).COURSE?(I(),Me(Jd,{key:3,title:n(h).title},null,8,["title"])):(I(),Me(co,{ref_key:"imgAvatorRef",ref:t,key:n(h).conversationKey+n(h).title+n(h).chatIco.join(","),"img-list":n(h).chatIco},null,8,["img-list"]))],2),p("div",{class:H(n(u).e("content"))},[p("div",{class:H(n(u).e("content_top"))},[p("div",{class:H(n(u).e("info"))},[n(A)?(I(),E("div",{key:0,class:H(n(u).e("title")),innerHTML:ie(n(h).title)},null,10,Yd)):(I(),E("div",{key:1,class:H(n(u).e("title"))},L(n(h).title||""),3)),n(v)?(I(),E("div",{key:2,class:H(n(u).m("remark"))},L(n(l)("message.top")),3)):re("",!0)],2),p("div",{class:H(n(u).e("time"))},L(n(h).time||n(h).module||""),3)],2),p("div",{class:H(n(u).e("content_bottom"))},[p("div",{class:H(n(u).e("content_msg"))},[a.msgSendType!="success"&&n(h).ext.fromPuid==n(o).puid?(I(),E("i",{key:0,class:H(n(u).e("sendType"))},[a.msgSendType=="sending"||a.msgSendType=="upload"?(I(),E("i",{key:0,class:H(n(u).e("sending"))},null,2)):re("",!0),a.msgSendType=="failed"?(I(),Me(ue,{key:1,"icon-class":"msg_send_failed",width:"14",height:"14"})):re("",!0)],2)):re("",!0),n(A)?(I(),E("div",{key:1,class:H(n(u).e("desc")),innerHTML:ie(n(h).desc)},null,10,Zd)):(I(),E("div",{key:2,class:H(n(u).e("desc")),"aria-label":n(h).desc||""},[n(b)?(I(),E("span",{key:0,class:H([n(u).e("desc"),n(u).m("warning")])},"["+L(n(l)("message.someoneReplied"))+"]",3)):n(y)?(I(),E("span",{key:1,class:H([n(u).e("desc"),n(u).m("warning")])},"["+L(n(l)("message.someoneAtMe"))+"]",3)):n(G)?(I(),E("span",{key:2,class:H([n(u).e("desc"),n(u).m("warning")])},"["+L(n(l)("message.draft"))+"]",3)):n(M)?(I(),E("span",{key:3,class:H([n(u).e("desc"),n(u).m("warning")])},"["+L(n(l)("message.specialCare"))+"]",3)):n(N)?(I(),E("span",{key:4,class:H([n(u).e("desc"),n(u).m("warning")])},"["+L(n(l)("message.hasNewNotice"))+"]",3)):re("",!0),n(h).unreadMessageNum&&n(f)&&a.isConversation?(I(),E("span",eg,L(`[${n(h).unreadMessageNum}${n(l)("message.unreadItems")}] `),1)):re("",!0),p("span",{innerHTML:ce(n(h).desc||"",n(h))},null,8,tg)],10,jd))],2),p("div",{class:H(n(u).e("status"))},[n(f)?(I(),Me(ue,{key:0,class:"no_disturb","icon-class":"no_disturb",width:"14px",height:"14px"})):re("",!0),n(h).module&&n(h).time?(I(),E("span",{key:1,class:H(n(u).e("module_time"))},L(n(h).module),3)):re("",!0)],2)],2)],2)],34)}}});const ng=It(sg,[["__scopeId","data-v-8346aa69"]]);class og{constructor(i=1){vn(this,"_count",0);vn(this,"_taskList",[]);vn(this,"_max",1);this._max=i,this._count=0,this._taskList=[]}trigger(i,r){return new Promise((l,o)=>{const u=this._execute(i,r,l,o);this._count<this._max?u():this._taskList.push(u)})}_execute(i,r,l,o){return()=>{this._count++;let u=!0,t=setTimeout(()=>{console.error("queue-warning: 任务执行超时"),clearTimeout(t),this._count>0&&this._count--,u=!1,this._next()},1e3*10);i(r).then(l).catch(o).finally(()=>{this._count>0&&this._count--,clearTimeout(t),u&&this._next()})}}_next(){if(this._taskList.length>0){const i=this._taskList.shift();i&&i()}}}const Dn=a=>(ss("data-v-e8baca81"),a=a(),ns(),a),ag=["id"],ig=["onContextmenu"],rg={class:"affix_box_img"},lg=Dn(()=>p("img",{src:mo,alt:"",draggable:"false"},null,-1)),cg={class:"dot"},ug={class:"affix_box_text"},dg={class:"affix_box_text_main"},gg={class:"vin_text"},fg={key:0,class:"remark"},pg={class:"time"},mg=["onContextmenu"],vg={class:"affix_box_img"},hg=Dn(()=>p("img",{src:vo,alt:"",draggable:"false"},null,-1)),yg={class:H(["badge"])},wg={class:"affix_box_text"},Cg={class:"affix_box_text_main"},Ig={class:"vin_text"},_g={key:0,class:"remark"},Ag={class:"time"},Sg=["onContextmenu"],Tg={class:"affix_box_img"},Mg=Dn(()=>p("img",{src:ho,alt:"",draggable:"false"},null,-1)),Rg={class:H(["badge"])},Eg={class:"affix_box_text"},bg={class:"affix_box_text_main"},xg={class:"vin_text"},Ng={key:0,class:"remark"},kg={class:"time"},Bg=["onContextmenu"],Lg={class:"affix_box_img"},Ug=Dn(()=>p("img",{src:yo,alt:"",draggable:"false"},null,-1)),Dg={class:H(["badge"])},Fg={class:"affix_box_text_clomn"},Hg={class:"affix_box_text_top"},Pg={class:"affix_box_text_info"},Og={class:"title"},Gg={key:0,class:"remark"},Kg={class:"time"},Qg={class:"affix_box_text_bottom"},Vg={class:"desc"},Wg=["id","onClick","onContextmenu"],Jg={class:"affix_box_img"},qg=["src"],Xg={class:H(["badge"])},$g={class:"affix_box_text_clomn"},zg={class:"affix_box_text_top"},Yg={class:"affix_box_text_info"},Zg={class:"title"},jg={key:0,class:"remark"},ef={class:"time"},tf={class:"affix_box_text_bottom"},sf={class:"desc"},nf=["onDrop","onDragenter","onDragover","onDragleave"],Je=36,of=Pe({__name:"ChatList",props:{checkedConverItemIndex:{type:[Number,String],default:-1}},emits:["updateCheckedConverItem","updateShowMode","clickAvatar","toInbox"],setup(a,{expose:i,emit:r}){const l=a,o=new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQ3SURBVHgB7ZshbBRBFIbnCBhKUkMCNTVFYJqSGgQV1FAMCQkYFHgwKDAoDCgqwIPCQMCQAAZTBKahqangTE0hwTSBmopy38393WF7u683u1f1vuSye7s7s7PfvJl5e9DO3rvLe8Gp5FhwanFBBi7IwAUZuCADF2TgggxckIELMnBBBi7IwAUZuCADF2TgggxckIELMnBBBi7IwAUZuCADF2TgggxckIELMhivoMmZEBaexU8u8w9CuP6lWR0NOB5yOH87hJNnh5/bWul9vsb9E6dCOH0h7iNr5mZllWHzYwi/1w4eV3nO97/P9WQth0Ozcr9X7/eQS54gGq2Gl9n5WQhKQdb01VBJ/yFKgqaXYkdQ5+anon5kcbwsT6TnGpIniF6BtDc/34qNr4LoeL8Y9xk2yOLBVp9Wl5HQVMDOr1gmvXe5DiIcQbSnQfTAeOYg5gwkNIHo0UNuvOpFxZliPiMaa8sOxDaUA+0LUuProsmsY6IXBXfivqKD7xo2u3+qyxJZDDGuQWxDxicoZVRZyOAhGVo7W3GCl5zuG7usrmvSSQPy5qA6GApAD1atdBZTC3HLUEkn9qoFQBA9Esm9Ncxpy/qLkEPmKjYI41TA1KXYEPVaOgzqhsQwtEpRLl39hk3o5fvo/oiiLB+OHamgcs/C7L24XX8et6w2aTQxTHTN5Lm45SGUAPIA2z/ifjp3KAr6eVIy6Woop4K2u3E1FRcfx2hsMNTy5qDu27jUSwbQuxxTVKVDrBxB+m6uRkuxI7SSpagsWyQT1WXUEUeeKKqnQ/L/P2kED0IOomt4QOA4vav8SXkQWXdVHkT0EXHIpFw5CiRf2TqRkmbiRKyuGZahH5L2VzF6TQLVwFFDvJ/zLMeH70fpXjzWn4TnivuAogPhaUTqtaZhstj+KvbhWrEvQUTPKBARKjv/8P9zemfTeS37lJm5UQxFrWYNk8X2BQl6PHcO0GqkyGPLMURTF5GyX/daPEfEETXMj4hqKVkcn6AmPUiuU5fvkFL0r1uJEpDEfbQqSl4LyeIYMumJuB32otlG3XyUSBIt4tujKENykNfCq0Z7EcTqRcOZVGmoXjT1M8UosPrxoJp0ta/XD+QTMWl0KudKocyoSWqJPEGzd6OMdNVQo5GihJBezYG60t9zNCchRxGSpgfMObonw4q28VnsXbvxMq+TBnSy/phF45zlvP/pFvOBfqehYQpxev7Ka7te/V6kVwSgTkWB6lHdys6RSedwbH/ZXypeejmGuLp5rYK8CCIy6kK3PP6V7B2WVEoZHlR1s2ohYPXJwSjhO5M3HYYoIipDUKf1P4diLtj923jsD6U8p6RJqcUo1yZ0/O/F6vF/FzNwQQYuyMAFGbggAxdk4IIMXJCBCzJwQQYuyMAFGbggAxdk4IIMXJCBCzJwQQYuyMAFGbggAxdk4IIM/gF96ZOv87GQoAAAAABJRU5ErkJggg==",self.location).href,u=new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAATESURBVHgB7ZvLThNRGMePQrxyU1BUipdg1FiNJi6sbtxJ3Is+ALgX3Au6Rx4AeQCBFwA3upGayIJwUQwkaFGB0HBVxIB4/tOe4cxwZr52Om0w+X5J05kzZ6Zn/vNdR9kjJLUf3mwJxshewfjCAhGwQAQsEAELRMACEbBABCwQAQtEwAIRsEAELBABC0TAAhGwQAQsEAELRMACEbBABCwQAQtEwAIRsEAELBABC0RQLAJSVlQsXl24Jsrld9PkiBhb+2kfu3zwsHU8G6b//JafdXIerovr4/eWNzdEvgksEBbXvzgvmk+dFa2158XDz0P2MezfKq0Q2dDxfUp0/Phi7zceqxGN1ZEd8yL7D1jft4fjorMumvHv9CRnxJOpcZEtgQUCXXPfLIGwSPVU3YuKryxZ27HSctFQecLa1hfafPKMfdM6y383LKsClw+VWJaDfVxz7Neqw9pG11atMRNYW2TfARGUnASCFQ2sLFqLqK+o2iFQXB7rSc7a+0og3KTifmW1USCcp86FK+M3euZnHFam6F+YN46D9rMX7d8NQk4CAbjZHiGMN1kjn1yspNzahoUp1BjINlYVmpxXBzfDx0SLdD8T3Revi0KQCuglIhcCC6RbATBlla65aWlhSXt+c1owPaA/jdSJ6KGdN6HcSgfnq2sgSJvGvUAoCEJggdxWgJt2LwKBU43pgVKf55Wq4boqSCO+wRowt0+Op87bdMzxIpVtk4UXCJkIi26trfOcEyuRFrCltrctruFotfVdI+OWshJkIh3lthBWD7LPEpO2qF6uHSaBBUImwuL9BGqoOmF93LSfu+TYh1UoV3RTX1Fpb+OBQOj+paQV9KNZxpeB1cWMilGdvKSQ5/IplxU7L+0VgxKooNe93aTxuLNYRPEIgeB2VNxx82Tqk6PsyIS8COR2F+AVg/yAqHr5ANeCS2IcNxpfXXLMR8ZSFo0Q4I5Pox7FpB+hC2TKPm6+3rhjHHe3Ayr2wMIgFArF+iNVsvi7JO59HNwh9NbW9n/WHVhZyNqdTITezSOz4Eb709lGjcW1m8FxZWWJdPuAj37DVnCW8QvjibQlwIKaJkZEuXTfsqIiUQhCtyCVWRBA78o4AVqkVSBmxNKWBStpPF4jorKphXWYmkj0aABNLCxGgXqrLTEhaqWA3Re8C073MYisx75MyVudr1oLWI6p1umTWQtdfzTdiOpzlPVAHJOb9Mr4gznuGKO3Lbiefk2qXvIiNIFKpcmjKn69lCrKVIbp1hpTHSxYNbqwJnezCWG9GlB1/gOXRSB4qwIW76h2VQx6WXdFNMkUjKf2OP0KA3Gm1yetwrUwH6k7sm+/PY6xFpmSdwOhCaR8/KZ8imhSsf9IBlQ/YAWIJ6m3k9dtkSBQGE8/DHJ2MdxM1+y0FZwRd9pkXEFlrKyDAhaGQP1CVted0gqRvikyecfz7mrMOH568K3IhpxfmN0efm8LgadualopUPA9GB9ytBV+9MkXZH7Vd5jgXVdB/hwK1lWfTvt+wdcEmlvENAjvrp7zTcEE+l/hfxcjYIEIWCACFoiABSJggQhYIAIWiIAFImCBCFggAhaIgAUiYIEIWCACFoiABSJggQhYIAIWiIAFImCBCFgggn9kZS8EWsUGOgAAAABJRU5ErkJggg==",self.location).href,t=new URL(""+new URL("head-visitor-b02780f3.png",import.meta.url).href,self.location).href,f=new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAABICAYAAAC6L9h5AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQeSURBVHgB7Zw7TBRBGMf/s6gxCmqhBRRKYjRqomKgsPFdqomPWKiVhdqaYA/0amylsQIqXwmtiNhQQCAWPohGsYBCCwhIIXLr/HeZcLfshUFm5lC+X7Ict3fH3f52vsfMkVXIcORpfELN4QIiXFBAPdYCMYZj6E2hdeiyGs0+rMwvDY/jbdEWtOgdd7CGiQt4WJhG2/ANNWH2JZIoqKoGr/S9BgjJyJqbwikjKkp+6BEkgorQLqJq7cTcbeiK66s24AuERRQUTg5dUq+jaP2CMaGUpIBpIp2UJMzKEc1LklxUHtMCRRCWRCRZIJIsEEkWiCQLRJIFIskCkWSBSLJgHTxQtwm4uR9o2oEgTP0CPk4C7e+B8Rk4x4uke0eBvdsQjNpN6fvx5Nx+A+c4D7ea9WEFFePrfb1IqhR8b44q10jitsBLTspjRK8Wd32GM6r1qLm1P8zIDSapud9P5Wk+BO8ECzcfZ7zOQ/7JI9hIYlsw+ANOOb8LQQgmqW5zuv2LSHWzIGh16x23fz5DqTZQzlkK55KmZtMqlj3A5VY3PrelEcti7CcwPQvnOA83Srrdp0fNGFZE9TKrYfcocL0nfX/XqMYncQxPsNnjRniWu7/ZvY7twrlddm0DpXD23/UJXhi8rJRXSYS9zKPjfvILxXPW76NJNVCSk3CjiM7TwMAlPXL2lT42NpOGX/conMKRw/DKCmo+mH4Ofh5XJ8aJJCZYs0xx60B6vzhUKKp1MA2LlcLwuv823YrzTzJijwFX96T3+XlcTVncjKRMk8jy3ZFzJinp2su/D48kvPoW55/G7WlIN2ZWQms2wAnemkmK6zyjE/DO0v0jk+mBjkxgWbBaMrz4+mKu7vaX8wxeO26GXGtTfp661mMffnze3f7S8OLf5nyw+TC8E6TjZp46Wbe4oeTB88DLrQvxMcoZ/F6632fFzCPY3I2JlIl179bS/UmVyslTzD/MX1lBDK+OM2GnLMHmbsTkqfZ3evuwsN+0CUy8PHgKYw7Kds8s76Z6hSSoJAPDr1YLe1BUxilqrEwvxfAK/TVVMRVbKinXJmRheWd4VUoQqeh6kgk/5pk8WBWZoCv5NRWpSLgVQwEs4xwp5mtq7mPXzoq4Gqi4JAPDj1veWlSlWXXLt6tNEJE1bgtEkgUiyQKRZIFIskAkWeBEEmfsqxFXn8tJM9mm169bmsL9l4cNnDC7WFMnTiSZpY7/FclJFogkC0SSBSLJApFkgUiyQCRZIJIsEEkWRDHwFUI+MYZ5w5H0HEI+al5SrERSOQob0crbiNcH0iH3EEIJvGzZ0Nn0+m5J4i5EaDPxJ+go0y4K67STeRJJwxfVxFwVTsmISkfQb+2CTsw+lX1Sw7O4vqowf423eG1cW4kVPmIBK+DFwBXVm338D2NcLEALpga7AAAAAElFTkSuQmCC",self.location).href,v=new og,h=Go(),A=R("classroom"),y=_t(),b=Es(),M=window.innerHeight,{conversationListData:N,getUserInfo:G,getReplyConversation:Z,getGroupConversation:W,getVerifyConversation:Q,getCxofficialConversation:V,getIsDragChangeMessage:X,getMsgFolderList:$,getMsgFolderConversations:U,searchFolderInfo:le,showFolderId:he,subscribesConversations:ce}=Ot(y),{t:O}=ts(),ie=window.RendererHelper.getPlatform()!="darwin",{checkedConverItemIndex:te}=rn(l),P=R({}),ae=R({}),ue=Re(()=>y.getReplyMeCount),x=Re(()=>y.getGroupInviteCount),_=Re(()=>y.getVerifyMsgCount),F=Re(()=>y.getCxofficialMsgCount),K=Re(()=>y.getReplyConversation),pe=Re(()=>y.getGroupConversation),J=Re(()=>y.getVerifyConversation),fe=Re(()=>y.getCxofficialConversation),oe=async(m,B)=>{if(m.conversationType==ge.SINGLE){let T=await window.RendererHelper.getUsersByTuids(String(m.conversationKey));if(T){const D=T[0].puid,Y=`https://photo.chaoxing.com/p/${D}_80?flag=1&psize=100_100c&ext=jpg`;await y.updateConversationAvator(m.conversationKey,Y);const Se=y.getUserInfo.puid;r("clickAvatar",B,Se,D)}}};Et(()=>X.value,m=>{m||(_e.value=null)},{immediate:!0});const _e=R(null),At=(m,B)=>{B.conversationKey!=z.CXAI&&(_e.value=B.conversationKey,X.value||y.setIsDragChangeMessage(!0))},Nt=j.debounce((m,B)=>{if(X.value){if(B.conversationKey==z.CXAI)return;_e.value=B.conversationKey,q(B)}else _e.value=null,y.setIsDragChangeMessage(!0)},1e3),Oe=(m,B)=>{var D;if(m.preventDefault(),B.conversationKey==z.CXAI)return;_e.value=null;const T=(D=m.dataTransfer)==null?void 0:D.files[0];T&&(y.setDragFile(T),q(B),window.RendererHelper.sendToView("DRAG_FILE_IN_CONVERSATION","tab_message"))};Et(()=>y.getMessageReminder,m=>{m&&De()});const Ne=R({conversationKey:z.ZHKF,latestSendTime:new Date().getTime(),unreadMessageNum:0});window.RendererHelper.on("CLIENT_IM_FLASH_TRAY_ICON",m=>{const{from:B,latestSendTime:T,unreadMessageNum:D}=m;B==z.ZHKF&&(Ne.value={...Ne.value,latestSendTime:Number(T),unreadMessageNum:Number(D)})},ki),window.RendererHelper.on("AI_SERVICE_TOAST",()=>{var m;((m=Ne==null?void 0:Ne.value)==null?void 0:m.unreadMessageNum)>0&&vt({content:O("message.isMsgSmartCustomerService"),zIndex:2024,duration:3e3})},Bi),window.RendererHelper.on("OPEN_THIS_MESSAGE",m=>{if(m.id===z.INBOX)r("toInbox");else if(m.id==z.ZHKF)vt({content:O("message.isMsgSmartCustomerService"),zIndex:2024,duration:3e3});else{let B=j.values(N.value).filter(T=>T.conversationKey==m.id);q(B[0])}},Li),window.RendererHelper.on("HIDE_THIS_MESSAGE",async m=>{if(m.isAllMessage){const B=j.values(N.value).filter(T=>T.unreadMessageNum>0&&!T.isNoDisturb);for(let T=0;T<B.length;T++){const D=B[T];await Qt(!0,D)}Ne.value={...Ne.value,unreadMessageNum:0},y.setInboxUnreadCount(0),window.RendererHelper.flashFrame(!1)}else if(m.id==z.INBOX)y.setInboxUnreadCount(0);else if(m.id==z.ZHKF)Ne.value={...Ne.value,unreadMessageNum:0};else{let B=j.values(N.value).find(T=>T.conversationKey==m.id);Qt(!0,B)}},Ui),window.RendererHelper.on("_preOpenTrayMsgPop",()=>{let m=j.values(N.value).filter(D=>D.unreadMessageNum>0&&!D.isNoDisturb);function B(D){return D&&D.conversationInfo!==void 0}Ne.value.unreadMessageNum&&m.push(Ne.value),y.inboxUnreadCount>0&&m.push({conversationKey:z.INBOX,latestSendTime:y.inboxReceivingTime,unreadMessageNum:y.inboxUnreadCount}),m=j.sortBy(m,[D=>-Math.max(D.latestSendTime)]);const T=m.map(D=>{let Y=[],Se="",Ue="";return B(D)&&(Y=D.conversationInfo.avatarUrl,Se=D.conversationInfo.name,Ue=D.latestMessage.msg),D.conversationKey===z.ZHKF&&(Y=[z.ZHKF],Se="智慧客服",Ue=""),D.conversationKey===z.INBOX&&(Y=[z.INBOX],Se="收件箱",Ue=""),{id:D.conversationKey,icon:Y,title:Se,content:Ue,unreadCount:D.unreadMessageNum}});window.RendererHelper.sendToMainProcess("_openTrayMsgPop",{msgList:T})},Di);const De=()=>{const m=tt.value+Ne.value.unreadMessageNum+y.inboxUnreadCount,B=A.value==="classroom";if(!(y.getMessageReminder&&!B))return;const D=Y=>{mt(()=>{v.trigger(ie?ys:Kt,Y)})};if(m>0){const Y=j.values(N.value).filter(Ht=>Ht.unreadMessageNum>0&&!Ht.isNoDisturb);Ne.value.unreadMessageNum&&Y.push(Ne.value),y.inboxUnreadCount&&Y.push({conversationKey:z.INBOX,latestSendTime:y.inboxReceivingTime,unreadMessageNum:y.inboxUnreadCount});const Se=Y.reduce((Ht,ze)=>{const Ve=Ht.latestSendTime??0,Vt=ze.latestSendTime??0;return Ve>Vt?Ht:ze});let Ue=[];const Qe=Se.conversationKey,Ge=Se.conversationType;Se.conversationInfo!==void 0&&(Ue=Se.conversationInfo.avatarUrl),Se.conversationKey===z.ZHKF&&(Ue=[z.ZHKF]),Se.conversationKey===z.INBOX&&(Ue=[z.INBOX]),D(ie?{imgList:Ue,isFlashTray:!0,conversationKey:Qe,conversationType:Ge}:{count:m,isFlashTray:!0})}else D(ie?{isFlashTray:!1}:{count:0,isFlashTray:!1})};window.MainWindowHelper.getAppSystemConfig().then(m=>{(m==null?void 0:m.appMode)=="classroom"?A.value="classroom":A.value="normal",Et(()=>tt.value,B=>{window.RendererHelper.sendToOuterWindow("updateMessageNum",B+Number(y.getInboxUnreadCount)+Number(y.getReplyMeCount)+Number(y.getGroupInviteCount)+Number(y.getVerifyMsgCount)+Number(Ne.value.unreadMessageNum)+Number(y.getCxofficialMsgCount)+ct.value),De()},{immediate:!0}),console.log("getAppSystemConfig:",m)}),window.RendererHelper.on("getConversationData",()=>{window.RendererHelper.sendMsgConversation(j.cloneDeep(Dt.value))},Fi);const Ze=["/message/conversation","/message/reply","/message/group","/message/verify","/message/cxofficial"];Et(()=>h.query,m=>{const B=$e.currentRoute.value.path;if(Ze.includes(B)&&(m!=null&&m.id)){const T=String(m.id)in Xt?Xt[String(m.id)]:String(m.id),D=U.value.find(Y=>Y.msgId==T);if(D){if(he.value=="0"){const Y=$.value.find(Se=>Se.id==D.folderId);Y&&Cs(Y)}}else y.setSearchFolderInfo(null),Ns(!0)}console.log("路由变化",B,JSON.stringify({id:m.id,chatType:m.chatType,name:y.getSingleChatFullName(m.id)}),Ze.includes(B))});const St=m=>{let B=[];U.value.forEach(D=>{D.folderId==m&&(D.msgId in Ss?B.push(Ss[D.msgId]):B.push(String(D.msgId)))});const T=Dt.value.filter(D=>B.includes(String(D.conversationKey)));for(let D of T){D.isTop=0;for(let Y of y.getTopConversation)D.conversationKey==Y.sessionId&&(D.isTop=1,Y.sort=D.sort||0)}return j.sortBy(T,[D=>!D.isTop,D=>D.isTop?(D==null?void 0:D.sort)||0:-Math.max(D==null?void 0:D.latestSendTime,(D==null?void 0:D.draftTime)||0,(D==null?void 0:D.topTime)||0)])},kt=Re(()=>{if(he.value!="0")return St(Ee.value.id);{let m=[];$.value.forEach(Y=>{var Qe;let Se={};const Ue=St(Y.id);Se={...Y,unreadMessageNum:j.sumBy(Ue.filter(Ge=>!Ge.isNoDisturb),Ge=>Ge.unreadMessageNum)||0,latestSendTime:((Qe=j.maxBy(Ue,Ge=>Ge.latestSendTime))==null?void 0:Qe.latestSendTime)||Y.updateTime},m.push(Se)});let B=Dt.value.filter(Y=>!U.value.some(Se=>Y.conversationKey==Ss[Se.msgId]||Y.conversationKey==Se.msgId)),T=[];T=[...m,...B];let D={};for(let Y of T)Y.isTop=0,"id"in Y?D[Y.id]=Y:Y.conversationKey&&(D[Y.conversationKey]=Y);for(let Y of y.getTopConversation){let Se=D[Y.sessionId];Se&&(Se.isTop=1,Se.sort=Y.sort||0)}return j.sortBy(T,[Y=>!Y.isTop,Y=>"id"in Y?-Math.max(Y.latestSendTime||Y.updateTime):-Math.max(Y==null?void 0:Y.latestSendTime,(Y==null?void 0:Y.draftTime)||0,(Y==null?void 0:Y.topTime)||0)])}}),Dt=Re(()=>{let m=[];try{m=j.values(N.value).concat(Object.assign({},Z.value)).concat(Object.assign({},W.value)).concat(Object.assign({},Q.value)).concat(j.cloneDeep(y.getSubscribesConversations)||[]),y.hasCxOfficial&&(m=m.concat(Object.assign({},V.value)))}catch(B){console.error("解析报错",B),m=j.values(N.value)}return j.sortBy(m,[B=>!B.isTop,B=>-Math.max(B.latestSendTime,(B==null?void 0:B.draftTime)||0,(B==null?void 0:B.topTime)||0)])}),cs=Re(()=>m=>{var B,T;if(_n.get(m,"ext.attachment.att_notice.sourceType")===1e3)return"[站内信函]";if(m.ext.attChatCall)return"[语音通话]";if((B=m.ext)!=null&&B.robotMessageInfo&&((T=m.ext)==null?void 0:T.robotStreamStatus)!==void 0)return jn;if(m.draft){if(y.getCurrentChatId==m.conversationKey)return m.latestMessage.msg;const D=Ka.parse(m.draft);let Y=[];return D.forEach(Se=>{var Ue,Qe,Ge;if(Se.type=="txt"&&((Ue=Se.content)==null?void 0:Ue.insert)!=`
`){const lt=(Ge=(Qe=Se.content)==null?void 0:Qe.insert)==null?void 0:Ge.replaceAll(`
`,"");lt&&Y.push(lt)}else Se.type=="img"?Y.push(`[${O("message.image")}]`):(Se.type=="file"||Se.type=="attachment")&&Y.push(`[${O("message.File")}]`)}),Y.join("")}else return m.latestMessage.msg}),tt=Re(()=>j.values(N.value).filter(m=>!m.isNoDisturb).reduce((m,B)=>m+B.unreadMessageNum,0)),ct=Re(()=>{var m;return(m=y.subscribesConversations)==null?void 0:m.reduce((B,T)=>B+T.unreadMessageNum,0)});Et(()=>ct.value,m=>{window.RendererHelper.sendToOuterWindow("updateMessageNum",m+Number(y.getInboxUnreadCount)+Number(y.getReplyMeCount)+Number(y.getGroupInviteCount)+Number(y.getVerifyMsgCount)+Number(Ne.value.unreadMessageNum)+Number(y.getCxofficialMsgCount)+tt.value)},{immediate:!0}),Et(()=>y.getReplyMeCount,m=>{window.RendererHelper.sendToOuterWindow("updateMessageNum",Number(m)+tt.value+Number(y.getInboxUnreadCount)+Number(y.getGroupInviteCount)+Number(y.getVerifyMsgCount)+Number(Ne.value.unreadMessageNum)+Number(y.getCxofficialMsgCount)+ct.value)},{immediate:!0}),Et(()=>y.getGroupInviteCount,m=>{window.RendererHelper.sendToOuterWindow("updateMessageNum",Number(m)+tt.value+Number(y.getInboxUnreadCount)+Number(y.getReplyMeCount)+Number(y.getVerifyMsgCount)+Number(Ne.value.unreadMessageNum)+Number(y.getCxofficialMsgCount)+ct.value)},{immediate:!0}),Et(()=>y.getInboxUnreadCount,m=>{window.RendererHelper.sendToOuterWindow("updateMessageNum",Number(m)+tt.value+Number(y.getReplyMeCount)+Number(y.getGroupInviteCount)+Number(y.getVerifyMsgCount)+Number(Ne.value.unreadMessageNum)+Number(y.getCxofficialMsgCount)+ct.value),De()},{immediate:!0}),Et(()=>y.getVerifyMsgCount,m=>{window.RendererHelper.sendToOuterWindow("updateMessageNum",Number(m)+tt.value+Number(y.getReplyMeCount)+Number(y.getGroupInviteCount)+Number(y.getInboxUnreadCount)+Number(Ne.value.unreadMessageNum)+Number(y.getCxofficialMsgCount)+ct.value)},{immediate:!0}),Et(()=>y.getCxofficialMsgCount,m=>{window.RendererHelper.sendToOuterWindow("updateMessageNum",Number(m)+tt.value+Number(y.getReplyMeCount)+Number(y.getGroupInviteCount)+Number(y.getInboxUnreadCount)+Number(Ne.value.unreadMessageNum)+Number(y.getVerifyMsgCount)+ct.value)},{immediate:!0}),Et(()=>Ne.value.unreadMessageNum,m=>{window.RendererHelper.sendToOuterWindow("updateMessageNum",Number(m)+tt.value+Number(y.getReplyMeCount)+Number(y.getGroupInviteCount)+Number(y.getInboxUnreadCount)+Number(y.getVerifyMsgCount)+Number(y.getCxofficialMsgCount)+ct.value),De()},{immediate:!0,deep:!0});const $e=Rs(),ht=R(),us=R(null),Kt=async m=>{const{count:B,isFlashTray:T}=m;window.RendererHelper.setBadgeCount(B)},ys=async m=>{const{conversationKey:B,conversationType:T}=m;if(m.isFlashTray){const D=await Mt(m.imgList);tt.value+Ne.value.unreadMessageNum+y.inboxUnreadCount>0&&(window.RendererHelper.flashTray(!0,D,{conversationKey:B,conversationType:T}),y.isTrayFlashing=!0)}else window.RendererHelper.flashTray(!1),y.isTrayFlashing=!1};ls(()=>{us.value=ht.value.getContext("2d")});const ee=()=>{_e.value=null,y.setReplyMeCount(0),y.setChatTargetId(-3),$e.push({path:"/message/reply",query:{id:z.REPLY}})},ne=()=>{_e.value=null,y.setVerifyMsgCount(0),y.setChatTargetId(-5),$e.push({path:"/message/verify",query:{id:z.VERIFY}})},be=()=>{_e.value=null,y.setGroupInviteCount(0),y.setChatTargetId(-4),$e.push({path:"/message/group",query:{id:z.GROUP}})},Fe=()=>{_e.value=null,y.setCxofficialMsgCount(0),y.setChatTargetId(-6),y.setSubscribesUrl(y.cxofficialUrl),$e.push({path:"/message/cxofficial",query:{id:z.CXOFFICIAL}})},ye=m=>{_e.value=null,m.unreadMessageNum=0;const B=ce.value.find(T=>T.conversationKey==m.conversationKey);B&&(B.unreadMessageNum=0),y.setChatTargetId(m.conversationKey),y.setSubscribesUrl(m.messageListUrl),$e.push({path:"/message/cxofficial",query:{id:m.conversationKey}})},q=async m=>{var T;if(console.log(`[ChatList.vue] call toMessage, key is ${m==null?void 0:m.conversationKey}, name is ${(T=m==null?void 0:m.conversationInfo)==null?void 0:T.name}`),_e.value=null,$e.currentRoute.value.query.id!==m.conversationKey){if(y.deleteStoreMsg(m.conversationKey),m.conversationType==ge.SINGLE){const D=await y.getLastMessage(String(m.conversationKey));(m.unreadMessageNum>1||D.success&&!D.data.isread)&&(y.sendReadMessage(m.conversationKey,"channel"),y.updateSelfReadStatus(m.conversationKey))}if(m&&m.unreadMessageNum>0){const D=await y.getLastMessage(String(m.conversationKey));D.success&&D.data.msgid?y.sendCMDMessage({chatType:ge.SINGLE,to:String(G.value.loginId),from:String(G.value.loginId),action:"CMD_READ_ACK",ext:{conversationId:m.conversationKey,conversationType:m.conversationType==ge.SINGLE?0:1,messageId:D.data.msgid,timestamp:String(m.latestSendTime),unreadCount:m.unreadMessageNum}}):console.log("[toMessage] error: not found last not tips message!")}y.clearUnreadNum(m.conversationKey),m&&m.isRemind&&y.clearAtStatus(m.conversationKey),m&&m.isReply&&y.clearReplyStatus(m.conversationKey),m&&m.isCare&&y.clearIsCareStatus(m.conversationKey),m&&m.isNewNotice?(b.setIsHasNewAnnouce(!0),y.clearIsNewNoticeStatus(m.conversationKey)):b.setIsHasNewAnnouce(!1),y.setChatTargetId(m.conversationKey),$e.push({path:"/message/conversation",query:{id:m.conversationKey,chatType:m.conversationType}})}},Be=async()=>{var m,B;y.updateConversationTop(P.value.conversationKey,(m=P.value)!=null&&m.isTop?0:1,((B=P.value)==null?void 0:B.conversationType)==ge.SINGLE?1:2)},ke=async()=>{var m,B,T,D;if(P.value.conversationKey==z.REPLY)y.updateReplyConversationTop((m=P.value)!=null&&m.isTop?0:1,Xt[z.REPLY]);else if(P.value.conversationKey==z.GROUP)y.updateGroupConversationTop((B=P.value)!=null&&B.isTop?0:1,Xt[z.GROUP]);else if(P.value.conversationKey==z.VERIFY)y.updateVerifyConversationTop((T=P.value)!=null&&T.isTop?0:1,Xt[z.VERIFY]);else if(P.value.conversationKey==z.CXOFFICIAL)y.updateCxofficialConversationTop((D=P.value)!=null&&D.isTop?0:1,Xt[z.CXOFFICIAL]);else if(P.value.type==10){P.value.isTop=P.value.isTop?0:1;const Y=P.value.isTop?new Date().getTime():0,Se=P.value.isTop?1:2,Ue=ce.value.find(Qe=>Qe.conversationKey==P.value.conversationKey);Ue&&(Ue.isTop=P.value.isTop,Ue.topTime=Y),await y.updateTop(P.value.conversationKey,4,Se,Y)}},je=async()=>{var m;y.updateConversationFolderTop(ae.value.id,(m=ae.value)!=null&&m.isTop?0:1)},Tt=R(!1),ds=async()=>{Tt.value=!0},ws=()=>{Tt.value=!1},et=()=>{const{destroy:m}=Lt(Tn,{title:O("message.reminder"),content:"删除后，文件夹内的会话将移动到根目录下",cancelBtn:{text:O("message.cancel"),callback(){m()}},confirmBtn:{text:O("message.delete"),async callback(){(await uo({id:ae.value.id,puid:y.puid})).result==1&&y.deleteMsgFolderInfo(ae.value.id),m()}}})},rt=async()=>{te.value==P.value.conversationKey&&($e.push("/message/msgcover"),y.setChatTargetId(0)),await y.deleteConversationItem(P.value.conversationKey,P.value.conversationType==ge.GROUP),await Ps({msgId:P.value.conversationKey,puid:y.puid,type:P.value.conversationType==ge.GROUP?Pt.GROUP:Pt.SINGLE,status:0})},Xe=R(""),Ee=R({}),xs=(m,B)=>{m.preventDefault(),document.body.click(),ae.value=B;const T=[[{icon:ae.value.isTop?"unpin":"top",name:ae.value.isTop?O("message.unpin"):O("message.top"),handler:()=>{Y(),je()}}],[{icon:"modify",name:O("message.modify"),handler:()=>{Y(),ds()}}],[{icon:"delete_con",name:O("message.delete"),handler:()=>{Y(),et()}}]],D=(m==null?void 0:m.y)+T.length*40+12>M?(m==null?void 0:m.y)-T.length*40-12:m==null?void 0:m.y,{destroy:Y}=Lt(Fs,{menuList:T,left:m==null?void 0:m.x,top:D,bottomBorder:!1});xe.windowClickOnce(Y)};Et(()=>le.value,m=>{m&&Cs(m)});const Cs=m=>{Ee.value=m,y.setShowFolderId(m.id),r("updateShowMode",{currentFolderInfo:Ee.value})},Ns=(m=!1)=>{Ee.value={},y.setShowFolderId("0"),m&&r("updateShowMode",{currentFolderInfo:{}})},gs=()=>{const{destroy:m}=Lt(sa,{conversationInfo:[P.value],cancelBtn:{text:O("message.cancel"),callback(){m()}},confirmBtn:{text:O("message.done"),callback(){m()}}})};i({closeFolderMode:Ns,getConversationListAndfolderList:()=>kt.value});const Ft=(m,B)=>{m.preventDefault(),document.body.click(),P.value=B,Xe.value=B.conversationKey;let T=P.value.conversationKey!=z.REPLY&&P.value.conversationKey!=z.GROUP&&P.value.conversationKey!=z.VERIFY&&P.value.conversationKey!=z.CXOFFICIAL;B.type==10&&(T=!1);const D=[];D.push([{icon:P.value.isTop?"unpin":"top",name:P.value.isTop?O("message.unpin"):O("message.top"),handler:()=>{Se(),T?Be():ke()}}]),D.push([{icon:"move",name:O("message.move"),handler:()=>{Se(),gs()}}]),T&&(D.push([{icon:B.unreadMessageNum>0?"markRead":"markUnread",name:B.unreadMessageNum>0?O("message.markRead"):O("message.markUnread"),handler:()=>{Se(),Qt(B.unreadMessageNum>0,B)}}]),D.push([{icon:"delete_con",name:O("message.delete"),handler:()=>{Se(),rt()}}]));const Y=(m==null?void 0:m.y)+D.length*40+12>M?(m==null?void 0:m.y)-D.length*40-12:m==null?void 0:m.y,{destroy:Se}=Lt(Fs,{menuList:D,left:m==null?void 0:m.x,top:Y,bottomBorder:!1}),Ue=()=>{Xe.value="",Se()};xe.windowClickOnce(Ue)},Qt=async(m,B)=>{if(m){if(B.unreadMessageNum>1)y.sendCMDMessage({chatType:ge.SINGLE,to:String(G.value.loginId),from:String(G.value.loginId),action:"CMD_READ_ACK",ext:{conversationId:B.conversationKey,conversationType:B.conversationType==ge.SINGLE?0:1,messageId:B.latestMessageId,timestamp:String(B.latestSendTime),unreadCount:B.unreadMessageNum}});else{const T=await y.getLastMessage(String(B.conversationKey));T.success&&!T.data.isread&&y.sendCMDMessage({chatType:ge.SINGLE,to:String(G.value.loginId),from:String(G.value.loginId),action:"CMD_READ_ACK",ext:{conversationId:B.conversationKey,conversationType:B.conversationType==ge.SINGLE?0:1,messageId:B.latestMessageId,timestamp:String(B.latestSendTime),unreadCount:B.unreadMessageNum}})}y.clearUnreadNum(B.conversationKey),B&&B.isRemind&&y.clearAtStatus(B.conversationKey),B&&B.isReply&&y.clearReplyStatus(B.conversationKey),B&&B.isCare&&y.clearIsCareStatus(B.conversationKey),B&&B.isNewNotice&&y.clearIsNewNoticeStatus(B.conversationKey)}else y.updateUnreadNum(B.conversationKey,1)},Mt=m=>new Promise((B,T)=>{if(!m||m.length==0)return B("");const D=us.value;D.clearRect(0,0,Je,Je);const Y=8;D.beginPath(),D.moveTo(Y,0),D.lineTo(Je-Y,0),D.quadraticCurveTo(Je,0,Je,Y),D.lineTo(Je,Je-Y),D.quadraticCurveTo(Je,Je,Je-Y,Je),D.lineTo(Y,Je),D.quadraticCurveTo(0,Je,0,Je-Y),D.lineTo(0,Y),D.quadraticCurveTo(0,0,Y,0),D.closePath(),D.clip();const Ue=m.map((Qe,Ge)=>({src:Is(Qe),x:_s(Ge,m.length).x,y:_s(Ge,m.length).y,size:m.length>1?Je/2:Je})).map(Qe=>new Promise(Ge=>{const lt=new Image;lt.src=Qe.src,lt.onload=()=>Ge({img:lt,x:Qe.x,y:Qe.y,size:Qe.size})}));Promise.all(Ue).then(Qe=>{Qe.forEach(lt=>{D.drawImage(lt.img,lt.x,lt.y,lt.size,lt.size)});const Ge=ht.value.toDataURL("image/png");if(Ge===_i)return console.error("[getImgBase64] error!, imgList:",tn(m),"images:",tn(Qe)),B(Ai);B(Ge)})}),Is=m=>{let B=m;switch(m){case at.CLASS:B=o;break;case at.COURSE:B=u;break;case at.GROUP:B=po;break;case z.ZHKF:B=t;break;case z.INBOX:B=f;break}return B},_s=(m,B)=>{let T={x:0,y:0};switch(B){case 1:T.x=0,T.y=0;break;case 2:T.x=m%2*(Je/2),T.y=m%2*(Je/2);break;case 3:m==0?(T.x=Je/4,T.y=0):m==1?(T.x=0,T.y=Je/2):(T.x=Je/2,T.y=Je/2);break;case 4:T.x=m%2*(Je/2),T.y=(m>=2?1:0)*(Je/2);break}return T};return(m,B)=>(I(),E(Ke,null,[(I(!0),E(Ke,null,ot(n(kt),T=>{var D,Y,Se,Ue,Qe,Ge,lt,Ht,ze;return I(),E("div",{id:"id"in T?T.id:T.conversationKey,key:"id"in T?T.id:T.conversationKey},["id"in T?(I(),Me(oa,{key:0,"folder-info":T,onRightClick:xs,onHandleClick:Cs},null,8,["folder-info"])):T.conversationKey==n(z).REPLY?(I(),E("div",{key:1,id:"reply",class:H(["affix_box",T.conversationKey==Xe.value?"affix_box_cover":""]),onClick:ee,style:dt({background:n(te)==-3?"#E4ECFF":""}),onContextmenu:Ve=>Ft(Ve,T)},[p("div",rg,[lg,Ct(p("div",cg,null,512),[[xt,!!n(ue)]])]),p("div",ug,[p("div",dg,[p("div",gg,L(n(O)("message.comments")),1),T!=null&&T.isTop?(I(),E("div",fg,L(n(O)("message.top")),1)):re("",!0)]),p("div",pg,L((D=n(K))!=null&&D.latestSendTime?n(xe).timeago((Y=n(K))==null?void 0:Y.latestSendTime):""),1)])],46,ig)):T.conversationKey==n(z).GROUP?(I(),E("div",{key:2,id:"group",class:H(["affix_box",T.conversationKey==Xe.value?"affix_box_cover":""]),onClick:be,style:dt({background:n(te)==-4?"#E4ECFF":""}),onContextmenu:Ve=>Ft(Ve,T)},[p("div",vg,[hg,Ct(p("div",yg,[p("div",{class:H(["text",ie?"":"lineHeight16",n(x)>99?"b-number":""])},L(n(x)>99?"99+":n(x)),3)],512),[[xt,!!n(x)]])]),p("div",wg,[p("div",Cg,[p("div",Ig,L(n(O)("message.groupInvitation")),1),T!=null&&T.isTop?(I(),E("div",_g,L(n(O)("message.top")),1)):re("",!0)]),p("div",Ag,L((Se=n(pe))!=null&&Se.latestSendTime?n(xe).timeago((Ue=n(pe))==null?void 0:Ue.latestSendTime):""),1)])],46,mg)):T.conversationKey==n(z).VERIFY?(I(),E("div",{key:3,id:"verify",class:H(["affix_box",T.conversationKey==Xe.value?"affix_box_cover":""]),onClick:ne,style:dt({background:n(te)==-5?"#E4ECFF":""}),onContextmenu:Ve=>Ft(Ve,T)},[p("div",Tg,[Mg,Ct(p("div",Rg,[p("div",{class:H(["text",ie?"":"lineHeight16",n(_)>99?"b-number":""])},L(n(_)>99?"99+":n(_)),3)],512),[[xt,!!n(_)]])]),p("div",Eg,[p("div",bg,[p("div",xg,L(n(O)("message.vinformation")),1),T!=null&&T.isTop?(I(),E("div",Ng,L(n(O)("message.top")),1)):re("",!0)]),p("div",kg,L((Qe=n(J))!=null&&Qe.latestSendTime?n(xe).timeago((Ge=n(J))==null?void 0:Ge.latestSendTime):""),1)])],46,Sg)):T.conversationKey==n(z).CXOFFICIAL?(I(),E("div",{key:4,id:"cxofficial",class:H(["affix_box",T.conversationKey==Xe.value?"affix_box_cover":""]),onClick:Fe,style:dt({background:n(te)==-6?"#E4ECFF":""}),onContextmenu:Ve=>Ft(Ve,T)},[p("div",Lg,[Ug,Ct(p("div",Dg,[p("div",{class:H(["text",ie?"":"lineHeight16",n(F)>99?"b-number":""])},L(n(F)>99?"99+":n(F)),3)],512),[[xt,!!n(F)]])]),p("div",Fg,[p("div",Hg,[p("div",Pg,[p("div",Og,L(n(O)("message.cxofficial")),1),T!=null&&T.isTop?(I(),E("div",Gg,L(n(O)("message.top")),1)):re("",!0)]),p("div",Kg,L((lt=n(fe))!=null&&lt.latestSendTime?n(xe).timeago((Ht=n(fe))==null?void 0:Ht.latestSendTime):""),1)]),p("div",Qg,[p("div",Vg,L(((ze=n(fe))==null?void 0:ze.subtitle)||""),1)])])],46,Bg)):"type"in T&&T.type==10?(I(),E("div",{key:5,id:"subscribes"+T.conversationKey,class:H(["affix_box",T.conversationKey==Xe.value?"affix_box_cover":""]),onClick:Ve=>ye(T),style:dt({background:n(te)==T.conversationKey?"#E4ECFF":""}),onContextmenu:Ve=>Ft(Ve,T)},[p("div",Jg,[p("img",{src:T.logo,alt:"",draggable:"false"},null,8,qg),Ct(p("div",Xg,[p("div",{class:H(["text",ie?"":"lineHeight16",T.unreadMessageNum>99?"b-number":""])},L(T.unreadMessageNum>99?"99+":T.unreadMessageNum),3)],512),[[xt,!!T.unreadMessageNum]])]),p("div",$g,[p("div",zg,[p("div",Yg,[p("div",Zg,L(T.name),1),T!=null&&T.isTop?(I(),E("div",jg,L(n(O)("message.top")),1)):re("",!0)]),p("div",ef,L(T!=null&&T.latestSendTime?n(xe).timeago(T==null?void 0:T.latestSendTime):""),1)]),p("div",tf,[p("div",sf,L((T==null?void 0:T.subtitle)||""),1)])])],46,Wg)):(I(),E("div",{key:6,onDrop:rs(Ve=>Oe(Ve,T),["prevent"]),class:H([_e.value==T.conversationKey?"drag_active":""]),onDragenter:rs(Ve=>n(Nt)(Ve,T),["prevent"]),onDragover:rs(Ve=>At(Ve,T),["prevent"]),onDragleave:rs(Ve=>_e.value=T.conversationKey,["prevent"])},[Te(ng,{"is-remind":T.isRemind,"is-reply":T.isReply,"is-care":T.isCare,"msg-send-type":T.latestMessage.state,"is-new-notice":T.isNewNotice,isDraft:!!T.draft&&n(y).getCurrentChatId!=T.conversationKey,"is-top":T.isTop,"is-no-disturb":T.isNoDisturb,"checked-conver-item-index":String(n(te)),"item-config":{title:T.conversationInfo.name,time:n(xe).timeago(T.latestSendTime),desc:n(cs)(T),chatIco:T.conversationInfo.avatarUrl,...T},onHandleClick:Ve=>q(T),onRightClick:Ft,onAvatorClick:oe,style:dt({background:n(te)===T.conversationKey?"#E4ECFF":""})},null,8,["is-remind","is-reply","is-care","msg-send-type","is-new-notice","isDraft","is-top","is-no-disturb","checked-conver-item-index","item-config","onHandleClick","style"])],42,nf))],8,ag)}),128)),Tt.value?(I(),Me(wo,{key:0,"folder-info":n(ae),"add-class-visible":Tt.value,onClose:ws},null,8,["folder-info","add-class-visible"])):re("",!0),p("canvas",{ref_key:"canvas",ref:ht,class:"my_canvas",width:Je,height:Je},null,512)],64))}});const af=It(of,[["__scopeId","data-v-e8baca81"]]),Na=a=>(ss("data-v-ff1f030f"),a=a(),ns(),a),rf={key:0,class:"back_head"},lf={class:"folder_name"},cf=Na(()=>p("div",{class:"affix_box_img"},[p("img",{src:Qd,alt:"",draggable:"false"})],-1)),uf={class:"affix_box_text"},df={class:"affix_box_img"},gf=Na(()=>p("img",{src:sr,alt:"",draggable:"false"},null,-1)),ff={class:"dot"},pf={class:"affix_box_text"},mf={class:"my_backtop"},vf=Pe({__name:"index",setup(a){const i=R(),{visible:r,myPuid:l,puid:o,left:u,top:t,handleClose:f}=qo({container:i}),v=(ue,x,_)=>{const{x:F,y:K}=ue;u.value=F+30;const pe=window.innerHeight-350;t.value=K>pe?pe:K,l.value=x,o.value=_,r.value=!0},{t:h}=ts(),A=_t(),{showFolderId:y}=Ot(A),b=Rs(),M=R(),N=R(),G=R(!1),Z=R(),W=Re(()=>A.getCurrentChatId),Q=Re(()=>A.getInboxUnreadCount),V=R({}),X=ue=>{var x;A.setShowFolderId(((x=ue.currentFolderInfo)==null?void 0:x.id)||"0"),V.value=ue.currentFolderInfo},$=()=>{var ue;A.setShowFolderId("0"),V.value={},(ue=Z.value)==null||ue.closeFolderMode(),A.setSearchFolderInfo(null)},U=()=>{A.setChatTargetId(-1),b.push("/message/contacts")},le=()=>{A.setInboxUnreadCount(0),window.open("https://notice.chaoxing.com/pc/notice/myNotice")};window.RendererHelper.on("openInbox",()=>{le()},Hi);const he=ue=>{A.setChatTargetId(ue)},ce=R([]),O=()=>{var F;let x=((F=Z.value)==null?void 0:F.getConversationListAndfolderList()).filter(K=>!(K!=null&&K.isNoDisturb)).filter(K=>K.unreadMessageNum>0),_=j.sortBy(x,[K=>!K.isTop,K=>-Math.max(K.latestSendTime,(K==null?void 0:K.draftTime)||0,(K==null?void 0:K.topTime)||0)]).map(K=>K.conversationKey||K.id);A.getInboxUnreadCount>0&&y.value=="0"&&_.unshift("inbox"),ce.value=_,console.log(_)};let ie="",te="";window.RendererHelper.on("TAB_MESSAGE_GESTURE",ue=>{var _,F,K;const{gesture:x}=ue;if(O(),x==="click_tab"){ie||((_=M.value)==null||_.setScrollTop(0),ie=ce.value[0]);const pe=ce.value.indexOf(te)+1;pe<=ce.value.length-1&&(ie=ce.value[pe]==ie?ie:ce.value[pe]),(F=document.getElementById(ie))==null||F.scrollIntoView(),te=ie;const J=ce.value.indexOf(ie)+1;J<=ce.value.length-1?ie=ce.value[J]:ie=ce.value[0]}x==="switch_tab"&&((K=M.value)==null||K.setScrollTop(0),ie=ce.value[0],te="")},"TAB_MESSAGE_GESTURE");function P(){var ue;(ue=M.value)==null||ue.setScrollTop(0)}const ae=ue=>{G.value=ue.scrollTop>=window.innerHeight/2};return ls(()=>{var ue;N.value=(ue=M.value)==null?void 0:ue.wrapRef}),(ue,x)=>{const _=Gt;return I(),E("div",{id:"conversationId",ref_key:"container",ref:i,class:"conversation"},[n(y)!="0"?(I(),E("div",rf,[p("div",{class:"back_btn",onClick:$},[Te(_,{"icon-class":"back",style:{cursor:"pointer","margin-right":"4px"},width:"14px",height:"14px",color:"#A3B9D9"}),p("span",null,L(n(h)("message.return")),1)]),p("div",lf,L(n(V).name),1)])):re("",!0),Te(n(Ws),{onScroll:ae,ref_key:"scrollBar",ref:M,class:"conversation_scrollbar",style:dt({height:n(y)!="0"?"calc(100% - 24px)":"100%"})},{default:He(()=>[n(y)=="0"?(I(),E("div",{key:0,id:"address",class:"affix_box",onClick:U,style:dt({background:n(W)===-1?"#E4ECFF":""})},[cf,p("div",uf,L(n(h)("message.contacts")),1)],4)):re("",!0),n(y)=="0"?(I(),E("div",{key:1,id:"inbox",class:"affix_box",onClick:le,style:dt({background:n(W)===-2?"#E4ECFF":""})},[p("div",df,[gf,Ct(p("div",ff,null,512),[[xt,!!n(Q)]])]),p("div",pf,L(n(h)("message.inbox")),1)],4)):re("",!0),n(A).initIsReady?(I(),Me(af,{key:2,onToInbox:le,onClickAvatar:v,ref_key:"chatListRef",ref:Z,checkedConverItemIndex:n(W),onUpdateCheckedConverItem:he,onUpdateShowMode:X},null,8,["checkedConverItemIndex"])):re("",!0)]),_:1},8,["style"]),n(r)?(I(),Me(Jo,{key:1,position:"fixed",puid:n(o),myPuid:n(l),"is-sub-component":!0,onClose:n(f),onBlur:n(f),container:i.value,left:n(u),top:n(t)},null,8,["puid","myPuid","onClose","onBlur","container","left","top"])):re("",!0),Ct(p("div",{class:"backtop-container",onClick:P},[p("div",mf,[Te(_,{"icon-class":"backTop",width:"18px",height:"18px",color:"#666"}),gt(" "+L(n(h)("message.backTop")),1)])],512),[[xt,G.value]])],512)}}});const hf=It(vf,[["__scopeId","data-v-ff1f030f"]]);function yf(a){return a.type===jt.AUDIO}function Po(a){if(console.log("[autoCleanRedDots] call"),!a)return;const i=Date.now(),r=_t(),l=Object.keys(a);for(const o of l){const u=a[o];u&&u.unreadMessageNum>0&&u.latestSendTime&&i-u.latestSendTime>Ko&&r.clearUnreadNum(o)}}const wf=a=>(ss("data-v-3deb419b"),a=a(),ns(),a),Cf={class:"chat_conversation_list"},If=wf(()=>p("source",{src:yr},null,-1)),_f=[If],Ye=64,Af=Pe({__name:"index",setup(a){const i=Go(),r=R(),{t:l}=ts(),o=new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQ3SURBVHgB7ZshbBRBFIbnCBhKUkMCNTVFYJqSGgQV1FAMCQkYFHgwKDAoDCgqwIPCQMCQAAZTBKahqangTE0hwTSBmopy38393WF7u683u1f1vuSye7s7s7PfvJl5e9DO3rvLe8Gp5FhwanFBBi7IwAUZuCADF2TgggxckIELMnBBBi7IwAUZuCADF2TgggxckIELMnBBBi7IwAUZuCADF2TgggxckIELMhivoMmZEBaexU8u8w9CuP6lWR0NOB5yOH87hJNnh5/bWul9vsb9E6dCOH0h7iNr5mZllWHzYwi/1w4eV3nO97/P9WQth0Ozcr9X7/eQS54gGq2Gl9n5WQhKQdb01VBJ/yFKgqaXYkdQ5+anon5kcbwsT6TnGpIniF6BtDc/34qNr4LoeL8Y9xk2yOLBVp9Wl5HQVMDOr1gmvXe5DiIcQbSnQfTAeOYg5gwkNIHo0UNuvOpFxZliPiMaa8sOxDaUA+0LUuProsmsY6IXBXfivqKD7xo2u3+qyxJZDDGuQWxDxicoZVRZyOAhGVo7W3GCl5zuG7usrmvSSQPy5qA6GApAD1atdBZTC3HLUEkn9qoFQBA9Esm9Ncxpy/qLkEPmKjYI41TA1KXYEPVaOgzqhsQwtEpRLl39hk3o5fvo/oiiLB+OHamgcs/C7L24XX8et6w2aTQxTHTN5Lm45SGUAPIA2z/ifjp3KAr6eVIy6Woop4K2u3E1FRcfx2hsMNTy5qDu27jUSwbQuxxTVKVDrBxB+m6uRkuxI7SSpagsWyQT1WXUEUeeKKqnQ/L/P2kED0IOomt4QOA4vav8SXkQWXdVHkT0EXHIpFw5CiRf2TqRkmbiRKyuGZahH5L2VzF6TQLVwFFDvJ/zLMeH70fpXjzWn4TnivuAogPhaUTqtaZhstj+KvbhWrEvQUTPKBARKjv/8P9zemfTeS37lJm5UQxFrWYNk8X2BQl6PHcO0GqkyGPLMURTF5GyX/daPEfEETXMj4hqKVkcn6AmPUiuU5fvkFL0r1uJEpDEfbQqSl4LyeIYMumJuB32otlG3XyUSBIt4tujKENykNfCq0Z7EcTqRcOZVGmoXjT1M8UosPrxoJp0ta/XD+QTMWl0KudKocyoSWqJPEGzd6OMdNVQo5GihJBezYG60t9zNCchRxGSpgfMObonw4q28VnsXbvxMq+TBnSy/phF45zlvP/pFvOBfqehYQpxev7Ka7te/V6kVwSgTkWB6lHdys6RSedwbH/ZXypeejmGuLp5rYK8CCIy6kK3PP6V7B2WVEoZHlR1s2ohYPXJwSjhO5M3HYYoIipDUKf1P4diLtj923jsD6U8p6RJqcUo1yZ0/O/F6vF/FzNwQQYuyMAFGbggAxdk4IIMXJCBCzJwQQYuyMAFGbggAxdk4IIMXJCBCzJwQQYuyMAFGbggAxdk4IIM/gF96ZOv87GQoAAAAABJRU5ErkJggg==",self.location).href,u=new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAATESURBVHgB7ZvLThNRGMePQrxyU1BUipdg1FiNJi6sbtxJ3Is+ALgX3Au6Rx4AeQCBFwA3upGayIJwUQwkaFGB0HBVxIB4/tOe4cxwZr52Om0w+X5J05kzZ6Zn/vNdR9kjJLUf3mwJxshewfjCAhGwQAQsEAELRMACEbBABCwQAQtEwAIRsEAELBABC0TAAhGwQAQsEAELRMACEbBABCwQAQtEwAIRsEAELBABC0RQLAJSVlQsXl24Jsrld9PkiBhb+2kfu3zwsHU8G6b//JafdXIerovr4/eWNzdEvgksEBbXvzgvmk+dFa2158XDz0P2MezfKq0Q2dDxfUp0/Phi7zceqxGN1ZEd8yL7D1jft4fjorMumvHv9CRnxJOpcZEtgQUCXXPfLIGwSPVU3YuKryxZ27HSctFQecLa1hfafPKMfdM6y383LKsClw+VWJaDfVxz7Neqw9pG11atMRNYW2TfARGUnASCFQ2sLFqLqK+o2iFQXB7rSc7a+0og3KTifmW1USCcp86FK+M3euZnHFam6F+YN46D9rMX7d8NQk4CAbjZHiGMN1kjn1yspNzahoUp1BjINlYVmpxXBzfDx0SLdD8T3Revi0KQCuglIhcCC6RbATBlla65aWlhSXt+c1owPaA/jdSJ6KGdN6HcSgfnq2sgSJvGvUAoCEJggdxWgJt2LwKBU43pgVKf55Wq4boqSCO+wRowt0+Op87bdMzxIpVtk4UXCJkIi26trfOcEyuRFrCltrctruFotfVdI+OWshJkIh3lthBWD7LPEpO2qF6uHSaBBUImwuL9BGqoOmF93LSfu+TYh1UoV3RTX1Fpb+OBQOj+paQV9KNZxpeB1cWMilGdvKSQ5/IplxU7L+0VgxKooNe93aTxuLNYRPEIgeB2VNxx82Tqk6PsyIS8COR2F+AVg/yAqHr5ANeCS2IcNxpfXXLMR8ZSFo0Q4I5Pox7FpB+hC2TKPm6+3rhjHHe3Ayr2wMIgFArF+iNVsvi7JO59HNwh9NbW9n/WHVhZyNqdTITezSOz4Eb709lGjcW1m8FxZWWJdPuAj37DVnCW8QvjibQlwIKaJkZEuXTfsqIiUQhCtyCVWRBA78o4AVqkVSBmxNKWBStpPF4jorKphXWYmkj0aABNLCxGgXqrLTEhaqWA3Re8C073MYisx75MyVudr1oLWI6p1umTWQtdfzTdiOpzlPVAHJOb9Mr4gznuGKO3Lbiefk2qXvIiNIFKpcmjKn69lCrKVIbp1hpTHSxYNbqwJnezCWG9GlB1/gOXRSB4qwIW76h2VQx6WXdFNMkUjKf2OP0KA3Gm1yetwrUwH6k7sm+/PY6xFpmSdwOhCaR8/KZ8imhSsf9IBlQ/YAWIJ6m3k9dtkSBQGE8/DHJ2MdxM1+y0FZwRd9pkXEFlrKyDAhaGQP1CVted0gqRvikyecfz7mrMOH568K3IhpxfmN0efm8LgadualopUPA9GB9ytBV+9MkXZH7Vd5jgXVdB/hwK1lWfTvt+wdcEmlvENAjvrp7zTcEE+l/hfxcjYIEIWCACFoiABSJggQhYIAIWiIAFImCBCFggAhaIgAUiYIEIWCACFoiABSJggQhYIAIWiIAFImCBCFgggn9kZS8EWsUGOgAAAABJRU5ErkJggg==",self.location).href,t=_t(),f=Es(),v=Ri(),h=R(),{conversationListData:A,getCurrentChatId:y,getUserInfo:b,autoReconnectNumMax:M,conversationList:N,isMultipleEdit:G}=Ot(t);let Z=R(3),W,Q=!1,V;const X=window.RendererHelper.getPlatform()!="darwin",$=R(!1),U=[],le=()=>{console.log("被执行完"),t.refreshConversation({isQueueCallback:!0})};async function he(){if(t.sqlReady&&Q){console.log("executeTask");let e=[];const g=await oe();g&&g.length>0&&(e=g.map(s=>s.conversationId),await window.MessageDbHelper.updateConversationsIsNoDisturb(e,!0));const d=await window.MessageDbHelper.queryAllIsNoDisturbConversation();if(d.success){const c=(d.rows??[]).filter(w=>!e.includes(w.conversationKey));for(const w of c)W.setSilentModeForConversation({conversationId:w.conversationKey,type:w.conversationType,isSilentMode:!0})}else console.log("queryAllIsNoDisturbConversation has error",d.error)}}const ce=R(!1),O=new Ei(1,le),ie=R([]),te={directJoined:e=>O.trigger(be,e),memberAbsence:e=>O.trigger(ye,{...e,type:"delete"}),memberPresence:e=>O.trigger(ye,{...e,type:"add"}),destroy:e=>O.trigger(Tt,e),removeMember:e=>O.trigger(Tt,e),updateInfo:e=>O.trigger(je,e)},P={muteGroup:e=>O.trigger($t,{groupevent:e,mute:!0}),rmGroupMute:e=>O.trigger($t,{groupevent:e,mute:!1}),addMute:e=>O.trigger(Js,{groupevent:e,mute:!0}),removeMute:e=>O.trigger(Js,{groupevent:e,mute:!1}),changeOwner:e=>O.trigger(zt,e),addAdmin:e=>O.trigger(Be,e),removeAdmin:e=>O.trigger(ke,e)},ae={CMD_APP_ALERT:e=>Rt(e),CMD_MEET_RTC_TEA_SCREEN:e=>Bs(e),CMD_MEET_RTC_STU_SCREEN:e=>Vt(e),CMD_GROUP_CHAT_INVITATION:e=>O.trigger(ze,e),REVOKE_FLAG:e=>$e(Se,e,700),CMD_READ_ACK:e=>Qe(e),CMD_GROUP_MSG_READ:e=>$e(Ee,e,800),CMD_GROUP_CHAT_SHOW_READ:e=>O.trigger(xs,e),CMD_MESSAGE_HINT_NEW:e=>O.trigger(lt,e),CMD_MESSAGE_HINT:e=>O.trigger(Ht,e),CMD_MESSAGE_UPDATE_GROUP_NOTICE:e=>O.trigger(rt,e),CMD_MESSAGE_DELETE_GROUP_NOTICE:e=>O.trigger(rt,e),PC_CLIENT_PUSH_LOG:e=>Wt(e),CMD_CHECK_MESSAGE_READ_ACK:e=>$e($s,e,2e3),CMD_CHECK_MESSAGE_READ_ACK_REPLY:e=>O.trigger(Yt,e),CMD_MESSAGE_TIP:e=>O.trigger(Jt,e),CMD_ONLINE_FILE_OPER:e=>window.OnlineFileHelper.handleOnlineFileMessage(e),CMD_ONLINE_FILE_TRANSFER_SUCCESS:e=>O.trigger(Qn,e),CMD_ONLINE_FILE_TRANSFER_FAILED:e=>O.trigger(fs,e),CMD_KICK_PC:e=>O.trigger(fn,e),CMD_ASK_PC_INFO:e=>O.trigger(Ys,e),CMD_CHANGE_PC_LOGIN_CONFIRM:e=>O.trigger(Kn,e)},ue={[qe.NORMAL]:(e,g)=>T(g,e),[qe.COURSE]:(e,g)=>D(e,at.COURSE,g),[qe.GROUP]:(e,g)=>T(g,e),[qe.DEPT]:(e,g)=>T(g,e),[qe.CLASS]:(e,g)=>D(e,at.CLASS,g),[qe.INTERACTION]:(e,g)=>T(g,e)},x=R("classroom"),_=R(!0),F=R(!1),K=R(!0);window.MessageDbHelper.initMessageData().then(async e=>{console.log(`[initMessageDataBase] result: ${e==null?void 0:e.success}`);const g=await window.RendererHelper.getUser();let d=String(g==null?void 0:g.uid)||"";us(Number(g.puid)),t.initSql(),he(),t.initSelfUserInfoDetail(g),f.initSelfUserInfoDetail(g),t.initConversationList(d).then(async()=>{(await window.MainWindowHelper.getAppSystemConfig()).clearMessageRedDot===!0&&Po(t.conversationList)}),window.RendererHelper.isNetOnline().then(s=>{s||t.changeConnectType(!1)}),window.MainWindowHelper.getAppSystemConfig().then(s=>{_.value=(s==null?void 0:s.messageReminder)||!1,F.value=(s==null?void 0:s.messageReminderSound)??!1,K.value=(s==null?void 0:s.clearMessageRedDot)??!0,t.setMessageReminder(_.value),(s==null?void 0:s.appMode)=="classroom"?x.value="classroom":x.value="normal",_.value||(window.RendererHelper.flashTray(!1),t.isTrayFlashing=!1,window.RendererHelper.flashFrame(!1))}),fe(),ys(),window.MainWindowHelper.getPanToken().then(s=>{s&&console.log(`云盘_token=${s}`)}),window.addEventListener("online",j.debounce(()=>{console.log("网络环境恢复正常，开始进行重连"),Oe&&clearInterval(Oe),De&&clearTimeout(De),Ze&&clearInterval(Ze),t.setAutoReconnectNumMax(5),kt()},2e3,{leading:!0,trailing:!1})),window.MainWindowHelper.useMode("ImMessage"),window.MainWindowHelper.useMode("OnlineFile"),window.OnlineFileHelper.setSendCmdMessageFun(s=>pe(s)),window.OnlineFileHelper.setTranslateFun(l),window.OnlineFileHelper.setCreateNewMessageFun(t.createNewMessage)});async function pe(e){return new Promise(async g=>{const{type:d}=e;switch(d){case jt.TEXT:{const{msg:s}=await t.saveMsg({msgType:jt.TEXT,msgOptions:e,isAtt:!1});await t.sendShowTypeMessage({msg:s,onAfterSend:c=>{g(c)}},!1);break}case jt.CMD:{const s=await t.sendCMDMessage(e,!0);g(s);break}}})}const J=R(),fe=()=>{window.MainWindowHelper.getImInfo().then(e=>{if(e){ee(String(e.puid)),t.initUserInfo({tuid:String(e.tuid),puid:String(e.puid),hxToken:e.hxToken}),f.initUserInfo({tuid:String(e.tuid)}),window.OnlineFileHelper.updateMyHxUid(String(e.tuid)),window.RendererHelper.getUID().then(d=>{window.OnlineFileHelper.updateMyPuid(d)});const g=sessionStorage.getItem(`chatTargetId_${e.tuid}`);if(g){const d=pt.currentRoute.value;let s="/message/msgcover",c=0;d!=null&&d.path&&(d==null?void 0:d.path.indexOf("/message"))>=0&&(c=g,s=d==null?void 0:d.path),t.setChatTargetId(c),pt.push({path:s,query:{...d==null?void 0:d.query,t:new Date().getTime()}})}f.initSql(),Ue(),Nt(e),J.value&&clearInterval(J.value),J.value=setInterval(()=>ee(String(e.puid)),15*1e3),Kt(e.tuid),ht(e.puid),window.RendererHelper.offStoreDataChanged("mainWindowStateChanged"),window.RendererHelper.onStoreDataChanged("mainWindowStateChanged",async d=>{var c;window.RendererHelper.isAppPackaged().then(w=>{w&&t.getConnectType&&(d=="focus"&&!$.value&&($.value=!0,ht(e.puid)),d=="blur"&&($.value=!1))}),d==="focus"&&t.isTrayFlashing===!0&&(window.RendererHelper.flashTray(!1),t.isTrayFlashing=!1);const s=String(t.getCurrentChatId);d=="restore"||d=="show"?await window.MainWindowHelper.getTopTabId()!=Bo?t.setCurChatIdInBackend(s):await Dt():d=="hide"||d=="minimize"?t.setCurChatIdInBackend(s):d==="focus"&&(((c=t.getCurrentConversation)==null?void 0:c.unreadMessageNum)??0)>0&&await Qt()&&(console.log("[message/index.vue][focus window] current chat id:",s),Us(s))})}}).catch(e=>{f.initSql(),console.log("获取数据报错",e);const g=setTimeout(()=>{Z.value>=0&&(clearTimeout(g),Z.value--,fe())},2e3)})};async function oe(){let e=[],g;try{do{const d=await W.getSilentModeRemindTypeConversations({pageSize:100,cursor:g});d.conversations&&Array.isArray(d.conversations)&&(e=e.concat(d.conversations.filter(s=>No(s.remindType)))),g=(d==null?void 0:d.cursor)??null}while(g);return e}catch(d){return console.error("查询消息免打扰会话出错:",d),e}}function _e(e){e&&(e.enableAll(),e.setLevel(1),e.setConsoleLogVisibility(!1),e.onLog=g=>{console.log(`[WebImSDK]: ${g.time} ${JSON.stringify(g==null?void 0:g.logs)}`)})}async function At(e,g){const d=await ri(g);return t.sendCMDMessage({chatType:ge.SINGLE,to:e,action:"CMD_REPLY_PC_INFO",from:e,deliverOnlineOnly:!0,ext:d})}const Nt=async function(e){console.log("initIm"),W==null||W.logout(),_e(bo.logger);const g=await window.MainWindowHelper.getPcDeviceInfo();W=js({...Kd,deviceId:g.deviceId+"-"+String(e.tuid)},!0),W.tokenLogin(String(e.tuid),e.hxToken).then(async()=>{Q=!0;const d=localStorage.getItem("localDeviceInfo");d&&window.RendererHelper.sendToMainProcess("setLocalStorageLocalDeviceInfo",yn(d)),he(),At(String(e.tuid),1);for(let s=0;s<U.length;s++){const c=U.pop();await t.outerSendMessage(c).catch(w=>{console.error("[outerSendMessage] error",w)})}}),W.addEvents({eventName:"connection",handlers:{onConnected:async()=>{var d;M.value=5,console.log("[WebImSDK onConnected]",(d=W.connection)==null?void 0:d.deviceId),window.MainWindowHelper.visibleNetStateView(!1,1),t.changeConnectType(!0)},onDisconnected:async d=>{if(console.log(`[WebImSDK onDisconnected] type: ${d==null?void 0:d.type}, message: ${d==null?void 0:d.message}`),window.RendererHelper.sendToMainProcess("hximDisconnect"),(d==null?void 0:d.type)===216){const s=await window.RendererHelper.getTempStore("LAST_MODIFY_PASSWORD_TIME"),c=new Date().getTime();s&&c-s<15*1e3||(console.log("Receive modify password event, call logout"),window.RendererHelper.toast(l("modifyPasswordLogoutTip"),{duration:2e3,top:180,position:"inWindow"}),setTimeout(()=>{window.RendererHelper.setSysStore("lastUserUid"),Gn()},2e3))}t.changeConnectType(!1)},onOnline:()=>{console.log(">>>>>网络连接成功。")},onOffline:()=>{console.log(">>>>>本机网络掉线。"),t.changeConnectType(!1)},onError:d=>{console.log(">>>>>环信连接报错",d==null?void 0:d.type,d==null?void 0:d.message),window.RendererHelper.isNetOnline().then(s=>{console.log("网络环境：",s)}),t.changeConnectType(!1)}}}),W.addEvents({eventName:"groupEvent",handlers:{onGroupEvent:async d=>{Object.keys(te).includes(d.operation)&&te[d.operation](d)},onGroupChange:d=>{Object.keys(P).includes(d.type)&&P[d.type](d)}}}),W.addEvents({eventName:"customEvent",handlers:{onReadMessage:async d=>{t.addLocalMsgAck({time:Date.now(),msgid:d.mid,acktype:Ls.SINGLE_READ_ACK,origindata:d}),$e(et,d,800)}}}),W.addEvents({eventName:"messageListen",handlers:{onChannelMessage:d=>{$e(ws,d,(d==null?void 0:d.onlineState)==1?500:1200)},onCmdMessage:d=>{ds(d)},onMessage:async d=>{var s,c;console.log(">>> onmessage","length:",d==null?void 0:d.length);try{const w=j.groupBy(d,S=>Zt(S));for(let S of Object.keys(w)){const k=w[S];if(ie.value.includes(S))console.log(">>>>>>>群聊不存在: key-",S);else{const C=k.filter(se=>{const{id:me}=se;return Od(me)&&S!=t.loginId?(console.log("This message is recalled, ignore it",me),Gd(me),!1):(se==null?void 0:se.chatType)!=ge.CHATROOM});for(const se of C)((s=se.ext)==null?void 0:s.robotMessageInfo)!==void 0&&t.deleteTempMessage(se.to,se.ext.tempMessageId).then(({db:me,memory:We})=>{console.log(`[deleteTempMessage][db=${me}][memory=${We}]`)});const[de,we]=j.partition(C,{onlineState:1});we!=null&&we.length&&(console.log(">>>>>>>离线消息: key-",S,"--length-",we.length),O.trigger(ks,j.sortBy(we,se=>se.time)));const Ae=j.sortBy(de,se=>se.time);for(const se of Ae)if(yf(se)){if(se.length)se.duration=se.length;else if(se.url!==void 0){const me=await fetch(se.url),We=new xo;await We.initWithUrl(me.url),se.duration=We.getDuration()}O.trigger(Mt,se)}else O.trigger(Mt,se)}}}catch(w){console.log("接收消息回调处理error",w)}try{const w=d.map(C=>C.id),S=(c=t.getLocakMsgAck)==null?void 0:c.filter(C=>w.includes(C.msgid));S!=null&&S.length&&S.forEach(C=>{C.acktype==Ls.CMD_READ_ACK?(console.log("收到消息执行本地红点ack",C.msgid),$e(Ge,C.origindata)):(console.log("收到消息执行本地已读回执ack",C.msgid),$e(et,C.origindata))});const k=w.join(", ");console.debug(`receive message ids: ${k}`)}catch(w){console.log("消息日志id处理error",w)}},onReceivedMessage(d){var k,C;const s=d.mid,c=d.to,w=(k=t.messageList[c])==null?void 0:k.find(de=>de.id===s);w&&w.sendType!=="success"&&(console.log("[message/index.vue] onReceivedMessage update message sendType to success",w.id),t.updateMsgValue({messageId:w.id,conversationKey:c,message:{sendType:"success"}}));const S=t.conversationList[c];S&&S.latestMessageId===d.id&&(t.updateConversationDataInMem(c,{latestMessageId:s}),t.updateConversationDataInDb(c,{latestMessageId:s})),S&&((C=S.latestMessage)==null?void 0:C.state)!=="success"&&String(S.latestMessageId)===s&&(S.latestMessage.state="success",t.updateConversationDataInDb(c,{latestMessageSendType:"success"}))}}}),W.addEvents({eventName:"multiDeviceEvent",handlers:{onMultiDeviceEvent(d){switch(d.operation){case"removeSilentModeForConversation":{console.log("removeSilentModeForConversation event",d);break}case"setSilentModeForConversation":{const{data:s,conversationId:c}=d??{};if(console.log("setSilentModeForConversation",c,s==null?void 0:s.type),c){const w=No(s==null?void 0:s.type);t.updateDisturb(c,w)}break}default:{console.log("multiDeviceEvent default event",d);break}}}}})};Et(()=>t.getConnectType,(e,g)=>{e?(Oe&&clearInterval(Oe),De&&clearTimeout(De),Ze&&clearInterval(Ze),window.MainWindowHelper.visibleNetStateView(!1,1)):(console.log("监听变化，重新开始连接"),St())});let Oe,Ne=R(!1),De,Ze;const St=()=>{console.log("触发重连");const e=!j.cloneDeep(t.getConnectType);if(M.value>0){const d=R([3e5,18e4,3e4,15e3,15e3][M.value-1]);Oe&&clearInterval(Oe),e&&(Ne.value=!1,Oe=setInterval(()=>{d.value>0?d.value-=1e3:(kt(),console.log(`正在进行第${6-M.value}次重连`),M.value-=1)},1e3))}else Oe&&clearInterval(Oe),De&&clearTimeout(De),Ze&&clearInterval(Ze)},kt=async()=>{Ne.value=!0;const e=await window.RendererHelper.isNetOnline();console.log("网络状态",e),e&&(Z.value=3,fe()),Oe&&clearInterval(Oe),De&&clearTimeout(De),Ze&&clearInterval(Ze),De=setTimeout(()=>{St()},5e3);let g=0;Ze=setInterval(async()=>{g++;const d=await window.RendererHelper.isNetOnline();js().isOpened()&&d&&(clearInterval(Oe),clearInterval(Ze),De&&clearTimeout(De),t.changeConnectType(!0)),g==10&&clearInterval(Ze)},1e3)},Dt=async()=>{const e=t.getCurChatIdInBackend;if(e&&A.value[e]&&A.value[e].unreadMessageNum){const g=await t.getLastNotAudioMessage(String(e)),d=g.success&&g.data,s=d.msgbody?JSON.parse(d.msgbody):{};(s==null?void 0:s.chatType)==ge.SINGLE?((d==null?void 0:d.msgtype)!=jt.AUDIO&&e!=t.loginId&&await t.sendReadMessage(e,"read",d.msgid),await t.updateSelfReadStatus(e),await t.sendCMDMessage({chatType:ge.SINGLE,to:String(b.value.loginId),action:"CMD_READ_ACK",ext:{conversationId:e,conversationType:0,messageId:d.msgid,timestamp:String(d.time),unreadCount:1},from:String(b.value.loginId)})):await t.sendCMDMessage({chatType:ge.SINGLE,to:String(b.value.loginId),action:"CMD_READ_ACK",ext:{conversationId:e,conversationType:1,messageId:d.msgid,timestamp:String(d.time),unreadCount:1},from:String(b.value.loginId)});const c=setTimeout(()=>{t.clearUnreadNum(e),clearTimeout(c)},3e3)}t.setCurChatIdInBackend("")};window.RendererHelper.on("thisTabBlur",()=>{console.debug("切换到其他标签或者模块"),t.setCurChatIdInBackend(String(t.getCurrentChatId))},Pi),window.RendererHelper.on("tabSelectdThis",()=>{console.debug("切回到消息模块的消息"),Dt()},Oi),window.RendererHelper.on("contentMenuItemClick",e=>{e=="reload"&&window.RendererHelper.isAppPackaged().then(g=>{g&&window.MainWindowHelper.syncAllContacts(!0).then(d=>{console.log(d)})})},Gi),window.RendererHelper.on("deleteAllMessageRecord",async()=>{await window.MessageDbHelper.deleteAllMessageRecord(),t.setChatTargetId(0),pt.push({path:"/message/msgcover"}),t.refreshConversation()},Ki),window.RendererHelper.onStoreDataChanged("appSystemConfig",e=>{_.value=(e==null?void 0:e.messageReminder)||!1,F.value=(e==null?void 0:e.messageReminderSound)??!1;const g=(e==null?void 0:e.clearMessageRedDot)??!0;K.value===!1&&g===!0&&Po(t.conversationList),K.value=g,t.setMessageReminder(_.value),_.value||(console.log("[message/index.vue] 学习通「通用设置 - 接收新消息通知」设置项关闭，停止托盘图标闪烁"),window.RendererHelper.flashTray(!1),t.isTrayFlashing=!1,window.RendererHelper.setBadgeCount(0),window.RendererHelper.flashFrame(!1))}),window.RendererHelper.on("REFRESH_REPLY_ME",e=>{var g;if(console.log("subscribesUrl======",e),e){const d=t.subscribesConversations.filter(s=>s.messageListUrl!=e);t.setSubscribesConversations(d),e==t.cxofficialUrl&&t.setCxOfficialStatus(!1)}(g=b.value)!=null&&g.puid&&ht(Number(b.value.puid))},Qi);const cs=R(!1);window.RendererHelper.on("MESSAGE_START_CONNECT",()=>{console.log("收到全局重连"),cs.value=!0,Z.value=3,fe()},Vi),window.RendererHelper.on("UPDATE_MESSAGE_FANSLIST",async e=>{e!=null&&e.tuid&&Kt(e==null?void 0:e.tuid)},Wi),window.RendererHelper.on("UPDATE_USER_NAME_BY_CARD",async e=>{var g,d,s;if(e.tuid&&e.name){if(A.value[e.tuid]){((d=(g=A.value[e.tuid])==null?void 0:g.conversationInfo)==null?void 0:d.name)!=e.name&&(N.value[e.tuid].conversationInfo.name=e.name,t.updateConversationDataInDb(e.tuid,{name:e.name}));const w=await window.MessageDbHelper.queryFirstPeopleDetail(e.tuid);w.success&&((s=w==null?void 0:w.data)==null?void 0:s.name)!=e.name&&await window.MessageDbHelper.updatePeopleNameInGroup(e.tuid,e.name)}const c=await window.MessageDbHelper.queryPeopleInDeletedGroupMember(e.tuid);c.success&&c.data.length>0&&c.data.some(S=>S.name!==e.name)&&(await window.MessageDbHelper.updatePeopleNameInDeletedGroupMember(e.tuid,e.name),await f.initDeletedGroupMemberList(f.getChatTargetId())),await window.MessageDbHelper.updatePeopleNameInMsgContact(e.tuid,e.name),Bt.value&&Bt.value.updateSearchResult(e)}},Ji);async function tt(e){return new Promise(async g=>{if(e||g(!1),A.value[e])t.setChatTargetId(String(e)),await pt.push({path:"/message/conversation",query:{id:String(e),chatType:ge.SINGLE,t:new Date().getTime()}});else{let d=await window.RendererHelper.getUsersByTuids(String(e));if(d&&d.length){const s=await t.getLastMessage(String(e)),c=s.success&&s.data?s.data.msg:"";await t.gatherConversation(String(e),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:d[0].name,pic:[d[0].pic],chatType:ge.SINGLE,puid:String(d[0].puid),msg:c}}),t.setChatTargetId(String(e)),await pt.push({path:"/message/conversation",query:{id:String(e),chatType:ge.SINGLE,t:new Date().getTime()}}),Ps({msgId:String(e),puid:t.puid,type:Pt.SINGLE,status:1})}}mt(()=>{var d;(d=document.getElementById(e))==null||d.scrollIntoView(),g(!0)})})}window.RendererHelper.on("SEND_NOTICE_OR_MESSAGE",async e=>{if(e.type=="notice")window.open(`https://notice.chaoxing.com/pc/notice/richtextNotice?sourceType=1000&isRtf=1&param_send=${e.param_send||""}`);else if(e.type=="message"){if(A.value[e.tuid])t.setChatTargetId(String(e.tuid)),pt.push({path:"/message/conversation",query:{id:String(e.tuid),chatType:ge.SINGLE,t:new Date().getTime()}});else{let g=await window.RendererHelper.getUsersByTuids(String(e.tuid));if(g&&g.length){const d=await t.getLastMessage(String(e.tuid)),s=d.success&&d.data?d.data.msg:"";await t.gatherConversation(String(e.tuid),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:g[0].name,pic:[g[0].pic],chatType:ge.SINGLE,puid:String(g[0].puid),msg:s}}),t.setChatTargetId(String(e.tuid)),pt.push({path:"/message/conversation",query:{id:String(e.tuid),chatType:ge.SINGLE,t:new Date().getTime()}}),Ps({msgId:String(e.tuid),puid:t.puid,type:Pt.SINGLE,status:1})}}mt(()=>{var g;(g=document.getElementById(e.tuid))==null||g.scrollIntoView()})}else e.type=="forward"&&window.RendererHelper.openWindow("https://im.chaoxing.com/res/studyForward/index.html",{width:640,height:fo,frame:!1,modal:!0,resizable:!1,subWindow:!0,id:"studyForward"},{attachment:e.attachment})},qi),window.RendererHelper.on("openImChatPage",async e=>{if(e.groupId)if(A.value[e.groupId])t.setChatTargetId(String(e.groupId)),pt.push({path:"/message/conversation",query:{id:String(e.groupId),chatType:ge.GROUP,t:new Date().getTime()}}),Us(e.groupId),mt(()=>{ct(String(e.groupId))});else{const{groupName:g,groupImgs:d}=await Y(String(e.groupId),!0),s=await t.getLastMessage(String(e.groupId)),c=s.success&&s.data?s.data.msg:"";await t.gatherConversation(String(e.groupId),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:g,pic:d,chatType:ge.GROUP,puid:String(e.groupId),msg:c}}),t.setChatTargetId(String(e.groupId)),pt.push({path:"/message/conversation",query:{id:String(e.groupId),chatType:ge.GROUP,t:new Date().getTime()}}),Us(e.groupId),mt(()=>{ct(String(e.groupId))})}else if(e.personId)if(A.value[e.personId])t.setChatTargetId(String(e.personId)),await pt.push({path:"/message/conversation",query:{id:String(e.personId),chatType:ge.SINGLE,t:new Date().getTime()}}),Us(e.personId),mt(()=>{ct(String(e.personId))});else{let g=await window.RendererHelper.getUsersByTuids(String(e.personId));if(g&&g.length){const d=await t.getLastMessage(String(e.personId)),s=d.success&&d.data?d.data.msg:"";await t.gatherConversation(String(e.personId),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:g[0].name,pic:[g[0].pic],chatType:ge.SINGLE,puid:String(g[0].puid),msg:s}}),t.setChatTargetId(String(e.personId)),await pt.push({path:"/message/conversation",query:{id:String(e.personId),chatType:ge.SINGLE,t:new Date().getTime()}}),Us(e.personId),mt(()=>{ct(String(e.personId))})}}},Xi);async function ct(e){var g;(g=document.getElementById(e))==null||g.scrollIntoView(),await window.RendererHelper.gotoMessagePage(),await window.RendererHelper.focusWebPage()}window.RendererHelper.on("openContactsPage",()=>{console.log("打开通讯录"),t.setChatTargetId(-1),pt.push({path:"/message/contacts"})},$i),window.RendererHelper.on("_sendImMessage",e=>{console.log("第三方调用发送消息",e),Q?t.outerSendMessage(e):U.push(e)},zi),window.RendererHelper.on("_saveImMessage",e=>{console.log("第三方调用插入消息",e),e.id||(e.id=bo.utils.getUniqueId()),e.time||(e.time=Date.now()),e.onlineState=1,t.createNewMessage(e)},Yi);const $e=(e,g,d=300)=>{const s=setTimeout(()=>{clearTimeout(s),O.trigger(e,g)},d)},ht=async e=>{var s,c,w,S,k,C,de,we,Ae,se,me,We,st;const g=(w=(c=(s=t.getSelfUserInfoDetail)==null?void 0:s.unitConfigInfos)==null?void 0:c.map(Le=>Le.fid))==null?void 0:w.join(","),d=await mi(e,g);if((d==null?void 0:d.result)==1){const Le=(k=(S=d.data)==null?void 0:S.list)==null?void 0:k.find(nt=>nt.type==6),yt=(de=(C=d.data)==null?void 0:C.list)==null?void 0:de.find(nt=>nt.type==17),ve=(Ae=(we=d.data)==null?void 0:we.list)==null?void 0:Ae.find(nt=>nt.type==9),Ce=(me=(se=d.data)==null?void 0:se.list)==null?void 0:me.find(nt=>nt.type==10&&nt.id==23),ft=(st=(We=d.data)==null?void 0:We.list)==null?void 0:st.filter(nt=>nt.type==10&&nt.id!=23),it=t.getCurrentChatId;if(Le&&(t.setReplyMeTime((Le==null?void 0:Le.updateTime)||0),it==-3&&Le.noRead>0?(t.setReplyMeCount(0),pt.push({path:"/message/reply",query:{t:new Date().getTime(),id:z.REPLY}})):t.setReplyMeCount(Le.noRead)),yt&&(t.setGroupInviteTime((yt==null?void 0:yt.updateTime)||0),it==-4&&yt.noRead>0?(t.setGroupInviteCount(0),pt.push({path:"/message/group",query:{t:new Date().getTime(),id:z.GROUP}})):t.setGroupInviteCount(yt.noRead)),ve&&(t.setVerifyMsgTime((ve==null?void 0:ve.updateTime)||0),it==-5&&ve.noRead>0?(t.setVerifyMsgCount(0),pt.push({path:"/message/verify",query:{t:new Date().getTime(),id:z.VERIFY}})):t.setVerifyMsgCount(ve.noRead)),Ce&&(t.setCxOfficialStatus(!0),t.setCxOfficialTitle(Ce.subtitle),t.setCxOfficialLogo(Ce.logo),t.setCxofficialMsgTime((Ce==null?void 0:Ce.updateTime)||0),t.setCxOfficialUrl(Ce==null?void 0:Ce.messageListUrl),it==-6&&Ce.noRead>0?(t.setCxofficialMsgCount(0),pt.push({path:"/message/cxofficial",query:{t:new Date().getTime(),id:z.CXOFFICIAL}})):t.setCxofficialMsgCount(Ce.noRead)),ft!=null&&ft.length){const nt=[];ft.forEach(ut=>{const wt=t.getSubscribesConversations.find(as=>as.conversationKey==ut.id)||{};nt.push({conversationKey:ut.id,isChecked:(wt==null?void 0:wt.isChecked)||!1,isTop:(wt==null?void 0:wt.isTop)||0,latestSendTime:ut.updateTime,subtitle:ut.subtitle,topTime:(wt==null?void 0:wt.topTime)||0,unreadMessageNum:ut.noRead,logo:ut.logo,name:ut.name,type:ut.type,messageListUrl:ut.messageListUrl})}),t.setSubscribesConversations(nt)}}else console.log("获取系统消息失败")},us=async e=>{var g,d,s;try{const c=await window.MessageDbHelper.queryAllMsgFolders();c.success&&t.initMsgFolderConversation({folderList:c.folders,conversations:c.conversation});const w=await Ii(e);if(w.result==1){await window.MessageDbHelper.insertMsgFolders(((g=w==null?void 0:w.data)==null?void 0:g.list)||[]);let S=[];(s=(d=w==null?void 0:w.data)==null?void 0:d.list)==null||s.forEach(C=>{S=S.concat(C.mlist||[])}),await window.MessageDbHelper.insertFolderConversation(S);const k=await window.MessageDbHelper.queryAllMsgFolders();k.success&&t.initMsgFolderConversation({folderList:k.folders,conversations:k.conversation})}}catch(c){console.log("getMsgFolders",c)}},Kt=async e=>{const g=await vi(e);g.result==1&&t.initFanList(g.data.list)},ys=async()=>{var g,d,s,c;const e=await hi();e.result==1&&(console.log("新建群聊权限",!((d=(g=e.data)==null?void 0:g.appconfig)!=null&&d.noNewChatGroup)),f.setCreateNewChatGroup(!((c=(s=e.data)==null?void 0:s.appconfig)!=null&&c.noNewChatGroup)))},ee=e=>{let s={baseUrl:"https://notice.chaoxing.com",url:"/apis/notice/getNoReadCount",getParams:{puid:e},postParams:{},tokenSign:!0};window.MainWindowHelper.genRequest(s).then(c=>{(c==null?void 0:c.result)==1&&c.data>0&&(t.setInboxUnreadCount(c.data),window.MainWindowHelper.syncAllNotice(),t.inboxReceivingTime=Date.now(),ne())})};function ne(){X&&_.value===!0&&(window.RendererHelper.flashTray(!0,Si),t.isTrayFlashing=!0)}const be=async e=>{//!* 注释掉，被拉进群没发消息不需要显示在会话列表
t.changeConnectType(!0),ie.value=ie.value.filter(g=>g!==e.id)},Fe=async(e,g)=>{let d={},s=[];d=(e==null?void 0:e.groupDetail)||{},s=j.orderBy((e==null?void 0:e.allMembers)||[],[S=>S.owner?-1:1,S=>S.admin?-1:1,S=>String(S.uid)]);let c=[],w="";if(!(d!=null&&d.description))c=s.slice(0,4).map(S=>S.pic),w=d.name?d.name:s.slice(0,4).map(S=>S.name).join("、");else{let S=JSON.parse(d.description),k={};Object.keys(ue).includes(String(S.groupType))?(k=ue[S.groupType](d,s),c=k.groupImgs,w=d.name?d.name:k.groupName):(k=T(s,d),c=k.groupImgs,w=d.name?d.name:k.groupName)}await t.gatherConversation(g,{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:w,pic:c,chatType:ge.GROUP}})},ye=async e=>{var g;if(t.changeConnectType(!0),A.value[e.id]&&!ie.value.includes(e.id)){const d=t.getCurrentChatId,s=await f.groupMemberChange(e.id,e.from,e.type,String(d));s&&((g=s.groupDetail)!=null&&g.id)&&!q(s==null?void 0:s.groupDetail)&&await Fe(s,e.id)}},q=e=>{if(e!=null&&e.description){let g=xe.isJSONString(e==null?void 0:e.description)?JSON.parse(e.description):{};return(g==null?void 0:g.groupType)==qe.CLASS?!0:(g==null?void 0:g.groupType)==qe.COURSE}else return!1},Be=async e=>{t.changeConnectType(!0),A.value[e.gid]&&!ie.value.includes(e.gid)&&await f.updateGroupMember(e.gid,e.to,{mute:!1,admin:1},String(t.getCurrentChatId))},ke=async e=>{t.changeConnectType(!0),A.value[e.gid]&&!ie.value.includes(e.gid)&&await f.updateGroupMember(e.gid,e.to,{admin:0},String(t.getCurrentChatId))},je=async e=>{if(t.changeConnectType(!0),A.value[e.id]&&!ie.value.includes(e.id)){const g=t.getCurrentChatId;e.detail.name?(await t.gatherConversation(e.id,{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:e.detail.name,chatType:ge.GROUP,time:e.detail.lastModified}}),await f.updateGroupDetail(e.id,e.detail,String(g))):await f.updateGroupDetail(e.id,e.detail,String(g));const d=Is(e==null?void 0:e.detail);N.value[e.id].isSilent=d,await t.updateConversationDataInDb(e.id,{isSilent:d?1:0})}},Tt=async e=>{try{t.changeConnectType(!0),ie.value.push(e.id),console.log(y.value,e.id),y.value==e.id&&(t.setChatTargetId(0),pt.push({path:"/message/msgcover"})),await t.destroyGroup(e.id)}catch(g){console.log("destroyGroup",g)}},ds=async e=>{Object.keys(ae).includes(e.action)&&ae[e.action](e),window.ImHelper.sendToMainIfNeed(e)},ws=async e=>{console.log("单聊收到整个会话回执，time:",e==null?void 0:e.time,"--from:",e==null?void 0:e.from,"--type:",e==null?void 0:e.type),await t.updateSingleMessageChannelStatus(e.from,e.time)},et=async e=>{console.log("单聊收到单条消息已读回执，mid:",e==null?void 0:e.mid,"--from:",e==null?void 0:e.from,"--type:",e==null?void 0:e.type),(await window.MessageDbHelper.queryOneMessageById(e.mid)).success&&(await t.updateSingleMessageStatus(e.from,e.mid),t.deleteLocalMsgAck(e==null?void 0:e.mid,Ls.SINGLE_READ_ACK));const s=(t.messageList[e.from]??[]).find(c=>c.id===e.mid);s&&s.sendType!=="success"&&(s.sendType="success",window.MessageDbHelper.updateMessageSendType(s.id,"success"))},rt=async e=>{t.changeConnectType(!0);const g=Zt(e);ie.value.includes(g)||await t.updateMessageGroupAnnounce(e,g)};let Xe={};const Ee=async e=>{var g,d,s;t.changeConnectType(!0),console.log("群聊收到单条消息已读回执，mid:",(g=e==null?void 0:e.ext)==null?void 0:g.msgId,"--from:",(d=e==null?void 0:e.ext)==null?void 0:d.fromUid,"--groupid:",(s=e==null?void 0:e.ext)==null?void 0:s.groupId),A.value[e.ext.groupId]&&!ie.value.includes(e.ext.groupId)&&((await window.MessageDbHelper.queryOneMessageById(e.ext.msgId)).success?await t.updateMessageStatus(e.ext.groupId,!1,e.ext.msgId,{fromPuid:e.ext.fromPuid,fromUid:e.ext.fromUid,time:e.ext.time}):Xe!=null&&Xe[e.ext.msgId]&&(Xe==null?void 0:Xe[e.ext.msgId])>=3?await t.updateMessageStatus(e.ext.groupId,!1,e.ext.msgId,{fromPuid:e.ext.fromPuid,fromUid:e.ext.fromUid,time:e.ext.time}):(Xe[e.ext.msgId]=Xe!=null&&Xe[e.ext.msgId]?Xe[e.ext.msgId]+1:1,console.log(e.ext.msgId,"群聊收到单条消息已读回执重试次数",Xe==null?void 0:Xe[e.ext.msgId]),$e(Ee,e,500)))},xs=async e=>{if(t.changeConnectType(!0),A.value[e.to]&&!ie.value.includes(e.to)){const{ext:g,from:d,time:s,to:c}=e,{showRead:w}=g??{};let S=bi(w);t.createNewTips({msg:S,from:d,timeStamp:s,chatType:ge.GROUP,to:c,ext:g})}},Cs=e=>e!=null&&e.description?JSON.parse(e.description).groupType==qe.COURSE:!1,Ns=async e=>{var d,s,c,w;let g=j.cloneDeep(e);if(g.type===jt.TEXT){if((d=g==null?void 0:g.ext)!=null&&d.attachment&&(typeof((s=g==null?void 0:g.ext)==null?void 0:s.attachment)=="string"&&(g.ext.attachment=JSON.parse(g.ext.attachment)),(c=g.ext.attachment)!=null&&c.att_video)){const{objectId2:S,fileLength:k}=(w=g.ext.attachment)==null?void 0:w.att_video;k||await li(S)}}else if(g.type===jt.IMAGE&&(!(g!=null&&g.width)||!(g!=null&&g.height))){const{width:S,height:k}=await xe.getImgInfo(g.url);g.width=S,g.height=k}return g},gs=R(),ks=async e=>{var Ce,ft,it,nt,ut,wt,as;if(!e.length)return;let g=Date.now();t.changeConnectType(!0);const d=e[e.length-1],s=Zt(d);let{isCare:c,isRemind:w,isReply:S,isNewNotice:k,atMsgCounter:C}=t.conversationListData[s]||{};for(const Ie of e){if(Ie.type==jt.AUDIO)if(Ie.length)Ie.duration=Ie.length;else{const bt=await fetch(Ie.url),is=new xo;await is.initWithUrl(bt.url),Ie.duration=is.getDuration()}(Ce=Ie.ext)!=null&&Ce.sendOnlineFile2&&Ie.from!==String(t.loginId)&&pn(Ie),s==z.CXAI&&(Ie.msg=((ut=(nt=(it=(ft=Ie.ext)==null?void 0:ft.cxai)==null?void 0:it.choices[0])==null?void 0:nt.message)==null?void 0:ut.content)||""),Ie.isread=Ie.from==t.loginId?1:0,Ie.isplay=0,c=c||Qa(t.getFanList,Ie.from),w=w||ko(Ie.ext,t.loginId,Ie.from),S=S||Va(Ie.ext,t.loginId),k=k||_s(Ie.ext,Ie.from,t.loginId),C=ko(Ie.ext,t.loginId,Ie.from)?(C||0)+1:C||0}s==z.CXAI&&await t.updateAllMessageRead(s);let de=[],we={};if(A.value[s])if((d==null?void 0:d.chatType)==ge.SINGLE)de=e.map(Ie=>({...Ie,sendName:A.value[s].conversationInfo.name}));else{const Ie=await window.MessageDbHelper.queryGroupMembersUidName(s);Ie.success&&(we=Ie.rows),de=e.map(bt=>({...bt,sendName:we[bt.from]}))}else if((d==null?void 0:d.chatType)==ge.SINGLE){let Ie=await window.RendererHelper.getUsersByTuids(s);de=e.map(bt=>({...bt,name:Ie[0].name,pic:[Ie[0].pic],sendName:Ie[0].name,puid:String(Ie[0].puid)}))}else{const{groupName:Ie,groupImgs:bt,groupDetail:is}=await Y(s,!0),ps=await window.MessageDbHelper.queryGroupMembersUidName(s);ps.success&&(we=ps.rows);const ka=Is(is);de=e.map(Mo=>({...Mo,name:Ie,pic:bt,sendName:we[Mo.from],isSilent:ka}))}console.info("[handleBatchMsg]",s,Date.now()-g),await t.batchInsertMsg(s,de),console.info("[handleBatchMsg]",s,Date.now()-g);let Ae=[];const se=await window.MessageDbHelper.queryLastMessageNotInviteTip(s);if(se.success){let Ie=se.data;if((Ie==null?void 0:Ie.chatType)==ge.GROUP&&!(Ie!=null&&Ie.sendName)){const bt=await window.RendererHelper.getUsersByTuids(Ie.from);bt&&(Ie.sendName=(wt=bt[0])==null?void 0:wt.name)}Ae.push(Ie)}console.info("[handleBatchMsg]",s,Date.now()-g);const me=await Wa(Ae,t.conversationList,t.chatTargetId.toString(),!1,t.fanList,t.curChatIdInBackend),st=de.filter(Ie=>Ie.from!=t.loginId).filter(Ie=>K.value?Date.now()-Ie.time<=Ko:!0);let Le;const yt=de.findLast(Ie=>Ja(Ie));yt&&(Le=qa(yt));const ve=Math.max(0,st.length-1);console.log(`unreadNumber: ${ve}, conversation[listKey].unreadMessageNum is ${me[s].unreadMessageNum}`),me[s].unreadMessageNum=(as=me[s])!=null&&as.isSilent?0:ve?me[s].unreadMessageNum+ve:me[s].unreadMessageNum,me[s].realUnreadMessageNum=me[s].unreadMessageNum,me[s].isCare=c,me[s].isRemind=w,me[s].isReply=S,me[s].isNewNotice=k,me[s].atMsgCounter=C,Le&&(me[s].origin=Le),console.info("[handleBatchMsg]",s,Date.now()-g),me[s].unreadMessageNum>0&&s==t.chatTargetId&&await Qt()?(await t.updateConversationList(me,s,!0),await Us(s)):await t.updateConversationList(me,s,!1),console.info("[handleBatchMsg]",s,Date.now()-g)};async function Ft(e){let g;try{const d=await window.RendererHelper.getUsersByTuids(e,{timeout:8e3});if(Array.isArray(d)&&d.length>0){const s=d[0];return{name:s.name,pic:s.pic,puid:String(s.puid)}}}catch(d){console.log("call getUsersByTuids has error",d);try{const s=await window.ContactsDbHelper.queryLocalUsersByTuids(e);if(Array.isArray(s)){const c=s.find(w=>j.has(w,"name")&&j.has(w,"pic")&&j.has(w,"puid"));return c?g=j.pick(c,["name","pic","puid"]):console.error("Not found user data in localUserList",s),g}else console.error("localUserList is not array",s)}catch(s){console.error("call queryLocalUsersByTuids has error",s)}}return g}async function Qt(){try{const g=await window.MainWindowHelper.getTopTabId()===Bo,d=await window.RendererHelper.isWindowFocused(),s=i.path=="/message/conversation";return g&&d&&s}catch{return!1}}const Mt=async e=>{const g=y.value;return new Promise(async d=>{var w,S,k,C,de;t.changeConnectType(!0);const s=Zt(e),c=await Ns(e);if(ie.value.includes(s))d();else{if(c.chatType==ge.SINGLE){if(c.from==g&&(c==null?void 0:c.from)!=t.loginId&&(t.newMsgCounter++,console.log("非自己的新消息数量 ",t.newMsgCounter)),((w=c==null?void 0:c.ext)==null?void 0:w.action)=="invite"){Wn(c);return}if(A.value[s])await t.createNewMessage({...c,sendName:A.value[s].conversationInfo.name}),_.value&&c.onlineState==1&&x.value!="classroom"&&c.from!=b.value.loginId&&c.from!=g&&!X&&await m({...c,pic:A.value[s].conversationInfo.avatarUrl,conversationName:A.value[s].conversationInfo.name,sendName:A.value[s].conversationInfo.name});else{let Ae=await Ft(s);const se=(Ae==null?void 0:Ae.name)||c.from,me=Ae!=null&&Ae.pic?[Ae.pic]:[],We=Ae!=null&&Ae.puid?String(Ae.puid):"";await t.createNewMessage({...c,name:se,pic:me,sendName:se,puid:We}),_.value&&c.onlineState==1&&x.value!="classroom"&&c.from!=b.value.loginId&&c.from!=g&&!X&&await m({...c,pic:me,sendName:se,conversationName:se})}c.from!=t.loginId&&c.onlineState==1&&await t.updateAllMessageRead(c.from),await Qt()&&c.from==g&&t.getCurChatIdInBackend!=c.from&&(c.type!=jt.AUDIO&&c.from!=t.loginId&&await t.sendReadMessage(c.from,"read",c.id),await t.updateSelfReadStatus(c.from,!1,c.id),await t.sendCMDMessage({chatType:ge.SINGLE,to:String(b.value.loginId),action:"CMD_READ_ACK",ext:{conversationId:s,conversationType:c.chatType==ge.SINGLE?0:1,messageId:c.id,timestamp:String(c.time),unreadCount:1},from:String(b.value.loginId)})),Xa((c==null?void 0:c.ext)??{})&&dn(c),(S=c==null?void 0:c.ext)!=null&&S.sendOnlineFile2&&c.from!==String(t.loginId)&&pn(c)}else{if(c.to==g&&(c==null?void 0:c.from)!=t.loginId&&t.newMsgCounter++,A.value[s]){const Ae=await window.MessageDbHelper.queryPeopleDetail(c.to,c.from);let se="";if(Ae.success&&Ae.rows.length&&(se=Ae.rows[0].name),!se){const me=await window.MessageDbHelper.queryPeopleDetailInDeletedGroup(c.to,c.from);me.success&&me.rows.length&&(se=me.rows[0].name)}if(!se){const me=await Ft(c.from);me&&(se=me.name)}await t.createNewMessage({...c,sendName:se}),_.value&&c.onlineState==1&&x.value!="classroom"&&c.from!=b.value.loginId&&c.to!=g&&!X&&!A.value[s].isNoDisturb&&!A.value[s].isSilent&&await m({...c,pic:A.value[s].conversationInfo.avatarUrl,conversationName:A.value[s].conversationInfo.name,sendName:se})}else{const{groupName:Ae,groupImgs:se,groupDetail:me}=await Y(s,!0),We=await window.MessageDbHelper.queryPeopleDetail(c.to,c.from);let st="";if(We.success&&We.rows.length&&(st=We.rows[0].name),!st){const Le=await window.MessageDbHelper.queryPeopleDetailInDeletedGroup(c.to,c.from);Le.success&&Le.rows.length&&(st=Le.rows[0].name)}if(!st){const Le=await Ft(c.from);Le&&(st=Le==null?void 0:Le.name)}if(await t.createNewMessage({...c,name:Ae,pic:se,sendName:st,isSilent:Is(me)}),_.value&&c.onlineState==1&&x.value!="classroom"&&c.from!=b.value.loginId&&c.to!=g&&!X&&await m({...c,pic:se,sendName:st,conversationName:Ae}),Cs(me)){let Le=xe.removeSpaces(JSON.parse(me.description));const yt=(k=Le==null?void 0:Le.courseInfo)==null?void 0:k.courseid,ve=(C=Le==null?void 0:Le.courseInfo)==null?void 0:C.classid;try{const Ce=await $a(yt,ve,!0);N.value[s].conversationInfo.name=Ce==null?void 0:Ce.courseName,f.updateGroup(s,{name:Ce==null?void 0:Ce.courseName},String(t.getCurrentChatId)),t.updateConversationDataInDb(s,{name:Ce==null?void 0:Ce.courseName}),Ti.TEACHER.includes((Ce==null?void 0:Ce.teaRole)||(Ce==null?void 0:Ce.role))&&t.updateClazzName(s,(Ce==null?void 0:Ce.clazzName)||"")}catch{}}}await Qt()&&c.to==g&&(t.sendCMDMessage({chatType:ge.SINGLE,to:String(b.value.loginId),action:"CMD_READ_ACK",ext:{conversationId:s,conversationType:1,messageId:c.id,timestamp:String(c.time),unreadCount:1},from:String(b.value.loginId)}),_s(c.ext,c.from,t.loginId)&&f.changeCurrentGroupAnnounceVal())}_.value&&c.from!=b.value.loginId&&x.value!="classroom"&&(A.value[s]&&!A.value[s].isNoDisturb&&!A.value[s].isSilent||!A.value[s])&&(window.RendererHelper.flashFrame(!0),F.value&&_.value&&gs.value&&c.onlineState==1&&(gs.value.currentTime=0,(de=gs.value)==null||de.play())),mt(()=>{ui(e)&&e.onlineState===1&&e.from==t.loginId&&window.RendererHelper.setTempStore("onSendGroupChainMessage",e)}),d()}})},Is=e=>{var g;try{if(e.description){let d=JSON.parse(e.description);return!!(d.groupType==qe.INTERACTION&&((g=d.courseInfo)!=null&&g.coursename))}else return!1}catch{return!1}},_s=(e,g,d)=>{var s,c,w;return((s=e==null?void 0:e.attachment)==null?void 0:s.attachmentType)==25&&((w=(c=e==null?void 0:e.attachment)==null?void 0:c.att_web)==null?void 0:w.type)==1&&g!=d},m=async e=>{Notification.permission==="granted"?await B(e):Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&await B(e)},B=async e=>{const g=await Fn(e.pic),d=xe.base64toBlob(g),s=URL.createObjectURL(d),c=za(e,!0);new Notification(e.conversationName,{body:c,icon:s,tag:"soManyNotification",silent:!0})},T=(e,g)=>{console.log("[message/index.vue][getNormalNameAndImg] call");const d=j.orderBy(e,[w=>w.owner?-1:1,w=>w.admin?-1:1,w=>String(w.uid)]);let s=[];tr(g.description)?s=[at.GROUP]:s=d.slice(0,4).map(w=>w.pic);const c=g.name?g.name:d.slice(0,4).map(w=>w.name).join("、");return{groupImgs:s,groupName:c}},D=(e,g,d)=>{const s=j.orderBy(d,[k=>k.owner?-1:1,k=>k.admin?-1:1,k=>String(k.uid)]),c=[g],w=JSON.parse(e.description),S=e.name?e.name:w&&w.courseInfo&&w.courseInfo.coursename?w.courseInfo.coursename:s.slice(0,4).map(k=>k.name).join("、");return{groupImgs:c,groupName:S}},Y=async(e,g=!1)=>{let d={},s=[];if(g){const S=t.getCurrentChatId,k=await f.updateGroupInfo(e,b.value.loginId,String(S));d=k.groupDetail,s=k.allMembers}else{const S=t.getCurrentChatId,k=await f.initGroupInfo(e,b.value.loginId,String(S));d=k.groupDetail,s=k.allMembers}s=j.orderBy(s,[S=>S.owner?-1:1,S=>S.admin?-1:1,S=>String(S.uid)]),console.log("排序后的",s);let c=[],w="";if(!d.description)c=s.slice(0,4).map(S=>S.pic),w=d.name?d.name:s.slice(0,4).map(S=>S.name).join("、");else{let S=JSON.parse(d.description),k={};Object.keys(ue).includes(String(S.groupType))?(k=ue[S.groupType](d,s),c=k.groupImgs,w=d.name?d.name:k.groupName):(k=T(s,d),c=k.groupImgs,w=d.name?d.name:k.groupName)}return{groupName:w,groupImgs:c,groupDetail:d}},Se=async e=>{var w,S,k;t.changeConnectType(!0),console.log(">>>>>收到撤回",e);const{from:g,to:d,onlineState:s,ext:c}=e;if(t.loginId==g)await t.recallMessage({mid:(w=e==null?void 0:e.ext)==null?void 0:w.msgId,to:e==null?void 0:e.to,chatType:e==null?void 0:e.chatType,isPcRecall:!1,updateStore:s==1});else{const C=e.ext.msgId,de=d===((S=W.connection)==null?void 0:S.user)?g:d;(c==null?void 0:c.msgId_from)==t.loginId?(console.log(">>>>>收到他人撤回,自己",de),ie.value.includes(de)||await t.delOrRecallMessage({type:"otherRecall",key:de,mid:C,isPcRecall:!0,updateStore:s==1,message:e}),(k=t.messageList[de])!=null&&k.length||await t.getHistoryMessage(de),t.gatherConversation(de)):(console.log(">>>>>收到他人撤回,其他群员",de),ie.value.includes(de)||await t.delOrRecallMessage({type:"deleteMsg",key:de,mid:C,isPcRecall:!0,updateStore:s==1}))}},Ue=async()=>{var g,d,s;await window.MessageDbHelper.deleteSevenDaysAck();const e=await window.MessageDbHelper.queryMessageAck();e.success&&((g=e.rows)!=null&&g.length)&&(console.log("queryMessageAck",(s=(d=e.rows)==null?void 0:d.map(c=>`msgId is ${c.msgid}, time is ${c.time}, acktype is ${c.acktype}`))==null?void 0:s.join("; ")),t.setLocalMsgAck(e.rows),e.rows.forEach(c=>{c.acktype==Ls.CMD_READ_ACK?O.trigger(Ge,c.origindata):O.trigger(et,c.origindata)}))},Qe=e=>{var g,d;t.addLocalMsgAck({time:((g=e.ext)==null?void 0:g.timestamp)||Date.now(),msgid:(d=e.ext)==null?void 0:d.messageId,acktype:Ls.CMD_READ_ACK,origindata:e}),$e(Ge,e)},Ge=async e=>{const g=e.ext??{};console.log("更新红点,conversationId:",g.conversationId,"--messageId:",g==null?void 0:g.messageId,"--timestamp:",g==null?void 0:g.timestamp),t.changeConnectType(!0),ie.value.includes(g.conversationId)||await t.syncReadMsgCount(g)&&(await window.MessageDbHelper.queryOneMessageById(g.messageId)).success&&t.deleteLocalMsgAck(g.messageId,Ls.CMD_READ_ACK)},lt=async e=>{var s;const g=(s=e.ext)==null?void 0:s.data;if(!g)return;const d=Zt(e);if(!ie.value.includes(d)&&g.showConversationListUser.includes(String(t.loginId))){const{from:c,time:w,chatType:S,to:k,ext:C}=e;let de=g.listUser.map(Ae=>`${Ae.uid==t.loginId?"你":`<span class="hignLight" data-uid="${Ae.uid}">${Ae.name}</span>`}`);const we=g.showUserId?`${e.from==t.loginId?"你":'<span class="hignLight" data-uid="'+g.showUserId+'">'+g.showDefaultUserName+"</span>"}${g.action}“${de.join("、")}”${g.msg}`:`“${de.join("、")}”${g.msg}`;await t.createNewTips({msg:we,from:c,timeStamp:w,chatType:S,to:k,ext:C}),await t.gatherConversation(d,{updateStore:e.onlineState===1})}},Ht=async e=>{console.log("messageHint",e);const g=Zt(e);if(!ie.value.includes(g)){const{from:d,time:s,chatType:c,to:w,ext:S}=e;await t.createNewTips({msg:S.hint,from:d,timeStamp:s,chatType:c,to:w,ext:S}),await t.gatherConversation(g,{updateStore:e.onlineState===1})}},ze=async e=>{var s,c,w,S;t.changeConnectType(!0);const g=(s=e.ext)==null?void 0:s.data;if(!g)return;const d=Zt(e);if(!ie.value.includes(d)){const{from:k,time:C,chatType:de,to:we,ext:Ae}=e,se=yn(g.inviteExt),{messageIds:me=[]}=se,We=me.length;let st="";if((g==null?void 0:g.noGroupName)===1&&(g==null?void 0:g.showUserId)===String(t.loginId)){const it=(c=await ci(d))==null?void 0:c.uid;it!==void 0&&(g==null?void 0:g.showUserId)==it&&(st=`${l("message.setGroupNameLeft")}<span class="hignLight" data-name="${we}">${l("message.setName")}</span>${l("message.setGroupNameRight")}`)}let Le=g.listUser.map(it=>`<span class="hignLight" data-uid="${it.uid}">${it.name}</span>`),yt=g.showUserId?`${e.from==t.loginId?l("message.you"):'<span class="hignLight" data-uid="'+g.showUserId+'">'+g.showDefaultUserName+"</span>"}${l("message.invited")}“${Le.join("、")}”${l("message.joinGroup")}${st}`:`“${Le.join("、")}”${l("message.joinGroup")}`;const ve=g.listUser.find(it=>it.uid==t.loginId)!==void 0,Ce=se&&We>0;ve&&Ce&&await Ve({conversationKey:we,messageIds:me}),Ce&&(yt=yt+l("message.attachedChatRecordsTip",{count:We})),await t.createNewTips({msg:yt,from:k,timeStamp:C,chatType:de,to:we,ext:Ae});const ft=(w=await t.gatherConversation(d,{updateStore:e.onlineState===1}))==null?void 0:w[d];ft&&ft._needsQuery&&((S=js().connection)==null||S.getGroupInfo({groupId:d}).then(async it=>{var Ie,bt;const nt=_n.first(it.data),ut=yn(nt.description);let wt=di;if(nt.name)wt=nt.name;else if([qe.COURSE,qe.CLASS].includes(ut.groupType)&&ut.courseInfo&&ut.courseInfo.coursename)wt=ut.courseInfo.coursename;else try{wt=(await window.RendererHelper.getUsersByTuids((bt=(Ie=nt.affiliations)==null?void 0:Ie.slice(0,4))==null?void 0:bt.map(ps=>"member"in ps?ps.member:ps.owner).join(","))).map(ps=>ps.name).join("、")}catch(is){console.error("[queryUserInfo], error:",is)}let as=["default"];if(ut.groupType==qe.COURSE)as=[at.COURSE];else if(ut.groupType==qe.CLASS)as=[at.CLASS];else try{as=await f.genGroupAvatar(d)}catch(is){console.error("genGroupAvatar Error:",is)}t.updateConversationName(d,wt),t.updateConversationAvator(d,as)}).catch(it=>{console.error("getGroupInfo Error:",it)}).finally(()=>{ft._needsQuery=!1}))}},Ve=async e=>{console.log("Invitee joined the group, start query and insert attached message records!");const{conversationKey:g,messageIds:d=[]}=e;try{const s=await js().connection.getHistoryMessages({targetId:g,chatType:"groupChat",pageSize:50,searchDirection:"up",searchOptions:{msgTypes:xi}});let{messages:c=[]}=s??{};const w=new Set(d),S=[];c=_n.sortBy(c.filter(k=>w.has(k.id)?!0:(S.push(k.id),!1)),k=>_n.get(k,"time")),S.length!==0&&console.error(`[getAttachedChatRecords] unPullIds: ${S.join(", ")}`),await ks(c)}catch(s){console.error("getAttachedChatRecords Error:",s)}},Vt=async e=>{e.from!=t.loginId&&(await window.MainWindowHelper.meetOperate({sender:e.from,data:e.ext,msgTime:e.time}),await window.RendererHelper.sendToOtherWindow("CMD_MEET_RTC_STU_SCREEN","projectionBox",{sender:e.from,data:e.ext}),await window.RendererHelper.sendToOtherWindow("CMD_MEET_RTC_STU_SCREEN","stuShowBox",{sender:e.from,data:e.ext}),await window.RendererHelper.sendToOtherWindow("CMD_MEET_RTC_STU_SCREEN","id_RtcWindow",{sender:e.from,data:e.ext}))},Wt=e=>{window.RendererHelper.sendToMainProcess("_uploadClientLog",e.ext)},Rt=e=>{var g,d,s,c;if(e.from!=t.loginId&&(s=(d=(g=e.ext)==null?void 0:g.alertData)==null?void 0:d.alert)!=null&&s.msg){let w=(c=e.ext.alertData)==null?void 0:c.alert;window.RendererHelper.alert(w.msg,{title:w.title})}},Bs=async e=>{e.from!=t.loginId&&await window.RendererHelper.sendToOtherWindow("CMD_MEET_RTC_TEA_SCREEN","meetWindow",{sender:e.from,data:e.ext})},$t=async e=>{t.changeConnectType(!0);const{groupevent:g,mute:d}=e;if(!g||ie.value.includes(g.gid))return;const{gid:s,from:c}=g,w=new Date().getTime();t.createNewTips({msg:l(d?"message.enabledMutingFeature":"message.disabledMutingFeature"),from:c,timeStamp:w,chatType:ge.GROUP,to:s}),f.updateGroup(s,{mute:d,muteRole:c,muteTimeStamp:w},String(t.getCurrentChatId))},zt=async e=>{if(t.changeConnectType(!0),!e||ie.value.includes(e.gid))return;const g=t.getCurrentChatId;await f.updateGroupMemberOwner(e.gid,e.from,0,String(g)),await f.updateGroupMemberOwner(e.gid,e.to,1,String(g))},Js=async e=>{var k;t.changeConnectType(!0);const{groupevent:g,mute:d}=e;if(!g||ie.value.includes(g.gid))return;const{gid:s,from:c,to:w}=g,S=new Date().getTime();if(w==t.loginId){const C=f.groupsInfos.owner;console.log("owner",C),await t.createNewTips({msg:h.value=="en_US"?`you are ${d?"muted":"unmuted"} by the ${C==c?"owner":"admin"}`:`你被${C==c?"创建者":"管理员"}${d?"禁言":"解除禁言"}`,from:c,timeStamp:S,chatType:ge.GROUP,to:s}),d&&(i.path==="/message/conversation"&&s===t.getCurrentChatId?(k=r.value)==null||k.clearEditorContent(String(s)):t.updateDraft(s,"",Date.now()))}f.updateGroupMember(s,w,{mute:d,muteRole:c,muteTimeStamp:S},String(t.getCurrentChatId))},qs=R(null),Xs=R(),Fn=e=>new Promise((g,d)=>{const s=qs.value,c=8;s.beginPath(),s.moveTo(c,0),s.lineTo(Ye-c,0),s.quadraticCurveTo(Ye,0,Ye,c),s.lineTo(Ye,Ye-c),s.quadraticCurveTo(Ye,Ye,Ye-c,Ye),s.lineTo(c,Ye),s.quadraticCurveTo(0,Ye,0,Ye-c),s.lineTo(0,c),s.quadraticCurveTo(0,0,c,0),s.closePath(),s.clip();const S=e.map((k,C)=>({src:k==at.CLASS?o:k==at.COURSE?u:k,x:un(C,e.length).x,y:un(C,e.length).y,size:e.length>1?Ye/2:Ye})).map(k=>new Promise(C=>{const de=new Image;de.src=k.src,de.onload=()=>C({img:de,x:k.x,y:k.y,size:k.size})}));Promise.all(S).then(k=>{k.forEach(de=>{s.drawImage(de.img,de.x,de.y,de.size,de.size)});const C=Xs.value.toDataURL("image/png");g(C)})}),un=(e,g)=>{let d={x:0,y:0};switch(g){case 1:d.x=0,d.y=0;break;case 2:d.x=e%2*(Ye/2),d.y=e%2*(Ye/2);break;case 3:e==0?(d.x=Ye/4,d.y=0):e==1?(d.x=0,d.y=Ye/2):(d.x=Ye/2,d.y=Ye/2);break;case 4:d.x=e%2*(Ye/2),d.y=(e>=2?1:0)*(Ye/2);break}return d};window.RendererHelper.on("OPEN_AI_CHAT",()=>{Hn()},Zi);const Hn=async()=>{var e,g;if(t.getCurrentChatId==z.CXAI){(e=document.getElementById(z.CXAI))==null||e.scrollIntoView();return}if(!A.value[z.CXAI]){let d=await window.RendererHelper.getUsersByTuids(z.CXAI);d&&await t.gatherConversation(String(z.CXAI),{updateStore:!0,otherRecall:!1,isActive:!0,data:{name:d[0].name,pic:[d[0].pic],chatType:ge.SINGLE,puid:String(d[0].puid)}})}t.setChatTargetId(z.CXAI),pt.push({path:"/message/conversation",query:{id:z.CXAI,chatType:ge.SINGLE,t:new Date().getTime()}}),(g=document.getElementById(z.CXAI))==null||g.scrollIntoView()},Bt=R(null),Pn=()=>{var e;(e=Bt.value)==null||e.closeSearchVisible()},$s=async e=>{console.log("别人问询我",e),await t.handleCheckMsgRead(e)},Yt=async e=>{console.log("我问询别人，结果",e),await t.handleCheckMsgReadReply(e)},Jt=async e=>{console.log("updateGroupName",e);const g=Zt(e);if(!ie.value.includes(g)){const{from:d,time:s,chatType:c,to:w,ext:S}=e;let k=await window.RendererHelper.getUsersByTuids(String(S.data.uid));const C=S.data.tip.replace(new RegExp(S.data.uid,"g"),de=>{var we;return de===String(t.loginId)?l("message.you"):`<span class="hignLight" data-uid="${de}">${((we=k[0])==null?void 0:we.name)||""}</span>`});await t.createNewTips({msg:C,from:d,timeStamp:s,chatType:c,to:w,ext:S}),await t.gatherConversation(g,{updateStore:(e==null?void 0:e.onlineState)==1})}};async function On(){if(!t.getIsContactDbLoaded)try{window.MainWindowHelper.useMode("contactsDb"),(await window.ContactsDbHelper.loadContactsDb()).success?t.setIsContactDbLoaded(!0):console.error("加载联系人数据库失败")}catch(e){console.error("加载联系人数据库时发生错误:",tn(e))}}ls(async()=>{await window.RendererHelper.getTempStore("hasEnteredMessageMenu")!==!0&&(window.RendererHelper.readyPreviewImageWindow(),window.RendererHelper.setTempStore("hasEnteredMessageMenu",!0)),gn(),On().then(),qs.value=Xs.value.getContext("2d"),document.title=l("message.messages"),window.MainWindowHelper.loadDownloadList(),h.value=await window.MainWindowHelper.getLanguage(),window.RendererHelper.setBlockRefresh(!0),zs(),window.RendererHelper.onStoreDataChanged("openCheckMessages",async()=>{const g=Date.now()-Ni,d=await window.RendererHelper.getTempStore("inviteMemberToGroupKey"),s=await window.MessageDbHelper.queryChatHistory(d,g);window.RendererHelper.setTempStore("chatHistoryList",s),window.RendererHelper.openWindow("sview:/#/checkMessages",{subWindow:!0,frame:!1,modal:!0,width:640,height:600,id:"checkMessages"},{})}),window.RendererHelper.on("beforeLogout",()=>{At(String(t.loginId),0)},ji),window.RendererHelper.on("changeLoginSetting",g=>{g.nextLoginNoConfirm!==void 0&&At(String(t.loginId),1)},er),Jn()});function zs(){V=setInterval(()=>{const e=Date.now();t.recallCmdMap.forEach((g,d)=>{e-g.timestamp>Ya&&t.recallCmdMap.delete(d)}),t.unreadCountMap.forEach((g,d)=>{e-g.createTime>Za&&t.unreadCountMap.delete(d)})},ja)}Ha(()=>{V&&clearInterval(V),mn()});async function dn(e){t.changeConnectType(!0);const{to:g,from:d,onlineState:s}=e,c=await window.MainWindowHelper.getAppSystemConfig(),w=async()=>{window.RendererHelper.showWindow("mainWindow"),window.RendererHelper.focusWindow("mainWindow"),await window.RendererHelper.invokeToMainProcess("_showTabAsync",{id:"tab_message"}),window.MainWindowHelper.selectSubTab("tab_message_sub"),t.chatTargetId==d?window.RendererHelper.shakeMainWindow({type:"receive",uid:e.from}).then():(await tt(d),window.RendererHelper.shakeMainWindow({type:"receive",uid:e.from}).then())};s==1&&c.windowShakeNotification&&w().then()}function gn(){const s=document.querySelector(".chat_aside_box");let c;function w(S){if(s){const k=S.x-c;c=S.pageX;let C=parseInt(getComputedStyle(s,"").width)+k;C<200&&(C=200),C>400&&(C=400),s.style.width=C+"px"}}s==null||s.addEventListener("mousedown",S=>{s.offsetWidth-S.offsetX<=4&&(c=S.x,ce.value=!0,document.addEventListener("mousemove",w,!1))},!1),document.addEventListener("mouseup",()=>{ce.value=!1,document.removeEventListener("mousemove",w,!1)},!1)}function Gn(){console.log("[message/index.vue] 用户退出登录，托盘图标闪烁关闭"),window.RendererHelper.flashTray(!1),t.isTrayFlashing=!1,window.RendererHelper.setBadgeCount(0),window.RendererHelper.flashFrame(!1),window.RendererHelper.appLoginOut(),window.RendererHelper.sendToOuterWindow("updateMessageNum",0)}async function fn(e){var d;const g=await window.MainWindowHelper.getPcDeviceInfo();((d=e.ext)==null?void 0:d.deviceId)===g.deviceId&&window.RendererHelper.sendToMainProcess("checkMutiTerminal")}async function Ys(e){return At(String(t.loginId),1)}async function Kn(e){const{nextLoginNoConfirm:g}=e.ext??{},d=t.puid,s=await window.RendererHelper.getAccount(d),c=(s==null?void 0:s.nextLoginToConfirm)??!1;g!=null&&g!==c&&(g===!1&&window.RendererHelper.setAutoLogin(!1),window.RendererHelper.setAccount(d,"nextLoginToConfirm",g),window.RendererHelper.sendToView("refreshLoginSetting","tab_setting",{nextLoginNoConfirm:g}))}function pn(e){const{from:g}=e;window.OnlineFileHelper.handleOnlineFileMessage(e);const d=window.OnlineFileHelper.getTransferStatistics(g);v.updateTask(g,d),v.bindOnlineFileEvents(g)}function Qn(e){const g=window.OnlineFileHelper.getFileSavePath(e.ext.onlineFileInfo.id),d=Date.now(),s={from:e.from,to:e.to,chatType:ge.SINGLE,type:"txt",msg:e.ext.onlineFileInfo.name,ext:{onlineFileInfo:e.ext.onlineFileInfo,onlineFileTransferSuccess:!0,savePath:g},id:`-1${d}`,time:d};return t.createNewMessage(s)}function fs(e){const{name:g,size:d}=e.ext.onlineFileInfo??{},s={from:e.from,to:e.to,chatType:ge.SINGLE,type:"txt",msg:l("transferFile.sendFailedTipMessage",{fileName:g,fileSize:d}),ext:{onlineFileInfo:e.ext.onlineFileInfo,onlineFileTransferFailed:!0},id:e.id,time:e.time};return t.createNewMessage(s)}window.addEventListener("beforeunload",Vn);function Vn(){t.subscribesUrl!==""&&window.RendererHelper.setTempStore("message_subscribesUrl",t.subscribesUrl)}function Wn(e){window.RendererHelper.sendToMainProcess("audioCallInvite",e)}function Jn(){window.RendererHelper.on("robotMessage",async e=>{var we,Ae;console.log("robotMessage",tn(e));const{type:g,tempMessageId:d,from:s,to:c,chatType:w,data:S,replyInfo:k}=e;switch(g){case"streamData":{if(ei(S)){const se=C("",{robotStreamStatus:qt.LOADING});await t.createNewMessage(se)}else if(ti(S)){const se=C(jn,{robotStreamStatus:qt.FINISHED});await t.createNewMessage(se)}else if(si(S)){const se=C(jn,{robotStreamStatus:qt.FINISHED});await t.createNewMessage(se)}else if(ni(S)){const{answer:se}=S,me=(we=t.messageList[c])==null?void 0:we.find(We=>We.id===d);if(me)if(me.ext.robotStreamStatus===qt.LOADING&&(me.ext.robotStreamStatus=qt.STREAMING,de(me)),oi(se)){const{flag:We,responseText:st}=yn(se);We!=="stop"?st&&(me.msg+=st):me.ext.robotStreamStatus===qt.STREAMING&&(me.ext.robotStreamStatus=qt.FINISHED)}else se&&typeof se=="string"&&(me.msg=se);else if(se&&typeof se=="string"){const We=C(se,{robotStreamStatus:qt.FINISHED});await t.createNewMessage(We)}}else if(ai(S)){const se=C(S.msg,{robotStreamStatus:qt.FINISHED});await t.createNewMessage(se)}else if(ii(S)){const se=C("",{robotStreamStatus:qt.LOADING});await t.createNewMessage(se)}break}case"streamEnd":{const se=(Ae=t.messageList[c])==null?void 0:Ae.find(me=>me.id===d);se&&se.ext.robotStreamStatus===qt.FINISHED&&de(se);break}}function C(se,me){const st={...{replyInfo:k,tempMessageId:d,robotMessageInfo:S},...me};return{msg:se,from:s,to:c,onlineState:1,chatType:w,type:"txt",id:d,ext:st,time:Date.now()}}function de(se){window.MessageDbHelper.updateMessage(se.id,{msg:se.msg,msgbody:JSON.stringify(se)})}},"robotMessage")}function mn(){window.RendererHelper.off("robotMessage","robotMessage")}return(e,g)=>{const d=mr,s=Pa("router-view"),c=vr,w=pr;return I(),E(Ke,null,[p("div",{onContextmenu:g[0]||(g[0]=rs(()=>{},["prevent"])),class:"chat"},[Te(w,{class:"chat_container"},{default:He(()=>[Te(d,{class:H(["chat_aside_box",{"is-resize":ce.value}]),style:dt({paddingTop:n(G)?"0":"15px"}),width:"284px"},{default:He(()=>[Te(Pd,{ref_key:"searchInputRef",ref:Bt,width:"100%"},null,512),Ct(p("div",Cf,[Te(hf)],512),[[xt,!n(G)]]),n(G)?(I(),Me(Qr,{key:0})):re("",!0)]),_:1},8,["class","style"]),Te(c,{class:"chat_main_box",onClick:Pn},{default:He(()=>[Te(s,null,{default:He(({Component:S})=>[(I(),Me(Oa(S),{ref_key:"childRef",ref:r},null,512))]),_:1})]),_:1})]),_:1})],32),p("canvas",{ref_key:"canvas",ref:Xs,class:"my_canvas",width:Ye,height:Ye},null,512),p("audio",{controls:"",ref_key:"audioRef",ref:gs,style:{display:"none"}},_f,512),Te(gi)],64)}}});const kp=It(Af,[["__scopeId","data-v-3deb419b"]]);export{kp as default};
