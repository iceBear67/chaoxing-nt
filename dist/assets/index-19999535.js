import"./base-82955267.js";/* empty css                     */import{a as z,u as G,s as N,r as h,C as q,o as F,b as o,e as c,f as e,h as r,m as j,I as J,y as b,n as D,l as a,F as y,g as O,p as d,J as p,N as K,q as Q}from"./index-26603ea5.js";import{M as X}from"./message-4d42f580.js";import{u as k}from"./index-46519fef.js";import{c as L,T as S}from"./index-b0b4f58c.js";import{M as Y}from"./index-ab028c07.js";import{M as Z}from"./index-403401b5.js";import{i as ss}from"./type-6514e97f.js";import{E as es}from"./index-853a0f6e.js";import"./_commonjsHelpers-de833af9.js";import"./lodash-4dfbea43.js";import"./message-fe5b63d1.js";import"./validate-f7672251.js";import"./index-94663b0f.js";import"./forward-bb18e89e.js";import"./index-9c66cebd.js";import"./el-input-983a785f.js";import"./index-952b158c.js";import"./icon-803f5cc0.js";import"./typescript-defaf979.js";import"./index-15f48857.js";import"./_baseGet-ad9634b7.js";import"./event-9519ab40.js";import"./use-form-common-props-325f2441.js";import"./index-08289d2b.js";import"./constants-84857360.js";import"./index-12f9ba11.js";import"./aria-60e0cdc6.js";import"./index-e5f0a9f0.js";import"./el-popper-548470bb.js";import"./index-57013d5d.js";import"./createAttachment-a64a5f42.js";import"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";/* empty css                                                              */function ts($,n,v){let g="";try{g=n?encodeURIComponent(n):""}catch(_){console.error("URL编码失败:",_),g=n||""}let f=`https://learn.chaoxing.com/im/addcg?cgid=${$}&cgname=${g}`;if(v&&v.length>0)try{const _=JSON.stringify(v),x=encodeURIComponent(_);f+=`&logo=${x}`}catch(_){console.error("Logo编码失败:",_)}return f}const os=["onContextmenu"],as={class:"group_header"},ns={class:"type"},cs={class:"group_content"},rs=["onClick"],is=["src"],ds={class:"item_content"},ls={key:0,class:"item_flag"},_s={class:"name"},us={key:0,class:"dot"},ps={class:"time"},gs={key:1,class:"invite_info"},ms=["onClick"],hs={key:2,class:"invite_info"},vs=["onClick"],fs={key:1},ys={class:"item_btn"},ks={key:0,class:"waiting"},ws=["onClick"],Cs=["onClick"],bs={key:1,class:"reject common_btn"},xs={key:2,class:"agree common_btn"},Ms={class:"item_content"},Rs={key:0,class:"item_flag"},Ss={class:"name"},$s={key:0,class:"dot"},Us={class:"time"},Is={key:1,class:"invite_info"},Vs={class:"group_name"},Ls={key:2,class:"invite_info"},Ps={class:"group_name"},Bs={class:"item_btn"},Hs={key:0,class:"waiting"},Ts=["onClick"],As=["onClick"],Ws={key:1,class:"reject common_btn"},Es={key:2,class:"agree common_btn"},zs={key:2,class:"item_content"},Gs={class:"name"},Ns={key:0,class:"dot"},qs={class:"time"},Fs={class:"invite_desc"},js={class:"item_content"},Js={key:0,class:"item_flag",style:{"background-color":"#ffaf40"}},Ds={class:"name"},Os={key:0,class:"dot"},Ks={class:"time"},Qs={key:1,class:"invite_info"},Xs={key:2,class:"invite_info"},Ys={class:"item_btn"},Zs={key:0,class:"waiting"},se=["onClick"],ee=["onClick"],te={key:1,class:"reject common_btn"},oe={key:2,class:"agree common_btn"},ae={key:0,class:"empty"},ne=z({__name:"index",setup($){const{t:n}=G(),v=K(),g=X(),{getUserInfo:f}=N(g),_=h([]),x=h(10),w=h(1),M=h(!1),C=h(!1),U=h();q(()=>v.query,t=>{t&&(t!=null&&t.t)&&R()}),F(()=>{R()});const R=()=>{M.value=!1,C.value=!1,w.value=1,_.value=[],V()},P=t=>{t.preventDefault(),document.body.click();const i=[];i.push([{name:n("message.refresh"),handler:()=>{u(),R()}}]);const{destroy:u}=L(Z,{menuList:i,left:t==null?void 0:t.x,top:t==null?void 0:t.y});k.windowClickOnce(u)},I=t=>{if(t.gid){const i=ts(t.gid,t.gname,t.logos);window.open(i)}},B=()=>{const{destroy:t}=L(Y,{title:n("message.reminder"),content:n("message.allVerificationMessagesCleared"),cancelBtn:{text:n("message.cancel"),callback(){t()}},confirmBtn:{text:n("message.clear"),callback(){A(),t()}}})},H=async t=>{const i=await window.RendererHelper.getMousePointInWindow(),u=await window.RendererHelper.getMousePointInScreen(),{width:s,height:l}=await window.RendererHelper.getScreenWorkArea(),W=u.x+340>s?i.x-340:i.x,E=u.y+200>l?i.y-200:i.y;window.RendererHelper.openWindow("sview:/#/personalCard",{width:340,height:200,resizable:!1,marginLeft:W,marginTop:E,subWindow:!0,frame:!1,id:"id_PersonInfoWindow"},{myPuid:g.getUserInfo.puid,puid:t.sender})},T=()=>{!C.value&&!M.value&&D(()=>{const t=U.value;t.wrapRef.scrollHeight-t.wrapRef.scrollTop-t.wrapRef.clientHeight<=100&&(w.value++,V())})},A=()=>{let t={baseUrl:"https://learn.chaoxing.com",url:"/apis/user/delUserValidateMsgV2",getParams:{receive:f.value.puid,op:1,cataids:"3,4,5,6"},postParams:{},tokenSign:!0};window.MainWindowHelper.genRequest(t).then(i=>{i.result==1&&(_.value=[],S({content:n("message.successfulOperation"),zIndex:2024,duration:2e3}))})},m=(t,i)=>{console.log(`[verify] User clicked ${i===1?"AGREE":"REJECT"} button`),t.isread=1;let u={baseUrl:"https://learn.chaoxing.com",url:"/apis/user/updateValidateMsgStatus",getParams:{mid:t.id,status:i,vs:1},postParams:{},tokenSign:!0};window.MainWindowHelper.genRequest(u).then(s=>{s.result==1?(t.status=i,t.isread=1,S({content:s.msg,zIndex:2024,duration:2e3}),console.log(`[verify] success. status: ${i}`)):(S({content:(s==null?void 0:s.errorMsg)??n("message.operationFailed"),zIndex:2024,duration:2e3}),console.error(`[verify] failed. status: ${i}`))}).catch(()=>{console.error(`[verify] failed. status: ${i}`)})},V=()=>{C.value=!0;let t={baseUrl:"https://learn.chaoxing.com",url:"/apis/user/getUserValidateMsgs",getParams:{puid:f.value.puid,cataids:"3,4,5,6",status:"0,-1,1,2,-2,3,4",clearMsgByCataid:1,cpage:w.value,pageSize:x.value},postParams:{},tokenSign:!0};window.MainWindowHelper.genRequest(t).then(i=>{var u,s;if(ss(i)&&(_.value.push(...(u=i.data)==null?void 0:u.list),M.value=((s=i.data)==null?void 0:s.pageCount)<=w.value,_.value.length)){const l=_.value[0];g.setVerifyMsgTime(l==null?void 0:l.sendtime)}}).finally(()=>{C.value=!1})};return(t,i)=>{const u=es;return a(),o("div",{class:"group",onContextmenu:b(P,["stop"])},[c("div",as,[c("div",ns,e(r(n)("message.verificationinformatio")),1),c("div",{class:"clear_btn",onClick:B},e(r(n)("message.clear")),1)]),c("div",cs,[j(u,{ref_key:"ScrollbarRef",ref:U,onScroll:T},{default:J(()=>[(a(!0),o(y,null,O(_.value,s=>(a(),o("div",{key:s.id,class:"group_item"},[c("div",{class:"avator",onClick:b(l=>H(s),["stop"])},[c("img",{src:s.senderlogo,alt:""},null,8,is)],8,rs),s.cataid==4?(a(),o(y,{key:0},[c("div",ds,[s.status==0?(a(),o("div",ls,e(s.cataname),1)):d("",!0),c("div",_s,[p(e(s.sendername)+" ",1),s.isread?d("",!0):(a(),o("span",us))]),c("div",ps,e(r(k).timeago(s.sendtime,!0)),1),s.msgtype==1?(a(),o("div",gs,[p(e(r(n)("message.invitedGroupChat"))+": ",1),c("span",{class:"group_name",style:{cursor:"pointer"},onClick:b(l=>I(s),["stop"])},e(s.name),9,ms)])):d("",!0),s.msgtype==2?(a(),o("div",hs,[p(e(r(n)("message.applyJoinGroupChat")+(s.name?":":""))+" ",1),s.name?(a(),o(y,{key:0},[s.status==1?(a(),o("span",{key:0,style:{cursor:"pointer",color:"#3a8bff"},onClick:b(l=>I(s),["stop"])},e(s==null?void 0:s.name),9,vs)):(a(),o("span",fs,e(s==null?void 0:s.name),1))],64)):d("",!0)])):d("",!0)]),c("div",ys,[s.status==0?(a(),o("div",ks,[c("div",{class:"refuse_btn",onClick:l=>m(s,-1)},e(r(n)("message.refuse")),9,ws),c("div",{class:"agree_btn",onClick:l=>m(s,1)},e(r(n)("message.Agree")),9,Cs)])):(s.status==-1||s.status==-2)&&(s.msgtype==1||s.msgtype==2)?(a(),o("div",bs,e(r(n)("message.refused")),1)):(s.status==1||s.status==2||s.status==4)&&(s.msgtype==1||s.msgtype==2)?(a(),o("div",xs,e(r(n)("message.accepted")),1)):d("",!0)])],64)):d("",!0),s.cataid==3?(a(),o(y,{key:1},[c("div",Ms,[s.status==0?(a(),o("div",Rs,e(s.cataname),1)):d("",!0),c("div",Ss,[p(e(s.sendername)+" ",1),s.isread?d("",!0):(a(),o("span",$s))]),c("div",Us,e(r(k).timeago(s.sendtime,!0)),1),s.msgtype==1?(a(),o("div",Is,[p(e(r(n)("message.invitedCourse"))+": ",1),c("span",Vs,e(s.gname),1)])):d("",!0),s.msgtype==2?(a(),o("div",Ls,[p(e(r(n)("message.applyCourse"))+": ",1),c("span",Ps,e(s.gname),1)])):d("",!0)]),c("div",Bs,[s.status==0?(a(),o("div",Hs,[c("div",{class:"refuse_btn",onClick:l=>m(s,-1)},e(r(n)("message.refuse")),9,Ts),c("div",{class:"agree_btn",onClick:l=>m(s,1)},e(r(n)("message.Agree")),9,As)])):(s.status==-1||s.status==-2)&&(s.msgtype==1||s.msgtype==2)?(a(),o("div",Ws,e(r(n)("message.refused")),1)):(s.status==1||s.status==2||s.status==4)&&(s.msgtype==1||s.msgtype==2)?(a(),o("div",Es,e(r(n)("message.accepted")),1)):d("",!0)])],64)):d("",!0),s.cataid==5?(a(),o("div",zs,[c("div",Gs,[p(e(s.sendername)+" ",1),s.isread?d("",!0):(a(),o("span",Ns))]),c("div",qs,e(r(k).timeago(s.sendtime,!0)),1),c("div",Fs,e(s.msg),1)])):d("",!0),s.cataid==6?(a(),o(y,{key:3},[c("div",js,[s.status==0?(a(),o("div",Js,e(s.cataname),1)):d("",!0),c("div",Ds,[p(e(s.sendername)+" ",1),s.isread?d("",!0):(a(),o("span",Os))]),c("div",Ks,e(r(k).timeago(s.sendtime,!0)),1),s.msgtype==1?(a(),o("div",Qs,[p(e(r(n)("message.invitedUnit")),1),c("span",null,e(s.gname),1)])):d("",!0),s.msgtype==2?(a(),o("div",Xs,[p(e(r(n)("message.applyUnit")),1),c("span",null,e(s.gname),1)])):d("",!0)]),c("div",Ys,[s.status==0?(a(),o("div",Zs,[c("div",{class:"refuse_btn",onClick:l=>m(s,-1)},e(r(n)("message.refuse")),9,se),c("div",{class:"agree_btn",onClick:l=>m(s,1)},e(r(n)("message.Agree")),9,ee)])):(s.status==-1||s.status==-2)&&(s.msgtype==1||s.msgtype==2)?(a(),o("div",te,e(r(n)("message.refused")),1)):(s.status==1||s.status==2||s.status==4)&&(s.msgtype==1||s.msgtype==2)?(a(),o("div",oe,e(r(n)("message.accepted")),1)):d("",!0)])],64)):d("",!0)]))),128)),_.value.length?d("",!0):(a(),o("div",ae,e(r(n)("message.currentlyVerificationMessage")),1))]),_:1},512)])],40,os)}}});const Ge=Q(ne,[["__scopeId","data-v-30823894"]]);export{Ge as default};
