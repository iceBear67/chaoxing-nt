import{B as I}from"./index-94663b0f.js";import{a as b,b as W,e as u,j as c,h as p,f as k,l as D,q as ne,r as w,o as oe,n as re,m as ie,F as se}from"./index-26603ea5.js";import{T as le}from"./index-b0b4f58c.js";import"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";const ce=b({__name:"simpleBox",props:{title:String,endText:String},setup(f){const o=I("simpleBox");return(i,l)=>(D(),W("div",{class:c([p(o).b(),"simple-box"])},[u("div",{class:c([p(o).e("panel"),"panel"])},[u("span",{class:c(p(o).e("title"))},k(f.title),3),u("button",{class:c(p(o).e("end")),onClick:l[0]||(l[0]=h=>i.$emit("handlerEndClick"))},k(f.endText),3)],2)],2))}});const ae=ne(ce,[["__scopeId","data-v-b02ff876"]]);class de{constructor(){}static joinChannel(o,i){if(window.ProjectionRtcHelper&&window.ProjectionRtcHelper.joinChannel)return window.ProjectionRtcHelper.joinChannel({puid:o,channelCode:i})}static getScreenWindowsInfo(){if(window.ProjectionRtcHelper&&window.ProjectionRtcHelper.getScreenWindowsInfo)return window.ProjectionRtcHelper.getScreenWindowsInfo()}static startScreenShare(o,i){if(window.ProjectionRtcHelper&&window.ProjectionRtcHelper.startScreenShare)return window.ProjectionRtcHelper.startScreenShare(o,i)}static stopScreenShare(o){if(window.ProjectionRtcHelper&&window.ProjectionRtcHelper.stopScreenShare)return window.ProjectionRtcHelper.stopScreenShare(o)}static release(){if(window.ProjectionRtcHelper&&window.ProjectionRtcHelper.releaseSdk)return window.ProjectionRtcHelper.releaseSdk()}}const g=de,he=b({__name:"index",setup(f){const o=I("projectionPanel");window.RendererHelper.setAlwaysOnTop(!0);let i=!1,l="",h="",S="",m=!1,_=0,M=0,j=0,y=0;const P=w(!1),x=w(!0),C=w(!1),B=w(!1),L=e=>{var n;m=!0,_=e.clientX,M=e.clientY;const t=(n=document.querySelector("#projectionBox"))==null?void 0:n.getBoundingClientRect();t&&(j=t.left,y=t.top),e.preventDefault()},$=e=>{if(!m)return;const t=e.clientX-_,n=e.clientY-M,s=j+t,Q=y+n,Z=window.innerWidth,ee=window.innerHeight,r=document.querySelector("#projectionBox");if(!r)return;const te=r.offsetWidth,E=r.offsetHeight,H=Math.max(0,Math.min(s,Z-te)),v=Math.max(0,Math.min(Q,ee-E));console.log("height",E,window.innerHeight),r.style.left=`${H}px`,r.style.top=`${v}px`,r.style.right="auto",r.style.bottom="auto",P.value=v<1,x.value=v>window.innerHeight-r.clientHeight-1,C.value=H<1,B.value=H>window.innerWidth-r.clientWidth-1},V=()=>{m=!1},T=w(!1);oe(async()=>{let e=await window.RendererHelper.getInitDataAsync();console.log("initData:",e),l=e==null?void 0:e.channelCode,h=e==null?void 0:e.type;let t=await window.RendererHelper.getUser();if(t&&t.name,S=e.uid,l===""||h===""||S===""){window.RendererHelper.alert("连接失败，请切换网络后重试");return}N(),document.addEventListener("contextmenu",n=>{n.preventDefault()}),d(!0),await O(l),document.addEventListener("mousemove",$),document.addEventListener("mouseup",V)});let a;const q=e=>{a&&a();const{destroy:t}=le({content:e,zIndex:2099,duration:-1,center:!1,top:170});a=t},A=()=>{a&&a()},N=()=>{window.RendererHelper.on("CMD_MEET_RTC_STU_SCREEN",async e=>{if(!e||!e.data)return;let t=e.data;t.ignoreCmd!=1&&(t.type==="endProjection"||t.type==="unShowScreen")&&R()}),window.RendererHelper.on("showMsgToast",q),window.RendererHelper.on("hideMsgToast",A),window.RendererHelper.on("showDisconnectView",()=>{T.value=!0}),window.RendererHelper.on("hideDisconnectView",()=>{T.value=!1}),window.ProjectionRtcHelper.onMessageReceived((e,t)=>{try{let n=JSON.parse(t==null?void 0:t.msgBody);if(n!=null&&n.endProjection){let s=window.ProjectionRtcHelper.isShowScreen()?"超级黑板端已结束您的此次展示":"超级黑板端已结束您的此次投屏";window.RendererHelper.alert(s),R()}}catch(n){console.error("parse message body error:",n)}})},O=async e=>{await g.joinChannel(S,e)?(window.ProjectionRtcHelper.setAutoSubscribeAudio(!1),await g.startScreenShare(e)==0?K(1,h,e):window.close()):window.close()},X=async()=>{await g.stopScreenShare(l)},Y=()=>{window.RendererHelper.confirm("确认结束投屏？",{okBtn:"结束",cancelBtn:"取消",okClick:()=>{R()}})},R=()=>{X(),g.release(),re(()=>{window.close()})},z=e=>{d(!1)},F=()=>{d(!1)},U=()=>{d(!0)},d=e=>{i!==e&&(e?(console.log("currentWindow.setIgnoreMouseEvents(true, { forward: true });"),window.RendererHelper.setIgnoreMouseEvents(!0,{forward:!0})):(console.log("currentWindow.setIgnoreMouseEvents(false);"),window.RendererHelper.setIgnoreMouseEvents(!1)),i=e)};function J(e,t,n){if(!e)return!1;let s=e.getBoundingClientRect();return t>s.left&&t<s.right&&n>s.top&&n<s.bottom}function G(e,t){J(document.querySelector("#projectionBox"),e,t)&&d(!1)}window.RendererHelper.getPlatform()=="darwin"&&setInterval(async()=>{let e=await window.RendererHelper.getMousePointInWindow();G(e.x,e.y)},800);const K=(e,t,n)=>{window.RendererHelper.setTempStore("startScreenOffline",{screenStatus:e,type:t,channelCode:n})};return(e,t)=>(D(),W(se,null,[u("div",{class:c(p(o).e("popBox"))},null,2),u("div",{onMouseenter:F,onMousemove:z,onMouseleave:U},[ie(ae,{class:c({isTopSide:P.value,isLeftSide:C.value,isBottomSide:x.value,isRightSide:B.value}),onMousedown:L,id:"projectionBox",title:"正在投屏中","end-text":"结束投屏",onHandlerEndClick:Y},null,8,["class"])],32)],64))}});export{he as default};
