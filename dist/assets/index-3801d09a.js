import{a as R,r as a,o as I,b as m,e as o,m as r,f as d,F as U,_ as $,z as j,A as B,l as w,q as D}from"./index-26603ea5.js";import{P as q}from"./index-2e182bac.js";import"./index-94663b0f.js";const u=s=>(j("data-v-e8a414c4"),s=s(),B(),s),E={class:"audio-call-container"},N=u(()=>o("div",{id:"callTime",class:"call-time-text"},null,-1)),W={class:"call-main-content"},z=["src"],F={class:"call-status-text"},O={class:"call-username"},G={class:"call-status"},L={id:"promptMessage",class:"call-prompt-message"},J={class:"call-control-buttons2"},K=u(()=>o("span",null,"接听",-1)),Q=u(()=>o("span",null," 静音",-1)),X=u(()=>o("audio",{id:"ringPlayer",src:"hview://files/call_ring.mp3",loop:""},null,-1)),Y=`
  width: 100%;
  --icon-hover-bg: rgba(255, 255, 255, 0.1);
`,Z=R({__name:"index",setup(s){const t=a({toUser:{puid:"",uid:"",name:"",pic:""},state:0,endReson:0,role:0,sdkType:0,callId:"",channelName:"",callerDevId:"",calleeDevId:"",startCallToTime:0,connectCallTime:0}),g=a(""),v=a("正在等待"),p=a(""),_=a(!1);I(async()=>{window.MainWindowHelper.useMode("AVCall"),window.AudioVideoCallHelper.initCallView(),V()}),window.RendererHelper.on("showAudioCallMessage",e=>{p.value=e}),window.RendererHelper.on("hideAudioCallMessage",()=>{p.value=""});let h=0;window.RendererHelper.on("audioCallStartTimer",e=>{const l=document.getElementById("callTime");h=e,setInterval(()=>{let n=Date.now()-h;l.innerHTML=b(n)},1e3)}),window.RendererHelper.on("updateAudioCallView",e=>{console.log("updateAudioCallView",e),t.value=Object.assign(t.value,e),g.value=e.toUser.pic,e.state===4&&i()}),window.RendererHelper.on("updateAudioCallStatusText",e=>{console.log("updateSatusText",e),v.value=e});const C=function(){i(),window.AudioVideoCallHelper.cancelAudioCall()},f=function(){i(),window.AudioVideoCallHelper.rejectCall()},y=function(){window.AudioVideoCallHelper.endAudioCall()},A=function(){t.value.state===4?y():t.value.role===0?C():f(),setTimeout(()=>{window.close()},100)},S=function(){i(),window.AudioVideoCallHelper.answerCall()},T=function(e){let l=window.AudioVideoCallHelper.muteAudio(e);l===0?_.value=e:console.error("静音操作失败，错误码:",l)},H=function(){window.AudioVideoCallHelper.closeWindow()},V=function(){const e=document.querySelector("audio#ringPlayer");e&&e.play().catch(l=>{console.error("播放铃声失败:",l)})},i=function(){const e=document.querySelector("audio#ringPlayer");e&&(e.pause(),e.currentTime=0)};function b(e){let l=Math.floor(e/1e3),n=Math.floor(l/3600);l%=3600;let c=Math.floor(l/60),M=l%60;const x=String(n).padStart(2,"0"),k=String(c).padStart(2,"0"),P=String(M).padStart(2,"0");return`${x}:${k}:${P}`}return(e,l)=>{const n=$;return w(),m(U,null,[o("div",E,[N,r(q,{btnGroup:["close","minimize","topUp"],style:Y,"on-close":H}),o("div",W,[o("img",{src:t.value.toUser.pic,class:"call-user-avatar"},null,8,z),o("div",F,[o("h2",O,d(t.value.toUser.name),1),o("p",G,d(v.value),1)])]),o("div",L,d(p.value),1),o("div",J,[t.value.role==1&&t.value.state!=4?(w(),m("button",{key:0,class:"call-control-btn",onClick:l[0]||(l[0]=c=>S())},[r(n,{"icon-class":"call/icon_call_answer",class:"call-icon",width:"56",height:"56"}),K])):(w(),m("button",{key:1,class:"call-control-btn",onClick:l[1]||(l[1]=c=>T(!_.value))},[r(n,{"icon-class":`call/icon_call_mute${_.value?"_activity":""}`,class:"call-icon",width:"56",height:"56"},null,8,["icon-class"]),Q])),o("button",{class:"call-control-btn",onClick:l[2]||(l[2]=c=>A())},[r(n,{"icon-class":"call/icon_call_reject",class:"call-icon",width:"56",height:"56"}),o("span",null,d(t.value.role==1||t.value.state==4?"挂断":"取消"),1)])])]),X],64)}}});const te=D(Z,[["__scopeId","data-v-e8a414c4"]]);export{te as default};
