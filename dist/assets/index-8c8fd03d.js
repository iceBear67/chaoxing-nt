import"./base-82955267.js";/* empty css                     */import{a as K,u as Q,s as X,r as u,C as Y,o as Z,c as ee,b as l,e as n,f as i,h as r,m as T,I as H,y as U,n as se,l as c,F as oe,g as te,p as g,J as M,k as ae,N as ne,q as ie}from"./index-26603ea5.js";import{M as re}from"./message-4d42f580.js";import{u as B}from"./index-46519fef.js";import{T as v,c as D}from"./index-b0b4f58c.js";import{M as le}from"./index-ab028c07.js";import{M as ce}from"./index-403401b5.js";import{i as S}from"./type-6514e97f.js";import{s as h}from"./message-fe5b63d1.js";import{D as de}from"./index-d3d722e6.js";import{E as pe}from"./index-853a0f6e.js";import"./_commonjsHelpers-de833af9.js";import"./lodash-4dfbea43.js";import"./validate-f7672251.js";import"./index-94663b0f.js";import"./forward-bb18e89e.js";import"./index-9c66cebd.js";import"./el-input-983a785f.js";import"./index-952b158c.js";import"./icon-803f5cc0.js";import"./typescript-defaf979.js";import"./index-15f48857.js";import"./_baseGet-ad9634b7.js";import"./event-9519ab40.js";import"./use-form-common-props-325f2441.js";import"./index-08289d2b.js";import"./constants-84857360.js";import"./index-12f9ba11.js";import"./aria-60e0cdc6.js";import"./index-e5f0a9f0.js";import"./el-popper-548470bb.js";import"./index-57013d5d.js";import"./createAttachment-a64a5f42.js";import"./index.vue_vue_type_style_index_0_lang-dfb9c5c0.js";/* empty css                                                              *//* empty css                   */import"./index-7e6c4fb9.js";import"./vnode-45baa450.js";import"./use-global-config-c67545e0.js";import"./index-f81182f6.js";/* empty css                                                              */const ue=["onContextmenu"],ge={class:"group_header"},me={class:"type"},_e={class:"group_content"},fe=["onClick"],ve=["src"],he={class:"item_content"},ye={key:0,class:"item_flag"},we={class:"name"},ke={key:0,class:"dot"},xe={class:"time"},be={key:1,class:"invite_info"},Ie=["onClick"],Ce={key:2,class:"invite_info"},Me=["onClick"],Se=["onClick"],$e={class:"item_btn"},Re={key:0,class:"waiting"},Ve=["onClick"],Le=["onClick"],Pe={key:1,class:"reject common_btn"},Te={key:2,class:"agree common_btn"},He={key:0,class:"empty"},Ue={class:"dialog-content"},Be=K({__name:"index",setup(De){const{t}=Q(),G=ne(),y=re(),{getUserInfo:w}=X(y),p=u([]),W=u(10),m=u(1),k=u(!1),_=u(!1),$=u(),f=u(!1);let R="";function q(){f.value=!1}function z(){window.open(R),f.value=!1}Y(()=>G.query,e=>{e&&(e!=null&&e.t)&&x()}),Z(()=>{x()});const J=e=>{e.preventDefault(),document.body.click();const o=[];o.push([{name:t("message.refresh"),handler:()=>{a(),x()}}]);const{destroy:a}=D(ce,{menuList:o,left:e==null?void 0:e.x,top:e==null?void 0:e.y});B.windowClickOnce(a)},x=()=>{k.value=!1,_.value=!1,m.value=1,p.value=[],P()},A=e=>{(e.msgtype==4||e.msgtype==3)&&b(e)},b=e=>{console.log(`[groupInvitation][toGroupDetail] call [gid=${e.gid}]`),e.isread=1,window.MainWindowHelper.genRequest({baseUrl:"https://groupyd.chaoxing.com",url:"/apis/circle/getCircle",getParams:{puid:w.value.puid,maxW:256,circleId:e.gid},postParams:{},tokenSign:!0}).then(o=>{var a;S(o)?window.open(`https://groupweb.chaoxing.com/pc/topic/topiclist/index?bbsid=${(a=o==null?void 0:o.data)==null?void 0:a.bbsid}`):console.error(`[groupInvitation][toGroupDetail] res: ${h(o)}`)})},F=async e=>{const o=await window.RendererHelper.getMousePointInWindow(),a=await window.RendererHelper.getMousePointInScreen(),{width:s,height:d}=await window.RendererHelper.getScreenWorkArea(),I=a.x+340>s?o.x-340:o.x,C=a.y+200>d?o.y-200:o.y;window.RendererHelper.openWindow("sview:/#/personalCard",{width:340,height:200,resizable:!1,marginLeft:I,marginTop:C,subWindow:!0,frame:!1,id:"id_PersonInfoWindow"},{myPuid:y.getUserInfo.puid,puid:e.sender})},N=()=>{const{destroy:e}=D(le,{title:t("message.reminder"),content:t("message.allVerificationMessagesCleared"),cancelBtn:{text:t("message.cancel"),callback(){e()}},confirmBtn:{text:t("message.clear"),callback(){O(),e()}}})},j=ee(()=>e=>{let o="";switch(e.msgtype){case 1:o=`${t("message.invitation")}: ${e.msg||t("message.notavailable")}`;break;case 2:o=`${t("message.vinformation")}: ${e.msg||t("message.notavailable")}`;break;case 3:o=`${e.msg}`;break;case 4:o=`${e.msg}`;break;default:o=`${e.msg}`;break}return o}),E=()=>{!_.value&&!k.value&&se(()=>{const e=$.value;e.wrapRef.scrollHeight-e.wrapRef.scrollTop-e.wrapRef.clientHeight<=100&&(m.value++,P())})},O=()=>{console.log("[groupInvitation][delUserValidateMsg] call");let e={baseUrl:"https://learn.chaoxing.com",url:"/apis/user/delUserValidateMsgV2",getParams:{receive:w.value.puid,op:1,cataids:2},postParams:{},tokenSign:!0};window.MainWindowHelper.genRequest(e).then(o=>{o.result==1?(p.value=[],v({content:t("message.successfulOperation"),zIndex:2024,duration:2e3})):console.error(`[groupInvitation][delUserValidateMsg] res: ${h(o)}`)})},V=(e,o)=>{console.log("[groupInvitation][updateValidateMsgStatus] call"),e.isread=1,window.MainWindowHelper.genRequest({baseUrl:"https://learn.chaoxing.com",url:"/apis/user/updateValidateMsgStatus",getParams:{mid:e.id,status:o,vs:1},postParams:{},tokenSign:!0}).then(a=>{var s;if(S(a))e.status=o,e.isread=1,v({content:o==1?t("message.JointheCommunitySuccess"):t("message.successfulOperation"),zIndex:2024,duration:2e3});else if(console.error(`[groupInvitation][updateValidateMsgStatus] res: ${h(a)}`),(s=a.data)!=null&&s.showPersonLimitTips){const{personLimitApplicationUrl:d,maxPersonLimit:I,approvalAllowedPersonLimit:C}=a.data;e.msgtype===2&&(I<C?(R=d,f.value=!0):L(t("groupInvitation.groupJoinFailedByMaxLimit")))}else L(a.errorMsg)})};function L(e){v({content:e,zIndex:2024,duration:2e3})}const P=()=>{console.log("[groupInvitation][getGroupInviteList] call"),_.value=!0,window.MainWindowHelper.genRequest({baseUrl:"https://learn.chaoxing.com",url:"/apis/user/getUserValidateMsgs",getParams:{puid:w.value.puid,cataids:"2",status:"0,-1,1,2,-2,3,4",clearMsgByCataid:1,cpage:m.value,pageSize:W.value},postParams:{},tokenSign:!0}).then(e=>{var o,a;if(S(e)){if(p.value.push(...(o=e.data)==null?void 0:o.list),k.value=((a=e.data)==null?void 0:a.pageCount)<=m.value,p.value.length){const s=p.value[0];y.setGroupInviteTime(s==null?void 0:s.sendtime)}}else console.error(`[groupInvitation][getGroupInviteList] res: ${h(e)}`),v({content:e.errorMsg,zIndex:2024,duration:2e3})}).finally(()=>{_.value=!1})};return(e,o)=>{const a=pe;return c(),l("div",{class:"group",onContextmenu:U(J,["stop"])},[n("div",ge,[n("div",me,i(r(t)("message.groupInvitation")),1),n("div",{class:"clear_btn",onClick:N},i(r(t)("message.clear")),1)]),n("div",_e,[T(a,{ref_key:"ScrollbarRef",ref:$,onScroll:E},{default:H(()=>[(c(!0),l(oe,null,te(p.value,s=>(c(),l("div",{key:s.id,class:"group_item"},[n("div",{class:"avator",onClick:U(d=>F(s),["stop"])},[n("img",{src:s.senderlogo,alt:""},null,8,ve)],8,fe),n("div",he,[s.status==0?(c(),l("div",ye,i(s.cataname),1)):g("",!0),n("div",we,[M(i(s.msgtype==4?s.name:s.sendername)+" ",1),s.isread?g("",!0):(c(),l("span",ke))]),n("div",xe,i(r(B).timeago(s.sendtime,!0)),1),s.msgtype==1?(c(),l("div",be,[M(i(r(t)("message.InvitesJoinGroup"))+": ",1),n("span",{class:"group_name",onClick:d=>b(s)},i(s.gname),9,Ie)])):g("",!0),s.msgtype==2?(c(),l("div",Ce,[M(i(r(t)("message.applyTojoin"))+": ",1),n("span",{class:"group_name",onClick:d=>b(s)},i(s.gname),9,Me)])):g("",!0),n("div",{class:"invite_desc",style:ae({cursor:s.msgtype==4||s.msgtype==3?"pointer":""}),onClick:d=>A(s)},i(r(j)(s)),13,Se)]),n("div",$e,[s.status==0?(c(),l("div",Re,[n("div",{class:"refuse_btn",onClick:d=>V(s,-1)},i(r(t)("message.refuse")),9,Ve),n("div",{class:"agree_btn",onClick:d=>V(s,1)},i(r(t)("message.Agree")),9,Le)])):(s.status==-1||s.status==-2)&&(s.msgtype==1||s.msgtype==2)?(c(),l("div",Pe,i(r(t)("message.refused")),1)):(s.status==1||s.status==2||s.status==4)&&(s.msgtype==1||s.msgtype==2)?(c(),l("div",Te,i(r(t)("message.accepted")),1)):g("",!0)])]))),128)),p.value.length?g("",!0):(c(),l("div",He,i(r(t)("message.currentlyVerificationMessage")),1))]),_:1},512)]),T(de,{visible:f.value,title:r(t)("groupInvitation.dialogTitle"),"confirm-text":r(t)("groupInvitation.confirm"),"close-text":r(t)("groupInvitation.cancel"),onClose:q,onConfirm:z},{default:H(()=>[n("div",Ue,i(r(t)("groupInvitation.groupJoinFailedByLimit")),1)]),_:1},8,["visible","title","confirm-text","close-text"])],40,ue)}}});const Ss=ie(Be,[["__scopeId","data-v-30d7fe96"]]);export{Ss as default};
