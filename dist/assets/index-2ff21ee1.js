import"./base-82955267.js";/* empty css                     */import{a as N,H as j,r as o,c as q,o as V,b as p,e as a,j as E,f as n,h as f,m as W,I as $,l as L,F as S,g as C,w as R,v as T,q as z}from"./index-26603ea5.js";import{u as D}from"./index-46519fef.js";import{_ as A}from"./lodash-4dfbea43.js";import{E as O}from"./index-853a0f6e.js";import"./_commonjsHelpers-de833af9.js";import"./index-9c66cebd.js";import"./index-15f48857.js";import"./_baseGet-ad9634b7.js";const P={class:"tab_header"},G={class:"tab_content"},J={class:"img"},K=["src"],Q={class:"content"},X={class:"name"},Y={class:"time"},Z={class:"img"},ee=["src"],te={class:"content"},se={class:"name"},ae=N({__name:"index",setup(ie){const y=j.global.t,t=o({readList:[],memberList:[],oldMemberList:[]}),d=o(1);t.value=window.RendererHelper.getInitData()||{readList:[],memberList:[],oldMemberList:[]};const M=o(),B=o([]),h=o([]),w=o([]),U=q(()=>i=>D.getLocalUserAvatar({puid:i})),F=i=>{let r=h.value.find(l=>l.uid==i);return r?r.name:""};V(async()=>{var m,v,_;M.value.focus(),t.value.readList=t.value.readList.sort((e,s)=>(s==null?void 0:s.time)-(e==null?void 0:e.time));let i=t.value.readList.map(e=>String(e.fromUid));const r=(m=t.value.memberList)==null?void 0:m.map(e=>e.uid);let l=[],b=(v=t.value.oldMemberList)==null?void 0:v.filter(e=>!r.includes(e)),g=i.filter(e=>!r.includes(e));l=[...new Set(b.concat(g))],l.length&&(B.value=await window.RendererHelper.getUsersByTuids(l.join(","))||[]),h.value=A.uniqBy(B.value.concat(t.value.memberList),"uid");let c=(_=t.value.oldMemberList)!=null&&_.length?t.value.oldMemberList.filter(e=>!i.includes(e)):t.value.memberList.filter(e=>!i.includes(e.uid)).map(e=>e.uid),u=[];h.value.forEach(e=>{e.uid&&c.includes(String(e.uid))&&u.push(e)}),w.value=u,console.log(w.value,i,c)});const k=i=>{d.value=i};let x=null;const H=()=>{x=setTimeout(()=>{window.RendererHelper.closeWindow("previewReadList")},300)},I=()=>{x&&clearTimeout(x)};return(i,r)=>{var b,g,c,u,m,v,_,e;const l=O;return L(),p("div",{ref_key:"contanier",ref:M,class:"read-list",tabindex:"1",onFocus:I,onBlur:H},[a("div",P,[a("div",{class:E(["tab_item",d.value==1?"active":""]),onClick:r[0]||(r[0]=s=>k(1))},n(f(y)("message.read"))+"("+n(((g=(b=t.value)==null?void 0:b.readList)==null?void 0:g.length)||0)+")",3),a("div",{class:E(["tab_item",d.value==0?"active":""]),onClick:r[1]||(r[1]=s=>k(0))},n(f(y)("message.unread"))+"("+n(Math.max((((u=(c=t.value)==null?void 0:c.oldMemberList)==null?void 0:u.length)||((v=(m=t.value)==null?void 0:m.memberList)==null?void 0:v.length))-(((e=(_=t.value)==null?void 0:_.readList)==null?void 0:e.length)||0),0))+")",3)]),a("div",G,[W(l,null,{default:$(()=>[(L(!0),p(S,null,C(t.value.readList,s=>R((L(),p("div",{class:"read_member_item",key:s.fromUid},[a("div",J,[a("img",{src:f(U)(s.fromPuid),alt:""},null,8,K)]),a("div",Q,[a("div",X,n(F(s.fromUid)),1),a("div",Y,n(f(D).parseDateFull(Number(s.time),!0)),1)])])),[[T,d.value==1]])),128)),(L(!0),p(S,null,C(w.value,s=>R((L(),p("div",{class:"read_member_item",key:s.uid},[a("div",Z,[a("img",{src:f(U)(String(s.puid)),alt:""},null,8,ee)]),a("div",te,[a("div",se,n(s.name),1)])])),[[T,d.value==0]])),128))]),_:1})])],544)}}});const pe=z(ae,[["__scopeId","data-v-6190bc5a"]]);export{pe as default};
