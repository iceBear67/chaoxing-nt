import{a as I,r,C as M,o as D,n as V,b as u,w as b,v as E,e as t,p as S,f as m,F as B,z as F,A as N,l as w,q as T}from"./index-26603ea5.js";const R=i=>(F("data-v-7d2ff570"),i=i(),N(),i),L={class:"rtcView",id:"rtcView"},U={key:0,class:"pauseSharing"},A=R(()=>t("i",null,null,-1)),O=R(()=>t("p",null,"对方已暂停共享",-1)),$=[A,O],z={key:1,class:"promoter"},J={key:2,class:"dialog"},Q=R(()=>t("div",{class:"header"},"屏幕广播",-1)),W={class:"main"},q={class:"footer"},G=I({__name:"index",setup(i){const s=r(!1),_=r(!1),a=r(3),c=r(""),p=r(!1);let v;M(a,e=>{e==0&&(clearInterval(v),window.RendererHelper.emit("startLockScreenForMeet"),s.value=!1,p.value=!0)}),window.RendererHelper.exitFullScreenWithEsc(!1);const C=()=>{clearInterval(v),console.log("chufal"),s.value=!1,window.RendererHelper.emit("startLockScreenForMeet"),p.value=!0};let h,f,l;const g=r(!1);D(async()=>{let e=await window.RendererHelper.getInitDataAsync();if(!e){window.close();return}if(c.value=e.name,console.log("显示倒计时弹窗",c.value),s.value=!0,v=setInterval(()=>{a.value>0&&(a.value--,console.log("num",a.value))},1e3),h=e.meetCode,f=await window.RendererHelper.getUID(),h===""||f===""){window.RendererHelper.alert("连接失败，请切换网络后重试");return}P(),document.addEventListener("contextmenu",o=>{o.preventDefault()}),await k(h)});const P=()=>{window.RendererHelper.on("CMD_MEET_RTC_STU_SCREEN",async e=>{if(!e||!e.data)return;let o=e.data;o.ignoreCmd!=1&&o.type==="unBroadcastScreen"&&d()}),window.RendererHelper.on("showDisconnectView",()=>{g.value=!0}),window.RendererHelper.on("hideDisconnectView",()=>{g.value=!1}),window.RendererHelper.on("screenSharePaused",e=>{_.value=e}),window.ProjectionRtcHelper.onScreenSharePaused((e,o,n)=>{_.value=n}),window.ProjectionRtcHelper.onMessageReceived((e,o)=>{try{let n=JSON.parse(o==null?void 0:o.msgBody);n!=null&&n.endProjection&&d()}catch(n){console.error("parse message body error:",n)}})},k=async e=>{window.ProjectionRtcHelper.onRemoteScreenShareStateChanged((o,n,j)=>{if(!j){n+""==l+""&&d();return}l||(l=n,window.ProjectionRtcHelper.subscribeVideo(o,n,document.querySelector("#rtcView"),!0),window.ProjectionRtcHelper.onNetworkQualityChanged(n,(x,H,y)=>{H>4||y>4?(console.log(`共享人当前网络不佳:${x} tx:${H} rx:${y}`),window.ProjectionRtcHelper.toastMsgLong("共享人当前网络不佳...")):window.ProjectionRtcHelper.hideToastMsg()}))}),window.ProjectionRtcHelper.onUserOffline((o,n)=>{n+""==l+""&&d()}),await window.ProjectionRtcHelper.joinChannel({puid:f,channelCode:e,channelOptions:{autoSubscribeAudio:!0}})},d=()=>{window.ProjectionRtcHelper.releaseSdk(),V(()=>{window.close()})};return(e,o)=>(w(),u(B,null,[b(t("div",L,null,512),[[E,!s.value]]),_.value?(w(),u("div",U,$)):S("",!0),p.value?(w(),u("div",z,m(c.value)+"的屏幕",1)):S("",!0),s.value?(w(),u("div",J,[Q,t("div",W,"即将观看"+m(c.value)+"的屏幕广播",1),t("div",q,[t("div",{onClick:C},"立即观看("+m(a.value)+")",1)])])):S("",!0)],64))}});const X=T(G,[["__scopeId","data-v-7d2ff570"]]);export{X as default};
